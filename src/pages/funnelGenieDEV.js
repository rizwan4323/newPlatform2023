import React from 'react';
import webConfig from './../../webConfig';
import withAuth from '../hoc/withAuth';
import { Helmet } from 'react-helmet';
import { UPDATE_FUNNELGENIE_PAGE_SETTING, SEND_MESSAGE } from '../queries';
import { Mutation } from 'react-apollo';
import toastr from 'toastr';
import Header from '../components/headerFunnelGenie';
import Loading from '../components/loading';
import Input from '../components/input';
import Modal from '../components/ModalComponent';
import CryptoJS from 'crypto-js';
import ComponentCountry from '../components/countryList';
// import fs from "fs";
// let fs = require('fs');
let ShortId = require('id-shorter');
let mongoDBId = ShortId({ isFullId: true });

const condition = require('../../Global_Conditions');
const points = require('../../Global_Values');
const editorTools = require('../../Editor_Tools');
const currencyGlobal = require('../../Global_Currency.json');

let user_id = "";

class FunnelGenieDEV extends React.Component {
    constructor(props) {
        super();
        this.state = {
            saveAsJSON: "",
            saveAsHTML: "",
            pageID: "",
            selectedIndex: -1,
            page_data: null,
            display: 'none',
            enableLoader: false,
            isPublish: false,

            // thank you page klaviyo   
            klaviyoPK: '',
            orderConfirmation: '',
            cartAbandonment: '',

            selectedPageID: "",
            selectedModalAction: "",

            isPageFullyLoaded: false,
            isSaving: false,

            // for approving cod product
            show_approve_button: false,
            show_approve_modal: false,
            product_link: ""
        }
    }

    encryptString(str){
        return CryptoJS.AES.encrypt(str, points.plg_domain_secret).toString();
    }

    decryptString(str){
        if(!str) return "";
        try {
            var bytes = CryptoJS.AES.decrypt(str, points.plg_domain_secret);
        return bytes.toString(CryptoJS.enc.Utf8);    
        } catch (error) {
            console.log('error decrypting the keys for paypal v1, giving way to paypal v2')
        }
        
    }

    componentWillMount() {
        user_id = this.props.session.getCurrentUser.id;
        // user_id = "5c0a85f0773001327b03904c"; // para pumasok sa order ko sa live (tech@themillionairemastermind.com)
    }

    componentDidMount() {
        toastr.options = {
            "progressBar": true,
            "closeButton": true,
            "debug": false,
            "newestOnTop": true,
            "positionClass": "toast-bottom-right",
            "preventDuplicates": false,
            "timeOut": 3000,
            "extendedTimeOut": 2000,
            "showEasing": "swing",
            "hideEasing": "linear",
            "showMethod": "fadeIn",
            "hideMethod": "fadeOut"
        }

        window.encodeID = (str) => {
            return mongoDBId.encode(str);
        }

        var params = this.props.location.state;
        if (!params) {
            window.location.href = "/funnel-genie-main"
        } else {
            // start restructure params
            this.props.location.state.pageList = params.pages;
            this.props.location.state.pages = params.pages.map(el => el.complete_path);
            // end restructure params
            console.log("Load Split Design ==>", params.splitEdit ? params.splitEdit : false)
            const payload = { query: `query($page_id: String!, $include_funnel_setting: Boolean){ getFunnelPageById(page_id: $page_id, include_funnel_setting: $include_funnel_setting){ id funnel_id funnel_type path page_type page_enable_loader page_selected_modal_action page_is_root page_title page_description page_og_image_link page_keyword split_design published_page_id funnel_header_analytics funnel_footer_analytics design { date publish json screenshot_url } domain_name funnel_name is_cod_funnel funnel_use_email_confirmation funnel_use_email_abandonment is_fulfill_by_plg funnel_is_phone_whatsapp funnel_enable_floating_bar funnel_enable_floating_bar_link funnel_phone funnel_email funnel_currency funnel_address funnel_favicon_link funnel_facebook_id funnel_facebook_access_token funnel_google_id  funnel_everflow funnel_snapchat_id funnel_pixel_id gateway_selected_merchant gateway_stripe_public gateway_stripe_private gateway_other gateway_paypal_client_id integration_confirmation_email integration_abandonment_email integration_tracking_email funnel_integration } }`, variables: { page_id: params.id, include_funnel_setting: true } }
            points.customFetch('/graphql', 'post', payload, result => {
                if (result) {
                    // if(!result.data.getFunnelPageById.page_type) points.toastrPrompt(toastr, "warning", "Go back to your " + points.capitalizeAndSerializeWord(result.data.getFunnelPageById.funnel_name) + " " + points.capitalizeAndSerializeWord(result.data.getFunnelPageById.path) + " page settings and set the page type.", "Invalid Type");
                    this.setState({
                        selectedPageID: params.id,
                        page_data: result.data.getFunnelPageById,
                        enableLoader: result.data.getFunnelPageById.page_enable_loader,
                        selectedModalAction: result.data.getFunnelPageById.page_selected_modal_action
                    }, () => {
                        var integrationPayload = { "query": "{\n  getMyIntegrations(id: \"" + user_id + "\", merchant_type: \"klaviyo\"){\n    id\n    merchant_type\n    merchant_name\n    public_key\n    private_key\n    other\n  }\n}\n", "variables": null, "operationName": null };
                        points.customFetch('/graphql', 'post', integrationPayload, integrationResult => {
                            if(integrationResult) {
                                var klaviyoObject = integrationResult.data.getMyIntegrations;
                                if(klaviyoObject && klaviyoObject.length != 0){
                                    this.setState({
                                        klaviyoPK: this.decryptString(klaviyoObject[0].private_key),
                                        orderConfirmation: this.state.page_data.integration_confirmation_email,
                                        cartAbandonment: this.state.page_data.integration_abandonment_email
                                    }, () => {
                                        this.initializeEditor(params);
                                    })
                                } else {
                                    this.initializeEditor(params);
                                }
                            }
                        })
                    })
                } else {
                    toastr.options.timeOut = 0;
                    toastr.options.extendedTimeOut = 0;
                    toastr.clear();
                    toastr.error("Make sure to have strong connection or the funnel page you request does not exist.", "Funnel Page Not found");
                    toastr.options.timeOut = 3000;
                    toastr.options.extendedTimeOut = 2000;
                }
            })
        }
    }

    hide_show_loading(){
        if(document.getElementById("upsell_loading")){
            document.getElementById("upsell_loading").remove();
        } else {
            var xx = `
                <div style="position: fixed; width: 100%; height: 100vh; overflow: scroll; z-index: 9999; top: 0;">
                    <div style="align-items: center;display: flex;flex-direction: column;margin: auto;min-height: 100%;justify-content: center;background-color: #00000078;">
                        <div style="display: flex;align-items: center; padding: 100px 40px; background-color: #ffffff;" class="product-card">
                            <div style="min-width: 320px; max-width: 700px;" class="funnel text-center">
                                <div style="display: flex; align-items: center; position: relative;">
                                    <style>
                                        #toast-container { left: 41% !important; }
                                        .st3 { transform-origin: center; transform-box: fill-box; }
                                        .st3.first { -webkit-animation: rotate-center 10s linear infinite both; animation: rotate-center 10s linear infinite both; }
                                        .st3.second {-webkit-animation: rotate-center 7s linear infinite reverse both; animation: rotate-center 7s linear infinite reverse both}
                                        .st3.third { -webkit-animation: rotate-center 3s linear infinite both; animation: rotate-center 3s linear infinite both; }
                                        @-webkit-keyframes rotate-center { 0% { -webkit-transform: rotate(0); transform: rotate(0); } 100% { -webkit-transform: rotate(360deg); transform: rotate(360deg); } }
                                        @keyframes rotate-center { 0% { -webkit-transform: rotate(0); transform: rotate(0); } 100% { -webkit-transform: rotate(360deg); transform: rotate(360deg); } }
                                    </style>
                                    <svg style="width: 250px; position: absolute; left: calc(50% - 125px);" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 242 136" xml:space="preserve"> <style type="text/css"> .st00{fill:#E7FAF4;} </style> <g id="XMLID_11_"> <path id="XMLID_14_" class="st00" d="M146.5,75.5c0-7-5.7-12.7-12.7-12.7H12.7C5.7,62.8,0,68.5,0,75.5s5.7,12.7,12.7,12.7h121.2   C140.8,88.2,146.5,82.5,146.5,75.5z"></path> <path id="XMLID_17_" class="st00" d="M229.3,88.2h-81.2c-7,0-12.7,5.7-12.7,12.7c0,4.1,1.9,7.7,4.9,10h-4.7c-7,0-12.7,5.7-12.7,12.7   s5.7,12.7,12.7,12.7h66.7c7,0,12.7-5.7,12.7-12.7c0-4.1-1.9-7.7-4.9-10h19.2c7,0,12.7-5.7,12.7-12.7S236.3,88.2,229.3,88.2z"></path> <path id="XMLID_19_" class="st00" d="M12.7,25.7h37c-7,0-12.7,5.7-12.7,12.7S42.7,51,49.7,51h121.2c7,0,12.7-5.7,12.7-12.7   s-5.7-12.7-12.7-12.7h-37c7,0,12.7-5.7,12.7-12.7s-5.7-12.7-12.7-12.7H12.7C5.7,0.3,0,6,0,13S5.7,25.7,12.7,25.7z"></path> </g> </svg>
                                    <svg style="margin: 0 auto; width: 200px; z-index: 1;" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Capa_1" x="0px" y="0px" viewBox="-343 645 512 512" xml:space="preserve"> <style type="text/css"> .st0{fill:#FBFAF6;} .st1{fill:#D1EBE2;} .st2{fill:#10E69E;} .st3{fill:#F08808;} </style> <path class="st0" d="M47.3,857.7L-15,930.4c-19.2,22.4-47.3,35.4-76.9,35.4h-18.5c-35.8,0-64.9-29-64.9-64.9  c0-11.9,9.7-21.6,21.6-21.6c3.8,0,92.7,0,97.2,0c25.4,0,50.3-7.5,71.4-21.6H47.3z"></path> <g> <path class="st1" d="M-44.6,998.3H-170l3.8-1.6c16.6-6.6,30.1-18.4,38.8-33.1l0,0c5.4,1.5,11,2.2,16.8,2.2h18.5c2,0,4-0.1,5.9-0.2   v0.1c8.8,13.7,21.7,24.7,37.5,31L-44.6,998.3z"></path> <path class="st1" d="M-67.9,877.7l0.5,1.7h-86.5l0.5-1.7c6.1-18.4,23.3-30.8,42.7-30.8C-91.2,846.9-74,859.3-67.9,877.7z"></path> </g> <rect x="-125.9" y="810" transform="matrix(-0.7071 0.7071 -0.7071 -0.7071 394.8218 1487.0126)" class="st1" width="30.6" height="30.6"></rect> <path class="st2" d="M-89.1,938.8c-3,0-5.4,2.4-5.4,5.4c0,3,2.4,5.4,5.4,5.4c3,0,5.4-2.4,5.4-5.4C-83.7,941.2-86.1,938.8-89.1,938.8  z"></path> <path class="st2" d="M-11.1,933.9l62.3-72.7c1.4-1.6,1.7-3.8,0.8-5.8c-0.9-1.9-2.8-3.1-4.9-3.1H14.7c-1.1,0-2.1,0.3-3,0.9  c-20.3,13.5-44,20.7-68.4,20.7h-6.9c-6.2-16.1-19.8-27.4-35.4-31.1l13.7-13.7c2.1-2.1,2.1-5.5,0-7.6l-21.6-21.6  c-2.1-2.1-5.5-2.1-7.6,0l-21.6,21.6c-2.1,2.1-2.1,5.5,0,7.6l13.8,13.8c-16.1,3.8-29.6,15.4-35.5,31.4c-7.2,1.1-13.5,5-17.7,10.5  c-4.9-6.6-12.8-10.8-21.6-10.8h-0.6c-14.5,0-26.4,11.8-26.4,26.4v0.5c0,15.1,10.8,28.3,25.5,31.2c3,0.6,6.1,1.2,9.1,1.8  c4,0.8,7.4,3.4,9.2,7.1c1.8,3.7,1.8,7.9-0.1,11.6c-1.4,2.6-0.3,5.9,2.4,7.2c2.6,1.4,5.9,0.3,7.2-2.4c2.8-5.5,3.2-11.7,1.5-17.5  c8.1,12.1,19.7,21.4,33.3,26.6c-8.2,11.2-19.5,20-32.4,25.1l-3.8,1.6c-2.4,1-3.8,3.5-3.3,6.1c0.5,2.5,2.7,4.4,5.3,4.4h125.4  c2.6,0,4.8-1.8,5.3-4.4c0.5-2.5-0.9-5.1-3.3-6.1l-3.9-1.6c-11.7-4.6-21.8-12.1-29.7-21.6C-50.9,966.3-27.9,953.5-11.1,933.9z   M-110.7,811.3l14,14l-14,14l-13.9-14L-110.7,811.3z M-110.7,852.3c15.6,0,28.9,9,35.3,21.6H-146  C-139.3,860.8-125.7,852.3-110.7,852.3z M-187.4,923.3c-3-0.6-6.2-1.2-9.2-1.8c-9.8-1.9-16.9-10.6-16.9-20.6v-0.5  c0-8.6,7-15.6,15.6-15.6h0.6c8.9,0,16.2,7.3,16.2,16.2c0,10.4,2.3,20.5,6.5,29.7C-177.8,927-182.3,924.4-187.4,923.3z M-67.3,992.8  h-80.5c9-6.2,16.7-14,22.8-23.1c4.6,1,9.5,1.5,14.3,1.5h18.6c1,0,2.1,0,3.1-0.1C-83,979.7-75.7,987.1-67.3,992.8z M-92.1,960.4  h-18.5c-32.5,0-59.5-26.3-59.5-59.5c0-8.9,7.3-16.2,16.2-16.2c3.8,0,92.7,0,97.2,0c26,0,51.2-7.5,73-21.6h19.1l-54.8,63.8  C-37.3,947.9-63.7,960.4-92.1,960.4z"></path> <path class="st2" d="M-110.7,938.8c-20.9,0-37.8-17-37.8-37.8c0-3-2.4-5.4-5.4-5.4s-5.4,2.4-5.4,5.4c0,26.8,21.8,48.6,48.6,48.6  c3,0,5.4-2.4,5.4-5.4C-105.3,941.2-107.7,938.8-110.7,938.8z"></path> <image style="overflow:visible;enable-background:new    ;" width="1680" height="1051" xlink:href="11A4C7C.jpg" transform="matrix(0.9997 0 0 0.9997 -942.7753 1900.6387)"> </image> <path class="st3 first" d="M-304.5,809.1c11.9-28.1,28.9-53.3,50.6-75s46.9-38.7,75-50.6c29.1-12.3,60-18.5,91.9-18.5s62.8,6.2,91.9,18.5  c28.1,11.9,53.3,28.9,75,50.6s38.7,46.9,50.6,75c0.3,0.7,0.6,1.4,0.9,2.1h21.5C116.5,714.2,22.8,645-87,645s-203.5,69.2-239.8,166.3  h21.5C-305.1,810.6-304.8,809.8-304.5,809.1z M79.9,1067.9c-21.7,21.7-46.9,38.7-75,50.6c-29.1,12.3-60,18.5-91.9,18.5  s-62.8-6.2-91.9-18.5c-28.1-11.9-53.3-28.9-75-50.6c-15.8-15.8-29.1-33.5-39.8-52.8h-22.6C-274.3,1099.2-187.4,1157-87,1157  s187.3-57.8,229.2-141.9h-22.6C109,1034.4,95.7,1052.1,79.9,1067.9z"></path> <path class="st3 second" d="M14.3,712.5v17.2c14.3,8.5,27.5,18.7,39.4,30.6c18.3,18.3,32.6,39.6,42.7,63.3c10.4,24.5,15.6,50.6,15.6,77.5  s-5.3,52.9-15.6,77.5c-10,23.7-24.4,45-42.7,63.2c-11.9,11.9-25.1,22.2-39.4,30.6v17.2C81.4,1053.4,127,982.5,127,901  S81.4,748.6,14.3,712.5z M-301,901c0,76.3,39.9,143.3,100,181.1v-18c-9.5-6.6-18.4-14.1-26.7-22.4c-18.3-18.3-32.6-39.6-42.7-63.2  c-10.4-24.5-15.6-50.6-15.6-77.5s5.3-52.9,15.6-77.5c10-23.7,24.4-45,42.7-63.3c8.3-8.3,17.2-15.8,26.7-22.4v-18  C-261.1,757.8-301,824.7-301,901z"></path> <path class="st3 third" d="M-201.6,786.4c30.6-30.6,71.3-47.5,114.6-47.5s84,16.9,114.6,47.5c0.5,0.5,1.1,1.1,1.6,1.6h20.1  C16.9,748.8-32.1,723.9-87,723.9s-103.9,25-136.4,64.1h20.1C-202.7,787.5-202.2,786.9-201.6,786.4z M27.6,1015.6  c-30.6,30.6-71.3,47.5-114.6,47.5s-84-16.9-114.6-47.5l-0.6-0.6h-20.3c32.5,38.6,81.1,63,135.5,63s103-24.5,135.5-63H28.2  L27.6,1015.6z"></path> </svg>
                                </div>
                                <label class="header-medium-bold color-green" style=" font-size: 1.5em; margin-top: 20px; ">Please wait a moment</label> <br/>
                                <label>Please don't do any operation while publishing is on process</label>
                                <div class="green-loading-parent" style="width: 90%; overflow: hidden;margin-top: 20px;border-radius: 20px;background-color: #DAE5DE;">
                                    <div class="green-loading" style="height: 17px; background-color: #1ac594; width: 50%; transition: width 1s;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            var div = document.createElement("div");
            div.id="upsell_loading";
            div.innerHTML = xx;
            document.body.appendChild(div);
        }
    }

    async publishAllPages(updateFunnelPageList){
        var pageList = this.props.location.state.pageList;
        var index = 1;
        var domain = "https://"+this.state.page_data.domain_name;
        var websiteURL = domain+this.props.location.state.pages[0];
        toastr.options.timeOut = 0;
        toastr.options.extendedTimeOut = 0;
        this.hide_show_loading();
        for(const page of pageList){
            document.querySelector(".green-loading").style.width = (index / pageList.length * 100).toFixed(2)+"%" // update loading 
            toastr.clear();
            await new Promise(resolve => this.loadThisPage(page.id, resolve));
            await new Promise(resolve => this.updateFunnelPageList(updateFunnelPageList, false, resolve));
            toastr.clear();
            index += 1;
        }
        toastr.options.onclick = function () {
            window.open(websiteURL, '_blank');
        }
        toastr.clear();
        toastr.success("Click here to go to homepage.","Upload Success!");
        this.hide_show_loading();
    }

    loadThisPage(id, resolve){
        this.setState({ pageID: "" }, () => {
            document.getElementById("editor").innerHTML = "";
            const payload = { query: `query($page_id: String!, $include_funnel_setting: Boolean){ getFunnelPageById(page_id: $page_id, include_funnel_setting: $include_funnel_setting){ id funnel_id funnel_type path page_type page_enable_loader page_selected_modal_action page_is_root page_title page_description page_og_image_link page_keyword split_design published_page_id funnel_header_analytics funnel_footer_analytics design { date publish json screenshot_url } domain_name funnel_name is_cod_funnel funnel_use_email_confirmation funnel_use_email_abandonment is_fulfill_by_plg funnel_is_phone_whatsapp funnel_enable_floating_bar funnel_enable_floating_bar_link funnel_phone funnel_email funnel_currency funnel_address funnel_favicon_link  funnel_facebook_access_token funnel_google_id funnel_tiktok_id funnel_snapchat_id funnel_pixel_id gateway_selected_merchant gateway_stripe_public gateway_stripe_private gateway_other gateway_paypal_client_id integration_confirmation_email integration_abandonment_email integration_tracking_email funnel_integration } }`, variables: { page_id: id, include_funnel_setting: true } }
            points.customFetch('/graphql', 'post', payload, result => {
                if (result) {
                    // if(!result.data.getFunnelPageById.page_type) points.toastrPrompt(toastr, "warning", "Go back to your " + points.capitalizeAndSerializeWord(result.data.getFunnelPageById.funnel_name) + " " + points.capitalizeAndSerializeWord(result.data.getFunnelPageById.path) + " page settings and set the page type.", "Invalid Page Type");
                    this.setState({
                        selectedPageID: id,
                        page_data: result.data.getFunnelPageById,
                        enableLoader: result.data.getFunnelPageById.page_enable_loader,
                        selectedModalAction: result.data.getFunnelPageById.page_selected_modal_action
                    }, () => {
                        if(this.state.page_data.page_type == "checkout" || this.state.page_data.page_type == "thank-you-page"){
                            var integrationPayload = { "query": "{\n  getMyIntegrations(id: \"" + user_id + "\", merchant_type: \"klaviyo\"){\n    id\n    merchant_type\n    merchant_name\n    public_key\n    private_key\n    other\n  }\n}\n", "variables": null, "operationName": null };
                            points.customFetch('/graphql', 'post', integrationPayload, integrationResult => {
                                if(integrationResult) {
                                    var klaviyoObject = integrationResult.data.getMyIntegrations;
                                    if(klaviyoObject && klaviyoObject.length != 0){
                                        this.setState({
                                            klaviyoPK: this.decryptString(klaviyoObject[0].private_key),
                                            orderConfirmation: this.state.page_data.integration_confirmation_email,
                                            cartAbandonment: this.state.page_data.integration_abandonment_email
                                        }, () => {
                                            this.initializeEditor(params, resolve);
                                        })
                                    } else {
                                        this.initializeEditor(params, resolve);
                                    }
                                }
                            })
                        } else {
                            this.initializeEditor(params, resolve);
                        }
                    })
                } else {
                    toastr.options.timeOut = 0;
                    toastr.options.extendedTimeOut = 0;
                    toastr.clear();
                    toastr.error("Make sure to have strong connection or the funnel page you request does not exist.", "Funnel Page Not found");
                    toastr.options.timeOut = 3000;
                    toastr.options.extendedTimeOut = 2000;
                }
            })
        })
    }

    getSpainProvince(name){
        return `
        <div class="select-parent" id="state-dropdown">
            <select name="${name ? name : ''}state" placeholder="State"><option value="C">A Coruña</option><option value="VI">Álava</option><option value="AB">Albacete</option><option value="A">Alicante</option><option value="AL">Almería</option><option value="O">Asturias</option><option value="AV">Ávila</option><option value="BA">Badajoz</option><option value="PM">Balears</option><option value="B">Barcelona</option><option value="BU">Burgos</option><option value="CC">Cáceres</option><option value="CA">Cádiz</option><option value="S">Cantabria</option><option value="CS">Castellón</option><option value="CE">Ceuta</option><option value="CR">Ciudad Real</option><option value="CO">Córdoba</option><option value="CU">Cuenca</option><option value="GI">Girona</option><option value="GR">Granada</option><option value="GU">Guadalajara</option><option value="SS">Guipúzcoa</option><option value="H">Huelva</option><option value="HU">Huesca</option><option value="J">Jaén</option><option value="LO">La Rioja</option><option value="GC">Las Palmas</option><option value="LE">León</option><option value="L">Lleida</option><option value="LU">Lugo</option><option value="M">Madrid</option><option value="MA">Málaga</option><option value="ML">Melilla</option><option value="MU">Murcia</option><option value="NA">Navarra</option><option value="OR">Ourense</option><option value="P">Palencia</option><option value="PO">Pontevedra</option><option value="SA">Salamanca</option><option value="TF">Santa Cruz de Tenerife</option><option value="SG">Segovia</option><option value="SE">Sevilla</option><option value="SO">Soria</option><option value="T">Tarragona</option><option value="TE">Teruel</option><option value="TO">Toledo</option><option value="V">Valencia</option><option value="VA">Valladolid</option><option value="BI">Vizcaya</option><option value="ZA">Zamora</option><option value="Z">Zaragoza</option></select>
        </div>
        `
    }

    getStateList(name){
        return `
            <div class="select-parent" id="state-dropdown">
                <select name="${name ? name : ''}state" placeholder="State">
                    <option disabled="">State</option>
                    <option value="AL">Alabama</option>
                    <option value="AK">Alaska</option>
                    <option value="AS">American Samoa</option>
                    <option value="AZ">Arizona</option>
                    <option value="AR">Arkansas</option>
                    <option value="CA">California</option>
                    <option value="CO">Colorado</option>
                    <option value="CT">Connecticut</option>
                    <option value="DE">Delaware</option>
                    <option value="DC">District of Columbia</option>
                    <option value="FM">Federated States of Micronesia</option>
                    <option value="FL">Florida</option>
                    <option value="GA">Georgia</option>
                    <option value="GU">Guam</option>
                    <option value="HI">Hawaii</option>
                    <option value="ID">Idaho</option>
                    <option value="IL">Illinois</option>
                    <option value="IN">Indiana</option>
                    <option value="IA">Iowa</option>
                    <option value="KS">Kansas</option>
                    <option value="KY">Kentucky</option>
                    <option value="LA">Louisiana</option>
                    <option value="ME">Maine</option>
                    <option value="MH">Marshall Islands</option>
                    <option value="MD">Maryland</option>
                    <option value="MA">Massachusetts</option>
                    <option value="MI">Michigan</option>
                    <option value="MN">Minnesota</option>
                    <option value="MS">Mississippi</option>
                    <option value="MO">Missouri</option>
                    <option value="MT">Montana</option>
                    <option value="NE">Nebraska</option>
                    <option value="NV">Nevada</option>
                    <option value="NH">New Hampshire</option>
                    <option value="NJ">New Jersey</option>
                    <option value="NM">New Mexico</option>
                    <option value="NY">New York</option>
                    <option value="NC">North Carolina</option>
                    <option value="ND">North Dakota</option>
                    <option value="MP">Northern Mariana Islands</option>
                    <option value="OH">Ohio</option>
                    <option value="OK">Oklahoma</option>
                    <option value="OR">Oregon</option>
                    <option value="PW">Palau</option>
                    <option value="PA">Pennsylvania</option>
                    <option value="PR">Puerto Rico</option>
                    <option value="RI">Rhode Island</option>
                    <option value="SC">South Carolina</option>
                    <option value="SD">South Dakota</option>
                    <option value="TN">Tennessee</option>
                    <option value="TX">Texas</option>
                    <option value="UT">Utah</option>
                    <option value="VT">Vermont</option>
                    <option value="VI">Virgin Islands</option>
                    <option value="VA">Virginia</option>
                    <option value="WA">Washington</option>
                    <option value="WV">West Virginia</option>
                    <option value="WI">Wisconsin</option>
                    <option value="WY">Wyoming</option>
                    <option value="AA">Armed Forces Americas</option>
                    <option value="AE">Armed Forces Europe</option>
                    <option value="AP">Armed Forces Pacific</option>
                </select>
            </div>
        `
    }

    getCountryList(name){
        return `
            <div class="select-parent">
                <select name="${name ? name : ''}country" onchange="typeof checkSelectedCountry != 'undefined' ? checkSelectedCountry(this) : void 0">
                    <option value="USA" selected>United States</option>
                    <option disabled="">---</option>
                    <option value="AFG">Afghanistan</option>
                    <option value="ALA">Åland Islands</option>
                    <option value="ALB">Albania</option>
                    <option value="DZA">Algeria</option>
                    <option value="ASM">American Samoa</option>
                    <option value="AND">Andorra</option>
                    <option value="AGO">Angola</option>
                    <option value="AIA">Anguilla</option>
                    <option value="ATA">Antarctica</option>
                    <option value="ATG">Antigua and Barbuda</option>
                    <option value="ARG">Argentina</option>
                    <option value="ARM">Armenia</option>
                    <option value="ABW">Aruba</option>
                    <option value="AUS">Australia</option>
                    <option value="AUT">Austria</option>
                    <option value="AZE">Azerbaijan</option>
                    <option value="BHS">Bahamas</option>
                    <option value="BHR">Bahrain</option>
                    <option value="BGD">Bangladesh</option>
                    <option value="BRB">Barbados</option>
                    <option value="BLR">Belarus</option>
                    <option value="BEL">Belgium</option>
                    <option value="BLZ">Belize</option>
                    <option value="BEN">Benin</option>
                    <option value="BMU">Bermuda</option>
                    <option value="BTN">Bhutan</option>
                    <option value="BOL">Bolivia (Plurinational State of)</option>
                    <option value="BES">Bonaire, Sint Eustatius and Saba</option>
                    <option value="BIH">Bosnia and Herzegovina</option>
                    <option value="BWA">Botswana</option>
                    <option value="BVT">Bouvet Island</option>
                    <option value="BRA">Brazil</option>
                    <option value="IOT">British Indian Ocean Territory</option>
                    <option value="BRN">Brunei Darussalam</option>
                    <option value="BGR">Bulgaria</option>
                    <option value="BFA">Burkina Faso</option>
                    <option value="BDI">Burundi</option>
                    <option value="CPV">Cabo Verde</option>
                    <option value="KHM">Cambodia</option>
                    <option value="CMR">Cameroon</option>
                    <option value="CAN">Canada</option>
                    <option value="CYM">Cayman Islands</option>
                    <option value="CAF">Central African Republic</option>
                    <option value="TCD">Chad</option>
                    <option value="CHL">Chile</option>
                    <option value="CHN">China</option>
                    <option value="CXR">Christmas Island</option>
                    <option value="CCK">Cocos (Keeling) Islands</option>
                    <option value="COL">Colombia</option>
                    <option value="COM">Comoros</option>
                    <option value="COD">Congo (the Democratic Republic of the)</option>
                    <option value="COG">Congo</option>
                    <option value="COK">Cook Islands</option>
                    <option value="CRI">Costa Rica</option>
                    <option value="CIV">Côte d'Ivoire</option>
                    <option value="HRV">Croatia</option>
                    <option value="CUB">Cuba</option>
                    <option value="CUW">Curaçao</option>
                    <option value="CYP">Cyprus</option>
                    <option value="CZE">Czechia</option>
                    <option value="DNK">Denmark</option>
                    <option value="DJI">Djibouti</option>
                    <option value="DMA">Dominica</option>
                    <option value="DOM">Dominican Republic</option>
                    <option value="ECU">Ecuador</option>
                    <option value="EGY">Egypt</option>
                    <option value="SLV">El Salvador</option>
                    <option value="GNQ">Equatorial Guinea</option>
                    <option value="ERI">Eritrea</option>
                    <option value="EST">Estonia</option>
                    <option value="SWZ">Eswatini</option>
                    <option value="ETH">Ethiopia</option>
                    <option value="FLK">Falkland Islands [Malvinas]</option>
                    <option value="FRO">Faroe Islands</option>
                    <option value="FJI">Fiji</option>
                    <option value="FIN">Finland</option>
                    <option value="FRA">France</option>
                    <option value="GUF">French Guiana</option>
                    <option value="PYF">French Polynesia</option>
                    <option value="ATF">French Southern Territories</option>
                    <option value="GAB">Gabon</option>
                    <option value="GMB">Gambia</option>
                    <option value="GEO">Georgia</option>
                    <option value="DEU">Germany</option>
                    <option value="GHA">Ghana</option>
                    <option value="GIB">Gibraltar</option>
                    <option value="GRC">Greece</option>
                    <option value="GRL">Greenland</option>
                    <option value="GRD">Grenada</option>
                    <option value="GLP">Guadeloupe</option>
                    <option value="GUM">Guam</option>
                    <option value="GTM">Guatemala</option>
                    <option value="GGY">Guernsey</option>
                    <option value="GIN">Guinea</option>
                    <option value="GNB">Guinea-Bissau</option>
                    <option value="GUY">Guyana</option>
                    <option value="HTI">Haiti</option>
                    <option value="HMD">Heard Island and McDonald Islands</option>
                    <option value="VAT">Holy See</option>
                    <option value="HND">Honduras</option>
                    <option value="HKG">Hong Kong</option>
                    <option value="HUN">Hungary</option>
                    <option value="ISL">Iceland</option>
                    <option value="IND">India</option>
                    <option value="IDN">Indonesia</option>
                    <option value="IRN">Iran (Islamic Republic of)</option>
                    <option value="IRQ">Iraq</option>
                    <option value="IRL">Ireland</option>
                    <option value="IMN">Isle of Man</option>
                    <option value="ISR">Israel</option>
                    <option value="ITA">Italy</option>
                    <option value="JAM">Jamaica</option>
                    <option value="JPN">Japan</option>
                    <option value="JEY">Jersey</option>
                    <option value="JOR">Jordan</option>
                    <option value="KAZ">Kazakhstan</option>
                    <option value="KEN">Kenya</option>
                    <option value="KIR">Kiribati</option>
                    <option value="PRK">Korea (the Democratic People's Republic of)</option>
                    <option value="KOR">Korea (the Republic of)</option>
                    <option value="KWT">Kuwait</option>
                    <option value="KGZ">Kyrgyzstan</option>
                    <option value="LAO">Lao People's Democratic Republic</option>
                    <option value="LVA">Latvia</option>
                    <option value="LBN">Lebanon</option>
                    <option value="LSO">Lesotho</option>
                    <option value="LBR">Liberia</option>
                    <option value="LBY">Libya</option>
                    <option value="LIE">Liechtenstein</option>
                    <option value="LTU">Lithuania</option>
                    <option value="LUX">Luxembourg</option>
                    <option value="MAC">Macao</option>
                    <option value="MDG">Madagascar</option>
                    <option value="MWI">Malawi</option>
                    <option value="MYS">Malaysia</option>
                    <option value="MDV">Maldives</option>
                    <option value="MLI">Mali</option>
                    <option value="MLT">Malta</option>
                    <option value="MHL">Marshall Islands</option>
                    <option value="MTQ">Martinique</option>
                    <option value="MRT">Mauritania</option>
                    <option value="MUS">Mauritius</option>
                    <option value="MYT">Mayotte</option>
                    <option value="MEX">Mexico</option>
                    <option value="FSM">Micronesia (Federated States of)</option>
                    <option value="MDA">Moldova (the Republic of)</option>
                    <option value="MCO">Monaco</option>
                    <option value="MNG">Mongolia</option>
                    <option value="MNE">Montenegro</option>
                    <option value="MSR">Montserrat</option>
                    <option value="MAR">Morocco</option>
                    <option value="MOZ">Mozambique</option>
                    <option value="MMR">Myanmar</option>
                    <option value="NAM">Namibia</option>
                    <option value="NRU">Nauru</option>
                    <option value="NPL">Nepal</option>
                    <option value="NLD">Netherlands</option>
                    <option value="NCL">New Caledonia</option>
                    <option value="NZL">New Zealand</option>
                    <option value="NIC">Nicaragua</option>
                    <option value="NER">Niger</option>
                    <option value="NGA">Nigeria</option>
                    <option value="NIU">Niue</option>
                    <option value="NFK">Norfolk Island</option>
                    <option value="MKD">North Macedonia</option>
                    <option value="MNP">Northern Mariana Islands</option>
                    <option value="NOR">Norway</option>
                    <option value="OMN">Oman</option>
                    <option value="PAK">Pakistan</option>
                    <option value="PLW">Palau</option>
                    <option value="PSE">Palestine, State of</option>
                    <option value="PAN">Panama</option>
                    <option value="PNG">Papua New Guinea</option>
                    <option value="PRY">Paraguay</option>
                    <option value="PER">Peru</option>
                    <option value="PHL">Philippines</option>
                    <option value="PCN">Pitcairn</option>
                    <option value="POL">Poland</option>
                    <option value="PRT">Portugal</option>
                    <option value="PRI">Puerto Rico</option>
                    <option value="QAT">Qatar</option>
                    <option value="REU">Réunion</option>
                    <option value="ROU">Romania</option>
                    <option value="RUS">Russian Federation</option>
                    <option value="RWA">Rwanda</option>
                    <option value="BLM">Saint Barthélemy</option>
                    <option value="SHN">Saint Helena, Ascension and Tristan da Cunha</option>
                    <option value="KNA">Saint Kitts and Nevis</option>
                    <option value="LCA">Saint Lucia</option>
                    <option value="MAF">Saint Martin (French part)</option>
                    <option value="SPM">Saint Pierre and Miquelon</option>
                    <option value="VCT">Saint Vincent and the Grenadines</option>
                    <option value="WSM">Samoa</option>
                    <option value="SMR">San Marino</option>
                    <option value="STP">Sao Tome and Principe</option>
                    <option value="SAU">Saudi Arabia</option>
                    <option value="SEN">Senegal</option>
                    <option value="SRB">Serbia</option>
                    <option value="SYC">Seychelles</option>
                    <option value="SLE">Sierra Leone</option>
                    <option value="SGP">Singapore</option>
                    <option value="SXM">Sint Maarten (Dutch part)</option>
                    <option value="SVK">Slovakia</option>
                    <option value="SVN">Slovenia</option>
                    <option value="SLB">Solomon Islands</option>
                    <option value="SOM">Somalia</option>
                    <option value="ZAF">South Africa</option>
                    <option value="SGS">South Georgia and the South Sandwich Islands</option>
                    <option value="SSD">South Sudan</option>
                    <option value="ESP">Spain</option>
                    <option value="LKA">Sri Lanka</option>
                    <option value="SDN">Sudan</option>
                    <option value="SUR">Suriname</option>
                    <option value="SJM">Svalbard and Jan Mayen</option>
                    <option value="SWE">Sweden</option>
                    <option value="CHE">Switzerland</option>
                    <option value="SYR">Syrian Arab Republic</option>
                    <option value="TWN">Taiwan (Province of China)</option>
                    <option value="TJK">Tajikistan</option>
                    <option value="TZA">Tanzania, the United Republic of</option>
                    <option value="THA">Thailand</option>
                    <option value="TLS">Timor-Leste</option>
                    <option value="TGO">Togo</option>
                    <option value="TKL">Tokelau</option>
                    <option value="TON">Tonga</option>
                    <option value="TTO">Trinidad and Tobago</option>
                    <option value="TUN">Tunisia</option>
                    <option value="TUR">Turkey</option>
                    <option value="TKM">Turkmenistan</option>
                    <option value="TCA">Turks and Caicos Islands</option>
                    <option value="TUV">Tuvalu</option>
                    <option value="UGA">Uganda</option>
                    <option value="UKR">Ukraine</option>
                    <option value="ARE">United Arab Emirates</option>
                    <option value="GBR">United Kingdom of Great Britain and Northern Ireland</option>
                    <option value="UMI">United States Minor Outlying Islands</option>
                    <option value="URY">Uruguay</option>
                    <option value="UZB">Uzbekistan</option>
                    <option value="VUT">Vanuatu</option>
                    <option value="VEN">Venezuela (Bolivarian Republic of)</option>
                    <option value="VNM">Viet Nam</option>
                    <option value="VGB">Virgin Islands (British)</option>
                    <option value="VIR">Virgin Islands (U.S.)</option>
                    <option value="WLF">Wallis and Futuna</option>
                    <option value="ESH">Western Sahara*</option>
                    <option value="YEM">Yemen</option>
                    <option value="ZMB">Zambia</option>
                    <option value="ZWE">Zimbabwe</option>
                </select>
            </div>
        `;
    }

    //true false function argument

    stringBoolean(args, contents){

        // ${ this.stringBoolean('\$\{values.enablePhone\}', this.getPhoneElement(true)) }

        let toBool = string => string === 'true' ? true : false;

       return toBool(args) ? contents : "";

       
    }
 
    getPhoneElement(excludeLabel){
        return `
            <div class="col-md-12" style="${!excludeLabel ? "padding: 0 10px;margin-top: 10px;" : ""}">
                ${!excludeLabel ? "<label>\$\{values.phoneLabel || values.phone\}</label>" : ""}
                <div class="phone-container" style="display: flex; align-items: center;">
                    ${!excludeLabel ? '<input type="text" name="phone" onkeyup="validatePhoneNumber(this)" style="margin-bottom: 0;" onload="onloadValidation(this)">' : '<input type="text" placeholder="\$\{values.phoneLabel || values.phone\}" name="phone" onkeyup="validatePhoneNumber(this)" onload="onloadValidation(this)">'}
                    <div style="position: relative; display: none; align-items: center; width: 50px; height: 37px; padding: 0 5px; border: 1px solid rgb(204, 204, 204); margin-left: 5px; cursor: pointer;">
                        ${ComponentCountry.selectDOM}
                        <img src="https://cdn.shopify.com/s/assets/flags/us-1c64c14fa68916dba409ddf0e38ca5dc8bd262b959a5814ecb6667096b35efa5.svg" width="100%">
                    </div>
                </div>
                <script>
                    var prevSelectedCC = "";
                    var countrySelectTag = document.querySelector(".\$\{values._meta.htmlID\}");
                    countrySelectTag.selectedIndex = 0;
                    function validatePhoneNumber(element){
                        countrySelectTag = document.querySelector(".\$\{values._meta.htmlID\}");
                        var value = element.value;
                        var nextElement = element.nextElementSibling;
                        var selectTag = nextElement.querySelector("select");
                        var imgTag = nextElement.querySelector("img");
                        if(value){
                            nextElement.style.display = "flex";
                            for(var x = 0; x < selectTag.options.length; x++){
                                var cc = selectTag.options[x].getAttribute("data-countrycode");
                                if(cc){
                                    if(value == cc){
                                        selectTag.value = selectTag.options[x].getAttribute("value");
                                        selectTag.dispatchEvent(new Event("change"));
                                        prevSelectedCC = cc;
                                        break;
                                    }
                                }
                            }
                        } else {
                            nextElement.style.display = "";
                        }
                    }
                    
                    countrySelectTag.onchange = (event) => {
                        countrySelectTag = document.querySelector(".\$\{values._meta.htmlID\}");
                        var selectedOption = event.target.options[event.target.selectedIndex];
                        if(selectedOption != -1){
                            countrySelectTag.nextElementSibling.src = selectedOption.getAttribute("data-countryflag");
                            var phoneValue = countrySelectTag.parentNode.previousElementSibling.value;
                            var cc = selectedOption.getAttribute("data-countrycode");
                            var newPhoneValue = phoneValue.replace(prevSelectedCC, cc+" ");
                            prevSelectedCC = cc;
                            if(!phoneValue.includes(cc)){
                                countrySelectTag.parentNode.previousElementSibling.value = newPhoneValue;
                            }
                        }
                    };
                </script>
            </div>
        `;
    }

    changeWordTemplate(template){
        // change [shop_name] to domain
        template = template.replace(/\[shop_name\]/g, this.state.page_data.domain_name)
        // change old lock.png because some user is getting ban for this picture
        template = template.replace(/https:\/\/static.saratrkr.com\/images\/lock.png/g, "https://cdn.productlistgenie.com/images/NWMzNDEwMGYxMjEwMTUyM2E3MDk4OWNi/1587406640027lock.png");
        if(this.state.page_data.funnel_phone){
            var replaceBy = "";
            if(this.state.page_data.funnel_is_phone_whatsapp) replaceBy = "<a href=\\\"https://wa.me/"+this.state.page_data.funnel_phone+"\\\" target=\\\"_blank\\\">"+this.state.page_data.funnel_phone+"<\\\/a>";
            else replaceBy = this.state.page_data.funnel_phone;
            // change [shop_phone] to funnel setting phone
            template = template.replace(/\[shop_phone\]/g, replaceBy)
        }
        // change [shop_email] to funnel setting email
        if(this.state.page_data.funnel_email){
            template = template.replace(/\[shop_email\]/g, this.state.page_data.funnel_email)
        }
        // change [shop_address] to funnel setting address
        if(this.state.page_data.funnel_address){
            template = template.replace(/\[shop_address\]/g, this.state.page_data.funnel_address)
        }
        return template;
    }

    convertCCDiscount(localPrice , currency){
        return points.customFetch(`/api/convert_price/9/${currency}`,"get",{},result => {
            if(result){
                const converted_price = result.converted_price;
                return localPrice - converted_price;
            }            
        });
    }

    getSendingEmailRequest(shouldReturn){
        var page_data = this.state.page_data;
        if(page_data.funnel_use_email_confirmation){
            return `
                const getMerchantType = () => {
                    if(localStorage.getItem("cod_data")) {
                        return "cod";
                    } else if(localStorage.getItem("paypal_as_checkout")) {
                        return "paypal";
                    } else if(localStorage.getItem("stripe_user_id")) {
                        return "stripe";
                    } else if(localStorage.getItem("authorize_customer_ids")) {
                        return "authorize.net";
                    } else return "";
                }
                const getjobId = () => typeof plg_job_id !== "undefined" ? plg_job_id : "";
                var sendEmailPayload = { id: getjobId(), name: localStorage.getItem("funnel_customer_name"), email: localStorage.getItem("funnel_customer_email"), merchant: getMerchantType(), lineItem: { name: productName, qty: plg_qty, price: plg_price, symbol: currency_symbol, currency: currency_word } };
                fetch('/send_email', {
                    method: "post",
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(sendEmailPayload)
                })
                .then(res => res.json())
                .then(res => {
                    if(!getjobId()){
                        localStorage.setItem("plg_email_id", res._id);
                    }
                    ${shouldReturn ? `return callback();` : `callback();`}
                })
                .catch(err => {
                    ${shouldReturn ? `return callback();` : `callback();`}
                })
            `;
        } else {
            return `
                ${shouldReturn ? `return callback();` : `callback();`}
            `;
        }
    }

    initializeEditor(params, resolve) {
        window.params = params;
        var state = this.state;
        var domain = "https://"+this.state.page_data.domain_name;
        window.funnel_domain = domain;
        var funnel_email = state.page_data.funnel_email ? state.page_data.funnel_email : "contact@lookbetterbald.com";
        var funnel_phone = state.page_data.funnel_phone ? state.page_data.funnel_phone : "1 *** 840-897*";
        var selected_merchant = state.page_data.gateway_selected_merchant;
        var public_key = state.page_data.gateway_stripe_public;
        var private_key = state.page_data.gateway_stripe_private;
        var other = state.page_data.gateway_other;
        var funnel_everflow = state.page_data.funnel_everflow;
        try {
            var paypalClientID = state.page_data.gateway_paypal_client_id != "n/a" && !state.page_data.gateway_paypal_client_id.includes('_PAYPALV2') ? state.page_data.gateway_paypal_client_id : "";
            var paypalClientIDv2 = state.page_data.gateway_paypal_client_id.includes('_PAYPALV2') ? state.page_data.gateway_paypal_client_id.replace('_PAYPALV2', '') : "";
        } catch (error) {
            console.log(error);
        }
        var page_type = state.page_data.page_type;

        var header = {
            "category": "Header",
            "tags": ["header"],
            "data": { "cells": [1, 2], "columns": [{ "contents": [{ "type": "image", "values": { "containerPadding": "10px", "_meta": { "htmlClassNames": "u_content_image" }, "selectable": true, "draggable": true, "deletable": true, "src": { "url": "https://via.placeholder.com/250x100?text=LOGO%20HERE", "width": 250, "height": 100 }, "fullWidth": false, "textAlign": "center", "maxWidth": "100%", "altText": "Image", "action": { "url": "", "target": "" } } }], "values": { "_meta": { "htmlClassNames": "u_column" } } }, { "contents": [{ "type": "navbar", "values": { "containerPadding": "10px", "_meta": { "htmlClassNames": "u_content_navbar" }, "selectable": true, "draggable": true, "deletable": true, "navigation": "[{\"text\":\"Home\",\"url\":\"/"+state.page_data.funnel_name+"\"},{\"text\":\"Nav 1\",\"url\":\"/"+state.page_data.funnel_name+"\"},{\"text\":\"Nav 2\",\"url\":\"/"+state.page_data.funnel_name+"\"},{\"text\":\"Nav 3\",\"url\":\"/"+state.page_data.funnel_name+"\"}]", "textColor": "#fff", "backgroundColor": "inherit", "hoverColor": "#121212" } }], "values": { "backgroundColor": "", "padding": "0px", "border": {}, "_meta": { "htmlClassNames": "u_column" } } }], "values": { "columns": false, "backgroundColor": "#1fbc9c", "columnsBackgroundColor": "rgba(31,188,156,0)", "backgroundImage": { "url": "", "fullWidth": true, "repeat": false, "center": true, "cover": false }, "padding": "0px", "hideMobile": false, "noStackMobile": true, "_meta": { "htmlClassNames": "u_row tessst" }, "selectable": true, "draggable": true, "deletable": true } },
            "displayMode": "web"
        };

        var header1 = {
            "category": "Header",
            "tags": ["header"],
            "data": {"cells":[1,2],"columns":[{"contents":[{"type":"image","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_image_10","htmlClassNames":"u_content_image"},"selectable":true,"draggable":true,"deletable":true,"src":{"url":"https://app.productlistgenie.io/assets/graphics/logo.png","width":199,"height":74},"fullWidth":false,"textAlign":"center","maxWidth":"38%","altText":"Image","action":{"url":"","target":""}}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_19","htmlClassNames":"u_column"}}},{"contents":[{"type":"navbar","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_navbar_1","htmlClassNames":"u_content_navbar"},"selectable":true,"draggable":true,"deletable":true,"navigation":"[{\"text\":\"Home\",\"url\":\""+params.pages.filter(el => el.split("/").length == 2).toString()+"\"},{\"text\":\"Collections\",\"url\":\"\"},{\"text\":\"Contact Us\",\"url\":\""+params.pages.filter(el => el.includes("contact-us")).toString()+"\"},{\"text\":\"About Us\",\"url\":\"\"},{\"text\":\"FAQ\",\"url\":\""+params.pages.filter(el => el.includes("faqs")).toString()+"\"}]","textColor":"#ffffff","backgroundColor":"#121212","hoverColor":"#57ae50"}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_20","htmlClassNames":"u_column"}}}],"values":{"columns":false,"backgroundColor":"#121212","columnsBackgroundColor":"","backgroundImage":{"url":"","fullWidth":true,"repeat":false,"center":true,"cover":false},"padding":"0px","hideMobile":false,"noStackMobile":false,"_meta":{"htmlID":"u_row_11","htmlClassNames":"u_row"},"selectable":true,"draggable":true,"deletable":true}},
            "displayMode": "web"
        };

        var header2 = {
            "category": "Header",
            "tags": ["header"],
            "data": {"cells":[1,1,1],"columns":[{"contents":[{"type":"image","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_image_10","htmlClassNames":"u_content_image"},"selectable":true,"draggable":true,"deletable":true,"src":{"url":"https://app.productlistgenie.io/assets/graphics/logo.png","width":199,"height":74},"fullWidth":false,"textAlign":"center","maxWidth":"64%","altText":"Image","action":{"url":"","target":""}}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_19","htmlClassNames":"u_column"}}},{"contents":[{"type":"navbar","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_navbar_1","htmlClassNames":"u_content_navbar"},"selectable":true,"draggable":true,"deletable":true,"navigation":"[{\"text\":\"Home\",\"url\":\""+params.pages.filter(el => el.split("/").length == 2).toString()+"\"},{\"text\":\"Collections\",\"url\":\"\"},{\"text\":\"About Us\",\"url\":\"\"}]","textColor":"#579650","backgroundColor":"rgba(255,255,255,0)","hoverColor":"#87e678"}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_20","htmlClassNames":"u_column"}}},{"contents":[{"type":"text","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_text_11","htmlClassNames":"u_content_text"},"selectable":true,"draggable":true,"deletable":true,"color":"#121212","textAlign":"left","lineHeight":"140%","text":"<p style=\"font-size: 14px; line-height: 140%; text-align: center;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%; text-align: center;\"><span style=\"font-size: 14px; line-height: 19.6px;\"><span style=\"font-family: Montserrat, sans-serif; text-align: right; line-height: 19.6px; font-size: 14px;\">Contact Info. [ <span style=\"font-size: 14px; line-height: 19.6px;\">[shop_phone]</span> or&nbsp;</span><a style=\"font-family: Montserrat, sans-serif; text-align: right;\" href=\"mailto:[shop_email]\">[shop_email]</a><span style=\"font-family: Montserrat, sans-serif; text-align: right; line-height: 19.6px; font-size: 14px;\">&nbsp;]</span></span></p>"}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_21","htmlClassNames":"u_column"}}}],"values":{"columns":false,"backgroundColor":"","columnsBackgroundColor":"","backgroundImage":{"url":"","fullWidth":true,"repeat":false,"center":true,"cover":false},"padding":"0px","hideMobile":false,"noStackMobile":false,"_meta":{"htmlID":"u_row_11","htmlClassNames":"u_row"},"selectable":true,"draggable":true,"deletable":true}},
            "displayMode": "web"
        };

        var header3 = {
            "category": "Header",
            "tags": ["header"],
            "data": {"cells":[1],"columns":[{"contents":[{"type":"image","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_image_10","htmlClassNames":"u_content_image"},"selectable":true,"draggable":true,"deletable":true,"src":{"url":"https://app.productlistgenie.io/assets/graphics/logo.png","width":199,"height":74},"fullWidth":false,"textAlign":"center","maxWidth":"100%","altText":"Image","action":{"url":"","target":""}}},{"type":"text","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_text_11","htmlClassNames":"u_content_text"},"selectable":true,"draggable":true,"deletable":true,"color":"#121212","textAlign":"left","lineHeight":"140%","text":"<p style=\"font-size: 14px; line-height: 140%; text-align: center;\"><span style=\"font-size: 16px; line-height: 22.4px; font-family: Montserrat, sans-serif; color: #ff6600;\">Home&nbsp; &nbsp; &nbsp; Collections&nbsp; &nbsp; &nbsp;About Us</span></p>"}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_19","htmlClassNames":"u_column"}}}],"values":{"columns":false,"backgroundColor":"#2a2a2a","columnsBackgroundColor":"","backgroundImage":{"url":"","fullWidth":true,"repeat":false,"center":true,"cover":false},"padding":"0px","hideMobile":false,"noStackMobile":false,"_meta":{"htmlID":"u_row_11","htmlClassNames":"u_row"},"selectable":true,"draggable":true,"deletable":true}},
            "displayMode": "web"
        };

        var header4 = {
            "category": "Header",
            "tags": ["header"],
            "data": {"cells":[2,1],"columns":[{"contents":[{"type":"navbar","values":{"containerPadding":"0px","_meta":{"htmlID":"u_content_navbar_1","htmlClassNames":"u_content_navbar"},"selectable":true,"draggable":true,"deletable":true,"navigation":"[{\"text\":\"Home\",\"url\":\""+params.pages.filter(el => el.split("/").length == 2).toString()+"\"},{\"text\":\"Collections\",\"url\":\"\"},{\"text\":\"About Us\",\"url\":\"\"},{\"text\":\"FAQ\",\"url\":\""+params.pages.filter(el => el.includes("faqs")).toString()+"\"}]","textColor":"#fff","backgroundColor":"inherit","hoverColor":"#68c0cd"}},{"type":"text","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_text_11","htmlClassNames":"u_content_text"},"selectable":true,"draggable":true,"deletable":true,"color":"#121212","textAlign":"left","lineHeight":"140%","text":"<p style=\"font-size: 14px; line-height: 140%; text-align: right;\"><span style=\"font-size: 12px; line-height: 16.8px;\"><span style=\"color: #ffffff; font-family: Montserrat, sans-serif; line-height: 16.8px; font-size: 12px;\">Contact Info. [ [shop_phone] or&nbsp;</span><a style=\"text-decoration-line: none; font-family: Montserrat, sans-serif;\" href=\"mailto:[shop_email]\">[shop_email]</a><span style=\"color: #ffffff; font-family: Montserrat, sans-serif; line-height: 16.8px; font-size: 12px;\">&nbsp;]</span></span></p>"}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_19","htmlClassNames":"u_column"}}},{"contents":[{"type":"image","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_image_10","htmlClassNames":"u_content_image"},"selectable":true,"draggable":true,"deletable":true,"src":{"url":"https://app.productlistgenie.io/assets/graphics/logo.png","width":199,"height":74},"fullWidth":false,"textAlign":"center","maxWidth":"100%","altText":"Image","action":{"url":"","target":""}}}],"values":{"backgroundColor":"rgba(225,225,225,0)","padding":"0px","border":{},"_meta":{"htmlID":"u_column_20","htmlClassNames":"u_column"}}}],"values":{"columns":false,"backgroundColor":"#547ba1","columnsBackgroundColor":"","backgroundImage":{"url":"","fullWidth":true,"repeat":false,"center":true,"cover":false},"padding":"0px","hideMobile":false,"noStackMobile":false,"_meta":{"htmlID":"u_row_11","htmlClassNames":"u_row"},"selectable":true,"draggable":true,"deletable":true}},
            "displayMode": "web"
        };

        var header5 = {
            "category": "Header",
            "tags": ["header"],
            "data": {"cells":[1,2],"columns":[{"contents":[{"type":"image","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_image_10","htmlClassNames":"u_content_image"},"selectable":true,"draggable":true,"deletable":true,"src":{"url":"https://app.productlistgenie.io/assets/graphics/logo.png","width":199,"height":74},"fullWidth":false,"textAlign":"center","maxWidth":"100%","altText":"Image","action":{"url":"","target":""}}}],"values":{"backgroundColor":"","padding":"0px","border":{"borderTopWidth":"1px","borderTopStyle":"solid","borderTopColor":"#5b9758","borderLeftWidth":"1px","borderLeftStyle":"solid","borderLeftColor":"#5b9758","borderRightWidth":"1px","borderRightStyle":"solid","borderRightColor":"#5b9758","borderBottomWidth":"1px","borderBottomStyle":"solid","borderBottomColor":"#5b9758"},"_meta":{"htmlID":"u_column_19","htmlClassNames":"u_column"}}},{"contents":[{"type":"navbar","values":{"containerPadding":"4px","_meta":{"htmlID":"u_content_navbar_1","htmlClassNames":"u_content_navbar"},"selectable":true,"draggable":true,"deletable":true,"navigation":"[{\"text\":\"Home\",\"url\":\""+params.pages.filter(el => el.split("/").length == 2).toString()+"\"},{\"text\":\"Collections\",\"url\":\"\"},{\"text\":\"About Us\",\"url\":\"\"},{\"text\":\"FAQ\",\"url\":\""+params.pages.filter(el => el.includes("faqs")).toString()+"\"},{\"text\":\"Contact [[shop_phone]]\",\"url\":\"tel:[shop_phone]\"}]","textColor":"#4c845a","backgroundColor":"rgba(0,0,0,0)","hoverColor":"#cce1bd"}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_20","htmlClassNames":"u_column"}}}],"values":{"columns":false,"backgroundColor":"#362c2c","columnsBackgroundColor":"","backgroundImage":{"url":"","fullWidth":true,"repeat":false,"center":true,"cover":false},"padding":"0px","hideMobile":false,"noStackMobile":false,"_meta":{"htmlID":"u_row_11","htmlClassNames":"u_row"},"selectable":true,"draggable":true,"deletable":true}},
            "displayMode": "web"
        };

        var header6 = {
            "category": "Header",
            "tags": ["header"],
            "data": {"cells":[1],"columns":[{"contents":[{"type":"image","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_image_11","htmlClassNames":"u_content_image"},"selectable":true,"draggable":true,"deletable":true,"src":{"url":"https://app.productlistgenie.io/assets/graphics/logo.png","width":199,"height":74},"fullWidth":false,"textAlign":"center","maxWidth":"100%","altText":"Image","action":{"url":"","target":""}}},{"type":"navbar","values":{"containerPadding":"0px","_meta":{"htmlID":"u_content_navbar_1","htmlClassNames":"u_content_navbar"},"selectable":true,"draggable":true,"deletable":true,"navigation":"[{\"text\":\"Home\",\"url\":\""+params.pages.filter(el => el.split("/").length == 2).toString()+"\"},{\"text\":\"Collections\",\"url\":\"\"},{\"text\":\"About Us\",\"url\":\"\"},{\"text\":\"FAQ\",\"url\":\""+params.pages.filter(el => el.includes("faqs")).toString()+"\"},{\"text\":\"Contact [[shop_phone]]\",\"url\":\"tel:[shop_phone]\"}]","textColor":"#515151","backgroundColor":"rgba(0,0,0,0)","hoverColor":"#cf5d11"}}],"values":{"backgroundColor":"","padding":"0px","border":{"borderTopWidth":"0px","borderTopStyle":"solid","borderTopColor":"#e65a25","borderLeftWidth":"1px","borderLeftStyle":"solid","borderLeftColor":"#e65a25","borderRightWidth":"1px","borderRightStyle":"solid","borderRightColor":"#e65a25","borderBottomWidth":"2px","borderBottomStyle":"solid","borderBottomColor":"#e65a25"},"_meta":{"htmlID":"u_column_19","htmlClassNames":"u_column"}}}],"values":{"columns":false,"backgroundColor":"#ffffff","columnsBackgroundColor":"#ffffff","backgroundImage":{"url":"","fullWidth":true,"repeat":false,"center":true,"cover":false},"padding":"0px 0px 3px","hideMobile":false,"noStackMobile":false,"_meta":{"htmlID":"u_row_11","htmlClassNames":"u_row"},"selectable":true,"draggable":true,"deletable":true}},
            "displayMode": "web"
        };
        
        var header7 = {
            "category": "Header",
            "tags": ["header"],
            "data": {"cells":[1,1,1],"columns":[{"contents":[{"type":"navbar","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_navbar_1","htmlClassNames":"u_content_navbar"},"selectable":true,"draggable":true,"deletable":true,"navigation":"[{\"text\":\"Home\",\"url\":\""+params.pages.filter(el => el.split("/").length == 2).toString()+"\"},{\"text\":\"Collections\",\"url\":\"\"},{\"text\":\"About Us\",\"url\":\"\"},{\"text\":\"FAQ\",\"url\":\""+params.pages.filter(el => el.includes("faqs")).toString()+"\"}]","textColor":"#d55e24","backgroundColor":"rgba(166,60,60,0)","hoverColor":"#e19a87"}}],"values":{"backgroundColor":"","padding":"0px","border":{"borderTopWidth":"0px","borderTopStyle":"solid","borderTopColor":"#CCC","borderLeftWidth":"0px","borderLeftStyle":"solid","borderLeftColor":"#CCC","borderRightWidth":"0px","borderRightStyle":"solid","borderRightColor":"#CCC","borderBottomWidth":"0px","borderBottomStyle":"solid","borderBottomColor":"#CCC"},"_meta":{"htmlID":"u_column_19","htmlClassNames":"u_column"}}},{"contents":[{"type":"image","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_image_10","htmlClassNames":"u_content_image"},"selectable":true,"draggable":true,"deletable":true,"src":{"url":"https://app.productlistgenie.io/assets/graphics/logo.png","width":199,"height":74},"fullWidth":false,"textAlign":"center","maxWidth":"100%","altText":"Image","action":{"url":"","target":""}}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_20","htmlClassNames":"u_column"}}},{"contents":[{"type":"text","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_text_12","htmlClassNames":"u_content_text"},"selectable":true,"draggable":true,"deletable":true,"color":"#ffffff","textAlign":"left","lineHeight":"140%","text":"<p style=\"font-size: 14px; line-height: 140%; text-align: center;\"><span style=\"font-size: 14px; line-height: 19.6px;\"><strong><span style=\"line-height: 19.6px; font-family: Montserrat, sans-serif; font-size: 14px;\">Contact Us [[shop_phone]]</span></strong></span></p>"}}],"values":{"backgroundColor":"#d55e24","padding":"0px","border":{},"_meta":{"htmlID":"u_column_21","htmlClassNames":"u_column"}}}],"values":{"columns":false,"backgroundColor":"","columnsBackgroundColor":"","backgroundImage":{"url":"","fullWidth":true,"repeat":false,"center":true,"cover":false},"padding":"0px","hideMobile":false,"noStackMobile":false,"_meta":{"htmlID":"u_row_11","htmlClassNames":"u_row"},"selectable":true,"draggable":true,"deletable":true}},
            "displayMode": "web"
        };

        var header8 = {
            "category": "Header",
            "tags": ["header"],
            "data": {"cells":[1,2],"columns":[{"contents":[{"type":"navbar","values":{"containerPadding":"40px 10px 10px","_meta":{"htmlID":"u_content_navbar_1","htmlClassNames":"u_content_navbar"},"selectable":true,"draggable":true,"deletable":true,"navigation":"[{\"text\":\"Home\",\"url\":\""+params.pages.filter(el => el.split("/").length == 2).toString()+"\"},{\"text\":\"Collections\",\"url\":\"\"},{\"text\":\"About Us\",\"url\":\"\"},{\"text\":\"FAQ\",\"url\":\""+params.pages.filter(el => el.includes("faqs")).toString()+"\"}]","textColor":"#fff","backgroundColor":"rgba(0,0,0,0)","hoverColor":"#37d978"}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_19","htmlClassNames":"u_column"}}},{"contents":[{"type":"image","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_image_10","htmlClassNames":"u_content_image"},"selectable":true,"draggable":true,"deletable":true,"src":{"url":"https://app.productlistgenie.io/assets/graphics/logo.png","width":199,"height":74},"fullWidth":false,"textAlign":"center","maxWidth":"54%","altText":"Image","action":{"url":"","target":""}}},{"type":"text","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_text_12","htmlClassNames":"u_content_text"},"selectable":true,"draggable":true,"deletable":true,"color":"#121212","textAlign":"center","lineHeight":"140%","text":"<p style=\"font-size: 14px; line-height: 140%; text-align: center;\"><span style=\"font-size: 12px; line-height: 16.8px; color: #339966;\"><span style=\"font-family: Montserrat, sans-serif; line-height: 16.8px; font-size: 12px;\">Contact Info. [ [shop_phone]</span><span style=\"font-family: Montserrat, sans-serif; line-height: 16.8px; font-size: 12px;\">&nbsp;]</span></span></p>"}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_20","htmlClassNames":"u_column"}}}],"values":{"columns":false,"backgroundColor":"#2b6874","columnsBackgroundColor":"","backgroundImage":{"url":"","fullWidth":true,"repeat":false,"center":true,"cover":false},"padding":"0px","hideMobile":false,"noStackMobile":false,"_meta":{"htmlID":"u_row_11","htmlClassNames":"u_row"},"selectable":true,"draggable":true,"deletable":true}},
            "displayMode": "web"
        };

        var header9 = {
            "category": "Header",
            "tags": ["header"],
            "data": {"cells":[1,1,1,1],"columns":[{"contents":[{"type":"image","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_image_10","htmlClassNames":"u_content_image"},"selectable":true,"draggable":true,"deletable":true,"src":{"url":"https://app.productlistgenie.io/assets/graphics/logo.png","width":199,"height":74},"fullWidth":false,"textAlign":"center","maxWidth":"44%","altText":"Image","action":{"url":"","target":""}}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_19","htmlClassNames":"u_column"}}},{"contents":[{"type":"text","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_text_12","htmlClassNames":"u_content_text"},"selectable":true,"draggable":true,"deletable":true,"color":"#121212","textAlign":"left","lineHeight":"140%","text":""}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_20","htmlClassNames":"u_column"}}},{"contents":[{"type":"navbar","values":{"containerPadding":"0px","_meta":{"htmlID":"u_content_navbar_1","htmlClassNames":"u_content_navbar"},"selectable":true,"draggable":true,"deletable":true,"navigation":"[{\"text\":\"Home\",\"url\":\""+params.pages.filter(el => el.split("/").length == 2).toString()+"\"},{\"text\":\"About Us\",\"url\":\"\"},{\"text\":\"FAQ\",\"url\":\""+params.pages.filter(el => el.includes("faqs")).toString()+"\"}]","textColor":"#fff","backgroundColor":"rgba(0,0,0,0)","hoverColor":"#e7f000"}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_21","htmlClassNames":"u_column"}}},{"contents":[{"type":"buttons","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_buttons_1","htmlClassNames":"u_content_buttons"},"selectable":true,"draggable":true,"deletable":true,"buttonLink":{"url":"tel:[shop_phone]","target":"_self"},"text":"Contact No: [shop_phone]","animation":"","animationInterval":5,"alignment":"center","buttonStyle":"","isSticky":false,"fontSize":"20px","buttonWidth":"100%","buttonColors":{"color":"#121212","backgroundColor":"#e7f000","hoverColor":"#db2121"},"borderRadius":"50px","padding":"5px"}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_22","htmlClassNames":"u_column"}}}],"values":{"columns":false,"backgroundColor":"#121212","columnsBackgroundColor":"","backgroundImage":{"url":"","fullWidth":true,"repeat":false,"center":true,"cover":false},"padding":"0px","hideMobile":false,"noStackMobile":false,"_meta":{"htmlID":"u_row_11","htmlClassNames":"u_row"},"selectable":true,"draggable":true,"deletable":true}},
            "displayMode": "web"
        };

        var header10 = {
            "category": "Header",
            "tags": ["header"],
            "data": {"cells":[1,1,1],"columns":[{"contents":[{"type":"image","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_image_10","htmlClassNames":"u_content_image"},"selectable":true,"draggable":true,"deletable":true,"src":{"url":"https://app.productlistgenie.io/assets/graphics/logo.png","width":199,"height":74},"fullWidth":false,"textAlign":"center","maxWidth":"38%","altText":"Image","action":{"url":"","target":""}}},{"type":"navbar","values":{"containerPadding":"2px","_meta":{"htmlID":"u_content_navbar_1","htmlClassNames":"u_content_navbar"},"selectable":true,"draggable":true,"deletable":true,"navigation":"[{\"text\":\"Home\",\"url\":\""+params.pages.filter(el => el.split("/").length == 2).toString()+"\"},{\"text\":\"Collections\",\"url\":\"\"},{\"text\":\"About Us\",\"url\":\"\"},{\"text\":\"\",\"url\":\"\"}]","textColor":"#ffffff","backgroundColor":"rgba(0,0,0,0)","hoverColor":"#c36834"}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_19","htmlClassNames":"u_column"}}},{"contents":[{"type":"text","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_text_14","htmlClassNames":"u_content_text"},"selectable":true,"draggable":true,"deletable":true,"color":"#121212","textAlign":"left","lineHeight":"140%","text":""}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_20","htmlClassNames":"u_column"}}},{"contents":[{"type":"buttons","values":{"containerPadding":"25px 10px 10px","_meta":{"htmlID":"u_content_buttons_2","htmlClassNames":"u_content_buttons"},"selectable":true,"draggable":true,"deletable":true,"buttonLink":{"url":"#","target":"_self"},"text":"50% OFF! GET NOW","animation":"","animationInterval":"2","alignment":"center","buttonStyle":"#ffffff,#e03a3a,#ff7373","isSticky":false,"fontSize":"15px","buttonWidth":"72%","buttonColors":{"color":"#FFF","backgroundColor":"#26c686","hoverColor":"#2A92BF"},"borderRadius":"0px","padding":"10px"}},{"type":"text","values":{"containerPadding":"4px","_meta":{"htmlID":"u_content_text_15","htmlClassNames":"u_content_text"},"selectable":true,"draggable":true,"deletable":true,"color":"#121212","textAlign":"left","lineHeight":"140%","text":"<p style=\"font-size: 14px; line-height: 140%; text-align: center;\"><span style=\"font-size: 14px; line-height: 19.6px; font-family: Montserrat, sans-serif; color: #ffffff;\">Contact Now: [shop_phone]</span></p>"}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_21","htmlClassNames":"u_column"}}}],"values":{"columns":false,"backgroundColor":"#466049","columnsBackgroundColor":"","backgroundImage":{"url":"","fullWidth":true,"repeat":false,"center":true,"cover":false},"padding":"0px","hideMobile":false,"noStackMobile":false,"_meta":{"htmlID":"u_row_11","htmlClassNames":"u_row"},"selectable":true,"draggable":true,"deletable":true}},
            "displayMode": "web"
        };

        var header11 = {
            "category": "Header",
            "tags": ["header"],
            "data": {"cells":[1,1,1],"columns":[{"contents":[{"type":"text","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_text_12","htmlClassNames":"u_content_text"},"selectable":true,"draggable":true,"deletable":true,"color":"#121212","textAlign":"left","lineHeight":"140%","text":""}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_20","htmlClassNames":"u_column"}}},{"contents":[{"type":"image","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_image_10","htmlClassNames":"u_content_image"},"selectable":true,"draggable":true,"deletable":true,"src":{"url":"https://app.productlistgenie.io/assets/graphics/logo.png","width":199,"height":74},"fullWidth":false,"textAlign":"center","maxWidth":"100%","altText":"Image","action":{"url":"","target":""}}},{"type":"divider","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_divider_3","htmlClassNames":"u_content_divider"},"selectable":true,"draggable":true,"deletable":true,"width":"100%","border":{"borderTopWidth":"1px","borderTopStyle":"solid","borderTopColor":"rgba(255,255,255,0.52)"},"textAlign":"center"}},{"type":"navbar","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_navbar_3","htmlClassNames":"u_content_navbar"},"selectable":true,"draggable":true,"deletable":true,"navigation":"[{\"text\":\"Home\",\"url\":\""+params.pages.filter(el => el.split("/").length == 2).toString()+"\"},{\"text\":\"Collections\",\"url\":\"\"},{\"text\":\"About Us\",\"url\":\"\"},{\"text\":\"FAQ\",\"url\":\""+params.pages.filter(el => el.includes("faqs")).toString()+"\"}]","textColor":"#1c7b54","backgroundColor":"rgba(0,0,0,0)","hoverColor":"#548245"}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_21","htmlClassNames":"u_column"}}},{"contents":[{"type":"text","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_text_13","htmlClassNames":"u_content_text"},"selectable":true,"draggable":true,"deletable":true,"color":"#121212","textAlign":"left","lineHeight":"140%","text":""}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_22","htmlClassNames":"u_column"}}}],"values":{"columns":false,"backgroundColor":"#47302d","columnsBackgroundColor":"","backgroundImage":{"url":"","fullWidth":true,"repeat":false,"center":true,"cover":false},"padding":"0px","hideMobile":false,"noStackMobile":false,"_meta":{"htmlID":"u_row_12","htmlClassNames":"u_row"},"selectable":true,"draggable":true,"deletable":true}},
            "displayMode": "web"
        };
        
        var productDescription1 = {
            "category": "Product Description",
            "tags": ["product description"],
            "data": {"cells":[1,1],"columns":[{"contents":[{"type":"text","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_text_11","htmlClassNames":"u_content_text"},"selectable":true,"draggable":true,"deletable":true,"color":"#121212","textAlign":"left","lineHeight":"140%","text":"<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\"><span style=\"font-size: 18px; line-height: 25.2px;\">PRODUCT DESCRIPTION</span></p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>"}},{"type":"buttons","values":{"containerPadding":"14px","_meta":{"htmlID":"u_content_buttons_1","htmlClassNames":"u_content_buttons"},"selectable":true,"draggable":true,"deletable":true,"buttonLink":{"url":"#","target":"_self"},"text":"Button","animation":"","animationInterval":"2","alignment":"center","buttonStyle":"","isSticky":false,"fontSize":"20px","buttonWidth":"100%","buttonColors":{"color":"#FFF","backgroundColor":"#26c686","hoverColor":"#2A92BF"},"borderRadius":"0px","padding":"10px 20px"}}],"values":{"backgroundColor":"#ffffff","padding":"0px","border":{},"_meta":{"htmlID":"u_column_19","htmlClassNames":"u_column"}}},{"contents":[{"type":"image","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_image_10","htmlClassNames":"u_content_image"},"selectable":true,"draggable":true,"deletable":true,"src":{"url":"https://via.placeholder.com/400x400?text=IMAGE","width":400,"height":400},"fullWidth":false,"textAlign":"center","maxWidth":"100%","altText":"Image","action":{"url":"","target":""}}}],"values":{"backgroundColor":"#ffffff","padding":"0px","border":{},"_meta":{"htmlID":"u_column_20","htmlClassNames":"u_column"}}}],"values":{"columns":false,"backgroundColor":"#f4f4f4","columnsBackgroundColor":"","backgroundImage":{"url":"","fullWidth":true,"repeat":false,"center":true,"cover":false},"padding":"0px","hideMobile":false,"noStackMobile":false,"_meta":{"htmlID":"u_row_11","htmlClassNames":"u_row"},"selectable":true,"draggable":true,"deletable":true}},
            "displayMode": "web"
        };

        var productDescription2 = {
            "category": "Product Description",
            "tags": ["product description"],
            "data": {"cells":[2,1],"columns":[{"contents":[{"type":"image","values":{"containerPadding":"0px","_meta":{"htmlID":"u_content_image_10","htmlClassNames":"u_content_image"},"selectable":true,"draggable":true,"deletable":true,"src":{"url":"https://via.placeholder.com/800x300?text=Product Image","width":800,"height":300},"fullWidth":false,"textAlign":"center","maxWidth":"100%","altText":"Image","action":{"url":"","target":""}}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_19","htmlClassNames":"u_column"}}},{"contents":[{"type":"text","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_text_11","htmlClassNames":"u_content_text"},"selectable":true,"draggable":true,"deletable":true,"color":"#121212","textAlign":"left","lineHeight":"140%","text":"<p style=\"font-size: 14px; line-height: 140%;\"><span style=\"font-size: 18px; line-height: 25.2px; font-family: Montserrat, sans-serif;\">Product Description</span></p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>"}},{"type":"buttons","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_buttons_1","htmlClassNames":"u_content_buttons"},"selectable":true,"draggable":true,"deletable":true,"buttonLink":{"url":"#","target":"_self"},"text":"Button","animation":"","animationInterval":"2","alignment":"center","buttonStyle":"","isSticky":false,"fontSize":"20px","buttonWidth":"100%","buttonColors":{"color":"#FFF","backgroundColor":"#2675c6","hoverColor":"#2A92BF"},"borderRadius":"5px","padding":"10px 20px"}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_20","htmlClassNames":"u_column"}}}],"values":{"columns":false,"backgroundColor":"#8ee3a7","columnsBackgroundColor":"","backgroundImage":{"url":"","fullWidth":true,"repeat":false,"center":true,"cover":false},"padding":"0px","hideMobile":false,"noStackMobile":false,"_meta":{"htmlID":"u_row_11","htmlClassNames":"u_row"},"selectable":true,"draggable":true,"deletable":true}},
            "displayMode": "web"
        };

        var productDescription3 = {
            "category": "Product Description",
            "tags": ["product description"],
            "data": {"cells":[1,1,1,1],"columns":[{"contents":[{"type":"text","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_text_11","htmlClassNames":"u_content_text"},"selectable":true,"draggable":true,"deletable":true,"color":"#121212","textAlign":"left","lineHeight":"140%","text":"<p style=\"line-height: 140%; font-size: 14px;\">&nbsp;</p>\n<p style=\"line-height: 140%; font-size: 14px;\"><span style=\"font-size: 18px; line-height: 25.2px;\"><strong><span style=\"font-family: Montserrat, sans-serif; line-height: 25.2px; font-size: 18px;\"><span style=\"color: #ffffff; font-size: 18px; line-height: 25.2px;\">Product Description</span></span></strong></span></p>\n<p style=\"line-height: 140%; font-size: 14px;\">&nbsp;</p>\n<p style=\"line-height: 140%; font-size: 14px;\">&nbsp;</p>\n<p style=\"line-height: 140%; font-size: 14px;\">&nbsp;</p>\n<p style=\"line-height: 140%; font-size: 14px;\">&nbsp;</p>\n<p style=\"line-height: 140%; font-size: 14px;\">&nbsp;</p>\n<p style=\"line-height: 140%; font-size: 14px;\">&nbsp;</p>\n<p style=\"line-height: 140%; font-size: 14px;\">&nbsp;</p>\n<p style=\"line-height: 140%; font-size: 14px;\">&nbsp;</p>\n<p style=\"line-height: 140%; font-size: 14px;\">&nbsp;</p>\n<p style=\"line-height: 140%; font-size: 14px;\">&nbsp;</p>\n<p style=\"line-height: 140%; font-size: 14px;\">&nbsp;</p>"}},{"type":"buttons","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_buttons_1","htmlClassNames":"u_content_buttons"},"selectable":true,"draggable":true,"deletable":true,"buttonLink":{"url":"#","target":"_self"},"text":"Button","animation":"","animationInterval":"2","alignment":"center","buttonStyle":"","isSticky":false,"fontSize":"20px","buttonWidth":"100%","buttonColors":{"color":"#FFF","backgroundColor":"#e65f5f","hoverColor":"#2A92BF"},"borderRadius":"5px","padding":"10px 20px"}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_19","htmlClassNames":"u_column"}}},{"contents":[{"type":"image","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_image_12","htmlClassNames":"u_content_image"},"selectable":true,"draggable":true,"deletable":true,"src":{"url":"https://via.placeholder.com/500x600?text=Product Image","width":500,"height":600},"fullWidth":false,"textAlign":"center","maxWidth":"100%","altText":"Image","action":{"url":"","target":""}}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_20","htmlClassNames":"u_column"}}},{"contents":[{"type":"image","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_image_10","htmlClassNames":"u_content_image"},"selectable":true,"draggable":true,"deletable":true,"src":{"url":"https://via.placeholder.com/500x600?text=Product Image","width":500,"height":600},"fullWidth":false,"textAlign":"center","maxWidth":"100%","altText":"Image","action":{"url":"","target":""}}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_21","htmlClassNames":"u_column"}}},{"contents":[{"type":"image","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_image_11","htmlClassNames":"u_content_image"},"selectable":true,"draggable":true,"deletable":true,"src":{"url":"https://via.placeholder.com/500x600?text=Product Image","width":500,"height":600},"fullWidth":false,"textAlign":"center","maxWidth":"100%","altText":"Image","action":{"url":"","target":""}}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_22","htmlClassNames":"u_column"}}}],"values":{"columns":false,"backgroundColor":"#e89f5e","columnsBackgroundColor":"","backgroundImage":{"url":"","fullWidth":true,"repeat":false,"center":true,"cover":false},"padding":"0px","hideMobile":false,"noStackMobile":false,"_meta":{"htmlID":"u_row_11","htmlClassNames":"u_row"},"selectable":true,"draggable":true,"deletable":true}},
            "displayMode": "web"
        };

        var productDescription4 = {
            "category": "Product Description",
            "tags": ["product description"],
            "data": {"cells":[2,1],"columns":[{"contents":[{"type":"text","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_text_11","htmlClassNames":"u_content_text"},"selectable":true,"draggable":true,"deletable":true,"color":"#121212","textAlign":"left","lineHeight":"140%","text":"<p style=\"font-size: 14px; line-height: 140%;\"><span style=\"font-family: Montserrat, sans-serif; font-size: 14px; line-height: 19.6px;\"><strong><span style=\"font-size: 18px; line-height: 25.2px;\">Product Description</span></strong></span></p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>"}},{"type":"klavio","values":{"containerPadding":"35px","_meta":{"htmlID":"u_content_klavio_1","htmlClassNames":"u_content_klavio"},"selectable":true,"draggable":true,"deletable":true,"kavioAPI":{"apikey":"LKHFxR","elementKlav":"<div class=\"klaviyo-form-PBEvNf\"></div>"}}}],"values":{"backgroundColor":"#ffffff","padding":"0px 20px","border":{},"_meta":{"htmlID":"u_column_19","htmlClassNames":"u_column"}}},{"contents":[{"type":"image","values":{"containerPadding":"0px","_meta":{"htmlID":"u_content_image_10","htmlClassNames":"u_content_image"},"selectable":true,"draggable":true,"deletable":true,"src":{"url":"https://via.placeholder.com/500x700?text=Product Image","width":500,"height":700},"fullWidth":false,"textAlign":"center","maxWidth":"100%","altText":"Image","action":{"url":"","target":""}}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_20","htmlClassNames":"u_column"}}}],"values":{"columns":false,"backgroundColor":"#dedede","columnsBackgroundColor":"#ffffff","backgroundImage":{"url":"","fullWidth":true,"repeat":false,"center":true,"cover":false},"padding":"0px","hideMobile":false,"noStackMobile":false,"_meta":{"htmlID":"u_row_11","htmlClassNames":"u_row"},"selectable":true,"draggable":true,"deletable":true}},
            "displayMode": "web"
        };

        var productDescription5 = {
            "category": "Product Description",
            "tags": ["product description"],
            "data": {"cells":[1,1,1],"columns":[{"contents":[{"type":"image","values":{"containerPadding":"0px","_meta":{"htmlID":"u_content_image_10","htmlClassNames":"u_content_image"},"selectable":true,"draggable":true,"deletable":true,"src":{"url":"https://via.placeholder.com/500x500?text=Product Image","width":500,"height":500},"fullWidth":false,"textAlign":"center","maxWidth":"100%","altText":"Image","action":{"url":"","target":""}}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_19","htmlClassNames":"u_column"}}},{"contents":[{"type":"text","values":{"containerPadding":"17px","_meta":{"htmlID":"u_content_text_11","htmlClassNames":"u_content_text"},"selectable":true,"draggable":true,"deletable":true,"color":"#121212","textAlign":"left","lineHeight":"140%","text":"<p style=\"font-size: 14px; line-height: 140%;\"><span style=\"font-size: 20px; line-height: 28px; font-family: Montserrat, sans-serif;\">Product Description</span></p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>"}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_20","htmlClassNames":"u_column"}}},{"contents":[{"type":"image","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_image_11","htmlClassNames":"u_content_image"},"selectable":true,"draggable":true,"deletable":true,"src":{"url":"https://via.placeholder.com/500x100?text=Trust Badge Image","width":500,"height":100},"fullWidth":false,"textAlign":"center","maxWidth":"100%","altText":"Image","action":{"url":"","target":""}}},{"type":"image","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_image_12","htmlClassNames":"u_content_image"},"selectable":true,"draggable":true,"deletable":true,"src":{"url":"https://via.placeholder.com/500x200?text=Reasons to buy image","width":500,"height":200},"fullWidth":false,"textAlign":"center","maxWidth":"100%","altText":"Image","action":{"url":"","target":""}}},{"type":"buttons","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_buttons_1","htmlClassNames":"u_content_buttons"},"selectable":true,"draggable":true,"deletable":true,"buttonLink":{"url":"#","target":"_self"},"text":"Button","animation":"","animationInterval":"2","alignment":"center","buttonStyle":"","isSticky":false,"fontSize":"20px","buttonWidth":"100%","buttonColors":{"color":"#FFF","backgroundColor":"#26c686","hoverColor":"#2A92BF"},"borderRadius":"5px","padding":"10px 20px"}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_21","htmlClassNames":"u_column"}}}],"values":{"columns":false,"backgroundColor":"#233c4c","columnsBackgroundColor":"","backgroundImage":{"url":"","fullWidth":true,"repeat":false,"center":true,"cover":false},"padding":"0px","hideMobile":false,"noStackMobile":false,"_meta":{"htmlID":"u_row_11","htmlClassNames":"u_row"},"selectable":true,"draggable":true,"deletable":true}},
            "displayMode": "web"
        };

        var productDescription6 = {
            "category": "Product Description",
            "tags": ["product description"],
            "data": {"cells":[1,1,1],"columns":[{"contents":[{"type":"text","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_text_11","htmlClassNames":"u_content_text"},"selectable":true,"draggable":true,"deletable":true,"color":"#121212","textAlign":"left","lineHeight":"140%","text":"<p style=\"font-size: 14px; line-height: 140%;\"><span style=\"font-size: 24px; line-height: 33.6px; font-family: Montserrat, sans-serif;\">This is a new Text block. Change the text.</span></p>"}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_19","htmlClassNames":"u_column"}}},{"contents":[{"type":"image","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_image_10","htmlClassNames":"u_content_image"},"selectable":true,"draggable":true,"deletable":true,"src":{"url":"https://via.placeholder.com/500x500?text=Product Image","width":500,"height":500},"fullWidth":false,"textAlign":"center","maxWidth":"100%","altText":"Image","action":{"url":"","target":""}}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_20","htmlClassNames":"u_column"}}},{"contents":[{"type":"klavio","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_klavio_1","htmlClassNames":"u_content_klavio"},"selectable":true,"draggable":true,"deletable":true,"kavioAPI":{"apikey":"LKHFxR","elementKlav":"<div class=\"klaviyo-form-PBEvNf\"></div>"}}}],"values":{"backgroundColor":"","padding":"20px","border":{},"_meta":{"htmlID":"u_column_21","htmlClassNames":"u_column"}}}],"values":{"columns":false,"backgroundColor":"#ab5fa4","columnsBackgroundColor":"","backgroundImage":{"url":"","fullWidth":true,"repeat":false,"center":true,"cover":false},"padding":"0px","hideMobile":false,"noStackMobile":false,"_meta":{"htmlID":"u_row_11","htmlClassNames":"u_row"},"selectable":true,"draggable":true,"deletable":true}},
            "displayMode": "web"
        };

        var productDescription7 = {
            "category": "Product Description",
            "tags": ["product description"],
            "data": {"cells":[1,1],"columns":[{"contents":[{"type":"text","values":{"containerPadding":"20px","_meta":{"htmlID":"u_content_text_11","htmlClassNames":"u_content_text"},"selectable":true,"draggable":true,"deletable":true,"color":"#121212","textAlign":"left","lineHeight":"140%","text":"<p style=\"font-size: 14px; line-height: 140%;\"><span style=\"font-size: 14px; line-height: 19.6px; font-family: Montserrat, sans-serif;\">Product Description</span></p>"}},{"type":"klavio","values":{"containerPadding":"13px","_meta":{"htmlID":"u_content_klavio_1","htmlClassNames":"u_content_klavio"},"selectable":true,"draggable":true,"deletable":true,"kavioAPI":{"apikey":"LKHFxR","elementKlav":"<div class=\"klaviyo-form-PBEvNf\"></div>"}}}],"values":{"backgroundColor":"#d5f0fc","padding":"0px","border":{},"_meta":{"htmlID":"u_column_19","htmlClassNames":"u_column"}}},{"contents":[{"type":"image","values":{"containerPadding":"0px","_meta":{"htmlID":"u_content_image_10","htmlClassNames":"u_content_image"},"selectable":true,"draggable":true,"deletable":true,"src":{"url":"https://via.placeholder.com/600x370?text=IMAGE","width":600,"height":370},"fullWidth":false,"textAlign":"center","maxWidth":"100%","altText":"Image","action":{"url":"","target":""}}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_20","htmlClassNames":"u_column"}}}],"values":{"columns":false,"backgroundColor":"","columnsBackgroundColor":"","backgroundImage":{"url":"","fullWidth":true,"repeat":false,"center":true,"cover":false},"padding":"0px","hideMobile":false,"noStackMobile":false,"_meta":{"htmlID":"u_row_11","htmlClassNames":"u_row"},"selectable":true,"draggable":true,"deletable":true}},
            "displayMode": "web"
        };

        var testimonial1 = {
            "category": "Testimonial",
            "tags": ["testimonial"],
            "data": {"cells":[1,2],"columns":[{"contents":[{"type":"image","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_image_10","htmlClassNames":"u_content_image"},"selectable":true,"draggable":true,"deletable":true,"src":{"url":"https://via.placeholder.com/500x200?text=IMAGE","width":500,"height":100},"fullWidth":false,"textAlign":"center","maxWidth":"70%","altText":"Image","action":{"url":"","target":""}}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_19","htmlClassNames":"u_column"}}},{"contents":[{"type":"text","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_text_11","htmlClassNames":"u_content_text"},"selectable":true,"draggable":true,"deletable":true,"color":"#121212","textAlign":"left","lineHeight":"140%","text":"<ul class=\"ul1\">\n<li class=\"li1\" style=\"font-size: 12px; line-height: 16.8px;\"><span style=\"font-family: Montserrat, sans-serif; font-size: 14px; line-height: 19.6px;\">Lorem ipsum dolor sit amet, est liber perfecto ad, ut quando laudem comprehensam sea. Ut cum discere concludaturque, deserunt adipisci duo in. Vidisse scripta imperdiet cu pri, congue tincidunt qui no, pro ei noster vituperatoribus. Vis ei utroque oporteat. Ne pri congue commodo deseruisse, consequat sadipscing eum et. Omnis aperiri periculis ei mel.</span></li>\n</ul>\n<p style=\"font-size: 14px; line-height: 140%; text-align: right;\"><span style=\"font-family: Montserrat, sans-serif; font-size: 16px; line-height: 22.4px;\">- Name</span></p>"}}],"values":{"backgroundColor":"","padding":"0px","border":{"borderTopWidth":"0px","borderTopStyle":"solid","borderTopColor":"#CCC","borderLeftWidth":"2px","borderLeftStyle":"solid","borderLeftColor":"#ff8000","borderRightWidth":"0px","borderRightStyle":"solid","borderRightColor":"#CCC","borderBottomWidth":"0px","borderBottomStyle":"solid","borderBottomColor":"#CCC"},"_meta":{"htmlID":"u_column_20","htmlClassNames":"u_column"}}}],"values":{"columns":false,"backgroundColor":"","columnsBackgroundColor":"","backgroundImage":{"url":"","fullWidth":true,"repeat":false,"center":true,"cover":false},"padding":"10px 0px","hideMobile":false,"noStackMobile":false,"_meta":{"htmlID":"u_row_11","htmlClassNames":"u_row"},"selectable":true,"draggable":true,"deletable":true}},
            "displayMode": "web"
        };

        var testimonial2 = {
            "category": "Testimonial",
            "tags": ["testimonial"],
            "data": { "cells": [1, 1, 1, 1], "columns": [{ "contents": [{ "type": "image", "values": { "containerPadding": "10px", "_meta": { "htmlClassNames": "u_content_image" }, "selectable": true, "draggable": true, "deletable": true, "src": { "url": "https://via.placeholder.com/110x80?text=IMAGE", "width": 80, "height": 80 }, "fullWidth": false, "textAlign": "center", "maxWidth": "100%", "altText": "Image", "action": { "url": "", "target": "" } } }, { "type": "text", "values": { "containerPadding": "10px", "_meta": { "htmlClassNames": "u_content_text" }, "selectable": true, "draggable": true, "deletable": true, "color": "#121212", "textAlign": "left", "lineHeight": "140%", "text": "<ul class=\"ul1\">\n<li class=\"li1\" style=\"font-size: 12px; line-height: 16.8px;\"><span style=\"color: #000000; font-size: 12px; line-height: 16.8px; font-family: Montserrat, sans-serif;\">Lorem ipsum dolor sit amet, est liber perfecto ad, ut quando laudem comprehensam sea.&nbsp;</span></li>\n</ul>" } }, { "type": "text", "values": { "containerPadding": "10px", "_meta": { "htmlClassNames": "u_content_text" }, "selectable": true, "draggable": true, "deletable": true, "color": "#121212", "textAlign": "left", "lineHeight": "140%", "text": "<p style=\"font-size: 14px; line-height: 140%; text-align: right;\"><span style=\"font-size: 14px; line-height: 19.6px; color: #000000;\"><strong><span style=\"font-size: 16px; line-height: 22.4px; font-family: Montserrat, sans-serif;\">- Name</span></strong></span></p>" } }], "values": { "backgroundColor": "", "padding": "0px", "border": {}, "_meta": { "htmlClassNames": "u_column" } } }, { "contents": [{ "type": "image", "values": { "containerPadding": "10px", "_meta": { "htmlClassNames": "u_content_image" }, "selectable": true, "draggable": true, "deletable": true, "src": { "url": "https://via.placeholder.com/110x80?text=IMAGE", "width": 80, "height": 80 }, "fullWidth": false, "textAlign": "center", "maxWidth": "100%", "altText": "Image", "action": { "url": "", "target": "" } } }, { "type": "text", "values": { "containerPadding": "10px", "_meta": { "htmlClassNames": "u_content_text" }, "selectable": true, "draggable": true, "deletable": true, "color": "#121212", "textAlign": "left", "lineHeight": "140%", "text": "<ul class=\"ul1\">\n<li class=\"li1\" style=\"font-size: 12px; line-height: 16.8px;\"><span style=\"font-family: Montserrat, sans-serif; font-size: 12px; line-height: 16.8px; color: #000000;\">Lorem ipsum dolor sit amet, est liber perfecto ad, ut quando laudem comprehensam sea. Ut cum discere concludaturque, deserunt adipisci duo in. Vidisse scripta imperdiet cu pri, congue tincidunt qui no, pro ei noster vituperatoribus. Vis ei utroque oporteat.&nbsp;</span></li>\n</ul>" } }, { "type": "text", "values": { "containerPadding": "10px", "_meta": { "htmlClassNames": "u_content_text" }, "selectable": true, "draggable": true, "deletable": true, "color": "#121212", "textAlign": "left", "lineHeight": "140%", "text": "<p style=\"font-size: 14px; line-height: 140%; text-align: right;\"><strong><span style=\"font-size: 16px; line-height: 22.4px; font-family: Montserrat, sans-serif;\">- Name</span></strong></p>" } }], "values": { "backgroundColor": "", "padding": "0px", "border": {}, "_meta": { "htmlClassNames": "u_column" } } }, { "contents": [{ "type": "image", "values": { "containerPadding": "10px", "_meta": { "htmlClassNames": "u_content_image" }, "selectable": true, "draggable": true, "deletable": true, "src": { "url": "https://via.placeholder.com/110x80?text=IMAGE", "width": 80, "height": 80 }, "fullWidth": false, "textAlign": "center", "maxWidth": "100%", "altText": "Image", "action": { "url": "", "target": "" } } }, { "type": "text", "values": { "containerPadding": "10px", "_meta": { "htmlClassNames": "u_content_text" }, "selectable": true, "draggable": true, "deletable": true, "color": "#121212", "textAlign": "left", "lineHeight": "140%", "text": "<ul class=\"ul1\">\n<li class=\"li1\" style=\"font-size: 12px; line-height: 16.8px;\"><span style=\"font-family: Montserrat, sans-serif; font-size: 12px; line-height: 16.8px; color: #000000;\">Lorem ipsum dolor sit amet, est liber perfecto ad, ut quando laudem comprehensam sea. Ut cum discere concludaturque, deserunt adipisci duo in.&nbsp;</span></li>\n</ul>" } }, { "type": "text", "values": { "containerPadding": "10px", "_meta": { "htmlClassNames": "u_content_text" }, "selectable": true, "draggable": true, "deletable": true, "color": "#121212", "textAlign": "left", "lineHeight": "140%", "text": "<p style=\"font-size: 14px; line-height: 140%; text-align: right;\"><strong><span style=\"font-size: 16px; line-height: 22.4px; font-family: Montserrat, sans-serif;\">- Name</span></strong></p>" } }], "values": { "backgroundColor": "", "padding": "0px", "border": {}, "_meta": { "htmlClassNames": "u_column" } } }, { "contents": [{ "type": "image", "values": { "containerPadding": "10px", "_meta": { "htmlClassNames": "u_content_image" }, "selectable": true, "draggable": true, "deletable": true, "src": { "url": "https://via.placeholder.com/110x80?text=IMAGE", "width": 80, "height": 80 }, "fullWidth": false, "textAlign": "center", "maxWidth": "100%", "altText": "Image", "action": { "url": "", "target": "" } } }, { "type": "text", "values": { "containerPadding": "10px", "_meta": { "htmlClassNames": "u_content_text" }, "selectable": true, "draggable": true, "deletable": true, "color": "#121212", "textAlign": "left", "lineHeight": "140%", "text": "<ul class=\"ul1\">\n<li class=\"li1\" style=\"font-size: 12px; line-height: 16.8px;\"><span style=\"font-family: Montserrat, sans-serif; font-size: 12px; line-height: 16.8px; color: #000000;\">Lorem ipsum dolor sit amet, est liber perfecto ad, ut quando laudem comprehensam sea.&nbsp;</span></li>\n</ul>" } }, { "type": "text", "values": { "containerPadding": "10px", "_meta": { "htmlClassNames": "u_content_text" }, "selectable": true, "draggable": true, "deletable": true, "color": "#121212", "textAlign": "left", "lineHeight": "140%", "text": "<p style=\"font-size: 14px; line-height: 140%; text-align: right;\"><strong><span style=\"font-size: 16px; line-height: 22.4px; font-family: Montserrat, sans-serif;\">- Name</span></strong></p>" } }], "values": { "backgroundColor": "", "padding": "0px", "border": {}, "_meta": { "htmlClassNames": "u_column" } } }], "values": { "columns": false, "backgroundColor": "", "columnsBackgroundColor": "", "backgroundImage": { "url": "", "fullWidth": true, "repeat": false, "center": true, "cover": false }, "padding": "20px 0px 0px", "hideMobile": false, "noStackMobile": false, "_meta": { "htmlClassNames": "u_row" }, "selectable": true, "draggable": true, "deletable": true } },
            "displayMode": "web"
        };

        var testimonial3 = {
            "category": "Testimonial",
            "tags": ["testimonial"],
            "data": {"cells":[1,2,1,2],"columns":[{"contents":[{"type":"image","values":{"containerPadding":"40px 10px 40px 10px","_meta":{"htmlID":"u_content_image_10","htmlClassNames":"u_content_image"},"selectable":true,"draggable":true,"deletable":true,"src":{"url":"https://via.placeholder.com/114?text=IMAGE","width":80,"height":80},"fullWidth":false,"textAlign":"center","maxWidth":"100%","altText":"Image","action":{"url":"","target":""}}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_19","htmlClassNames":"u_column"}}},{"contents":[{"type":"text","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_text_11","htmlClassNames":"u_content_text"},"selectable":true,"draggable":true,"deletable":true,"color":"#121212","textAlign":"left","lineHeight":"160%","text":"<p style=\"font-size: 14px; line-height: 160%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 160%;\"><span style=\"font-size: 12px; line-height: 19.2px; font-family: Montserrat, sans-serif;\"><span style=\"font-size: 20px; line-height: 32px;\"><strong><span style=\"line-height: 32px; color: #339966; font-size: 20px;\">\"&nbsp;</span></strong></span>Lorem ipsum dolor sit amet, est liber perfecto ad, ut quando laudem comprehensam sea. Ut cum discere concludaturque, deserunt adipisci duo in. Vidisse scripta imperdiet cu pri, congue tincidunt qui no, pro ei noster vituperatoribus.&nbsp;<span style=\"color: #339966; font-size: 20px; line-height: 32px;\"><strong><span style=\"line-height: 32px; font-size: 20px;\">\"</span></strong></span></span></p>\n<p style=\"font-size: 14px; line-height: 160%;\">&nbsp;</p>"}},{"type":"text","values":{"containerPadding":"20px","_meta":{"htmlID":"u_content_text_12","htmlClassNames":"u_content_text"},"selectable":true,"draggable":true,"deletable":true,"color":"#121212","textAlign":"left","lineHeight":"140%","text":"<p style=\"font-size: 14px; line-height: 140%; text-align: right;\"><span style=\"color: #339966; font-size: 14px; line-height: 19.6px;\"><strong><span style=\"font-size: 14px; line-height: 19.6px; font-family: Montserrat, sans-serif;\">-NAME</span></strong></span></p>"}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_20","htmlClassNames":"u_column"}}},{"contents":[{"type":"image","values":{"containerPadding":"40px 10px 40px 10px","_meta":{"htmlID":"u_content_image_11","htmlClassNames":"u_content_image"},"selectable":true,"draggable":true,"deletable":true,"src":{"url":"https://via.placeholder.com/114?text=IMAGE","width":80,"height":80},"fullWidth":false,"textAlign":"center","maxWidth":"100%","altText":"Image","action":{"url":"","target":""}}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_21","htmlClassNames":"u_column"}}},{"contents":[{"type":"text","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_text_13","htmlClassNames":"u_content_text"},"selectable":true,"draggable":true,"deletable":true,"color":"#121212","textAlign":"left","lineHeight":"160%","text":"<p style=\"line-height: 160%; font-size: 14px;\">&nbsp;</p>\n<p style=\"line-height: 160%; font-size: 14px;\"><span style=\"font-family: Montserrat, sans-serif; font-size: 20px; line-height: 32px;\"><strong><span style=\"line-height: 32px; color: #339966; font-size: 20px;\">\"&nbsp;</span></strong></span><span style=\"font-family: Montserrat, sans-serif; font-size: 12px; line-height: 19.2px;\">Lorem ipsum dolor sit amet, est liber perfecto ad, ut quando laudem comprehensam sea. Ut cum discere concludaturque, deserunt adipisci duo in.&nbsp;&nbsp;</span><span style=\"font-family: Montserrat, sans-serif; color: #339966; font-size: 20px; line-height: 32px;\"><strong><span style=\"line-height: 32px; font-size: 20px;\">\"</span></strong></span></p>"}},{"type":"text","values":{"containerPadding":"20px","_meta":{"htmlID":"u_content_text_14","htmlClassNames":"u_content_text"},"selectable":true,"draggable":true,"deletable":true,"color":"#121212","textAlign":"left","lineHeight":"140%","text":"<p style=\"font-size: 14px; line-height: 140%; text-align: right;\"><span style=\"color: #339966; font-size: 14px; line-height: 19.6px;\"><strong><span style=\"font-size: 14px; line-height: 19.6px; font-family: Montserrat, sans-serif;\">-NAME</span></strong></span></p>"}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_22","htmlClassNames":"u_column"}}}],"values":{"columns":false,"backgroundColor":"","columnsBackgroundColor":"","backgroundImage":{"url":"","fullWidth":true,"repeat":false,"center":true,"cover":false},"padding":"0px","hideMobile":false,"noStackMobile":false,"_meta":{"htmlID":"u_row_11","htmlClassNames":"u_row"},"selectable":true,"draggable":true,"deletable":true}},
            "displayMode": "web"
        };

        var trustBadge1 = {
            "category": "Trust Badge",
            "tags": ["trust badge"],
            "data": {"cells":[1],"columns":[{"contents":[{"type":"image","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_image_10","htmlClassNames":"u_content_image"},"selectable":true,"draggable":true,"deletable":true,"src":{"url":"https://cdn.productlistgenie.com/images/15599280323315reasons_1000x500.png","width":1000,"height":238},"fullWidth":false,"textAlign":"center","maxWidth":"100%","altText":"Image","action":{"url":"","target":""}}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_19","htmlClassNames":"u_column"}}}],"values":{"columns":false,"backgroundColor":"","columnsBackgroundColor":"","backgroundImage":{"url":"","fullWidth":true,"repeat":false,"center":true,"cover":false},"padding":"0px","hideMobile":false,"noStackMobile":false,"_meta":{"htmlID":"u_row_11","htmlClassNames":"u_row"},"selectable":true,"draggable":true,"deletable":true}},
            "displayMode": "web"
        };

        var guaranteeSeal1 = {
            "category": "Guarantee Seal",
            "tags": ["guarantee seal"],
            "data": {"cells":[1,1,1],"columns":[{"contents":[],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_20","htmlClassNames":"u_column"}}},{"contents":[{"type":"text","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_text_11","htmlClassNames":"u_content_text"},"selectable":true,"draggable":true,"deletable":true,"color":"#121212","textAlign":"center","lineHeight":"140%","text":"<p style=\"font-size: 14px; line-height: 140%;\"><strong><span style=\"font-family: Montserrat, sans-serif; font-size: 14px; line-height: 19.6px;\"><span style=\"font-size: 24px; line-height: 33.6px;\">OUR GUARANTEE</span></span></strong></p>"}},{"type":"image","values":{"containerPadding":"10px","_meta":{"htmlID":"u_content_image_10","htmlClassNames":"u_content_image"},"selectable":true,"draggable":true,"deletable":true,"src":{"url":"https://cdn.productlistgenie.com/images/1559927422121kisspng-customer-satisfaction-guarantee-stock-photography-100-guaranteed-5b41e893409e43.0323872315310460352647.png","width":600,"height":474},"fullWidth":false,"textAlign":"center","maxWidth":"75%","altText":"GUARANTEE LOGO","action":{"url":"","target":""}}},{"type":"text","values":{"containerPadding":"20px","_meta":{"htmlID":"u_content_text_13","htmlClassNames":"u_content_text"},"selectable":true,"draggable":true,"deletable":true,"color":"#121212","textAlign":"left","lineHeight":"200%","text":"<ul>\n<li style=\"font-size: 14px; line-height: 28px;\"><span style=\"font-size: 14px; line-height: 28px; font-family: Montserrat, sans-serif;\">Lorem ipsum dolor sit amet, est liber perfecto ad, ut quando laudem comprehensam sea.</span></li>\n<li style=\"line-height: 28px; font-size: 14px;\"><span style=\"line-height: 28px; font-size: 14px;\"><span style=\"font-family: Montserrat, sans-serif; font-size: 14px; line-height: 28px;\">Lorem ipsum dolor sit amet, est liber perfecto ad, ut quando laudem comprehensam sea.</span></span></li>\n<li style=\"line-height: 28px; font-size: 14px;\"><span style=\"line-height: 28px; font-size: 14px;\"><span style=\"font-family: Montserrat, sans-serif; font-size: 14px; line-height: 28px;\"> Vidisse scripta imperdiet cu pri, congue tincidunt qui no, pro ei noster vituperatoribus.</span></span></li>\n</ul>"}}],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_21","htmlClassNames":"u_column"}}},{"contents":[],"values":{"backgroundColor":"","padding":"0px","border":{},"_meta":{"htmlID":"u_column_22","htmlClassNames":"u_column"}}}],"values":{"columns":false,"backgroundColor":"","columnsBackgroundColor":"","backgroundImage":{"url":"","fullWidth":true,"repeat":false,"center":true,"cover":false},"padding":"0px","hideMobile":false,"noStackMobile":false,"_meta":{"htmlID":"u_row_12","htmlClassNames":"u_row"},"selectable":true,"draggable":true,"deletable":true}},
            "displayMode": "web"
        };

        var footer = {
            "category": "Footer",
            "tags": ["footer"],
            "data": { "cells": [1], "columns": [{ "contents": [{ "type": "text", "values": { "containerPadding": "10px", "_meta": { "htmlClassNames": "u_content_text" }, "selectable": true, "draggable": true, "deletable": true, "color": "rgba(0,0,0,0)", "textAlign": "left", "lineHeight": "140%", "text": "<p style=\"text-align: center; line-height: 140%; font-size: 14px;\"><span style=\"color: #ffffff; font-family: Roboto, Helvetica, sans-serif; font-size: 14px; line-height: 19.6px;\"><span style=\"font-size: 16px; line-height: 22.4px;\">Questions? contact us at <a style=\"color: #ffffff;\" href=\"mailto:[shop_email]\">[shop_email]</a></span></span></p>\n<p style=\"text-align: center; line-height: 140%; font-size: 14px;\"><span style=\"color: #ffffff; font-family: Roboto, Helvetica, sans-serif; font-size: 14px; line-height: 19.6px;\"><span style=\"font-size: 16px; line-height: 22.4px;\">Call us at [shop_phone]</span></span></p>" } }, { "type": "text", "values": { "containerPadding": "10px", "_meta": { "htmlClassNames": "u_content_text" }, "selectable": true, "draggable": true, "deletable": true, "color": "#121212", "textAlign": "left", "lineHeight": "140%", "text": "<p style=\"text-align: center; font-size: 14px; line-height: 140%;\"><span style=\"font-size: 14px; line-height: 19.6px; color: #ffffff;\"><a style=\"color: #ffffff;\" href=\""+params.pages.filter(el => el.includes("contact-us")).toString()+"\">Contact us</a>&nbsp;-&nbsp;<a style=\"color: #ffffff;\" href=\""+params.pages.filter(el => el.includes("terms-of-service")).toString()+"\">Terms of Service</a>&nbsp;-&nbsp;<a style=\"color: #ffffff;\" href=\""+params.pages.filter(el => el.includes("privacy-policy")).toString()+"\">Privacy Policy -</a> <a style=\"color: #ffffff;\" href=\""+params.pages.filter(el => el.includes("refund-policy")).toString()+"\">Refund Policy -</a> <a style=\"color: #ffffff;\" href=\""+params.pages.filter(el => el.includes("faqs")).toString()+"\">FAQs</a></span></p>" } }, { "type": "html", "values": { "containerPadding": "0px", "_meta": { "htmlClassNames": "u_content_html" }, "selectable": true, "draggable": true, "deletable": true, "html": "<style>\n  .u_row:last-child .row a {\n    text-decoration: none;\n  }\n</style>" } }], "values": { "backgroundColor": "", "padding": "0px", "border": {}, "_meta": { "htmlClassNames": "u_column" } } }], "values": { "columns": false, "backgroundColor": "#5b5b5b", "columnsBackgroundColor": "", "backgroundImage": { "url": "", "fullWidth": true, "repeat": false, "center": true, "cover": false }, "padding": "10px", "hideMobile": false, "noStackMobile": false, "_meta": { "htmlClassNames": "u_row" }, "selectable": true, "draggable": true, "deletable": true } },
            "displayMode": "web"
        };

        let stripeDOM = `
            <div class="stripe-form column column_12_12 clear">
                <div class="globalContent">
                    <main>
                        <section class="container-lg">
                            <div class="cell example example5" id="example-5">
                                <form class="payment-form">
                                    <div id="example5-paymentRequest" style="display: none;">
                                        <!--Stripe paymentRequestButton Element inserted here-->
                                    </div>
                                    <fieldset>
                                        <legend class="card-only" data-tid="elements_examples.form.pay_with_card" style="display: none;">Pay with card</legend>
                                        <legend class="payment-request-available" data-tid="elements_examples.form.enter_card_manually" style="display: none;">Or enter card details</legend>
                                        <div class="row">
                                            <div class="field">
                                                <label>\$\{values.shippingHeader\}</label>
                                                <input id="example5-name" name="name" data-tid="elements_examples.form.name_placeholder" class="input" type="text" placeholder="\$\{values.fullName\}" required="" autocomplete="name">
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="field">
                                                <input id="example5-email" name="email" data-tid="elements_examples.form.email_placeholder" class="input" type="text" placeholder="\$\{values.email\}" required="" autocomplete="email">
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="field">
                                                <input id="example5-phone" name="phone" data-tid="elements_examples.form.phone_placeholder" class="input" type="text" placeholder="\$\{values.phone\}" required="" autocomplete="tel">
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="field">
                                                <input id="example5-address" data-tid="elements_examples.form.address_placeholder" class="input" type="text" placeholder="\$\{values.address\}" required="" autocomplete="address-line1">
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="field">
                                                <input id="example5-state" data-tid="elements_examples.form.state_placeholder" class="input empty" type="text" placeholder="\$\{values.state\}" required="" autocomplete="address-level1">
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="field">
                                                ${this.getCountryList()}
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="field">
                                                <input id="example5-city" data-tid="elements_examples.form.city_placeholder" class="input" type="text" placeholder="\$\{values.city\}" required="" autocomplete="address-level2">
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="field">
                                                <input id="example5-zip" data-tid="elements_examples.form.postal_code_placeholder" class="input empty" type="text" placeholder="\$\{values.zipcode\}" required="" autocomplete="postal-code">
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="field">
                                                <label for="example5-card" data-tid="elements_examples.form.card_label">\$\{values.creditCard\}</label>
                                                <div id="example5-card" class="input"></div>
                                            </div>
                                        </div>
                                        <!-- Billing information -->
                                        <div class="field">
                                            <label onclick="typeof toggleBillingAddress != 'undefined' ? toggleBillingAddress(this) : void 0" style="margin: 0 0 5px; cursor: pointer; text-decoration: underline;">\$\{values.billingAddress1\}</label>
                                        </div>
                                        <div id="billing_form" style="display: none;">
                                            <div class="row">
                                                <div class="field">
                                                    <input id="example5-billing_email" data-tid="elements_examples.form.email_placeholder" class="input" type="text" placeholder="\$\{values.email\}" autocomplete="email">
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="field">
                                                    <input id="example5-billing_phone" data-tid="elements_examples.form.phone_placeholder" class="input" type="text" placeholder="\$\{values.phone\}" autocomplete="tel">
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="field">
                                                    <input id="example5-billing_address" data-tid="elements_examples.form.address_placeholder" class="input" type="text" placeholder="\$\{values.address\}" autocomplete="address-line1">
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="field">
                                                    <input id="example5-billing_state" data-tid="elements_examples.form.state_placeholder" class="input empty" type="text" placeholder="\$\{values.state\}" autocomplete="address-level1">
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="field">
                                                    ${this.getCountryList("billing_")}
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="field">
                                                    <input id="example5-billing_city" data-tid="elements_examples.form.city_placeholder" class="input" type="text" placeholder="\$\{values.city\}" autocomplete="address-level2">
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="field">
                                                    <input id="example5-billing_zip" data-tid="elements_examples.form.postal_code_placeholder" class="input empty" type="text" placeholder="\$\{values.zipcode\}" autocomplete="postal-code">
                                                </div>
                                            </div>
                                        </div>
                                        <button type="submit" data-tid="elements_examples.form.pay_button" id="stripe-checkout-button">\$\{values.submitLabel\}</button>
                                    </fieldset>
                                    <div class="error" role="alert">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 17 17">
                                            <path class="base" fill="#121212" d="M8.5,17 C3.80557963,17 0,13.1944204 0,8.5 C0,3.80557963 3.80557963,0 8.5,0 C13.1944204,0 17,3.80557963 17,8.5 C17,13.1944204 13.1944204,17 8.5,17 Z"></path>
                                            <path class="glyph" fill="#FFF" d="M8.5,7.29791847 L6.12604076,4.92395924 C5.79409512,4.59201359 5.25590488,4.59201359 4.92395924,4.92395924 C4.59201359,5.25590488 4.59201359,5.79409512 4.92395924,6.12604076 L7.29791847,8.5 L4.92395924,10.8739592 C4.59201359,11.2059049 4.59201359,11.7440951 4.92395924,12.0760408 C5.25590488,12.4079864 5.79409512,12.4079864 6.12604076,12.0760408 L8.5,9.70208153 L10.8739592,12.0760408 C11.2059049,12.4079864 11.7440951,12.4079864 12.0760408,12.0760408 C12.4079864,11.7440951 12.4079864,11.2059049 12.0760408,10.8739592 L9.70208153,8.5 L12.0760408,6.12604076 C12.4079864,5.79409512 12.4079864,5.25590488 12.0760408,4.92395924 C11.7440951,4.59201359 11.2059049,4.59201359 10.8739592,4.92395924 L8.5,7.29791847 L8.5,7.29791847 Z"></path>
                                        </svg>
                                        <span class="message"></span>
                                    </div>
                                </form>
                                <div class="success">
                                    <div class="icon">
                                        <svg width="84px" height="84px" viewBox="0 0 84 84" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                                            <circle class="border" cx="42" cy="42" r="40" stroke-linecap="round" stroke-width="4" stroke="#121212" fill="none"></circle>
                                            <path class="checkmark" stroke-linecap="round" stroke-linejoin="round" d="M23.375 42.5488281 36.8840688 56.0578969 64.891932 28.0500338" stroke-width="4" stroke="#121212" fill="none"></path>
                                        </svg>
                                    </div>
                                    <h3 class="title" data-tid="elements_examples.success.title">Payment successful</h3>
                                    <p class="message">
                                        <span data-tid="elements_examples.success.message"></span>
                                        <span class="token" style="display: none"></span>
                                    </p>
                                    <a class="reset" href="#">
                                        <svg width="32px" height="32px" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                                            <path fill="#121212" d="M15,7.05492878 C10.5000495,7.55237307 7,11.3674463 7,16 C7,20.9705627 11.0294373,25 16,25 C20.9705627,25 25,20.9705627 25,16 C25,15.3627484 24.4834055,14.8461538 23.8461538,14.8461538 C23.2089022,14.8461538 22.6923077,15.3627484 22.6923077,16 C22.6923077,19.6960595 19.6960595,22.6923077 16,22.6923077 C12.3039405,22.6923077 9.30769231,19.6960595 9.30769231,16 C9.30769231,12.3039405 12.3039405,9.30769231 16,9.30769231 L16,12.0841673 C16,12.1800431 16.0275652,12.2738974 16.0794108,12.354546 C16.2287368,12.5868311 16.5380938,12.6540826 16.7703788,12.5047565 L22.3457501,8.92058924 L22.3457501,8.92058924 C22.4060014,8.88185624 22.4572275,8.83063012 22.4959605,8.7703788 C22.6452866,8.53809377 22.5780351,8.22873685 22.3457501,8.07941076 L22.3457501,8.07941076 L16.7703788,4.49524351 C16.6897301,4.44339794 16.5958758,4.41583275 16.5,4.41583275 C16.2238576,4.41583275 16,4.63969037 16,4.91583275 L16,7 L15,7 L15,7.05492878 Z M16,32 C7.163444,32 0,24.836556 0,16 C0,7.163444 7.163444,0 16,0 C24.836556,0 32,7.163444 32,16 C32,24.836556 24.836556,32 16,32 Z">
                                            </path>
                                        </svg>
                                    </a>
                                </div>
                            </div>
                        </section>
                    </main>
                </div>
                <script src="https://js.stripe.com/v3/"></script>
                <script>
                    let addInitiateCheckoutFn = \$\{addInitiateCheckoutFn\};
                    let addToCartFn = \$\{addToCartFn\};
                    let purchasedFn = \$\{purchasedFn\};
                    addInitiateCheckoutFn("${this.state.page_data.funnel_snapchat_id}", \$\{values.fbInitiate\}, "\$\{values._meta.htmlID\}", "[name='name'],[name='email']");

                    var stripe = Stripe("${public_key}");
                    // remove localstorage from previous session of stripe
                    localStorage.removeItem("plg_prod_list");
                    localStorage.removeItem("stripe_user_id");
                    localStorage.removeItem("stripe_currency");
                    localStorage.removeItem("plg_email_id");
                    localStorage.removeItem("cod_data");
                    localStorage.removeItem("cod_currency");
                    var isSameAsShippingAddress = true;
                    function toggleBillingAddress(event){
                        isSameAsShippingAddress = !isSameAsShippingAddress;
                        var billingDOM = document.getElementById("billing_form");
                        if(billingDOM.style.display == "none"){
                            billingDOM.style.display = "block";
                            event.innerText = "\$\{values.billingAddress2\}";
                            // add the required attribute
                            document.getElementById("billing_form").querySelectorAll("input").forEach(el => {
                                el.required = true;
                            })
                        } else {
                            billingDOM.style.display = "none";
                            event.innerText = "\$\{values.billingAddress1\}";
                            // reset the text boxes and remove the required attribute
                            document.getElementById("billing_form").querySelectorAll("input").forEach(el => {
                                el.value = "";
                                el.required = false;
                            })
                        }
                    }
                    function registerElements(elements, exampleName) {
                        var formClass = '.' + exampleName;
                        var example = document.querySelector(formClass);
                        var form = example.querySelector('form');
                        var resetButton = example.querySelector('a.reset');
                        var error = form.querySelector('.error');
                        var errorMessage = error.querySelector('.message');
                        function enableInputs() {
                            Array.prototype.forEach.call(
                                form.querySelectorAll(
                                    "input[type='text'], input[type='email'], input[type='tel']"
                                ),
                                function (input) {
                                    input.removeAttribute('disabled');
                                }
                            );
                        }
                        function disableInputs() {
                            Array.prototype.forEach.call(
                                form.querySelectorAll(
                                    "input[type='text'], input[type='email'], input[type='tel']"
                                ),
                                function (input) {
                                    input.setAttribute('disabled', 'true');
                                }
                            );
                        }
                        function triggerBrowserValidation() {
                            // The only way to trigger HTML5 form validation UI is to fake a user submit
                            // event.
                            var submit = document.createElement('input');
                            submit.type = 'submit';
                            submit.style.display = 'none';
                            form.appendChild(submit);
                            submit.click();
                            submit.remove();
                        }
                        // Listen for errors from each Element, and show error messages in the UI.
                        var savedErrors = {};
                        elements.forEach(function (element, idx) {
                            element.on('change', function (event) {
                                if (event.error) {
                                    error.classList.add('visible');
                                    savedErrors[idx] = event.error.message;
                                    errorMessage.innerText = event.error.message;
                                } else {
                                    savedErrors[idx] = null;
                                    // Loop over the saved errors and find the first one, if any.
                                    var nextError = Object.keys(savedErrors)
                                        .sort()
                                        .reduce(function (maybeFoundError, key) {
                                            return maybeFoundError || savedErrors[key];
                                        }, null);
                                    if (nextError) {
                                        // Now that they've fixed the current error, show another one.
                                        errorMessage.innerText = nextError;
                                    } else {
                                        // The user fixed the last error; no more errors.
                                        error.classList.remove('visible');
                                    }
                                }
                            });
                        });
                        // Listen on the form's 'submit' handler...
                        form.addEventListener('submit', function (e) {
                            e.preventDefault();
                            // Trigger HTML5 validation UI on the form if any of the inputs fail
                            // validation.
                            var plainInputsValid = true;
                            Array.prototype.forEach.call(form.querySelectorAll('input'), function (
                                input
                            ) {
                                if (input.checkValidity && !input.checkValidity()) {
                                    plainInputsValid = false;
                                    return;
                                }
                            });
                            if (!plainInputsValid) {
                                triggerBrowserValidation();
                                return;
                            }
                            // Show a loading screen...
                            example.classList.add('submitting');
                            // Disable all inputs.
                            disableInputs();
                            // Gather additional customer data we may have collected in our form.
                            var email = form.querySelector('#' + exampleName + '-email');
                            var name = form.querySelector('#' + exampleName + '-name');
                            var phone = form.querySelector('#' + exampleName + '-phone');
                            var address1 = form.querySelector('#' + exampleName + '-address');
                            var city = form.querySelector('#' + exampleName + '-city');
                            var state = form.querySelector('#' + exampleName + '-state');
                            var country = form.querySelector('[name="country"]');
                            var zip = form.querySelector('#' + exampleName + '-zip');
                            // Billing address
                            var billing_email = form.querySelector('#' + exampleName + '-billing_email');
                            var billing_phone = form.querySelector('#' + exampleName + '-billing_phone');
                            var billing_address1 = form.querySelector('#' + exampleName + '-billing_address');
                            var billing_city = form.querySelector('#' + exampleName + '-billing_city');
                            var billing_state = form.querySelector('#' + exampleName + '-billing_state');
                            var billing_country = form.querySelector('[name="billing_country"]');
                            var billing_zip = form.querySelector('#' + exampleName + '-billing_zip');
                            var additionalData = {
                                email: email ? email.value : undefined,
                                name: name ? name.value : undefined,
                                phone: phone ? phone.value : undefined,
                                address_line1: address1 ? address1.value : undefined,
                                address_city: city ? city.value : undefined,
                                address_country: country ? country.value : undefined,
                                address_state: state ? state.value : undefined,
                                address_zip: zip ? zip.value : undefined
                            };
                            additionalData.billing_email = billing_email.value ? billing_email.value : additionalData.email,
                            additionalData.billing_phone = billing_phone.value ? billing_phone.value : additionalData.phone,
                            additionalData.billing_address_line1 = billing_address1.value ? billing_address1.value : additionalData.address_line1,
                            additionalData.billing_address_city = billing_city.value ? billing_city.value : additionalData.address_city,
                            additionalData.billing_address_country = billing_country.value ? billing_country.value : additionalData.address_country,
                            additionalData.billing_address_state = billing_state.value ? billing_state.value : additionalData.address_state,
                            additionalData.billing_address_zip = billing_zip.value ? billing_zip.value : additionalData.address_zip
                            // for sending order confirmation
                            localStorage.setItem("funnel_customer_name", additionalData.name)
                            localStorage.setItem("funnel_customer_email", additionalData.email)
                            // Use Stripe.js to create a token. We only need to pass in one Element
                            // from the Element group in order to create a token. We can also pass
                            // in the additional customer data we collected in our form.
                            stripe.createToken(elements[0], additionalData).then(async function (result) {
                                if (result.token) {
                                    sendTokenToServer(result.token, err => {
                                        if (!err) {
                                            // Stop loading!
                                            example.classList.remove('submitting');
                                            // If we received a token, show the token ID.
                                            example.querySelector('.token').innerText = result.token.id;
                                            example.classList.add('submitted');
                                            // redirection after payment
                                            window.open("\$\{values.submitAction.url\}", "\$\{values.submitAction.target\}");
                                        } else {
                                            errorMessage.innerText = err;
                                            example.classList.remove('submitting');
                                            enableInputs();
                                        }
                                    });
                                } else {
                                    // Otherwise, un-disable inputs.
                                    example.classList.remove('submitting');
                                    enableInputs();
                                    alert(result.error.message);
                                }
                            });
                        });
                        resetButton.addEventListener('click', function (e) {
                            e.preventDefault();
                            // Resetting the form (instead of setting the value to for each input)
                            // helps us clear webkit autofill styles.
                            form.reset();
                            // Clear each Element.
                            elements.forEach(function (element) {
                                element.clear();
                            });
                            // Reset error state as well.
                            error.classList.remove('visible');
                            // Resetting the form does not un-disable inputs, so we need to do it separately:
                            enableInputs();
                            example.classList.remove('submitted');
                        });
                    }
                </script>
                <script>
                    function stripeDollar(val) {
                        var str, pos, rnd = 0;
                        if (val < .995) rnd = 1;
                        str = escape(val * 1.0 + 0.005001 + rnd);
                        pos = str.indexOf(".");
                        if (pos > 0) str = str.substring(rnd, pos + 3);
                        return str.replace(".", "");
                    }
                    (function() {
                        "use strict";
                        let elements = stripe.elements({ locale: 'auto' });
                        var card = elements.create("card", {
                            iconStyle: "solid",
                            style: {
                                base: {
                                    fontWeight: 400,
                                    fontFamily: "Helvetica Neue, Helvetica, Arial, sans-serif",
                                    fontSize: "16px",
                                    fontSmoothing: "antialiased"
                                }
                            }
                        });
                        card.mount("#example5-card");
                        var paymentRequest = stripe.paymentRequest({
                            country: "\$\{defaultCountry\}",
                            currency: "\$\{defaultCurrency\}",
                            total: {
                                amount: parseFloat(stripeDollar(plg_price)),
                                label: "Total"
                            }
                        });
                        paymentRequest.on("token", function(result) {
                            sendTokenToServer(result.token, err => {
                                var example = document.querySelector(".example5");
                                example.querySelector(".token").innerText = result.token.id;
                                example.classList.add("submitted");
                                result.complete("success");
                    
                                // redirection after payment
                                window.open("\$\{values.submitAction.url\}", "\$\{values.submitAction.target\}");
                            })
                        });
                        var paymentRequestElement = elements.create("paymentRequestButton", {
                            paymentRequest: paymentRequest,
                            style: {
                                paymentRequestButton: {
                                    theme: "light"
                                }
                            }
                        });
                        paymentRequest.canMakePayment().then(function(result) {
                            if (result) {
                                document.querySelector(".example5 .card-only").style.display = "none";
                                document.querySelector(".example5 .payment-request-available").style.display = "block";
                                paymentRequestElement.mount("#example5-paymentRequest");
                            }
                        });
                        registerElements([card], "example5");
                    })()
                </script>
                <script>
                    function sendTokenToServer(token, callback) {
                        if (!plg_price) {
                            alert("Please select variant.");
                            document.querySelector(".example5").classList.remove("submitting");
                            return;
                        }
                        addToCartFn(\$\{values.fbTrack\});
                        try {
                            token.phone = document.querySelector('input[name="phone"]').value
                        } catch (error) {
                            console.log(error)
                        }
                        fetch('/create-customer-charge', {
                            method: 'post',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                amount: stripeDollar(plg_price),
                                customer_info: token,
                                product_name: plg_selectedVariant.product_name,
                                variant_name: plg_selectedVariant.variant_name,
                                metadata: {
                                    meta: "${this.encryptString(user_id)}",
                                    pageid: "${state.page_data.funnel_id}",
                                    currency: "\$\{defaultCurrency\}",
                                    variant_id: plg_selectedVariant.variant_id // for shopify variant id
                                },
                                merchantType: "stripe",
                                secret: "${private_key}",
                            })
                        })
                        .then(res => res.json())
                        .then(result => {
                            if (result.status == "success") {
                                let currency_word = plg_selectedVariant.currency ? plg_selectedVariant.currency.word : "USD";
                                let currency_symbol = plg_selectedVariant.currency ? plg_selectedVariant.currency.code : "$";
                                purchasedFn(\$\{values.fbPurchase\}, plg_price, currency_word, () => {
                                    var x_checkout = [{
                                        product_url: window.location.href,
                                        product_name: plg_selectedVariant.product_name,
                                        variant_name: plg_selectedVariant.variant_name,
                                        product_price: parseFloat(plg_price)
                                    }]
                                    localStorage.setItem("plg_prod_list", JSON.stringify(x_checkout));
                                    localStorage.setItem("funnel_customer_email", document.querySelector('#example5-email').value);
                                    localStorage.setItem("funnel_customer_name", document.querySelector('#example5-name').value);
                                    localStorage.setItem("stripe_user_id", btoa(result.customer_id));
                                    localStorage.setItem("stripe_currency", "\$\{defaultCurrency\}");
                                    // for sending email
                                    var productName = plg_selectedVariant.product_name;
                                    var plg_qty = plg_selectedVariant.variant_qty ? parseInt(plg_selectedVariant.variant_qty) : 1;
                                    ${this.getSendingEmailRequest()}
                                });
                            } else {
                                console.log("RESPONSE:", result);
                                alert("Payment failed. Please try again.");
                                document.querySelector(".example5").classList.remove("submitting")
                            }
                        })
                        .catch(err => {
                            console.log("ERROR:", err)
                            alert("Payment failed. Please try again.");
                            document.querySelector(".example5").classList.remove("submitting")
                        })
                    }
                    window.onload = () => {
                        var defaultSelectedCountry = "\$\{defaultDropdownCountry\}";
                        document.querySelector(".stripe-form").querySelectorAll("select").forEach(select => {
                            select.value = defaultSelectedCountry
                        })
                    }
                </script>
            </div>
        `;
    
        var isUpsellOrDownsell = state.page_data.page_type == "upsell" || state.page_data.page_type == "downsell" ? true : false;
        var titlePrice = state.page_data.page_type.substring(0, 1).toUpperCase() + state.page_data.page_type.substring(1);
        const buttonJSON = {
            "fbTrack": {
                "label": "Track AddToCart",
                "defaultValue": false,
                "widget": "toggle"
            },
            "fbInitiate": {
                "label": "Track InitiateCheckout",
                "defaultValue": false,
                "widget": "toggle"
            },
            "fbPurchase": {
                "label": "Track Purchase",
                "defaultValue": false,
                "widget": "toggle"
            },
            "buttonLink": {
                "label": "Link",
                "defaultValue": {
                    "url": "/",
                    "target": "_self"
                },
                "widget": "link_list"
            },
            "text": {
                "label": "Text",
                "defaultValue": "Button",
                "widget": "text"
            },
            "subText": {
                "label": "Sub Text",
                "defaultValue": "",
                "widget": "text"
            },
            "productQty": {
                "label": "Product Quantity (will overwrite if use shopify product)",
                "defaultValue": "1",
                "widget": "text"
            },
            "productName": {
                "label": "Product Name (will overwrite if use shopify product)",
                "defaultValue": "Product Name",
                "widget": "text"
            },
            "productPrice": {
                "label": titlePrice+" Price (will overwrite if use shopify product)",
                "defaultValue": "20",
                "widget": "text"
            },
            "productTag": {
                "label": titlePrice+" Tag (will overwrite if use shopify product)",
                "defaultValue": "",
                "widget": "text"
            },
            "productSku": {
                "label": "PLG Variant ID (will overwrite if use shopify product)",
                "defaultValue": "",
                "widget": "text"
            },
            "paypalSubscriptionID": {
                "label": "Paypal Subscription ID (recurring payments)",
                "defaultValue": "",
                "widget": "text"
            },
            "variants": {
                "label": "Variants",
                "defaultValue": JSON.stringify([]),
                "widget": "variants"
            },
            "animation": {
                "label": "Apply Animation",
                "defaultValue": "",
                "widget": "animation_list"
            },
            "animationInterval": {
                "label": "Animation Interval in second(s)",
                "defaultValue": "2",
                "widget": "counter"
            },
            "alignment": {
                "label": "Alignment",
                "defaultValue": 'center',
                "widget": "alignment"
            },
            "buttonStyle": {
                "label": "Design",
                "defaultValue": "",
                "widget": "color_design_list"
            },
            "fontWeight": {
                "label": "Font Weight",
                "defaultValue": "700",
                "widget": "counter"
            },
            "isSticky": {
                "label": "Use Sticky in Mobile",
                "defaultValue": false,
                "widget": "toggle"
            },
            "fontSize": {
                "label": "Font Size",
                "defaultValue": "20px",
                "widget": "px"
            },
            "buttonWidth": {
                "label": "Width",
                "defaultValue": "100%",
                "widget": "width"
            },
            "buttonColors": {
                "label": "Color",
                "defaultValue": {
                    "color": "#FFF",
                    "backgroundColor": "#26c686",
                    "hoverColor": "#2A92BF"
                },
                "widget": "button_color"
            },
            "borderRadius": {
                "label": "Border Radius",
                "defaultValue": "5px",
                "widget": "border_radius"
            },
            "padding": {
                "label": "Padding",
                "defaultValue": "20px",
                "widget": "padding"
            },
            "useConfirmation": {
                "label": "Use Confirmation",
                "defaultValue": false,
                "widget": "toggle" 
            },
            // RECENT: border upsell confirmation popup
            "borderRadius_popup": {
                "label": "Confirmation Body Radius",
                "defaultValue": "0px",
                "widget": "border_radius"
            },
            "cHeader": {
                "label": "Confirmation Text",
                "defaultValue": "Are you sure you want to purchase ?",
                "widget": "text"
            },
            "cBody": {
                "label": "Confirmation Body",
                "defaultValue": "",
                "widget": "text"
            },
            "cPositiveButton": {
                "label": "Confirmation Positive Button",
                "defaultValue": "Yes",
                "widget": "text"
            },
            "cpButtonColors": {
                "label": "Confirmation Positive Button Colors",
                "defaultValue": {
                    "color": "#FFF",
                    "backgroundColor": "#26c686",
                    "hoverColor": "#2A92BF"
                },
                "widget": "button_color"
            },
            "cNegativeButton": {
                "label": "Confirmation Negative Button",
                "defaultValue": "No",
                "widget": "text"
            },
            "cnButtonColors": {
                "label": "Confirmation Negative Button Colors",
                "defaultValue": {
                    "color": "#FFF",
                    "backgroundColor": "#d33b22",
                    "hoverColor": "#c87668"
                },
                "widget": "button_color"
            }
        };

        if (!isUpsellOrDownsell) {
            delete buttonJSON.productName;
            delete buttonJSON.productPrice;
            delete buttonJSON.productTag;
            delete buttonJSON.variants;
            delete buttonJSON.fbInitiate;
            delete buttonJSON.fbPurchase;
            delete buttonJSON.productQty;
            delete buttonJSON.productSku;
            // start for confirmation
            delete buttonJSON.useConfirmation;
            delete buttonJSON.cHeader
            delete buttonJSON.cBody
            delete buttonJSON.cPositiveButton
            delete buttonJSON.cpButtonColors
            delete buttonJSON.cNegativeButton
            delete buttonJSON.cnButtonColors
            // end for confirmation
        }

        if (this.props.session.getCurrentUser.privilege <= 4 && !localStorage.getItem(points.plg_domain_secret)) { // User Privilege
            delete buttonJSON.productSku;
        }

        let variantRecommendedStyle = JSON.stringify({ "label": "Select Recommended Style", "list": [{ "value": "0", "label": "None" }, { "value": "1", "label": "Arrow" }, { "value": "2", "label": "Ribbon" }], "selected": "1" });
        let customJS = [`
            /* start generate styling and normal functions */
            let btnStyleFn = ${editorTools.generate_button_style};
            let braitreeStyleFn = ${editorTools.generate_braintree_style};
            let formStyleFn = ${editorTools.generate_form_style};
            let inputStyleFn = ${editorTools.generate_input_style};
            let variantStyleFn = ${editorTools.generate_variant_style};
            let subscriptionStyleFn = ${editorTools.generate_subscription_style};
            let subscriptionDropdownStyleFn = ${editorTools.generate_subscription_dropdown_style};
            let stripeStyleFn = ${editorTools.generate_stripe_style};
            let addInitiateCheckoutFn = ${editorTools.analytics_initiate_checkout};
            let addToCartFn = ${editorTools.analytics_add_to_cart};
            let purchasedFn = ${editorTools.analytics_purchased};
            let getCookie = ${editorTools.function_get_cookie};
            let isExist = ${editorTools.function_is_exist};
            /* end generate styling and normal functions */

            console.log("1. Initializing youtube video...");
            unlayer.registerTool({
                type: 'youtube_video',
                category: 'contents',
                label: 'Videos',
                icon: '<svg class="svg-inline--fa fa-w-14 fa-w-20 fa-3x" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" viewBox="0 0 512 512"> <g fill="#fff"> <path d="M0,0C0,0,0,512,0,512C0,512,512,512,512,512C512,512,512,0,512,0C512,0,0,0,0,0C0,0,0,0,0,0M497,15C497,15,497,375.5,497,375.5C497,375.5,15,375.5,15,375.5C15,375.5,15,15,15,15C15,15,497,15,497,15C497,15,497,15,497,15M15,497C15,497,15,390.5,15,390.5C15,390.5,497,390.5,497,390.5C497,390.5,497,497,497,497C497,497,15,497,15,497C15,497,15,497,15,497M60,419C55.9,419,52.5,422.4,52.5,426.5C52.5,426.5,52.5,459.5,52.5,459.5C52.5,463.6,55.9,467,60,467C64.1,467,67.5,463.6,67.5,459.5C67.5,459.5,67.5,426.5,67.5,426.5C67.5,422.4,64.1,419,60,419C60,419,60,419,60,419M90,419C85.9,419,82.5,422.4,82.5,426.5C82.5,426.5,82.5,459.5,82.5,459.5C82.5,463.6,85.9,467,90,467C94.1,467,97.5,463.6,97.5,459.5C97.5,459.5,97.5,426.5,97.5,426.5C97.5,422.4,94.1,419,90,419C90,419,90,419,90,419M461.5,435.5C461.5,435.5,356.5,435.5,356.5,435.5C353.2,422.8,341.6,413.5,328,413.5C314.4,413.5,302.8,422.8,299.5,435.5C299.5,435.5,134.5,435.5,134.5,435.5C130.4,435.5,127,438.9,127,443C127,447.1,130.4,450.5,134.5,450.5C134.5,450.5,299.5,450.5,299.5,450.5C302.8,463.1,314.4,472.5,328,472.5C341.6,472.5,353.2,463.1,356.5,450.5C356.5,450.5,461.5,450.5,461.5,450.5C465.6,450.5,469,447.1,469,443C469,438.9,465.6,435.5,461.5,435.5C461.5,435.5,461.5,435.5,461.5,435.5M328,457.5C322.7,457.5,318.1,454.7,315.6,450.5C314.3,448.3,313.5,445.7,313.5,443C313.5,440.3,314.3,437.7,315.6,435.5C318.1,431.3,322.8,428.5,328,428.5C333.2,428.5,337.9,431.3,340.4,435.5C341.7,437.7,342.5,440.3,342.5,443C342.5,445.7,341.7,448.3,340.4,450.5C337.9,454.7,333.3,457.5,328,457.5C328,457.5,328,457.5,328,457.5M256,312C318.9,312,370,260.9,370,198C370,135.10000000000002,318.9,84,256,84C193.1,84,142,135.10000000000002,142,198C142,260.9,193.1,312,256,312C256,312,256,312,256,312M256,99C310.6,99,355,143.39999999999998,355,198C355,252.60000000000002,310.6,297,256,297C201.4,297,157,252.60000000000002,157,198C157,143.39999999999998,201.4,99,256,99C256,99,256,99,256,99M230.4,247C233.1,248.7,236.1,249.5,239.1,249.5C241.6,249.5,244.1,248.89999999999998,246.4,247.8C246.4,247.8,246.8,247.60000000000002,246.8,247.60000000000002C246.8,247.60000000000002,300.1,213.2,300.1,213.2C305.2,210.5,308.5,205.3,308.8,199.5C309.1,193.5,306.1,187.89999999999998,301,184.7C301,184.7,247.8,151.7,247.8,151.7C242.7,148.60000000000002,236.3,148.39999999999998,231.1,151.3C225.9,154.2,222.6,159.7,222.6,165.7C222.6,165.7,222.6,233,222.6,233C222.6,238.7,225.5,244,230.4,247C230.4,247,230.4,247,230.4,247M237.6,165.60000000000002C237.6,165,237.9,164.60000000000002,238.4,164.3C238.6,164.2,238.9,164.10000000000002,239.1,164.10000000000002C239.4,164.10000000000002,239.6,164.2,239.9,164.3C239.9,164.3,293.1,197.3,293.1,197.3C293.6,197.60000000000002,293.8,198,293.8,198.60000000000002C293.8,199.2,293.5,199.60000000000002,293,199.8C293,199.8,292.6,200,292.6,200C292.6,200,239.5,234.3,239.5,234.3C239.1,234.39999999999998,238.7,234.39999999999998,238.3,234.10000000000002C237.8,233.8,237.6,233.39999999999998,237.6,232.89999999999998C237.6,232.89999999999998,237.6,165.60000000000002,237.6,165.60000000000002C237.6,165.60000000000002,237.6,165.60000000000002,237.6,165.60000000000002" /> </g> </svg>',
                values: {},
                options: {
                    text: {
                        title: "Video",
                        position: 1,
                        options: {
                            "alignment": {
                                "label": "Alignment",
                                "defaultValue": 'center',
                                "widget": "alignment"
                            },
                            "autoplay": {
                                "label": "Autoplay",
                                "defaultValue": !0,
                                "widget": "toggle"
                            },
                            "color": {
                                "label": "Video URL",
                                "defaultValue": "video link",
                                "widget": "text"
                            },
                            "videoWidth": {
                                "label": "Width",
                                "defaultValue": "50%",
                                "widget": "width"
                            }
                        }
                    }
                },
                renderer: {
                    Viewer: unlayer.createViewer({
                        render(values) {
                            var matchArr = values.color.match('v=([a-zA-Z0-9\_\-]+)&?');
                            if(matchArr){
                                values.color = values.color.match('v=([a-zA-Z0-9\_\-]+)&?')[matchArr.length-1];
                            }
                            return \`<div style="text-align: \$\{values.alignment\}"><iframe class="youtube-embed" onload="this.height = (this.offsetWidth / 16 * 9);" width="\$\{values.videoWidth\}" src="https://www.youtube.com/embed/\$\{values.color\}?controls=0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>\`
                        }
                    }),
                    exporters: {
                        web: function (values) {
                            var matchArr = values.color.match('v=([a-zA-Z0-9\_\-]+)&?');
                            if(matchArr){
                                values.color = values.color.match('v=([a-zA-Z0-9\_\-]+)&?')[matchArr.length-1];
                            }
                            return \`<div style="text-align: \$\{values.alignment\}"><iframe class="youtube-embed" onload="this.height = (this.offsetWidth / 16 * 9);" width="\$\{values.videoWidth\}" src="https://www.youtube.com/embed/\$\{values.color\}?autoplay=\$\{values.autoplay\}&controls=0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>\`
                        }
                    }
                }
            })
            
            unlayer.registerPropertyEditor({
                name: 'animation_list',
                layout: 'bottom',
                Widget: unlayer.createWidget({
                    render(value) {
                        return \`<div class="blockbuilder-widget blockbuilder-alignment-widget row">
                            <div class="blockbuilder-widget-label col-6">
                                <label class="blockbuilder-label-primary">
                                    <span>Select Animation</span>
                                </label>
                            </div>
                            <div class="col-6 text-right eiCcjJ">
                                <select class="animation_list form-control">
                                    <option value="">None</option>
                                    <option value="pulsate">Pulsate</option>
                                    <option value="shake-horizontal">Shake Horizontal</option>
                                    <option value="shake-vertical">Shake Vertical</option>
                                    <option value="bounce-top">Bounce</option>
                                </select>
                            </div>
                        </div>\`
                    },
                    mount(node, value, updateValue) {
                        var input = node.getElementsByClassName('animation_list')[0]
                        input.value = value;
                        input.onchange = (e) => {
                            updateValue(e.target.value)
                        }
                    }
                })
            });

            unlayer.registerPropertyEditor({
                name: 'bg_position',
                layout: 'bottom',
                Widget: unlayer.createWidget({
                    render(value) {
                        return \`<div class="blockbuilder-widget blockbuilder-alignment-widget row">
                            <div class="blockbuilder-widget-label col-6">
                                <label class="blockbuilder-label-primary">
                                    <span>Background Position</span>
                                </label>
                            </div>
                            <div class="col-6 text-right eiCcjJ">
                                <select class="bgimagepos_list form-control">
                                <option value="initial">initial</option>
                                <option value="top left">top left</option>
                                <option value="top center">top center</option>
                                <option value="top right">top right</option>
                                <option value="center left">center left</option>
                                <option value="center center">center</option>
                                <option value="center right">center right</option>
                                <option value="bottom left">bottom left</option>
                                <option value="bottom center">bottom center</option>
                                <option value="bottom right">bottom right</option>
                                </select>
                            </div>
                        </div>\`
                    },
                    mount(node, value, updateValue) {
                        var input = node.getElementsByClassName('bgimagepos_list')[0]
                        input.value = value;
                        input.onchange = (e) => {
                            updateValue(e.target.value)
                        }
                    }
                })
            });
            
            unlayer.registerPropertyEditor({
                name: 'custom_dropdown',
                layout: 'bottom',
                Widget: unlayer.createWidget({
                    render(value) {
                        typeof value == "string" ? value = JSON.parse(value) : void 0;
                        return \`<div class="blockbuilder-widget blockbuilder-text-widget row sc-bZQynM eiCcjJ">
                            <div class="col-12">
                                <div class="blockbuilder-widget-label pb-2">
                                    <label class="blockbuilder-label-primary">
                                        <span>\$\{value.label\}</span>
                                    </label>
                                </div>
                                <select class="custom-select form-control">
                                    \$\{(() => {
                                        return value.list.map(val => {
                                            return \`<option value="\$\{val.value\}">\$\{val.label\}</option>\`
                                        }).join('')
                                    })()\}
                                </select>
                            </div>
                        </div>\`
                    },
                    mount(node, value, updateValue) {
                        typeof value == "string" ? value = JSON.parse(value) : void 0;
                        var selectTag = node.querySelector(".custom-select");
                        selectTag.value = value.selected;
                        selectTag.onchange = event => {
                            var selected = event.target.value;
                            value.selected = selected;
                            updateValue(JSON.stringify(value));
                        }
                    }
                })
            });



            unlayer.registerPropertyEditor({
                name: 'link_list',
                layout: 'bottom',
                Widget: unlayer.createWidget({
                    render(value) {
                        return \`<div class="blockbuilder-widget blockbuilder-link-widget">
                            <div class="row eiCcjJ">
                                <div class="blockbuilder-widget-label col-6">
                                    <label class="blockbuilder-label-primary">
                                        <span>Link</span>
                                    </label>
                                </div>
                                <div class="col-6 text-right">
                                    <select class="form-control custom-target">
                                        <option value="_self">Same Tab</option>
                                        <option value="_blank">New Tab</option>
                                        <option value="_popup">Popup Button</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row pt-1 sc-bZQynM eiCcjJ">
                                <div class="col-12">
                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">URL</span>
                                        </div>
                                        <input list="pages" class="form-control custom-url" onclick="this.select()">
                                        <datalist id="pages">
                                            ${(() => {
                                                return window.params.pages.map(el => {
                                                    var value = el.split("/");
                                                    return `<option value="${el}">${value.length == 2 ? "Homepage" : points.presentableFunnelName(value[2])}</option>`
                                                }).join('')
                                            })()}
                                        </datalist>
                                    </div>
                                </div>
                            </div>
                        </div>\`
                    },
                    mount(node, value, updateValue) {
                        var tab = node.getElementsByClassName('custom-target')[0];
                        var url = node.getElementsByClassName('custom-url')[0];
                        tab.value = value.target;
                        tab.onchange = (e) => {
                            value.target = e.target.value;
                            var toggleModal = "javascript:toggleModal()";
                            if(e.target.value == "_popup"){
                                url.value = toggleModal;
                                value.url = toggleModal;
                                url.disabled = true;
                            } else {
                                if(value.url == toggleModal){
                                    url.value = "";
                                    value.url = "";
                                    url.disabled = false;
                                }
                            }
                            updateValue(value)
                        }

                        url.value = value.url;
                        if(value.target == "_popup"){
                            url.disabled = true;
                        }
                        url.onchange = (e) => {
                            value.url = e.target.value;
                            updateValue(value)
                        }
                    }
                })
            });

            unlayer.registerPropertyEditor({
                name: 'color_design_list',
                layout: 'bottom',
                Widget: unlayer.createWidget({
                    render(value) {
                        return \`<div class="blockbuilder-widget blockbuilder-link-widget">
                            <div class="row eiCcjJ">
                                <div class="blockbuilder-widget-label col-6">
                                    <label class="blockbuilder-label-primary">
                                        <span>Button Design</span>
                                    </label>
                                </div>
                                <div class="col-6 text-right">
                                    <select class="form-control button_design">
                                        <option value="">Custom</option>
                                        <!-- color: font, bg, hover -->
                                        <option value="#ffffff,#1566c6,#438de4">Blue</option>
                                        <option value="#ffffff,#e03a3a,#ff7373">Red</option>
                                        <option value="#ffffff,#e03a9e,#ee63b7">Pink</option>
                                        <option value="#ffffff,#3bb057,#6ecc85">Green</option>
                                        <option value="#ffffff,#3aaee0,#2a92bf">Sky Blue</option>
                                        <option value="#4f4e4e,#e6f435,#f4ff6a">Yellow</option>
                                        <option value="#ffffff,#ea7c14,#feb169">Orange</option>
                                        <option value="#ffffff,#aa1bc2,#c850dc">Purple</option>
                                    </select>
                                </div>
                            </div>
                        </div>\`
                    },
                    mount(node, value, updateValue) {
                        var btnDesign = node.getElementsByClassName('button_design')[0];
                        btnDesign.value = value;
                        btnDesign.onchange = (e) => {
                            updateValue(e.target.value)
                        }
                    }
                })
            });
            console.log("1 gaious initializeing fomo inputs")
            ${editorTools.datePickerWidget()}
            console.log("2 gaious initializeing fomo viewer script")
            unlayer.registerTool({
                type: 'fomo-text',
                category: 'contents',
                label: 'FOMO Text',
                icon: '<svg aria-hidden="true" data-prefix="fab" data-icon="wpforms" class="svg-inline--fa fa-wpforms fa-w-14 fa-3x" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M448 75.2v361.7c0 24.3-19 43.2-43.2 43.2H43.2C19.3 480 0 461.4 0 436.8V75.2C0 51.1 18.8 32 43.2 32h361.7c24 0 43.1 18.8 43.1 43.2zm-37.3 361.6V75.2c0-3-2.6-5.8-5.8-5.8h-9.3L285.3 144 224 94.1 162.8 144 52.5 69.3h-9.3c-3.2 0-5.8 2.8-5.8 5.8v361.7c0 3 2.6 5.8 5.8 5.8h361.7c3.2.1 5.8-2.7 5.8-5.8zM150.2 186v37H76.7v-37h73.5zm0 74.4v37.3H76.7v-37.3h73.5zm11.1-147.3l54-43.7H96.8l64.5 43.7zm210 72.9v37h-196v-37h196zm0 74.4v37.3h-196v-37.3h196zm-84.6-147.3l64.5-43.7H232.8l53.9 43.7zM371.3 335v37.3h-99.4V335h99.4z"></path></svg>',
                values: {},
                options: {
                    products: {
                        title: "Contents",
                        position: 1,
                        options: {
                            "fomoText": {
                                "label": "Fomo Text",
                                "defaultValue": "",
                                "widget": "fomo_input"
                            },  
                        }
                    }              
                },
                renderer: {
                    Viewer: unlayer.createViewer({
                        render(values) {
                            console.log(values)
                            let fomoValue = values.fomoText !== "" ? JSON.parse(values.fomoText) : {key: "[FOMO]", days: "0"};
                            Date.prototype.addDays = function(days) {
                                var date = new Date(this.valueOf());
                                date.setDate(date.getDate() + days);
                                return date;
                            }
                            let date = new Date();
                            return \`This will not be shown in publish always put this widget on the bottom part. FOMO Day result [ \$\{new Intl.DateTimeFormat("en-US", {
                                year: "numeric",
                                month: "long",
                                day: "numeric"
                            }).format(date.addDays(parseInt(fomoValue?.days ?? "0")))\} ] Keyword : [ \$\{fomoValue?.key ?? "Input a Keyword to Find"\} ] \`;
                        }
                    }),
                    exporters: {
                        web: function(values) {
                            console.log(values)
                            let fomoValue = values.fomoText !== "" ? JSON.parse(values.fomoText) : {key: "[FOMO]", days: "0"};
                            return \`
                            <script>

                            Date.prototype.addDays = function(days) {
                                var date = new Date(this.valueOf());
                                date.setDate(date.getDate() + days);
                                return date;
                            }
                            
                            
                            
                            let replaceOnDocument = (pattern, string, {target = document.body} = {}) => {                                    
                                [
                                    target,
                                    ...target.querySelectorAll("*:not(script):not(noscript):not(style)")
                                ].forEach(({childNodes: [...nodes]}) => nodes
                                    .filter(({nodeType}) => nodeType === document.TEXT_NODE)
                                    .forEach((textNode) => textNode.textContent = textNode.textContent.replace(pattern, string)));
                            };

                            replaceOnDocument(/\$\{fomoValue?.key\}/g, new Intl.DateTimeFormat("en-US", { year: "numeric", month: "long", day: "numeric" }).format((new Date()).addDays(parseInt('\$\{fomoValue?.days\}'))));                            
                            
                            </script>\`;
                        }
                    }
                }
            });
            

            

            console.log("2. Initializing button...");
            unlayer.registerTool({
                type: 'buttons',
                category: 'contents',
                label: 'Button',
                icon: '<svg class="svg-inline--fa fa-w-14 fa-w-20 fa-3x" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" viewBox="0 0 512 512"> <g fill="#fff"> <path d="M22.496,15.496999999999957C22.496,15.496999999999957,118.577,15.496999999999957,118.577,15.496999999999957C122.676,15.496999999999957,126.075,12.097999999999956,126.075,7.998999999999967C126.075,7.998999999999967,126.075,7.998999999999967,126.075,7.998999999999967C126.075,3.899000000000001,122.676,0.5,118.577,0.5C118.577,0.5,7.499,0.5,7.499,0.5C3.399,0.5,0,3.899000000000001,0,7.998999999999967C0,7.998999999999967,0,119.077,0,119.077C0,123.17599999999999,3.399,126.57499999999999,7.499,126.57499999999999C7.499,126.57499999999999,7.499,126.57499999999999,7.499,126.57499999999999C11.598,126.57499999999999,14.997,123.17599999999999,14.997,119.077C14.997,119.077,14.997,22.99599999999998,14.997,22.99599999999998C14.997,18.895999999999958,18.396,15.496999999999957,22.496,15.496999999999957C22.496,15.496999999999957,22.496,15.496999999999957,22.496,15.496999999999957M7.499,386.325C7.499,386.325,7.499,386.325,7.499,386.325C3.399,386.325,0,389.724,0,393.823C0,393.823,0,504.90099999999995,0,504.90099999999995C0,509.001,3.399,512.4,7.499,512.4C7.499,512.4,118.577,512.4,118.577,512.4C122.676,512.4,126.075,509.001,126.075,504.90099999999995C126.075,504.90099999999995,126.075,504.90099999999995,126.075,504.90099999999995C126.075,500.80199999999996,122.676,497.40299999999996,118.577,497.40299999999996C118.577,497.40299999999996,22.496,497.40299999999996,22.496,497.40299999999996C18.396,497.40299999999996,14.997,494.00399999999996,14.997,489.904C14.997,489.904,14.997,393.823,14.997,393.823C14.997,389.724,11.598,386.325,7.499,386.325C7.499,386.325,7.499,386.325,7.499,386.325M489.404,497.40299999999996C489.404,497.40299999999996,393.323,497.40299999999996,393.323,497.40299999999996C389.224,497.40299999999996,385.825,500.80199999999996,385.825,504.90099999999995C385.825,504.90099999999995,385.825,504.90099999999995,385.825,504.90099999999995C385.825,509.001,389.224,512.4,393.323,512.4C393.323,512.4,504.401,512.4,504.401,512.4C508.501,512.4,511.9,509.001,511.9,504.90099999999995C511.9,504.90099999999995,511.9,393.823,511.9,393.823C511.9,389.724,508.501,386.325,504.401,386.325C504.401,386.325,504.401,386.325,504.401,386.325C500.302,386.325,496.903,389.724,496.903,393.823C496.903,393.823,496.903,489.904,496.903,489.904C496.903,494.00399999999996,493.504,497.40299999999996,489.404,497.40299999999996C489.404,497.40299999999996,489.404,497.40299999999996,489.404,497.40299999999996M385.825,7.998999999999967C385.825,7.998999999999967,385.825,7.998999999999967,385.825,7.998999999999967C385.825,12.097999999999956,389.224,15.496999999999957,393.323,15.496999999999957C393.323,15.496999999999957,489.404,15.496999999999957,489.404,15.496999999999957C493.504,15.496999999999957,496.903,18.895999999999958,496.903,22.99599999999998C496.903,22.99599999999998,496.903,119.077,496.903,119.077C496.903,123.17599999999999,500.302,126.57499999999999,504.401,126.57499999999999C504.401,126.57499999999999,504.401,126.57499999999999,504.401,126.57499999999999C508.501,126.57499999999999,511.9,123.17599999999999,511.9,119.077C511.9,119.077,511.9,7.998999999999967,511.9,7.998999999999967C511.9,3.899000000000001,508.501,0.5,504.401,0.5C504.401,0.5,393.323,0.5,393.323,0.5C389.224,0.5,385.825,3.899000000000001,385.825,7.998999999999967C385.825,7.998999999999967,385.825,7.998999999999967,385.825,7.998999999999967M482.806,169.56699999999995C482.806,169.56699999999995,29.094,169.56699999999995,29.094,169.56699999999995C13.097,169.56699999999995,0,182.56399999999996,0,198.661C0,198.661,0,314.43899999999996,0,314.43899999999996C0,330.436,12.997,343.533,29.094,343.533C29.094,343.533,482.906,343.533,482.906,343.533C498.903,343.533,512,330.53599999999994,512,314.43899999999996C512,314.43899999999996,512,198.56099999999998,512,198.56099999999998C511.9,182.56399999999996,498.903,169.56699999999995,482.806,169.56699999999995C482.806,169.56699999999995,482.806,169.56699999999995,482.806,169.56699999999995M496.903,314.43899999999996C496.903,322.13699999999994,490.604,328.53599999999994,482.806,328.53599999999994C482.806,328.53599999999994,29.094,328.53599999999994,29.094,328.53599999999994C21.396,328.53599999999994,14.997,322.23699999999997,14.997,314.43899999999996C14.997,314.43899999999996,14.997,198.56099999999998,14.997,198.56099999999998C14.997,190.863,21.296,184.464,29.094,184.464C29.094,184.464,482.906,184.464,482.906,184.464C490.604,184.464,497.003,190.76299999999998,497.003,198.56099999999998C497.003,198.56099999999998,497.003,314.43899999999996,497.003,314.43899999999996C497.003,314.43899999999996,496.903,314.43899999999996,496.903,314.43899999999996C496.903,314.43899999999996,496.903,314.43899999999996,496.903,314.43899999999996M255.95,223.55599999999998C251.851,223.55599999999998,248.451,226.95599999999996,248.451,231.05499999999995C248.451,231.05499999999995,248.451,282.04499999999996,248.451,282.04499999999996C248.451,286.144,251.851,289.544,255.95,289.544C260.049,289.544,263.449,286.144,263.449,282.04499999999996C263.449,282.04499999999996,263.449,231.05499999999995,263.449,231.05499999999995C263.449,226.95599999999996,260.049,223.55599999999998,255.95,223.55599999999998C255.95,223.55599999999998,255.95,223.55599999999998,255.95,223.55599999999998M220.957,223.55599999999998C216.858,223.55599999999998,213.458,226.95599999999996,213.458,231.05499999999995C213.458,231.05499999999995,213.458,282.04499999999996,213.458,282.04499999999996C213.458,286.144,216.858,289.544,220.957,289.544C225.056,289.544,228.455,286.144,228.455,282.04499999999996C228.455,282.04499999999996,228.455,231.05499999999995,228.455,231.05499999999995C228.455,226.95599999999996,225.056,223.55599999999998,220.957,223.55599999999998C220.957,223.55599999999998,220.957,223.55599999999998,220.957,223.55599999999998M290.943,223.55599999999998C286.844,223.55599999999998,283.445,226.95599999999996,283.445,231.05499999999995C283.445,231.05499999999995,283.445,282.04499999999996,283.445,282.04499999999996C283.445,286.144,286.844,289.544,290.943,289.544C295.042,289.544,298.442,286.144,298.442,282.04499999999996C298.442,282.04499999999996,298.442,231.05499999999995,298.442,231.05499999999995C298.442,226.95599999999996,295.042,223.55599999999998,290.943,223.55599999999998C290.943,223.55599999999998,290.943,223.55599999999998,290.943,223.55599999999998" /> </g> </svg>',
                values: {},
                options: {
                    button: {
                        title: "Button",
                        position: 1,
                        options: ${JSON.stringify(buttonJSON)},
                    }
                },
                renderer: {
                    Viewer: unlayer.createViewer({
                        render(values) {
                            var btnColor = values.buttonColors.color;
                            var btnBackgroundColor = values.buttonColors.backgroundColor;
                            var btnhoverColor = values.buttonColors.hoverColor;
                            if(values.buttonStyle){
                                var splittedValue = values.buttonStyle.split(",");
                                btnColor = splittedValue[0];
                                btnBackgroundColor = splittedValue[1];
                                btnhoverColor = splittedValue[2];
                            }
                            clearInterval(window["'"+values._meta.htmlID+"'"]);
                            return \`
                                <div style="text-align: \$\{values.alignment\}">
                                    <style onload="if(\$\{values.animation != ""\}){ window[\'\$\{values._meta.htmlID\}\'] = setInterval(() => { this.nextElementSibling.classList.remove('\$\{values.animation\}'); setTimeout(() => { this.nextElementSibling.classList.add('\$\{values.animation\}'); }, 500); }, \$\{values.animationInterval * 1000\}) }">
                                        .shake-horizontal { -webkit-animation: shake-horizontal 0.8s cubic-bezier(0.455, 0.030, 0.515, 0.955) both; animation: shake-horizontal 0.8s cubic-bezier(0.455, 0.030, 0.515, 0.955) both; } @-webkit-keyframes shake-horizontal { 0%, 100% { -webkit-transform: translateX(0); transform: translateX(0); } 10%, 30%, 50%, 70% { -webkit-transform: translateX(-10px); transform: translateX(-10px); } 20%, 40%, 60% { -webkit-transform: translateX(10px); transform: translateX(10px); } 80% { -webkit-transform: translateX(8px); transform: translateX(8px); } 90% { -webkit-transform: translateX(-8px); transform: translateX(-8px); } } @keyframes shake-horizontal { 0%, 100% { -webkit-transform: translateX(0); transform: translateX(0); } 10%, 30%, 50%, 70% { -webkit-transform: translateX(-10px); transform: translateX(-10px); } 20%, 40%, 60% { -webkit-transform: translateX(10px); transform: translateX(10px); } 80% { -webkit-transform: translateX(8px); transform: translateX(8px); } 90% { -webkit-transform: translateX(-8px); transform: translateX(-8px); } }
                                        .shake-vertical { -webkit-animation: shake-vertical 0.8s cubic-bezier(0.455, 0.030, 0.515, 0.955) both; animation: shake-vertical 0.8s cubic-bezier(0.455, 0.030, 0.515, 0.955) both; } @-webkit-keyframes shake-vertical { 0%, 100% { -webkit-transform: translateY(0); transform: translateY(0); } 10%, 30%, 50%, 70% { -webkit-transform: translateY(-8px); transform: translateY(-8px); } 20%, 40%, 60% { -webkit-transform: translateY(8px); transform: translateY(8px); } 80% { -webkit-transform: translateY(6.4px); transform: translateY(6.4px); } 90% { -webkit-transform: translateY(-6.4px); transform: translateY(-6.4px); } } @keyframes shake-vertical { 0%, 100% { -webkit-transform: translateY(0); transform: translateY(0); } 10%, 30%, 50%, 70% { -webkit-transform: translateY(-8px); transform: translateY(-8px); } 20%, 40%, 60% { -webkit-transform: translateY(8px); transform: translateY(8px); } 80% { -webkit-transform: translateY(6.4px); transform: translateY(6.4px); } 90% { -webkit-transform: translateY(-6.4px); transform: translateY(-6.4px); } }
                                        .bounce-top { -webkit-animation: bounce-top 0.9s both; animation: bounce-top 0.9s both; } @-webkit-keyframes bounce-top { 0% { -webkit-transform: translateY(-45px); transform: translateY(-45px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; opacity: 1; } 24% { opacity: 1; } 40% { -webkit-transform: translateY(-24px); transform: translateY(-24px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 65% { -webkit-transform: translateY(-12px); transform: translateY(-12px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 82% { -webkit-transform: translateY(-6px); transform: translateY(-6px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 93% { -webkit-transform: translateY(-4px); transform: translateY(-4px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 25%, 55%, 75%, 87% { -webkit-transform: translateY(0px); transform: translateY(0px); -webkit-animation-timing-function: ease-out; animation-timing-function: ease-out; } 100% { -webkit-transform: translateY(0px); transform: translateY(0px); -webkit-animation-timing-function: ease-out; animation-timing-function: ease-out; opacity: 1; } } @keyframes bounce-top { 0% { -webkit-transform: translateY(-45px); transform: translateY(-45px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; opacity: 1; } 24% { opacity: 1; } 40% { -webkit-transform: translateY(-24px); transform: translateY(-24px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 65% { -webkit-transform: translateY(-12px); transform: translateY(-12px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 82% { -webkit-transform: translateY(-6px); transform: translateY(-6px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 93% { -webkit-transform: translateY(-4px); transform: translateY(-4px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 25%, 55%, 75%, 87% { -webkit-transform: translateY(0px); transform: translateY(0px); -webkit-animation-timing-function: ease-out; animation-timing-function: ease-out; } 100% { -webkit-transform: translateY(0px); transform: translateY(0px); -webkit-animation-timing-function: ease-out; animation-timing-function: ease-out; opacity: 1; } }
                                        .pulsate { -webkit-animation: pulsate 0.8s ease-in-out infinite both; animation: pulsate 0.8s ease-in-out infinite both; } @-webkit-keyframes pulsate { 0% { -webkit-transform: scale(1); transform: scale(1); } 50% { -webkit-transform: scale(0.9); transform: scale(0.9); } 100% { -webkit-transform: scale(1); transform: scale(1); } } @keyframes pulsate { 0% { -webkit-transform: scale(1); transform: scale(1); } 50% { -webkit-transform: scale(0.9); transform: scale(0.9); } 100% { -webkit-transform: scale(1); transform: scale(1); } }
                                        @media only screen and (max-width: 768px) {
                                            button {
                                                width: 100% !important;
                                            }
                                        }
                                    </style>
                                    

                                    
                                    
                                      
                                    <button
                                        onclick="window.open('\$\{values.buttonLink.url\}','\$\{values.buttonLink.target\}')"
                                        onmouseover="this.style.backgroundColor='\$\{btnhoverColor\}'"
                                        onmouseleave="this.style.backgroundColor='\$\{btnBackgroundColor\}'"
                                        class="\$\{values.animation\}"
                                        style="border-radius: \$\{values.borderRadius\}; font-size: \$\{values.fontSize\}; padding: \$\{values.padding\}; color: \$\{btnColor\}; background-color: \$\{btnBackgroundColor\}; cursor: pointer; border: none; width: \$\{values.buttonWidth\}; font-weight: \$\{values.fontWeight\};">
                                        \$\{values.text\}
                                        <div class="subtext" style="font-weight: 400; font-size: calc(\$\{values.fontSize\} * .75);">
                                            \$\{values.subText\}
                                        </div>
                                    </button>
                                </div>
                            \`;
                        }
                    }),
                    exporters: {
                        web: function (values) {
                            var btnColor = values.buttonColors.color;
                            var btnBackgroundColor = values.buttonColors.backgroundColor;
                            var btnhoverColor = values.buttonColors.hoverColor;
                            var target = values.buttonLink.target != "_popup" ? values.buttonLink.target : "_self";
                            if(values.buttonStyle){
                                var splittedValue = values.buttonStyle.split(",");
                                btnColor = splittedValue[0];
                                btnBackgroundColor = splittedValue[1];
                                btnhoverColor = splittedValue[2];
                            }
                            clearInterval(window[values._meta.htmlID]);
                            var exportStyle = \`
                                <style onload="if(\$\{values.animation != ""\}){ window['\$\{values._meta.htmlID\}'] = setInterval(() => { this.nextElementSibling.classList.remove('\$\{values.animation\}'); setTimeout(() => { this.nextElementSibling.classList.add('\$\{values.animation\}'); }, 500); }, \$\{values.animationInterval * 1000\}) }">
                                    .shake-horizontal { -webkit-animation: shake-horizontal 0.8s cubic-bezier(0.455, 0.030, 0.515, 0.955) both; animation: shake-horizontal 0.8s cubic-bezier(0.455, 0.030, 0.515, 0.955) both; } @-webkit-keyframes shake-horizontal { 0%, 100% { -webkit-transform: translateX(0); transform: translateX(0); } 10%, 30%, 50%, 70% { -webkit-transform: translateX(-10px); transform: translateX(-10px); } 20%, 40%, 60% { -webkit-transform: translateX(10px); transform: translateX(10px); } 80% { -webkit-transform: translateX(8px); transform: translateX(8px); } 90% { -webkit-transform: translateX(-8px); transform: translateX(-8px); } } @keyframes shake-horizontal { 0%, 100% { -webkit-transform: translateX(0); transform: translateX(0); } 10%, 30%, 50%, 70% { -webkit-transform: translateX(-10px); transform: translateX(-10px); } 20%, 40%, 60% { -webkit-transform: translateX(10px); transform: translateX(10px); } 80% { -webkit-transform: translateX(8px); transform: translateX(8px); } 90% { -webkit-transform: translateX(-8px); transform: translateX(-8px); } }
                                    .shake-vertical { -webkit-animation: shake-vertical 0.8s cubic-bezier(0.455, 0.030, 0.515, 0.955) both; animation: shake-vertical 0.8s cubic-bezier(0.455, 0.030, 0.515, 0.955) both; } @-webkit-keyframes shake-vertical { 0%, 100% { -webkit-transform: translateY(0); transform: translateY(0); } 10%, 30%, 50%, 70% { -webkit-transform: translateY(-8px); transform: translateY(-8px); } 20%, 40%, 60% { -webkit-transform: translateY(8px); transform: translateY(8px); } 80% { -webkit-transform: translateY(6.4px); transform: translateY(6.4px); } 90% { -webkit-transform: translateY(-6.4px); transform: translateY(-6.4px); } } @keyframes shake-vertical { 0%, 100% { -webkit-transform: translateY(0); transform: translateY(0); } 10%, 30%, 50%, 70% { -webkit-transform: translateY(-8px); transform: translateY(-8px); } 20%, 40%, 60% { -webkit-transform: translateY(8px); transform: translateY(8px); } 80% { -webkit-transform: translateY(6.4px); transform: translateY(6.4px); } 90% { -webkit-transform: translateY(-6.4px); transform: translateY(-6.4px); } }
                                    .bounce-top { -webkit-animation: bounce-top 0.9s both; animation: bounce-top 0.9s both; } @-webkit-keyframes bounce-top { 0% { -webkit-transform: translateY(-45px); transform: translateY(-45px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; opacity: 1; } 24% { opacity: 1; } 40% { -webkit-transform: translateY(-24px); transform: translateY(-24px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 65% { -webkit-transform: translateY(-12px); transform: translateY(-12px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 82% { -webkit-transform: translateY(-6px); transform: translateY(-6px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 93% { -webkit-transform: translateY(-4px); transform: translateY(-4px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 25%, 55%, 75%, 87% { -webkit-transform: translateY(0px); transform: translateY(0px); -webkit-animation-timing-function: ease-out; animation-timing-function: ease-out; } 100% { -webkit-transform: translateY(0px); transform: translateY(0px); -webkit-animation-timing-function: ease-out; animation-timing-function: ease-out; opacity: 1; } } @keyframes bounce-top { 0% { -webkit-transform: translateY(-45px); transform: translateY(-45px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; opacity: 1; } 24% { opacity: 1; } 40% { -webkit-transform: translateY(-24px); transform: translateY(-24px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 65% { -webkit-transform: translateY(-12px); transform: translateY(-12px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 82% { -webkit-transform: translateY(-6px); transform: translateY(-6px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 93% { -webkit-transform: translateY(-4px); transform: translateY(-4px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 25%, 55%, 75%, 87% { -webkit-transform: translateY(0px); transform: translateY(0px); -webkit-animation-timing-function: ease-out; animation-timing-function: ease-out; } 100% { -webkit-transform: translateY(0px); transform: translateY(0px); -webkit-animation-timing-function: ease-out; animation-timing-function: ease-out; opacity: 1; } }
                                    .pulsate { -webkit-animation: pulsate 0.8s ease-in-out infinite both; animation: pulsate 0.8s ease-in-out infinite both; } @-webkit-keyframes pulsate { 0% { -webkit-transform: scale(1); transform: scale(1); } 50% { -webkit-transform: scale(0.9); transform: scale(0.9); } 100% { -webkit-transform: scale(1); transform: scale(1); } } @keyframes pulsate { 0% { -webkit-transform: scale(1); transform: scale(1); } 50% { -webkit-transform: scale(0.9); transform: scale(0.9); } 100% { -webkit-transform: scale(1); transform: scale(1); } }
                                    .mobile-sticky {
                                        position: fixed;
                                        left: 0;
                                        bottom: 0;
                                        width: 100%;
                                        z-index: 999;
                                        background-color: #fff;
                                        padding: 10px;
                                    }
                                    @media only screen and (max-width: 768px) {
                                        button {
                                            width: 100% !important;
                                        }
                                    }
                                </style>
                            \`
                            if(${isUpsellOrDownsell}){
                                // this is upsell or downsell
                                var merchant_type = "${selected_merchant}";
                                var isPaypalActive = "${paypalClientID}";
                                var upsellScript = \`
                                    <style>
                                        .paypal-buttons {
                                            margin-top: 10px;
                                        }
                                    </style>
                                    <script src="https://www.paypal.com/sdk/js?client-id=${this.decryptString(paypalClientID)}\$\{values.paypalSubscriptionID != "" ? "&vault=true&intent=subscription" : ""\}"></script>
                                    <script>
                                    //&vault=true&intent=capture
                                        var isFunctionCalled = false;
                                        function sendFBaddToCartAndInitiateCheckout(isAddEnable, isInitiateEnable, email){
                                            if(!isFunctionCalled){
                                                if(isAddEnable){
                                                    if(typeof fbq !== 'undefined'){
                                                        console.log("fire facebook add to cart")
                                                        fbq('track', 'AddToCart');
                                                    }
                                                    if(typeof snaptr !== 'undefined'){
                                                        console.log("fire snapchat add to cart")
                                                        snaptr('track','ADD_CART');
                                                    }
                                                }
                                                if(isInitiateEnable) {
                                                    if(typeof fbq !== 'undefined'){
                                                        console.log("fire facebook initiate checkout")
                                                        fbq('track', 'InitiateCheckout');
                                                    }
                                                    if(typeof snaptr !== 'undefined'){
                                                        console.log("fire snapchat initiate checkout")
                                                        snaptr('init', '${this.state.page_data.funnel_snapchat_id}', {'user_email':email});
                                                        snaptr('track','SIGN_UP');
                                                    }
                                                }
                                                isFunctionCalled = true;
                                            }
                                        }
                                        // RECENT: Disable funtion for Purchase for upsell
                                        function sendFBPurchaseEvent(isEnable, price){
                                            if(isEnable) {
                                                if(typeof fbq !== 'undefined'){
                                                    console.log("fire facebook triggered but not fired")
                                                    // fbq('track', 'Purchase', {value: parseFloat(price), currency: localStorage.getItem("cod_data") ? JSON.parse(localStorage.getItem("cod_data")).currencyWord : "USD"})
                                                }
                                                if(typeof snaptr !== 'undefined'){
                                                    console.log("fire snapchat triggered but not fired")
                                                    // snaptr('track', 'PURCHASE', {'currency': localStorage.getItem("cod_data") ? JSON.parse(localStorage.getItem("cod_data")).currencyWord : "USD", 'price': parseFloat(price)});
                                                }
                                            }
                                        }
                                        // cod upsell function
                                        function upsell_cod_function(dataprouctPrice, dataproductName, datavariantname, datavariantid, datalink, datatarget, isAddToCart, isInitiateCheckout, isPurchased, dataprouctSku, dataprouctQty){
                                            dataprouctPrice = dataprouctPrice ? dataprouctPrice : 0;
                                            //RECENT: Add the replace function
                                            ${funnel_everflow && `
                                                try {
                                                    sourcePR = sourcePR.replace('PLGAMOUNT', parseFloat(dataprouctPrice))
                                                } catch (error) {
                                                    console.log(error)
                                                }`}
                                            var customerData = JSON.parse(localStorage.getItem("cod_data"));
                                            sendFBaddToCartAndInitiateCheckout(isAddToCart, isInitiateCheckout, customerData.email);
                                            customerData.productPrice = dataprouctPrice;
                                            customerData.productName = dataproductName;
                                            customerData.variantName = datavariantname;
                                            customerData.pageid = "${state.page_data.funnel_id}";
                                            customerData.fplg = "${state.page_data.is_fulfill_by_plg}";
                                            customerData.variant_id = datavariantid; // for shopify variant id
                                            customerData.variantQty = dataprouctQty ? dataprouctQty : "1"; // for variant quantity
                                            customerData.variantSku = dataprouctSku ? dataprouctSku : ""; // for variant sku
                                            // RECENT: 
                                            customerData.source_link = sourcePR; // for order link
                                            fetch("/create-customer-charge", {
                                                method: "POST",
                                                headers: {
                                                    'Content-Type': 'application/json'
                                                },
                                                body: JSON.stringify(customerData)
                                            })
                                            .then(result => {
                                                sendFBPurchaseEvent(isPurchased, dataprouctPrice);
                                                var upsell_localStorage = JSON.parse(localStorage.getItem("plg_prod_list"));
                                                upsell_localStorage.push({
                                                    product_url: window.location.href,
                                                    product_name: dataproductName,
                                                    variant_name: datavariantname,
                                                    product_price: parseFloat(dataprouctPrice)
                                                })
                                                localStorage.setItem("plg_prod_list", JSON.stringify(upsell_localStorage));
                                                window.open(datalink, datatarget);
                                            })
                                            .catch(err => {
                                                // send error error email
                                                window.open(datalink, datatarget);
                                                const email_payload = { toEmail: "tech@themillionairemastermind.com", fromEmail: "fg_error@gmail.com", subjectEmail: "Funnel creating order failed.", textEmail: "COD Upsell Funnel Error: "+err+", Link: "+window.location.href, htmlEmail: "COD Upsell Funnel Error: "+err+", Link: "+window.location.href };
                                                fetch("https://stats.productlistgenie.io/console", { method: "POST", headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(email_payload) });

                                                hide_show_loading();
                                                alert("Server Error occurred. Please try again.");
                                            })
                                        }
                                        // stripe upsell function
                                        function upsell_stripe_function(dataprouctPrice, dataproductName, datavariantname, datavariantid, datalink, datatarget, productQty){
                                            dataprouctPrice = dataprouctPrice ? dataprouctPrice : 0;
                                            function stripeDollar (val) {
                                                var str,pos,rnd=0;
                                                if (val < .995) rnd = 1;
                                                    str = escape (val*1.0 + 0.005001 + rnd);
                                                    pos = str.indexOf (".");
                                                if (pos > 0) str = str.substring (rnd, pos + 3);
                                                return str.replace(".","");
                                            }
                                            var redirectLink = datalink;
                                            var redirectTarget = datatarget;
                                            var productPrice = dataprouctPrice;
                                            var stripeToken = localStorage.getItem("stripe_user_id");
                                            fetch("/charge-customer", {
                                                method: 'post',
                                                headers: {
                                                    'Content-Type': 'application/json'
                                                },
                                                body: JSON.stringify({
                                                    amount: stripeDollar(productPrice),
                                                    userid: atob(stripeToken),
                                                    product_name: dataproductName,
                                                    metadata: {
                                                        email: localStorage.getItem("funnel_customer_email"),
                                                        meta: "${this.encryptString(user_id)}",
                                                        variant_name: datavariantname,
                                                        pageid: "${state.page_data.funnel_id}",
                                                        currency: localStorage.getItem("stripe_currency"),
                                                        variant_id: datavariantid // for shopify variant id
                                                    },
                                                    merchantType: "stripe",
                                                    secret: "${private_key}"
                                                })
                                            })
                                            .then(res => res.json())
                                            .then(result => {
                                                if(result.status == "success"){
                                                    var xx_checkout = JSON.parse(localStorage.getItem("plg_prod_list"));
                                                    xx_checkout.push({
                                                        product_url: window.location.href,
                                                        product_name: dataproductName,
                                                        variant_name: datavariantname,
                                                        product_price: dataprouctPrice
                                                    });
                                                    localStorage.setItem("plg_prod_list", JSON.stringify(xx_checkout));
                                                    try {
                                                        sendFBPurchaseEvent(true, dataprouctPrice);
                                                        console.log("Stripe send fb purchase event")
                                                      }
                                                      catch(err) {
                                                        
                                                        console.error("Stripe Error send fb purchase event")
                                                      }
                                                    // for sending email
                                                    const callback = () => setTimeout(() => window.open(redirectLink, redirectTarget), 1000);
                                                    var productName = dataproductName;
                                                    var plg_price = dataprouctPrice;
                                                    var plg_job_id = localStorage.getItem("plg_email_id");

                                                    // unset data for sending email
                                                    var plg_qty = productQty ? parseInt(productQty) : 1;
                                                    var currency_word = "USD";
                                                    var currency_symbol = "$";
                                                    ${this.getSendingEmailRequest()}
                                                } else {
                                                    alert("Payment failed. Please try again.");
                                                    hide_show_loading();
                                                }
                                            })
                                            .catch(err => {
                                                alert("Payment failed. Please try again.");
                                                hide_show_loading();
                                            })
                                        }




                                        function upsell_braintree_function(dataprouctPrice, dataproductName, datavariantname, datavariantid, datalink, datatarget, productQty){
                                            dataprouctPrice = dataprouctPrice ? dataprouctPrice : 0;
                                            var redirectLink = datalink;
                                            var redirectTarget = datatarget;
                                            var object = JSON.parse(atob(localStorage.getItem("braintree_user_ids")));
                                            
                                            var productPrice = dataprouctPrice;
                                            fetch("/braintree-charge-customer-upsell", {
                                                method: 'post',
                                                headers: {
                                                    'Content-Type': 'application/json'
                                                },
                                                body: JSON.stringify({
                                                    amount: productPrice,
                                                    product_name: dataproductName,
                                                    refToken: object.tk,
                                                    env: localStorage.getItem("live"),
                                                    tokens: object.tokens,
                                                    merchantType: "braintree",
                                                })
                                            })
                                            .then(res => res.json())
                                            .then(result => {
                                                if(result.success){
                                                    ${funnel_everflow ? `
                                                    try {
                                                        sourcePR = sourcePR.replace('PLGAMOUNT', parseFloat(dataprouctPrice))
                                                    } catch (error) {
                                                        console.log(error)
                                                    }` : ``}
                                                    object.productName = dataproductName;
                                                    object.variantName = datavariantname;
                                                    object.productPrice = dataprouctPrice;
                                                    object.variant_id = datavariantid; // for shopify variant id
                                                    object.source_link = sourcePR;
                                                    savebraintreeInitialData(object, success => {
                                                        var xx_checkout = JSON.parse(localStorage.getItem("plg_prod_list"));
                                                        xx_checkout.push({
                                                            product_url: window.location.href,
                                                            product_name: dataproductName,
                                                            variant_name: datavariantname,
                                                            product_price: parseFloat(dataprouctPrice)
                                                        });
                                                        localStorage.setItem("plg_prod_list", JSON.stringify(xx_checkout));
                                                        try {
                                                            console.log("braintree send fb purchase event")
                                                            sendFBPurchaseEvent(true, dataprouctPrice);
                                                        }
                                                        catch(err) {
                                                            console.error("braintree Error send fb purchase event")
                                                        }
                                                        // for sending email 
                                                        const callback = () => setTimeout(() => window.open(redirectLink, redirectTarget), 3000);
                                                        var productName = dataproductName;
                                                        var plg_price = dataprouctPrice;
                                                        var plg_job_id = localStorage.getItem("plg_email_id");
                                        
                                                        // unset data for sending email
                                                        var plg_qty = productQty ? parseInt(productQty) : 1;
                                                        var currency_word = "USD";
                                                        var currency_symbol = "$";
                                                        ${this.getSendingEmailRequest()}
                                                    })
                                                } else {
                                                    alert("Payment failed. Please try again.");
                                                    hide_show_loading();
                                                }
                                            })
                                            .catch(err => {
                                                alert("Payment failed. Please try again.");
                                                hide_show_loading();
                                            })
                                        
                                            function savebraintreeInitialData(result, success, error){
                                                fetch('/braintree-orders-initial', {
                                                    method: "POST",
                                                    headers: {
                                                        'Content-Type': 'application/json',
                                                    },
                                                    body: JSON.stringify(result)
                                                })
                                                .then(res => {
                                                    success(res)
                                                })
                                                .catch(err => {
                                                    error(err)
                                                })
                                            }
                                        }




                                        // paypal upsell function
                                        function upsell_paypal_function(){
                                            document.querySelectorAll('[data-parent-id]').forEach(el => {
                                                paypal.Buttons({
                                                    style: {
                                                        layout: 'horizontal'
                                                    },
                                                    createOrder: function(data, actions) {
                                                        return actions.order.create({
                                                            purchase_units: [{
                                                                amount: { value: el.getAttribute("data-price") },
                                                                description: el.getAttribute("data-productname").substring(0, 126)
                                                            }]
                                                        });
                                                    },
                                                    onApprove: function(data, actions) {
                                                        return actions.order.capture().then(function(details) {
                                                            // Call your server to save the transaction
                                                            var x_checkout = JSON.parse(localStorage.getItem("plg_prod_list"));
                                                            x_checkout.push({
                                                                product_url: window.location.href,
                                                                product_name: el.getAttribute("data-productname"),
                                                                variant_name: el.getAttribute("data-variantname"),
                                                                product_price: parseFloat(el.getAttribute("data-price"))
                                                            })
                                                            localStorage.setItem("plg_prod_list", JSON.stringify(x_checkout));
                                                            var sendObjectToServer = {
                                                                ...details,
                                                                metadata: {
                                                                    meta: "${this.encryptString(user_id)}",
                                                                    pageid: "${state.page_data.funnel_id}"
                                                                },
                                                                product_name: el.getAttribute("data-productname"),
                                                                variant_name: el.getAttribute("data-variantname"),
                                                                variant_id: el.getAttribute("data-variantid"), // for shopify variant id
                                                                cog: el.getAttribute("data-cog")
                                                            }
                                                            hide_show_loading();
                                                            // send initial data to server and send to app.productlistgenie.io
                                                            return fetch('/paypal-orders-initial', {
                                                                method: "POST",
                                                                headers: {
                                                                    'Content-Type': 'application/json',
                                                                },
                                                                body: JSON.stringify(sendObjectToServer)
                                                            })
                                                            .then(res => {
                                                                hide_show_loading();

                                                                // for sending email
                                                                const callback = () => setTimeout(() => window.open(el.getAttribute("data-link"), el.getAttribute("data-target")), 1000);
                                                                var productName = el.getAttribute("data-productname");
                                                                var plg_price = el.getAttribute("data-price");
                                                                var plg_job_id = localStorage.getItem("plg_email_id");

                                                                // unset data for sending email
                                                                var plg_qty = el.getAttribute("data-qty");
                                                                var currency_word = "USD";
                                                                var currency_symbol = "$";
                                                                ${this.getSendingEmailRequest(true)}
                                                            })
                                                            .catch(err => {
                                                                hide_show_loading();
                                                                return window.open(el.getAttribute("data-link"), el.getAttribute("data-target"))
                                                            })
                                                        });
                                                    }
                                                }).render('#'+el.getAttribute('data-parent-id'));
                                            })
                                        }


                                       

                                          // Paypal Subscription Upsell function
                                          function upsell_paypal_subscriptoin_function(){
                                            document.querySelectorAll('[data-parent-id]').forEach(el => {
                                                paypal.Buttons({
                                                    style: {
                                                        layout: 'horizontal'
                                                    },
                                                   
                                                    createSubscription: function(data, actions) {
                                                        return actions.subscription.create({
                                                          plan_id: "\$\{values.paypalSubscriptionID\}"
                                                        });
                                                      },
                                                    onApprove: function(data, actions) {
                                                      
                                                        return actions.subscription.get().then(function(details) {
                                                            
                                                            // Call your server to save the transaction
                                                            var x_checkout = JSON.parse(localStorage.getItem("plg_prod_list"));
                                                            x_checkout.push({
                                                                product_url: window.location.href,
                                                                product_name: el.getAttribute("data-productname"),
                                                                variant_name: el.getAttribute("data-variantname"),
                                                                product_price: parseFloat(el.getAttribute("data-price"))
                                                            })
                                                            localStorage.setItem("plg_prod_list", JSON.stringify(x_checkout));
                                                       

                                                            var sendObjectToServer = {
                                                                 ...details, 
                                                                 payer: {
                                                                     email_address: details.subscriber.email_address,
                                                                     name: {
                                                                        given_name: details.subscriber.name.given_name + " " + details.subscriber.name.surname
                                                                     }
                                                                 }, 
                                                                 purchase_units: [
                                                                    {
                                                                        amount: {
                                                                            value: details.billing_info.last_payment.amount.value
                                                                        },
                                                                        shipping: {
                                                                            name: {
                                                                                full_name: details.subscriber.name.given_name + details.subscriber.name.surname
                                                                            },
                                                                            address: details.subscriber.shipping_address.address

                                                                        }

                                                                    }, 
                                                                    details.subscriber],
                                                                metadata: {
                                                                    meta: "${this.encryptString(user_id)}",
                                                                    pageid: "${state.page_data.funnel_id}"
                                                                },
                                                                product_name: el.getAttribute("data-productname"),
                                                                variant_name: el.getAttribute("data-variantname"),
                                                                variant_id: el.getAttribute("data-variantid") // for shopify variant id
                                                            }
                                                            hide_show_loading();
                                                            // send initial data to server and send to app.productlistgenie.io
                                                            return fetch('/paypal-orders-initial', {
                                                                method: "POST",
                                                                headers: {
                                                                    'Content-Type': 'application/json',
                                                                },
                                                                body: JSON.stringify(sendObjectToServer)
                                                            })
                                                            .then(res => {
                                                                hide_show_loading();

                                                                // for sending email
                                                                const callback = () => setTimeout(() => window.open(el.getAttribute("data-link"), el.getAttribute("data-target")), 1000);
                                                                var productName = el.getAttribute("data-productname");
                                                                var plg_price = el.getAttribute("data-price");
                                                                var plg_job_id = localStorage.getItem("plg_email_id");

                                                                // unset data for sending email
                                                                var plg_qty = el.getAttribute("data-qty");
                                                                var currency_word = "USD";
                                                                var currency_symbol = "$";
                                                                ${this.getSendingEmailRequest(true)}
                                                            })
                                                            .catch(err => {
                                                                hide_show_loading();
                                                                return window.open(el.getAttribute("data-link"), el.getAttribute("data-target"))
                                                            })
                                                        })
                                                    }
                                                }).render('#'+el.getAttribute('data-parent-id'));
                                            })
                                        }

                                        // authorize upsell function
                                        function upsell_authorize_function(dataprouctPrice, dataproductName, datavariantname, datavariantid, datalink, datatarget, productQty, cog){
                                            dataprouctPrice = dataprouctPrice ? dataprouctPrice : 0;
                                            var redirectLink = datalink;
                                            var redirectTarget = datatarget;
                                            var object = JSON.parse(atob(localStorage.getItem("authorize_customer_ids")));
                                            var productPrice = dataprouctPrice;
                                            fetch("/charge-customer", {
                                                method: 'post',
                                                headers: {
                                                    'Content-Type': 'application/json'
                                                },
                                                body: JSON.stringify({
                                                    loginKey: object.loginKey,
                                                    tk: object.tk,
                                                    productPrice: parseFloat(productPrice),
                                                    productName: dataproductName,
                                                    variantName: datavariantname,
                                                    customerProfileId: object.customerProfileId,
                                                    paymentProfileId: object.customerPaymentProfileId,
                                                    merchantType: "authorize.net",
                                                    testMode: object.testMode
                                                })
                                            })
                                            .then(res => res.json())
                                            .then(result => {
                                                ${funnel_everflow && `
                                                try {
                                                    sourcePR = sourcePR.replace('PLGAMOUNT', parseFloat(dataprouctPrice))
                                                } catch (error) {
                                                    console.log(error)
                                                }`}
                                                object.productName = dataproductName;
                                                object.variantName = datavariantname;
                                                object.productPrice = dataprouctPrice;
                                                object.transID = result.result.transactionResponse.transId;
                                                object.variant_id = datavariantid; // for shopify variant id
                                                object.source_link = sourcePR;
                                                object.cog = cog;
                                                saveAuthorizeInitialData(object, success => {
                                                    var xx_checkout = JSON.parse(localStorage.getItem("plg_prod_list"));
                                                    xx_checkout.push({
                                                        product_url: window.location.href,
                                                        product_name: dataproductName,
                                                        variant_name: datavariantname,
                                                        product_price: parseFloat(dataprouctPrice)
                                                    });
                                                    localStorage.setItem("plg_prod_list", JSON.stringify(xx_checkout));
                                                    try {
                                                        console.log("Authorize send fb purchase event")
                                                        sendFBPurchaseEvent(true, dataprouctPrice);
                                                      }
                                                      catch(err) {
                                                        console.error("authorize Error send fb purchase event")
                                                      }
                                                    // for sending email 
                                                    const callback = () => setTimeout(() => window.open(redirectLink, redirectTarget), 3000);
                                                    var productName = dataproductName;
                                                    var plg_price = dataprouctPrice;
                                                    var plg_job_id = localStorage.getItem("plg_email_id");

                                                    // unset data for sending email
                                                    var plg_qty = productQty ? parseInt(productQty) : 1;
                                                    var currency_word = "USD";
                                                    var currency_symbol = "$";
                                                    ${this.getSendingEmailRequest()}
                                                })
                                            })
                                            .catch(err => {
                                                alert("Payment failed. Please try again.");
                                                hide_show_loading();
                                            })

                                            function saveAuthorizeInitialData(result, success, error){
                                                fetch('/authorize-orders-initial', {
                                                    method: "POST",
                                                    headers: {
                                                        'Content-Type': 'application/json',
                                                    },
                                                    body: JSON.stringify(result)
                                                })
                                                .then(res => {
                                                    success(res)
                                                })
                                                .catch(err => {
                                                    error(err)
                                                })
                                            }
                                        }
                                        // upsell function
                                        function upsell_downsell(element, isAddToCart, isInitiateCheckout, isPurchased, useConfirmation){
                                            var dataprouctPrice = element.getAttribute('data-price');
                                            var dataproductName = element.getAttribute('data-productname')
                                            var datavariantname = element.getAttribute('data-variantname');
                                            var datavariantid = element.getAttribute('data-variantid');
                                            var datalink = element.getAttribute('data-link');
                                            var datatarget = element.getAttribute('data-target');
                                            var productQty = element.getAttribute('data-qty');
                                            var productSku = element.getAttribute('data-sku');
                                            var cog = element.getAttribute('data-cog');
                                            hide_show_confirmation(element, useConfirmation, () => {
                                                if(localStorage.getItem("cod_data") && localStorage.getItem("plg_prod_list")){
                                                    hide_show_loading();
                                                    upsell_cod_function(dataprouctPrice, dataproductName, datavariantname, datavariantid, datalink, datatarget, isAddToCart, isInitiateCheckout, isPurchased, productSku, productQty);
                                                } else if(localStorage.getItem("stripe_user_id")){
                                                    hide_show_loading();
                                                    upsell_stripe_function(dataprouctPrice, dataproductName, datavariantname, datavariantid, datalink, datatarget, productQty);
                                                } else if(localStorage.getItem("braintree_user_ids")){
                                                    hide_show_loading();
                                                    upsell_braintree_function(dataprouctPrice, dataproductName, datavariantname, datavariantid, datalink, datatarget, productQty);
                                                } else if(localStorage.getItem("paypal_as_checkout")){
                                                    alert("Please click on the paypal button below");
                                                } else if(localStorage.getItem("authorize_customer_ids")){
                                                    hide_show_loading();
                                                    upsell_authorize_function(dataprouctPrice, dataproductName, datavariantname, datavariantid, datalink, datatarget, productQty, cog);
                                                } else if(localStorage.getItem("refTransaction")){  // RECENT: PAYPAL v2
                                                    hide_show_loading();
                                                    doRefTransaction(element)
                                                } else {
                                                    alert("Did not go through checkout.");
                                                }
                                            })
                                        }
                                        // Aug17
                                        if(localStorage.getItem("paypal_as_checkout")){
                                            if("\$\{values.paypalSubscriptionID\}" != "") {
                                                upsell_paypal_subscriptoin_function()
                                                try {
                                                    document.querySelectorAll('.u_content_buttons').forEach(el => {
                                                        el.firstElementChild.style.display = "none";
                                                        el.style.textAlign = "center";
                                                    })
                                                } catch (error) {
                                                    console.log("non existing")
                                                }
                                            } else {
                                                 upsell_paypal_function()
                                            }
                                        }
                                        function hide_show_confirmation(element, useConfirmation, callback){
                                            const headerText = element.getAttribute('data-cHeader');
                                            const cBody = element.getAttribute('data-cBody');
                                            const positiveText = element.getAttribute('data-cpButton');
                                            const negativeText = element.getAttribute('data-cnButton');
                                            window.callback = callback;
                                            if(useConfirmation){
                                                if(document.getElementById("upsell_confirmation")){
                                                    // if confirmation is showing (hide it)
                                                    closeConfirmationModal();
                                                } else {
                                                    var confirmation = \\\`
                                                        <style>
                                                            #upsell_confirmation button { border-radius: 5px; font-size: 20px; padding: 10px; cursor: pointer; border: none; } #upsell_confirmation button.positive-button { color: #ffffff; background-color: #26c686; } #upsell_confirmation button.negative-button { color: #ffffff; background-color: #f16f6f; }
                                                        </style>
                                                        <div style="position: fixed; width: 100%; height: 100vh; overflow: scroll; z-index: 9999; top: 0; left: 0;">
                                                            <div style="align-items: center; display: flex; flex-direction: column; margin: auto; min-height: 100%; justify-content: center; background-color: #00000078;">
                                                                <div style="padding: 20px; background-color: #ffffff; border-radius:\$\{values.borderRadius_popup\};">
                                                                    <h1 class="confirmation-header style="margin: 0 0 10px;">\\\$\\\{headerText\\\}</h1>
                                                                    <p class="confirmation-body" style="margin: 0 0 10px;">\\\$\\\{cBody\\\}</p>
                                                                    <div style="display: flex; flex-flow: row wrap; -webkit-flex-flow: row wrap; justify-content: space-around;">
                                                                        <button class="positive-button" style="width: 48%; margin: 0 1%;" onclick="closeConfirmationModal(); window.callback();">\\\$\\\{positiveText\\\}</button>
                                                                        <button class="negative-button" style="width: 48%; margin: 0 1%;" onclick="closeConfirmationModal()">\\\$\\\{negativeText\\\}</button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    \\\`;
                                                    var div = document.createElement("div");
                                                    div.id = "upsell_confirmation";
                                                    div.innerHTML = confirmation;
                                                    document.body.appendChild(div);
                                                }
                                            } else {
                                                callback();
                                            }
                                        }
                                        function closeConfirmationModal(){
                                            document.getElementById("upsell_confirmation").remove();
                                        }
                                    </script>
                                \`
                                var selectedVariant = JSON.parse(values.variants).filter(el => el.isSuggest);
                                var variantid = "";
                                var cog;
                                var variantName = values.text;
                                if(selectedVariant.length != 0 && selectedVariant[0].price){
                                    values.productName = selectedVariant[0].shopifyProduct.name;
                                    variantName = selectedVariant[0].variant_name;
                                    cog = selectedVariant[0].cog  ? selectedVariant[0].cog : 0;
                                    values.productPrice = selectedVariant[0] && selectedVariant[0].price ? selectedVariant[0].price : 0;
                                    variantid = selectedVariant[0].id;
                                    values.productTag = selectedVariant[0].tag;
                                    values.productQty = selectedVariant[0].variant_qty ? selectedVariant[0].variant_qty : "1";
                                    values.productSku = selectedVariant[0].variant_sku ? selectedVariant[0].variant_sku : "";
                                }
                                return \`<div style="text-align: \$\{values.alignment\}">
                                    \$\{exportStyle\}
                                    <div class="hide-in-mobile">
                                        <button
                                            data-parent-id="\$\{values._meta.htmlID\}"
                                            data-qty="\$\{values.productQty ? values.productQty : "1"\}"
                                            data-sku="\$\{values.productSku ? values.productSku : ""\}"
                                            data-tag="\$\{values.productTag\}"
                                            data-price="\$\{values.productPrice.replace(/,/g,".")\}"
                                            data-productname="\$\{values.productName\}"
                                            data-variantname="\$\{variantName\}"
                                            data-variantid="\$\{variantid\}" 
                                            data-cog="\$\{cog\}" 
                                            data-link="\$\{values.buttonLink.url\}"
                                            data-target="\$\{values.buttonLink.target\}"
                                            data-cHeader="\$\{values.cHeader\}"
                                            data-cBody="\$\{values.cBody\}"
                                            data-cpButton="\$\{values.cPositiveButton\}"
                                            data-cnButton="\$\{values.cNegativeButton\}"
                                            onclick="upsell_downsell(this, \$\{values.fbTrack\}, \$\{values.fbInitiate\}, \$\{values.fbPurchase\}, \$\{values.useConfirmation\})" 
                                            onmouseover="this.style.backgroundColor='\$\{btnhoverColor\}'" onmouseleave="this.style.backgroundColor='\$\{btnBackgroundColor\}'"\ class="\$\{values.animation\}"
                                            style="border-radius: \$\{values.borderRadius\}; font-size: \$\{values.fontSize\}; padding: \$\{values.padding\}; color: \$\{btnColor\}; background-color: \$\{btnBackgroundColor\}; cursor: pointer; border: none; width: \$\{values.buttonWidth\};">
                                            \$\{values.text\}
                                            <div class="subtext" style="font-weight: 400; font-size: calc(\$\{values.fontSize\} * .75);">
                                                \$\{values.subText\}
                                            </div>
                                        </button>
                                    </div>
                                    <script>
                                        var isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                                        if(\$\{values.isSticky\} && isMobile){
                                            window.onscroll = function() {stickyFunction()};
                                            var header = document.querySelector(".hide-in-mobile");
                                            var sticky = header.offsetTop;
                                            function stickyFunction() {
                                                if(isMobile){
                                                    if (window.pageYOffset > sticky) {
                                                        header.classList.add("mobile-sticky");
                                                    } else {
                                                        header.classList.remove("mobile-sticky");
                                                    }
                                                }
                                            }
                                        }
                                        function hide_show_loading(){
                                            if(document.getElementById("upsell_loading")){
                                                document.getElementById("upsell_loading").remove();
                                            } else {
                                                var xx = '<style> #spinner { position: relative; width: 100%; height: 100%; } #spinner:after { content: ""; display: block; position: absolute; width: 80px; height: 80px; margin-left: -40px; margin-top: -40px; border: 5px solid #d1faeb; -moz-border-radius: 50%; -webkit-border-radius: 50%; border-radius: 50%; border-top-color: #26c686; border-right-color: #26c686; -moz-animation: rotate 0.5s linear infinite; -webkit-animation: rotate 0.5s linear infinite; animation: rotate 0.5s linear infinite; } @-moz-keyframes rotate { 0% { -moz-transform: rotateZ(-360deg); transform: rotateZ(-360deg); } 50% { -moz-transform: rotateZ(-180deg); transform: rotateZ(-180deg); } 100% { -moz-transform: rotateZ(0deg); transform: rotateZ(0deg); } } @-webkit-keyframes rotate { 0% { -webkit-transform: rotateZ(-360deg); transform: rotateZ(-360deg); } 50% { -webkit-transform: rotateZ(-180deg); transform: rotateZ(-180deg); } 100% { -webkit-transform: rotateZ(0deg); transform: rotateZ(0deg); } } @keyframes rotate { 0% { -moz-transform: rotateZ(-360deg); -ms-transform: rotateZ(-360deg); -webkit-transform: rotateZ(-360deg); transform: rotateZ(-360deg); } 50% { -moz-transform: rotateZ(-180deg); -ms-transform: rotateZ(-180deg); -webkit-transform: rotateZ(-180deg); transform: rotateZ(-180deg); } 100% { -moz-transform: rotateZ(0deg); -ms-transform: rotateZ(0deg); -webkit-transform: rotateZ(0deg); transform: rotateZ(0deg); } } </style> <div style="position: fixed; width: 100%; height: 100vh; overflow: scroll; z-index: 9999; top: 0; left: 0;"><div style="align-items: center; display: flex; flex-direction: column; margin: auto; min-height: 100%; justify-content: center; background-color: #00000078;"><div style="display: flex; align-items: center; padding: 100px;"><div id="spinner"></div></div></div></div>';
                                                var div = document.createElement("div");
                                                div.id="upsell_loading";
                                                div.innerHTML = xx;
                                                document.body.appendChild(div);
                                            }
                                        }
                                        // Paypalv2 upsell reference transaction
                                        function doRefTransaction(elementValues){
                                            var captured = localStorage.getItem('refTransaction')
                                            var refId = captured ? captured : '';
                                            var payload = {
                                                    method: 'DoReferenceTransaction',
                                                    keys: localStorage.getItem('plgppkeys'),
                                                    price: elementValues.dataset.price,
                                                    currencycode: 'USD',
                                                    paymentaction: 'SALE',
                                                    referenceId: refId,
                                                    desc: elementValues.dataset.productname
                                                }
                                                fetch('/paypalv2-capture-upsell', {
                                                    method: 'POST',
                                                    headers: {
                                                        'Content-Type': 'application/json'
                                                    },
                                                    body: JSON.stringify(payload)
                                                })
                                                .then(response => response.text() )
                                                .then(async result => {
                                                    let doAJsonResponse = {
                                                        success : false,
                                                        transactionId: null
                                                    };
                                                    console.log(result)
                                                    const resArray = result.split('&');
                                                    await resArray.forEach(function(v, i ,rr){
                                                        //make string response as json
                                                        vArray = v.split('=');
                                    
                                                        if(vArray[0] == 'ACK'){
                                                            doAJsonResponse.success = vArray[1] == 'Success'  ? 1 : 0;
                                                        }
                                    
                                                        if(vArray[0] == 'TOKEN'){
                                                            doAJsonResponse.token = vArray[1];
                                                        }
                                    
                                                        if(vArray[0] == 'TRANSACTIONID'){
                                                            doAJsonResponse.transactionId = vArray[1];
                                                        }
                                                    });
                                    
                                                    if(doAJsonResponse.success){
                                                        //Get Payment Transaction Details
                                                        const formattedData = await getTransactionDetails(doAJsonResponse.transactionId, elementValues);
                                                    }
                                                    return doAJsonResponse;
                                                })
                                                .catch(error => {
                                                    hide_show_loading()
                                                    console.log('error', error)
                                                });
                                        }   
                                    
                                            async function getTransactionDetails(transactionId, elementValues){
                                                let formattedData = null;
                                                var payload = {
                                                method: 'GetTransactionDetails',
                                                keys: localStorage.getItem('plgppkeys'),
                                                transactionId: transactionId,
                                                metadata: {
                                                    meta: document.querySelector("meta[plgdata][data-cid]").getAttribute("data-cid"),
                                                    pageid: document.querySelector("meta[plgdata][data-pageid]").getAttribute("data-pageid")
                                                },
                                                variant_id: elementValues.dataset.variantid,
                                                source_link: sourcePR ? sourcePR.replace('PLGAMOUNT', parseFloat(elementValues.dataset.price)) : '',
                                                }
                                    
                                                await fetch('/paypalv2-orders-initial', {
                                                    method: 'POST',
                                                    headers: {
                                                        'Content-Type': 'application/json'
                                                    },
                                                    body: JSON.stringify(payload)
                                                }).then(
                                                    response => response.text() 
                                                ).then(async result => {

                                                let upsell_localStorage = JSON.parse(localStorage.getItem("plg_prod_list"));
                                                upsell_localStorage.push({
                                                    product_url: window.location.href,
                                                    product_name: elementValues.dataset.productname,
                                                    variant_name: elementValues.dataset.variantname,
                                                    product_price: parseFloat(elementValues.dataset.price)
                                                })
                                                localStorage.setItem("plg_prod_list", JSON.stringify(upsell_localStorage));
                                                    //save transaction details to server here
                                                    window.location.href = elementValues.dataset.link
                                                }).catch(error => {
                                                    hide_show_loading()
                                                    console.log(error)
                                                });
                                               
                                                return
                                            }
                                    </script>
                                    \$\{upsellScript\}
                                </div>
                                \`;
                            } else {
                                return \`<div style="text-align: \$\{values.alignment\}">
                                    \$\{exportStyle\}
                                    <div class="hide-in-mobile">
                                        <button
                                            data-tag="\$\{values.productTag\}"
                                            onclick="\$\{values.fbTrack\} && typeof fbq !== 'undefined' ? fbq('track', 'AddToCart') : void 0; window.open('\$\{values.buttonLink.url\}','\$\{target\}')"
                                            onmouseover="this.style.backgroundColor='\$\{btnhoverColor\}'"
                                            onmouseleave="this.style.backgroundColor='\$\{btnBackgroundColor\}'"
                                            class="\$\{values.animation\}"
                                            style="border-radius: \$\{values.borderRadius\}; font-size: \$\{values.fontSize\}; padding: \$\{values.padding\}; color: \$\{btnColor\}; background-color: \$\{btnBackgroundColor\}; cursor: pointer; border: none; width: \$\{values.buttonWidth\}; font-weight: \$\{values.fontWeight\};">
                                            \$\{values.text\}
                                            <div class="subtext" style="font-weight: 400; font-size: calc(\$\{values.fontSize\} * .75);">
                                                \$\{values.subText\}
                                            </div>
                                        </button>
                                    </div>
                                    <script>
                                        var isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                                        if(\$\{values.isSticky\} && isMobile){
                                            window.onscroll = function() {stickyFunction()};
                                            var header = document.querySelector(".hide-in-mobile");
                                            var sticky = header.offsetTop;
                                            function stickyFunction() {
                                                if(isMobile){
                                                    if (window.pageYOffset > sticky) {
                                                        header.classList.add("mobile-sticky");
                                                    } else {
                                                        header.classList.remove("mobile-sticky");
                                                    }
                                                }
                                            }
                                        }
                                    </script>
                                </div>
                                \`;
                            }
                        }
                    }
                }
            });

            console.log("3.5. Initializing thank you page upsell button...");
            unlayer.registerTool({
                type: 'thankyou_upsell_button',
                category: 'contents',
                label: 'COD TY Upsell',
                icon: '<svg class="svg-inline--fa fa-w-14 fa-w-20 fa-3x" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" viewBox="0 0 512 512"> <g fill="#fff"> <path d="M22.496,15.496999999999957C22.496,15.496999999999957,118.577,15.496999999999957,118.577,15.496999999999957C122.676,15.496999999999957,126.075,12.097999999999956,126.075,7.998999999999967C126.075,7.998999999999967,126.075,7.998999999999967,126.075,7.998999999999967C126.075,3.899000000000001,122.676,0.5,118.577,0.5C118.577,0.5,7.499,0.5,7.499,0.5C3.399,0.5,0,3.899000000000001,0,7.998999999999967C0,7.998999999999967,0,119.077,0,119.077C0,123.17599999999999,3.399,126.57499999999999,7.499,126.57499999999999C7.499,126.57499999999999,7.499,126.57499999999999,7.499,126.57499999999999C11.598,126.57499999999999,14.997,123.17599999999999,14.997,119.077C14.997,119.077,14.997,22.99599999999998,14.997,22.99599999999998C14.997,18.895999999999958,18.396,15.496999999999957,22.496,15.496999999999957C22.496,15.496999999999957,22.496,15.496999999999957,22.496,15.496999999999957M7.499,386.325C7.499,386.325,7.499,386.325,7.499,386.325C3.399,386.325,0,389.724,0,393.823C0,393.823,0,504.90099999999995,0,504.90099999999995C0,509.001,3.399,512.4,7.499,512.4C7.499,512.4,118.577,512.4,118.577,512.4C122.676,512.4,126.075,509.001,126.075,504.90099999999995C126.075,504.90099999999995,126.075,504.90099999999995,126.075,504.90099999999995C126.075,500.80199999999996,122.676,497.40299999999996,118.577,497.40299999999996C118.577,497.40299999999996,22.496,497.40299999999996,22.496,497.40299999999996C18.396,497.40299999999996,14.997,494.00399999999996,14.997,489.904C14.997,489.904,14.997,393.823,14.997,393.823C14.997,389.724,11.598,386.325,7.499,386.325C7.499,386.325,7.499,386.325,7.499,386.325M489.404,497.40299999999996C489.404,497.40299999999996,393.323,497.40299999999996,393.323,497.40299999999996C389.224,497.40299999999996,385.825,500.80199999999996,385.825,504.90099999999995C385.825,504.90099999999995,385.825,504.90099999999995,385.825,504.90099999999995C385.825,509.001,389.224,512.4,393.323,512.4C393.323,512.4,504.401,512.4,504.401,512.4C508.501,512.4,511.9,509.001,511.9,504.90099999999995C511.9,504.90099999999995,511.9,393.823,511.9,393.823C511.9,389.724,508.501,386.325,504.401,386.325C504.401,386.325,504.401,386.325,504.401,386.325C500.302,386.325,496.903,389.724,496.903,393.823C496.903,393.823,496.903,489.904,496.903,489.904C496.903,494.00399999999996,493.504,497.40299999999996,489.404,497.40299999999996C489.404,497.40299999999996,489.404,497.40299999999996,489.404,497.40299999999996M385.825,7.998999999999967C385.825,7.998999999999967,385.825,7.998999999999967,385.825,7.998999999999967C385.825,12.097999999999956,389.224,15.496999999999957,393.323,15.496999999999957C393.323,15.496999999999957,489.404,15.496999999999957,489.404,15.496999999999957C493.504,15.496999999999957,496.903,18.895999999999958,496.903,22.99599999999998C496.903,22.99599999999998,496.903,119.077,496.903,119.077C496.903,123.17599999999999,500.302,126.57499999999999,504.401,126.57499999999999C504.401,126.57499999999999,504.401,126.57499999999999,504.401,126.57499999999999C508.501,126.57499999999999,511.9,123.17599999999999,511.9,119.077C511.9,119.077,511.9,7.998999999999967,511.9,7.998999999999967C511.9,3.899000000000001,508.501,0.5,504.401,0.5C504.401,0.5,393.323,0.5,393.323,0.5C389.224,0.5,385.825,3.899000000000001,385.825,7.998999999999967C385.825,7.998999999999967,385.825,7.998999999999967,385.825,7.998999999999967M482.806,169.56699999999995C482.806,169.56699999999995,29.094,169.56699999999995,29.094,169.56699999999995C13.097,169.56699999999995,0,182.56399999999996,0,198.661C0,198.661,0,314.43899999999996,0,314.43899999999996C0,330.436,12.997,343.533,29.094,343.533C29.094,343.533,482.906,343.533,482.906,343.533C498.903,343.533,512,330.53599999999994,512,314.43899999999996C512,314.43899999999996,512,198.56099999999998,512,198.56099999999998C511.9,182.56399999999996,498.903,169.56699999999995,482.806,169.56699999999995C482.806,169.56699999999995,482.806,169.56699999999995,482.806,169.56699999999995M496.903,314.43899999999996C496.903,322.13699999999994,490.604,328.53599999999994,482.806,328.53599999999994C482.806,328.53599999999994,29.094,328.53599999999994,29.094,328.53599999999994C21.396,328.53599999999994,14.997,322.23699999999997,14.997,314.43899999999996C14.997,314.43899999999996,14.997,198.56099999999998,14.997,198.56099999999998C14.997,190.863,21.296,184.464,29.094,184.464C29.094,184.464,482.906,184.464,482.906,184.464C490.604,184.464,497.003,190.76299999999998,497.003,198.56099999999998C497.003,198.56099999999998,497.003,314.43899999999996,497.003,314.43899999999996C497.003,314.43899999999996,496.903,314.43899999999996,496.903,314.43899999999996C496.903,314.43899999999996,496.903,314.43899999999996,496.903,314.43899999999996M255.95,223.55599999999998C251.851,223.55599999999998,248.451,226.95599999999996,248.451,231.05499999999995C248.451,231.05499999999995,248.451,282.04499999999996,248.451,282.04499999999996C248.451,286.144,251.851,289.544,255.95,289.544C260.049,289.544,263.449,286.144,263.449,282.04499999999996C263.449,282.04499999999996,263.449,231.05499999999995,263.449,231.05499999999995C263.449,226.95599999999996,260.049,223.55599999999998,255.95,223.55599999999998C255.95,223.55599999999998,255.95,223.55599999999998,255.95,223.55599999999998M220.957,223.55599999999998C216.858,223.55599999999998,213.458,226.95599999999996,213.458,231.05499999999995C213.458,231.05499999999995,213.458,282.04499999999996,213.458,282.04499999999996C213.458,286.144,216.858,289.544,220.957,289.544C225.056,289.544,228.455,286.144,228.455,282.04499999999996C228.455,282.04499999999996,228.455,231.05499999999995,228.455,231.05499999999995C228.455,226.95599999999996,225.056,223.55599999999998,220.957,223.55599999999998C220.957,223.55599999999998,220.957,223.55599999999998,220.957,223.55599999999998M290.943,223.55599999999998C286.844,223.55599999999998,283.445,226.95599999999996,283.445,231.05499999999995C283.445,231.05499999999995,283.445,282.04499999999996,283.445,282.04499999999996C283.445,286.144,286.844,289.544,290.943,289.544C295.042,289.544,298.442,286.144,298.442,282.04499999999996C298.442,282.04499999999996,298.442,231.05499999999995,298.442,231.05499999999995C298.442,226.95599999999996,295.042,223.55599999999998,290.943,223.55599999999998C290.943,223.55599999999998,290.943,223.55599999999998,290.943,223.55599999999998" /> </g> </svg>',
                values: {},
                options: {
                    upsell: {
                        title: "Product Information",
                        position: 1,
                        options: ${editorTools.config_upsell()},
                    },
                    button: {
                        title: "Button",
                        position: 2,
                        options: ${editorTools.config_button("buttonLink")},
                    },
                    confirmation: {
                        title: "Confirmation",
                        position: 3,
                        options: ${editorTools.config_confirmation()}
                    }
                },
                renderer: {
                    Viewer: unlayer.createViewer({
                        render(values) {
                            let button_style = btnStyleFn(values);
                            let replace_text = text => {
                                if (text) {
                                    text = text.replace("[qty]", values.productQty);
                                    text = text.replace("[name]", values.productName);
                                    text = text.replace("[price]", values.productPrice);
                                }
                                return text;
                            }
                            return \`
                                \$\{button_style\}
                                <button class="\$\{values.animation\}">
                                    \$\{replace_text(values.text)\}
                                    <div class="subtext">\$\{replace_text(values.subText)\}</div>
                                </button>
                            \`;
                        }
                    }),
                    exporters: {
                        web: function (values) {
                            let button_style = btnStyleFn(values);
                            let replace_text = text => {
                                if (text) {
                                    text = text.replace("[qty]", values.productQty);
                                    text = text.replace("[name]", values.productName);
                                    text = text.replace("[price]", values.productPrice);
                                }
                                return text;
                            }
                            return \`
                                \$\{button_style\}
                                <button class="\$\{values.animation\}"
                                    onclick = "thankyou_upsell(this)"
                                    data-parentid = "\$\{values._meta.htmlID\}"
                                    data-quantity = "\$\{values.productQty\}"
                                    data-productname = "\$\{values.productName\}"
                                    data-variantname = "\$\{values.productQty + "x of " + values.productName\}"
                                    data-price = "\$\{values.productPrice\}"
                                    data-sku = "\$\{values.productSku\}"
                                    data-tags = "\$\{values.productTags\}"

                                    data-trackaddtocart = "\$\{values.fbTrack\}"
                                    data-initiatecheckout = "\$\{values.fbInitiate\}"
                                    data-trackpurchased = "\$\{values.fbPurchase\}"
                                    
                                    data-useconfirmation="\$\{values.use_confirmation\}"
                                    data-header="\$\{values.header\}"
                                    data-ptext="\$\{values.positive_button\}"
                                    data-ntext="\$\{values.negative_button\}"
                                >
                                    \$\{replace_text(values.text)\}
                                    <div class="subtext">\$\{replace_text(values.subText)\}</div>
                                </button>
                                <script>
                                    function thankyou_upsell (element) {
                                        let content_id = element.getAttribute('data-parentid');
                                        let quantity = element.getAttribute('data-quantity');
                                        let product_name = element.getAttribute('data-productname')
                                        let variant_name = element.getAttribute('data-variantname');
                                        let price = element.getAttribute('data-price');
                                        let sku = element.getAttribute('data-sku');

                                        let track_add_to_cart = element.getAttribute('data-trackaddtocart');
                                        let track_initiate_checkout = element.getAttribute('data-initiatecheckout');
                                        let track_purchased = element.getAttribute('data-trackpurchased');
                                        ${funnel_everflow && `
                                                try {
                                                    sourcePR = sourcePR.replace('PLGAMOUNT', parseFloat(dataprouctPrice))
                                                } catch (error) {
                                                    console.log(error)
                                                }`}
                                        if(localStorage.getItem("cod_data") && localStorage.getItem("plg_prod_thankyou_list")) {
                                            let payload = {
                                                ...JSON.parse(localStorage.getItem("cod_data")),
                                                variant_id: "",
                                                variantQty: quantity,
                                                productPrice: price,
                                                productName: product_name,
                                                variantName: variant_name,
                                                variantSku: sku,
                                                pageid: "${state.page_data.funnel_id}",
                                                fplg: "${state.page_data.is_fulfill_by_plg}",
                                                source_link: sourcePR
                                            }
    
                                            ty_hide_show_confirmation(element, () => {
                                                hide_show_loading();
                                                fetch("/create-customer-charge", {
                                                    method: "POST",
                                                    headers: {
                                                        'Content-Type': 'application/json'
                                                    },
                                                    body: JSON.stringify(payload)
                                                })
                                                .then(result => {
                                                    hide_show_loading();
                                                    let cart = JSON.parse(localStorage.getItem("plg_prod_thankyou_list"));
                                                    cart.data.push({ product_name: product_name, variant_name: variant_name, product_price: price, product_url: window.location.href });
                                                    localStorage.setItem("plg_prod_thankyou_list", JSON.stringify(cart));
                                                    localStorage.setItem(content_id, "true");
                                                    if(typeof render_cart !== "undefined") render_cart();
                                                    disable_upsell();
                                                });
                                            });
                                        } else {
                                            alert("Did not go through checkout.");
                                        }
                                    }

                                    function disable_upsell () {
                                        let list = Object.keys(localStorage).filter(e => e.includes("u_content_thankyou_upsell"));
                                        list.forEach(e => {
                                            document.querySelector('[data-parentid="' + e + '"]').disabled = true;
                                        })
                                    }
                                    disable_upsell();

                                    function ty_hide_show_confirmation(element, callback) {
                                        window.callback = callback;
                                        let use_confirmation = element.getAttribute('data-useconfirmation');
                                        let header = element.getAttribute('data-header');
                                        let positive_text = element.getAttribute('data-ptext');
                                        let negative_text = element.getAttribute('data-ntext');
                                        if(use_confirmation === "true") {
                                            if(document.getElementById("upsell_confirmation")){
                                                closeConfirmationModal();
                                            } else {
                                                var confirmation = \\\`
                                                    <style>
                                                        #upsell_confirmation button { border-radius: 5px; font-size: 20px; padding: 10px; cursor: pointer; border: none; }
                                                        #upsell_confirmation button.positive-button { color: #ffffff; background-color: #26c686; }
                                                        #upsell_confirmation button.positive-button:hover { background-color: #2a92bf; }
                                                        #upsell_confirmation button.negative-button { color: #ffffff; background-color: #d33b22; }
                                                        #upsell_confirmation button.negative-button:hover { background-color: #c87668; }
                                                    </style>
                                                    <div style="position: fixed; width: 100%; height: 100vh; overflow: scroll; z-index: 9999; top: 0; left: 0;">
                                                        <div style="align-items: center; display: flex; flex-direction: column; margin: auto; min-height: 100%; justify-content: center; background-color: #00000078;">
                                                        <div style="padding: 20px; background-color: #ffffff; border-radius:\$\{values.borderRadius_popup\};">
                                                                <h1 style="margin: 0 0 10px;">\\\$\\\{header\\\}</h1>
                                                                <div style="display: flex; flex-flow: row wrap; -webkit-flex-flow: row wrap; justify-content: space-around;">
                                                                    <button class="positive-button" style="width: 48%; margin: 0 1%;" onclick="closeConfirmationModal(); window.callback();">\\\$\\\{positive_text\\\}</button>
                                                                    <button class="negative-button" style="width: 48%; margin: 0 1%;" onclick="closeConfirmationModal()">\\\$\\\{negative_text\\\}</button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                \\\`;
                                                var div = document.createElement("div");
                                                div.id = "upsell_confirmation";
                                                div.innerHTML = confirmation;
                                                document.body.appendChild(div);
                                            }
                                        } else {
                                            callback();
                                        }
                                    }

                                    function closeConfirmationModal(){
                                        document.getElementById("upsell_confirmation").remove();
                                    }

                                    function hide_show_loading(){
                                        if(document.getElementById("submit_loading")) {
                                            document.getElementById("submit_loading").remove();
                                        } else {
                                            var xx = '<style> #spinner { position: relative; width: 100%; height: 100%; } #spinner:after { content: ""; display: block; position: absolute; width: 80px; height: 80px; margin-left: -40px; margin-top: -40px; border: 5px solid #d1faeb; -moz-border-radius: 50%; -webkit-border-radius: 50%; border-radius: 50%; border-top-color: #26c686; border-right-color: #26c686; -moz-animation: rotate 0.5s linear infinite; -webkit-animation: rotate 0.5s linear infinite; animation: rotate 0.5s linear infinite; } @-moz-keyframes rotate { 0% { -moz-transform: rotateZ(-360deg); transform: rotateZ(-360deg); } 50% { -moz-transform: rotateZ(-180deg); transform: rotateZ(-180deg); } 100% { -moz-transform: rotateZ(0deg); transform: rotateZ(0deg); } } @-webkit-keyframes rotate { 0% { -webkit-transform: rotateZ(-360deg); transform: rotateZ(-360deg); } 50% { -webkit-transform: rotateZ(-180deg); transform: rotateZ(-180deg); } 100% { -webkit-transform: rotateZ(0deg); transform: rotateZ(0deg); } } @keyframes rotate { 0% { -moz-transform: rotateZ(-360deg); -ms-transform: rotateZ(-360deg); -webkit-transform: rotateZ(-360deg); transform: rotateZ(-360deg); } 50% { -moz-transform: rotateZ(-180deg); -ms-transform: rotateZ(-180deg); -webkit-transform: rotateZ(-180deg); transform: rotateZ(-180deg); } 100% { -moz-transform: rotateZ(0deg); -ms-transform: rotateZ(0deg); -webkit-transform: rotateZ(0deg); transform: rotateZ(0deg); } } </style> <div style="position: fixed; width: 100%; height: 100vh; overflow: scroll; z-index: 9999; top: 0; left: 0;"><div style="align-items: center; display: flex; flex-direction: column; margin: auto; min-height: 100%; justify-content: center; background-color: #00000078;"><div style="display: flex; align-items: center; padding: 100px;"><div id="spinner"></div></div></div></div>';
                                            var div = document.createElement("div");
                                            div.id = "submit_loading";
                                            div.innerHTML = xx;
                                            document.body.appendChild(div);
                                        }
                                    }
                                </script>
                            \`;
                        }
                    }
                }
            });
            
            // ========================= Property Editor for title =================================
            unlayer.registerPropertyEditor({
                name: 'editor_title',
                layout: 'bottom',
                Widget: unlayer.createWidget({
                    render(value) {
                        return \`
                        <div>
                            <div class="blockbuilder-widget blockbuilder-text-widget row eiCcjJ">
                                <div class="col-12">
                                    <div class="blockbuilder-widget-label pb-2">
                                    <H4 style="color:#FFFFFF">\$\{value.title\}</H4>
                                    <h5 style="color:#9a9a9a">\$\{value.description\}</h5>
                                    </div>
                                </div>
                            </div>
                        </div> 
                        \`
                    },
                    mount(node, value, updateValue) {
                       
                    }
                })
            });
            //========================= Property Editor for title =================================

            unlayer.registerPropertyEditor({
                name: 'klavio_integration',
                layout: 'bottom',
                Widget: unlayer.createWidget({
                    render(value) {
                        return \`
                        <div>
                            <div class="blockbuilder-widget blockbuilder-text-widget row eiCcjJ">
                                <div class="col-12">
                                    <div class="blockbuilder-widget-label pb-2">
                                        <label class="blockbuilder-label-primary">
                                            <span>Klaviyo Public API key Text</span>
                                        </label>
                                    </div>
                                    <input class="color-value form-control apikey" />
                                </div>
                            </div>
                        </div> <br/> <br/>
                        <div>
                            <div class="blockbuilder-widget blockbuilder-text-widget row eiCcjJ">
                                <div class="col-12">
                                    <div class="blockbuilder-widget-label pb-2">
                                        <label class="blockbuilder-label-primary">
                                            <span>Embed Element code (optional)</span>
                                        </label>
                                    </div>
                                    <input id="embed-element" class="color-value form-control embed-element" />
                                </div>
                            </div>
                        </div>\`
                    },
                    mount(node, value, updateValue) {
                        var em1 = node.getElementsByClassName('apikey')[0]
                        em1.value = value.apikey
                        em1.onchange = function(event) {
                            value.apikey = event.target.value
                            updateValue(value)
                        }
                        var em2 = node.getElementsByClassName('embed-element')[0]
                        em2.value = value.elementKlav
                        em2.onchange = function(event) {
                            value.elementKlav = event.target.value
                            updateValue(value)
                        }
                    }
                })
            });

            console.log("3. Initializing klavio...");
            unlayer.registerTool({
                type: 'klavio',
                category: 'contents',
                label: 'Klaviyo',
                icon: '<svg class="svg-inline--fa fa-edge fa-w-16 fa-3x" role="img" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 50.4 34" style="enable-background:new 0 0 50.4 34;" xml:space="preserve"> <style type="text/css"> .st0{fill:url(#SVGID_1_);} </style> <linearGradient id="SVGID_1_" gradientUnits="userSpaceOnUse" x1="-72.1" y1="60.4358" x2="-72.1" y2="108.5195" gradientTransform="matrix(0.7071 0 0 -0.7071 76.1809 76.7341)"> <stop offset="0" style="stop-color:#FFE01E"/> <stop offset="0.1373" style="stop-color:#CADD32"/> <stop offset="0.3103" style="stop-color:#8FD848"/> <stop offset="0.4774" style="stop-color:#5ED55B"/> <stop offset="0.634" style="stop-color:#37D269"/> <stop offset="0.7779" style="stop-color:#1CD073"/> <stop offset="0.9044" style="stop-color:#0BCF7A"/> <stop offset="1" style="stop-color:#05CE7C"/> </linearGradient> <path class="st0" d="M1,15.4l22.6-15c0.9-0.6,2.3-0.6,3.2,0l22.6,15c1.4,0.9,1.4,2.4,0,3.2l-3,2C41.9,13.6,34.1,9,25.2,9 C16.3,9,8.5,13.7,4,20.6l-3-2C-0.3,17.7-0.3,16.3,1,15.4z M25.2,15.2c-6.7,0-12.6,3.6-16,8.8l5.2,3.5c2.2-3.6,6.2-6.1,10.7-6.1 c4.5,0,8.5,2.4,10.7,6.1l5.2-3.5C37.8,18.8,31.9,15.2,25.2,15.2z M25.2,27.7c-2.4,0-4.4,1.3-5.5,3.2l3.5,2.3c0.6,0.5,1.2,0.7,2,0.7 s1.5-0.3,2-0.7l3.5-2.3C29.7,29.1,27.6,27.7,25.2,27.7z"/> </svg>',
                values: {},
                options: {
                    default: {
                        title: null,
                    },
                    text: {
                        title: "Klaviyo Integration",
                        position: 1,
                        options: {
                            "kavioAPI": {
                                "label": "Color",
                                "defaultValue": {
                                    "apikey": "LKHFxR",
                                    "elementKlav": "<div class=\\"klaviyo-form-PBEvNf\\"></div>"
                                },
                                "widget": "klavio_integration"
                            }
                        },
                    }
                },
                renderer: {
                    Viewer: unlayer.createViewer({
                        render(values) {
                            return \`<div style="text-align: center; font-style: italic;">
                                <strong>Embeded Klaviyo</strong> 
                                (Click here to edit)
                            </div>\`
                        }
                    }),
                    exporters: {
                        web: function(values) {
                            return \`
                                <style onload="document.getElementById('\$\{values._meta.htmlID\}').style.padding = '0';"></style>
                                <script type="text/javascript" async src="https://static.klaviyo.com/onsite/js/klaviyo.js?company_id=\$\{values.kavioAPI.apikey\}"></script>
                                \$\{values.kavioAPI.elementKlav.replace()\}
                            \`
                        },
                        email: function() {}
                    },
                },
            });

            console.log("4. Initializing redirection...");
            unlayer.registerTool({
                type: 'redirection',
                category: 'contents',
                label: 'Redirect',
                icon: '<svg class="svg-inline--fa fa-edge fa-w-16 fa-3x" fill="#fff" version="1.1" id="Capa_1" x="0px" y="0px" viewBox="0 0 512 512"> <g> <path d="M469.333,0H42.667C19.114,0.028,0.028,19.114,0,42.667v426.667C0.028,492.886,19.114,511.972,42.667,512h426.667 c23.552-0.028,42.638-19.114,42.667-42.667V42.667C511.972,19.114,492.886,0.028,469.333,0z M494.933,469.333 c0,14.138-11.461,25.6-25.6,25.6H42.667c-14.138,0-25.6-11.461-25.6-25.6v-384h477.867V469.333z M494.933,68.267H17.067v-25.6 c0-14.138,11.462-25.6,25.6-25.6h426.667c14.138,0,25.6,11.462,25.6,25.6V68.267z"/> <path d="M59.733,34.133H51.2c-4.713,0-8.533,3.82-8.533,8.533S46.487,51.2,51.2,51.2h8.533c4.713,0,8.533-3.82,8.533-8.533 S64.446,34.133,59.733,34.133z"/> <path d="M97.109,34.816c-2.06-0.939-4.426-0.939-6.485,0c-1.034,0.433-1.986,1.039-2.816,1.792c-3.3,3.365-3.3,8.752,0,12.117 c0.83,0.753,1.782,1.359,2.816,1.792c2.066,0.91,4.419,0.91,6.485,0c1.034-0.433,1.986-1.039,2.816-1.792 c3.3-3.365,3.3-8.752,0-12.117C99.095,35.855,98.143,35.249,97.109,34.816z"/> <path d="M131.272,34.736c-3.202-1.329-6.89-0.59-9.331,1.872c-0.753,0.83-1.359,1.782-1.792,2.816 c-0.911,2.066-0.911,4.419,0,6.485c0.433,1.034,1.039,1.986,1.792,2.816c3.365,3.3,8.752,3.3,12.117,0 c0.753-0.83,1.359-1.782,1.792-2.816c0.478-1.013,0.712-2.123,0.683-3.243C136.554,39.2,134.474,36.065,131.272,34.736z"/> <path d="M460.8,34.133H170.667c-4.713,0-8.533,3.82-8.533,8.533s3.82,8.533,8.533,8.533H460.8c4.713,0,8.533-3.82,8.533-8.533 S465.513,34.133,460.8,34.133z"/> <path d="M131.012,406.357c0.388,0.357,0.811,0.675,1.263,0.947c32.121,34.15,76.927,53.51,123.81,53.495 s91.676-19.402,123.776-53.572c0.424-0.247,0.824-0.533,1.195-0.853c0.28-0.393,0.526-0.81,0.734-1.246 c59.882-64.957,59.882-164.999,0-229.956l-0.034-0.017c-0.208-0.436-0.454-0.853-0.734-1.246 c-0.389-0.362-0.815-0.682-1.271-0.956c-32.107-34.122-76.88-53.47-123.733-53.47s-91.626,19.348-123.733,53.47 c-0.456,0.273-0.882,0.594-1.271,0.956c-0.28,0.393-0.526,0.81-0.734,1.246c-59.882,64.957-59.882,164.999,0,229.956 C130.487,405.547,130.732,405.964,131.012,406.357z M302.549,436.454c13.117-15.841,22.99-34.108,29.056-53.76v-0.026 c10.72,5.022,20.834,11.245,30.148,18.551C344.941,417.296,324.697,429.344,302.549,436.454z M373.53,388.821 c-11.356-9.11-23.817-16.751-37.086-22.741c5.488-22.067,8.485-44.679,8.934-67.413h63.787 C407.391,331.79,394.882,363.436,373.53,388.821z M409.165,281.6h-63.787c-0.45-22.734-3.447-45.347-8.934-67.413 c13.268-5.985,25.729-13.62,37.086-22.724C394.879,216.843,407.387,248.482,409.165,281.6z M361.754,179.021 c-9.314,7.306-19.428,13.53-30.148,18.551c-6.063-19.661-15.936-37.937-29.056-53.786 C324.697,150.897,344.941,162.945,361.754,179.021z M264.533,137.728c20.915,5.478,39.415,30.626,51.072,66.227 c-16.468,5.678-33.669,8.951-51.072,9.719V137.728z M264.533,230.75c18.987-0.711,37.773-4.159,55.774-10.24 c4.841,20.019,7.527,40.499,8.013,61.09h-63.787V230.75z M264.533,298.667h63.787c-0.487,20.585-3.173,41.059-8.013,61.073 c-18.002-6.075-36.787-9.518-55.774-10.223V298.667z M264.533,366.592c17.403,0.771,34.604,4.047,51.072,9.728 c-11.657,35.601-30.157,60.749-51.072,66.227V366.592z M150.246,401.195c9.317-7.288,19.431-13.495,30.148-18.5v-0.026 c6.066,19.652,15.939,37.919,29.056,53.76C187.303,429.319,167.059,417.271,150.246,401.195z M247.467,442.539 c-20.915-5.478-39.415-30.626-51.072-66.227c16.468-5.678,33.669-8.951,51.072-9.719V442.539z M247.467,349.517 c-18.987,0.711-37.772,4.159-55.774,10.24c-4.841-20.02-7.527-40.499-8.013-61.09h63.787V349.517z M247.467,281.6H183.68 c0.487-20.585,3.173-41.059,8.013-61.073c18.002,6.075,36.787,9.518,55.774,10.223V281.6z M247.467,137.719v75.955 c-17.403-0.771-34.604-4.047-51.072-9.728C208.051,168.346,226.551,143.198,247.467,137.719z M209.451,143.761 c-13.123,15.856-22.996,34.141-29.056,53.811v-0.026c-10.72-5.022-20.834-11.245-30.148-18.552 C167.059,162.919,187.303,150.871,209.451,143.761z M138.47,191.445c11.356,9.11,23.817,16.751,37.086,22.741 c-5.488,22.067-8.485,44.679-8.934,67.413h-63.787C104.609,248.476,117.118,216.83,138.47,191.445z M166.622,298.667 c0.45,22.734,3.447,45.347,8.934,67.413c-13.268,5.985-25.729,13.62-37.086,22.724c-21.349-25.38-33.857-57.02-35.635-90.138 H166.622z"/> </g> </svg>',
                values: {},
                options: {
                    redirect: {
                        title: "Redirect",
                        position: 1,
                        options: {
                            "redirectToGenieBrands": {
                                "label": "Use Yalagenie",
                                "defaultValue": false,
                                "widget": "toggle"
                            },
                            "redirectLink": {
                                "label": "Redirect Link",
                                "defaultValue": {
                                    url: "",
                                    target: "_self"
                                },
                                "widget": "link_list"
                            },
                            "timeout": {
                                "label": "Delay before redirect (Millisecond)",
                                "defaultValue": 500,
                                "widget": "counter"
                            },
                            "script": {
                                "label": "Javascript Code",
                                "defaultValue": "",
                                "widget": "html"
                            }
                        }
                    }
                },
                renderer: {
                    Viewer: unlayer.createViewer({
                        render(values) {
                            return \`
                                <div style="text-align: center; font-style: italic;">
                                    <strong>Embeded Redirect Script</strong>
                                </div>
                            \`
                        }
                    }),
                    exporters: {
                        web: function(values) {
                            return \`
                                <div style="text-align: center; font-style: italic;">
                                    \$\{values.script\}
                                    <script>
                                        var genie_brands = \$\{values.redirectToGenieBrands\};
                                        if(genie_brands) {
                                            if(localStorage.getItem("plg_prod_thankyou_list") || localStorage.getItem("plg_prod_list")) {
                                                var object = {};
                                                if(localStorage.getItem("plg_prod_thankyou_list")) {
                                                    object = JSON.parse(localStorage.getItem("plg_prod_thankyou_list"));
                                                } else if(localStorage.getItem("plg_prod_list")) {
                                                    object = {
                                                        currency: localStorage.getItem("cod_data") ? JSON.parse(localStorage.getItem("cod_data")).currencySymbol : "$",
                                                        data: JSON.parse(localStorage.getItem("plg_prod_list"))
                                                    }
                                                }
                                                if(localStorage.getItem("cod_data")) {
                                                    object.customer_info = JSON.parse(localStorage.getItem("cod_data"));

                                                    // remove unnecessary object we only need customer info
                                                    delete object.customer_info.source_link;
                                                    delete object.customer_info.smsVerified;
                                                    delete object.customer_info.currencySymbol;
                                                    delete object.customer_info.currencyWord;
                                                    delete object.customer_info.variant_id;
                                                    delete object.customer_info.customerID;
                                                    delete object.customer_info.merchantType;
                                                    delete object.customer_info.variantName;
                                                    delete object.customer_info.productName;
                                                    delete object.customer_info.productPrice;
                                                    delete object.customer_info.fplg;
                                                    delete object.customer_info.pageid;
                                                    delete object.customer_info.meta;
                                                }
                                                object.currency = encodeURI(object.currency);
                                                let cod_currency = JSON.parse(localStorage.getItem("cod_currency"));
                                                let escape_url = btoa(escape(JSON.stringify(object)));
                                                var link = "https://yalagenie.com/thank-you/"+cod_currency.code.toLowerCase()+"?data="+escape_url;
                                                setTimeout(function() {
                                                    window.location.href = link;
                                                }, \$\{values.timeout\});
                                            } else {
                                                console.log("No action to perform.");
                                            }
                                        } else {
                                            setTimeout(function() {
                                                window.open("\$\{values.redirectLink.url\}", "\$\{values.redirectLink.target\}")
                                            }, \$\{values.timeout\});
                                        }
                                    </script>
                                </div>
                            \`
                        },
                        email: function() {}
                    },
                },
            });

            // Variant Button
            unlayer.registerPropertyEditor({
                name: 'variants',
                layout: 'bottom',
                Widget: unlayer.createWidget({
                    render(value) {
                        return \`
                            <div class="blockbuilder-widget blockbuilder-link-widget">
                                <div class="row eiCcjJ">
                                    <div class="blockbuilder-widget-label col-12">
                                        <label class="blockbuilder-label-primary">
                                            <span>Search product in your shopify</span>
                                        </label>
                                        <!-- start toggle button for shopify variant options -->
                                        <label class="blockbuilder-label-right">
                                            <div class="react-toggle">
                                                <div class="react-toggle-track">
                                                    <div class="react-toggle-track-check">
                                                        <svg width="14" height="11" viewBox="0 0 14 11">
                                                            <title>switch-check</title>
                                                            <path d="M11.264 0L5.26 6.004 2.103 2.847 0 4.95l5.26 5.26 8.108-8.107L11.264 0" fill="#fff" fill-rule="evenodd"></path>
                                                        </svg>
                                                    </div>
                                                    <div class="react-toggle-track-x">
                                                        <svg width="10" height="10" viewBox="0 0 10 10">
                                                            <title>switch-x</title>
                                                            <path d="M9.9 2.12L7.78 0 4.95 2.828 2.12 0 0 2.12l2.83 2.83L0 7.776 2.123 9.9 4.95 7.07 7.78 9.9 9.9 7.776 7.072 4.95 9.9 2.12" fill="#fff" fill-rule="evenodd"></path>
                                                        </svg>
                                                    </div>
                                                </div>
                                                <div class="react-toggle-thumb"></div>
                                                <input class="react-toggle-screenreader-only" type="checkbox">
                                            </div>
                                        </label>
                                        <!-- end toggle button for shopify variant options -->
                                        <div style="margin: 10px 0; width: 100%; position: relative;">
                                            <input type="text" class="search-shopify-product form-control">
                                            <ul class="shopify-show-result"></ul>
                                        </div>
                                    </div>
                                </div>
                                <div id="blockbuilder-widget-variant-menu" style="overflow-y: auto; max-height: 335px; overflow-x: hidden;">
                                    <!-- Dynamic Variant Will Appear here -->
                                </div>
                            </div>
                        \`
                    },
                    mount(node, value, updateValue) {
                        let variantMenuContainer = document.getElementById("blockbuilder-widget-variant-menu");
                        let parseVariant = [{ "isSuggest":false, "variant_name":"1x of your product", "price":"20", "discount":"10" }];
                        try {
                            // dko alam bkt ayaw ma parse pag may sobrang comma sa huli ng object pero sa console ok naman kaya binura ko nlng
                            value = value.replace(/,\}/g, "}");
                            if(value) parseVariant = JSON.parse(value);
                        } catch(error) {
                            console.log("An error has occurred while parsing variant (Mount)");
                        }
                        if (parseVariant.length != 0) variantMenuContainer.innerHTML = \`<style>input::-webkit-outer-spin-button,input::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}input[type=number]{-moz-appearance:textfield}</style><div class="row eiCcjJ" style="margin: 0 0 5px; padding-bottom: 5px; border-bottom: 1px solid #5a5a5a;"> <div class="blockbuilder-widget-label col-1" style="padding: 0"> <input type="radio" name="suggest" class="variant_suggest" style="font-size: 12px; cursor: pointer; margin: 0 auto;"> </div> <div class="blockbuilder-widget-label col-11" style="padding: 0"> <!-- Labels --> <div class="blockbuilder-widget-label col-2 text-center" style="padding: 5px;"> <label class="blockbuilder-label-primary"> <span>Qty</span> </label> </div> <div class="blockbuilder-widget-label col-2 text-center" style="padding: 5px;"> <label class="blockbuilder-label-primary"> <span>Price</span> </label> </div> <div class="blockbuilder-widget-label col-2 text-center" style="padding: 5px;"> <label class="blockbuilder-label-primary"> <span>DISC (%)</span> </label> </div> <div class="blockbuilder-widget-label col-4 text-center" style="padding: 5px;"> <label class="blockbuilder-label-primary"> <span>Tag</span> </label> </div> <div class="blockbuilder-widget-label col-2 text-center" style="padding: 5px;"><label class="blockbuilder-label-primary"><span>Cost of Goods</span></label></div>

                        <!-- Inputs --> <div class="blockbuilder-widget-label col-2" style="padding: 0 0 0 5px;"> <input type="text" class="variant_qty form-control" style="background-color: #555555; border: 1px solid #777; color: #fff; font-size: 12px;"> </div> <div class="blockbuilder-widget-label col-2" style="padding: 0 0 0 5px;"> <input type="number" class="variant_prices form-control" style="background-color: #555555; border: 1px solid #777; color: #fff; font-size: 12px;"> </div> <div class="blockbuilder-widget-label col-2" style="padding: 0 0 0 5px;"> <input type="number" class="variant_discounts form-control" style="background-color: #555555; border: 1px solid #777; color: #fff; font-size: 12px;"> </div> <div class="blockbuilder-widget-label col-4" style="padding: 0 0 0 5px;"> <input type="text" class="variant_tag form-control" style="background-color: #555555; border: 1px solid #777; color: #fff; font-size: 12px;" placeholder="Tag"> </div><div class="blockbuilder-widget-label col-2" style="padding: 0  5px  0 5px;"><input type="number" class="cog form-control" style="background-color: #555555; border: 1px solid #777; color: #fff; font-size: 12px;"></div><div class="blockbuilder-widget-label col-4" style="padding: 5px 0;"> <label class="blockbuilder-label-primary"> <span>Ribbon Text</span> </label> </div> <div class="col-8" style="padding: 5px 5px 0 0;"> <input type="text" class="ribbon_text form-control" style="background-color: #555555; border: 1px solid #777; color: #fff; font-size: 12px;" placeholder="Ribbon Text"> </div> <div class="blockbuilder-widget-label col-4" style="padding: 5px 0;"> <label class="blockbuilder-label-primary"> <span>Variant Name</span> </label> </div> <div class="col-8" style="padding: 5px 5px 0 0;"> <input type="text" class="variant_names form-control" style="background-color: #555555; border: 1px solid #777; color: #fff; font-size: 12px;"> </div> ${(() => { if(this.props.session.getCurrentUser.privilege >= 5 || localStorage.getItem(points.plg_domain_secret)){ /* if admin or login as anonymous // User Privilege scroll left */ return ` <div class="blockbuilder-widget-label col-4" style="padding: 5px 0;"> <label class="blockbuilder-label-primary"> <span>PLG Variant ID</span> </label> </div> <div class="col-8" style="padding: 5px 5px 0 0;"> <input type="text" class="variant_sku form-control" style="background-color: #555555; border: 1px solid #777; color: #fff; font-size: 12px;" placeholder="PLG Variant ID"> <ul class="shopify-show-result"></ul> </div> `; } else return ""; })()} </div> </div>\`;
                        let variants = parseVariant.filter(el => el.variant_name || el.price || el.discount);
                        variants.forEach((variantValue, i) => {
                            variantMenuContainer.innerHTML += \`
                                <div class="row eiCcjJ" style="margin: 0 0 5px; padding-bottom: 5px; border-bottom: 1px solid #5a5a5a;">
                                    <div class="blockbuilder-widget-label col-1" style="padding: 0">
                                        <input type="radio" name="suggest" class="variant_suggest" style="font-size: 12px; cursor: pointer; margin: 0 auto;">
                                    </div>
                                    <div class="blockbuilder-widget-label col-11" style="padding: 0">
                                        <!-- Labels -->
                                        <div class="blockbuilder-widget-label col-2 text-center" style="padding: 5px;">
                                            <label class="blockbuilder-label-primary">
                                                <span>Qty</span>
                                            </label>
                                        </div>
                                        <div class="blockbuilder-widget-label col-2 text-center" style="padding: 5px;">
                                            <label class="blockbuilder-label-primary">
                                                <span>Price</span>
                                            </label>
                                        </div>
                                        <div class="blockbuilder-widget-label col-2 text-center" style="padding: 5px;">
                                            <label class="blockbuilder-label-primary">
                                                <span>DISC (%)</span>
                                            </label>
                                        </div>
                                        <div class="blockbuilder-widget-label col-4 text-center" style="padding: 5px;">
                                            <label class="blockbuilder-label-primary">
                                                <span>Tag</span>
                                            </label>
                                        </div>
                                        <div class="blockbuilder-widget-label col-2 text-center" style="padding: 5px;">
                                            <label class="blockbuilder-label-primary">
                                                <span>Cost of Goods</span>
                                            </label>
                                        </div>
                                        <!-- Inputs -->
                                        <div class="blockbuilder-widget-label col-2" style="padding: 0;">
                                            <input type="text" class="variant_qty form-control" style="background-color: #555555; border: 1px solid #777; color: #fff; font-size: 12px;">
                                        </div>
                                        <div class="blockbuilder-widget-label col-2" style="padding: 0 0 0 5px;">
                                            <input type="number" class="variant_prices form-control" style="background-color: #555555; border: 1px solid #777; color: #fff; font-size: 12px;">
                                        </div>
                                        <div class="blockbuilder-widget-label col-2" style="padding: 0 0 0 5px;">
                                            <input type="number" class="variant_discounts form-control" style="background-color: #555555; border: 1px solid #777; color: #fff; font-size: 12px;">
                                        </div>
                                        <div class="blockbuilder-widget-label col-4" style="padding: 0 0 0 5px;">
                                            <input type="text" class="variant_tag form-control" style="background-color: #555555; border: 1px solid #777; color: #fff; font-size: 12px;" placeholder="Tag">
                                        </div>
                                        <div class="blockbuilder-widget-label col-2" style="padding: 0  5px  0 5px;">
                                            <input type="number" class="cog form-control" style="background-color: #555555; border: 1px solid #777; color: #fff; font-size: 12px;">
                                        </div>
                                        <div class="blockbuilder-widget-label col-4" style="padding: 5px 0;">
                                            <label class="blockbuilder-label-primary">
                                                <span>Ribbon Text</span>
                                            </label>
                                        </div>
                                        <div class="col-8" style="padding: 5px 5px 0 0;">
                                            <input type="text" class="ribbon_text form-control" style="background-color: #555555; border: 1px solid #777; color: #fff; font-size: 12px;" placeholder="Ribbon Text">
                                        </div>
                                        <div class="blockbuilder-widget-label col-4" style="padding: 5px 0;">
                                            <label class="blockbuilder-label-primary">
                                                <span>Variant Name</span>
                                            </label>
                                        </div>
                                        <div class="col-8" style="padding: 5px 5px 0 0;">
                                            <input type="text" class="variant_names form-control" style="background-color: #555555; border: 1px solid #777; color: #fff; font-size: 12px;">
                                        </div>
                                        ${(() => {
                                            if (this.props.session.getCurrentUser.privilege >= 5 || localStorage.getItem(points.plg_domain_secret)) { // User Privilege
                                                /* if admin or login as anonymous */
                                                return `
                                                    <div class="blockbuilder-widget-label col-4" style="padding: 5px 0;">
                                                        <label class="blockbuilder-label-primary">
                                                            <span>PLG Variant ID</span>
                                                        </label>
                                                    </div>
                                                    <div class="col-8" style="padding: 5px 5px 0 0;">
                                                        <input type="text" class="variant_sku form-control" style="background-color: #555555; border: 1px solid #777; color: #fff; font-size: 12px;" placeholder="PLG Variant ID">
                                                        <ul class="shopify-show-result"></ul>
                                                    </div>
                                                `;
                                            } else return "";
                                        })()}
                                    </div>
                                </div>
                            \`;
                        });

                        var suggests = document.querySelectorAll(".variant_suggest");
                        var ribbon_text = document.querySelectorAll(".ribbon_text");
                        var qtys = document.querySelectorAll(".variant_qty");
                        var names = document.querySelectorAll(".variant_names");
                        var prices = document.querySelectorAll(".variant_prices");
                        var discounts = document.querySelectorAll(".variant_discounts");
                        var tag = document.querySelectorAll(".variant_tag");
                        var skus = document.querySelectorAll(".variant_sku");
                        var cogs = document.querySelectorAll(".cog");
                        suggests.forEach((el,i) => {
                            el.checked = variants[i] && variants[i].isSuggest ? variants[i].isSuggest : false;
                            el.onclick = () => {
                                // remove check from all radio
                                variants = variants.map(variant => {
                                    variant.isSuggest = false;
                                    return variant;
                                });
                                variants[i] = {
                                    id: variants[i] && variants[i].id ? variants[i].id : "",
                                    isSuggest: el.checked,
                                    ribbon_text: variants[i] && variants[i].ribbon_text ? variants[i].ribbon_text : "",
                                    variant_qty: variants[i] && variants[i].variant_qty ? variants[i].variant_qty : "",
                                    variant_name: variants[i] && variants[i].variant_name ? variants[i].variant_name : "",
                                    price: variants[i] && variants[i].price ? variants[i].price : "",
                                    discount: variants[i] && variants[i].discount ? variants[i].discount : "",
                                    shopifyProduct: variants[i] && variants[i].shopifyProduct ? variants[i].shopifyProduct : "",
                                    tag: variants[i] && variants[i].tag ? variants[i].tag : "",
                                    variant_sku: variants[i] && variants[i].variant_sku ? variants[i].variant_sku : "",
                                    cog: variants[i] && variants[i].cog ? variants[i].cog : ""
                                }
                                updateValue(JSON.stringify(variants))
                            }
                        });
                        ribbon_text.forEach((el, i) => {
                            el.value = variants[i] && variants[i].ribbon_text ? variants[i].ribbon_text : "";
                            el.onchange = () => {
                                variants[i] = {
                                    id: variants[i] && variants[i].id ? variants[i].id : "",
                                    isSuggest: variants[i] && variants[i].isSuggest ? variants[i].isSuggest : false,
                                    ribbon_text: el.value,
                                    variant_qty: variants[i] && variants[i].variant_qty ? variants[i].variant_qty : "",
                                    variant_name: variants[i] && variants[i].variant_name ? variants[i].variant_name : "",
                                    price: variants[i] && variants[i].price ? variants[i].price : "",
                                    discount: variants[i] && variants[i].discount ? variants[i].discount : "",
                                    shopifyProduct: variants[i] && variants[i].shopifyProduct ? variants[i].shopifyProduct : "",
                                    tag: variants[i] && variants[i].tag ? variants[i].tag : "",
                                    variant_sku: variants[i] && variants[i].variant_sku ? variants[i].variant_sku : "",
                                    cog: variants[i] && variants[i].cog ? variants[i].cog : ""
                                }
                                updateValue(JSON.stringify(variants))
                            }
                        });
                        qtys.forEach((el,i) => {
                            el.value = variants[i] && variants[i].variant_qty ? variants[i].variant_qty : "1";
                            // if(variants[0] && variants[0].id) el.disabled = true; // disabled if has shopify variant id in first index
                            el.onchange = () => {
                                var shopifyProduct = variants[i] && variants[i].shopifyProduct ? variants[i].shopifyProduct : "";
                                variants[i] = {
                                    id: variants[i] && variants[i].id ? variants[i].id : "",
                                    isSuggest: variants[i] && variants[i].isSuggest ? variants[i].isSuggest : false,
                                    ribbon_text: variants[i] && variants[i].ribbon_text ? variants[i].ribbon_text : "",
                                    variant_qty: el.value,
                                    variant_name: variants[i] && variants[i].variant_name ? variants[i].variant_name : "",
                                    price: variants[i] && variants[i].price ? variants[i].price : "",
                                    discount: variants[i] && variants[i].discount ? variants[i].discount : "",
                                    shopifyProduct: shopifyProduct,
                                    tag: variants[i] && variants[i].tag ? variants[i].tag : "",
                                    variant_sku: variants[i] && variants[i].variant_sku ? variants[i].variant_sku : "",
                                    cog: variants[i] && variants[i].cog ? variants[i].cog : ""
                                }
                                updateValue(JSON.stringify(variants))
                            }
                        });
                        names.forEach((el,i) => {
                            el.value = variants[i] && variants[i].variant_name ? variants[i].variant_name : "";
                            // if(variants[0] && variants[0].id) el.disabled = true; // disabled if has shopify variant id in first index
                            el.onchange = () => {
                                var shopifyProduct = variants[i] && variants[i].shopifyProduct ? variants[i].shopifyProduct : "";
                                variants[i] = {
                                    id: variants[i] && variants[i].id ? variants[i].id : "",
                                    isSuggest: variants[i] && variants[i].isSuggest ? variants[i].isSuggest : false,
                                    ribbon_text: variants[i] && variants[i].ribbon_text ? variants[i].ribbon_text : "",
                                    variant_qty: variants[i] && variants[i].variant_qty ? variants[i].variant_qty : "",
                                    variant_name: el.value,
                                    price: variants[i] && variants[i].price ? variants[i].price : "",
                                    discount: variants[i] && variants[i].discount ? variants[i].discount : "",
                                    shopifyProduct: shopifyProduct,
                                    tag: variants[i] && variants[i].tag ? variants[i].tag : "",
                                    variant_sku: variants[i] && variants[i].variant_sku ? variants[i].variant_sku : "",
                                    cog: variants[i] && variants[i].cog ? variants[i].cog : ""
                                }
                                updateValue(JSON.stringify(variants))
                            }
                        });
                        prices.forEach((el,i) => {
                            el.value = variants[i] && variants[i].price ? variants[i].price : "";
                            el.disabled = variants[0] && variants[0].id ? true : false; // disabled if has shopify variant id in first index
                            el.onchange = () => {
                                variants[i] = {
                                    id: variants[i] && variants[i].id ? variants[i].id : "",
                                    isSuggest: variants[i] && variants[i].isSuggest ? variants[i].isSuggest : false,
                                    ribbon_text: variants[i] && variants[i].ribbon_text ? variants[i].ribbon_text : "",
                                    variant_qty: variants[i] && variants[i].variant_qty ? variants[i].variant_qty : "",
                                    variant_name: variants[i] && variants[i].variant_name ? variants[i].variant_name : "",
                                    price: el.value,
                                    discount: variants[i] && variants[i].discount ? variants[i].discount : "",
                                    shopifyProduct: variants[i] && variants[i].shopifyProduct ? variants[i].shopifyProduct : "",
                                    tag: variants[i] && variants[i].tag ? variants[i].tag : "",
                                    variant_sku: variants[i] && variants[i].variant_sku ? variants[i].variant_sku : "",
                                    cog: variants[i] && variants[i].cog ? variants[i].cog : ""
                                }
                                updateValue(JSON.stringify(variants))
                            }
                        });
                        discounts.forEach((el,i) => {
                            el.value = variants[i] && variants[i].discount ? variants[i].discount : "";
                            el.disabled = variants[0] && variants[0].id ? true : false; // disabled if has shopify variant id in first index
                            el.onchange = () => {
                                variants[i] = {
                                    id: variants[i] && variants[i].id ? variants[i].id : "",
                                    isSuggest: variants[i] && variants[i].isSuggest ? variants[i].isSuggest : false,
                                    ribbon_text: variants[i] && variants[i].ribbon_text ? variants[i].ribbon_text : "",
                                    variant_qty: variants[i] && variants[i].variant_qty ? variants[i].variant_qty : "",
                                    variant_name: variants[i] && variants[i].variant_name ? variants[i].variant_name : "",
                                    price: variants[i] && variants[i].price ? variants[i].price : "",
                                    discount: el.value,
                                    shopifyProduct: variants[i] && variants[i].shopifyProduct ? variants[i].shopifyProduct : "",
                                    tag: variants[i] && variants[i].tag ? variants[i].tag : "",
                                    variant_sku: variants[i] && variants[i].variant_sku ? variants[i].variant_sku : "",
                                    cog: variants[i] && variants[i].cog ? variants[i].cog : ""
                                }
                                updateValue(JSON.stringify(variants))
                            }
                        });
                        tag.forEach((el, i) => {
                            el.value = variants[i] && variants[i].tag ? variants[i].tag : "";
                            el.onchange = () => {
                                variants[i] = {
                                    id: variants[i] && variants[i].id ? variants[i].id : "",
                                    isSuggest: variants[i] && variants[i].isSuggest ? variants[i].isSuggest : false,
                                    ribbon_text: variants[i] && variants[i].ribbon_text ? variants[i].ribbon_text : "",
                                    variant_qty: variants[i] && variants[i].variant_qty ? variants[i].variant_qty : "",
                                    variant_name: variants[i] && variants[i].variant_name ? variants[i].variant_name : "",
                                    price: variants[i] && variants[i].price ? variants[i].price : "",
                                    discount: variants[i] && variants[i].discount ? variants[i].discount : "",
                                    shopifyProduct: variants[i] && variants[i].shopifyProduct ? variants[i].shopifyProduct : "",
                                    tag: el.value,
                                    variant_sku: variants[i] && variants[i].variant_sku ? variants[i].variant_sku : "",
                                    cog: variants[i] && variants[i].cog ? variants[i].cog : ""
                                }
                                updateValue(JSON.stringify(variants))
                            }
                        });
                        cogs.forEach((el, i) => {
                            el.value = variants[i] && variants[i].cog ? variants[i].cog : "";
                            el.onchange = () => {
                                variants[i] = {
                                    id: variants[i] && variants[i].id ? variants[i].id : "",
                                    isSuggest: variants[i] && variants[i].isSuggest ? variants[i].isSuggest : false,
                                    ribbon_text: variants[i] && variants[i].ribbon_text ? variants[i].ribbon_text : "",
                                    variant_qty: variants[i] && variants[i].variant_qty ? variants[i].variant_qty : "",
                                    variant_name: variants[i] && variants[i].variant_name ? variants[i].variant_name : "",
                                    price: variants[i] && variants[i].price ? variants[i].price : "",
                                    discount: variants[i] && variants[i].discount ? variants[i].discount : "",
                                    shopifyProduct: variants[i] && variants[i].shopifyProduct ? variants[i].shopifyProduct : "",
                                    tag: variants[i] && variants[i].tag ? variants[i].tag : "",
                                    variant_sku: variants[i] && variants[i].variant_sku ? variants[i].variant_sku : "",
                                    cog: el.value,
                                }
                                updateValue(JSON.stringify(variants))
                            }
                        });
                        var to = [];
                        skus.forEach((el, i) => {
                            el.value = variants[i] && variants[i].variant_sku ? variants[i].variant_sku : "";
                            el.onkeyup = () => {
                                clearTimeout(to[i]);
                                if(el.value) {
                                    el.parentNode.querySelector(".shopify-show-result").style.zIndex = 10;
                                    el.parentNode.querySelector(".shopify-show-result").innerHTML = "<li>Loading...</li>";
                                    to[i] = setTimeout(() => {
                                        const payload = { query: \`query($search: String) { getFunnelProducts(search: $search, limit: 5, page: 1){ id productName productSku productSrp } }\`, variables: { search: el.value } }
                                        fetch('/graphql', { method: "POST", headers: { 'Content-Type': 'application/json', }, body: JSON.stringify(payload) })
                                        .then(res => res.json())
                                        .then(res => {
                                            const data = res.data.getFunnelProducts;
                                            var str = "";
                                            if(data.length != 0) {
                                                data.forEach(d => {
                                                    str += \`<li id="\$\{d.id\}" data-price="\$\{d.productSrp\}" class="plg_cod_product">\$\{d.productName\} - \$\{d.productSku\}</li>\`;
                                                })
                                            } else {
                                                str = "<li>No Result Found.</li>";
                                            }
                                            el.parentNode.querySelector(".shopify-show-result").innerHTML = str;
                                            el.parentNode.querySelectorAll(".shopify-show-result li").forEach(li => {
                                                li.onclick = () => {
                                                    if(li.id) el.value = window.parent.encodeID(li.id);
                                                    compileResult(); // compileResult(li.getAttribute("data-price"));
                                                    el.parentNode.querySelector(".shopify-show-result").innerHTML = "";
                                                }
                                            })
                                        })
                                        .catch(err => el.parentNode.querySelector(".shopify-show-result").innerHTML = "<li>Please Try again.</li>")
                                    }, 500)
                                } else {
                                    el.parentNode.querySelector(".shopify-show-result").innerHTML = "";
                                    compileResult();
                                }
                            }

                            function compileResult(price){
                                if(price) price = price * 3.75; // per dollar in ksa and uae (remove discount if used plg cod product use price too)
                                variants[i] = {
                                    id: variants[i] && variants[i].id ? variants[i].id : "",
                                    isSuggest: variants[i] && variants[i].isSuggest ? variants[i].isSuggest : false,
                                    ribbon_text: variants[i] && variants[i].ribbon_text ? variants[i].ribbon_text : "",
                                    variant_qty: variants[i] && variants[i].variant_qty ? variants[i].variant_qty : "",
                                    variant_name: variants[i] && variants[i].variant_name ? variants[i].variant_name : "",
                                    price: price ? price : variants[i] && variants[i].price ? variants[i].price : "",
                                    discount: price ? "" : variants[i] && variants[i].discount ? variants[i].discount : "",
                                    shopifyProduct: variants[i] && variants[i].shopifyProduct ? variants[i].shopifyProduct : "",
                                    tag: variants[i] && variants[i].tag ? variants[i].tag : "",
                                    cog: variants[i] && variants[i].cog ? variants[i].cog : "",
                                    variant_sku: el.value,
                                }
                                updateValue(JSON.stringify(variants))
                            }
                        });

                        // initialize product search variable needed for disabling shopify variant 
                        var searchShopify = node.querySelector(".search-shopify-product");
                        var showResult = node.querySelector(".shopify-show-result");

                        // start enabling and disabling shopify variant
                        var toggleParent = node.querySelector(".react-toggle");
                        var toggleCheckbox = node.querySelector("input[type='checkbox']");
                        var isUpsellOrDownsell = ${isUpsellOrDownsell};
                        if(isUpsellOrDownsell){
                            node.querySelector(".upsellOrdownsell") ? node.querySelector(".upsellOrdownsell").innerHTML = \`<label><span>Select</span></label>\` : void 0;
                        }
                        toggleCheckbox.onclick = event => {
                            searchShopify.parentNode.classList.toggle("hide");
                            toggleParent.classList.toggle("react-toggle--checked");
                            if(!event.target.checked){
                                searchShopify.value = "";
                                showResult.innerHTML = "";
                                if(isUpsellOrDownsell){
                                    variants = [];
                                } else {
                                    variants = [ { "id": "", "isSuggest":false, "variant_name":"1x of your product", "price":"20", "discount":"10" } ];
                                }
                                updateValue(JSON.stringify(variants))
                            }
                        }
                        // handle class change for toggle parent and checkbox
                        if(variants.length != 0 && variants[0].shopifyProduct){
                            searchShopify.parentNode.classList.remove("hide");
                            toggleParent.classList.add("react-toggle--checked");
                            toggleCheckbox.checked = true;
                            searchShopify.value = variants[0].shopifyProduct.name;
                        } else {
                            searchShopify.parentNode.classList.add("hide");
                        }
                        // end enabling and disabling shopify variant

                        // start search shopify product
                        var searchTimeout = null;
                        searchShopify.onkeyup = event => {
                            showResult.innerHTML = \`<li>Loading please wait...</li>\`
                            clearTimeout(searchTimeout)
                            var searchProduct = event.target.value;
                            searchTimeout = setTimeout(() => {
                                fetch('/api/admin-search-products', {
                                    method: "POST",
                                    headers: {
                                        'Content-Type': 'application/json'
                                    },
                                    body: JSON.stringify({
                                        searchProduct,
                                        storeUrl: "${this.props.session.getCurrentUser.store_url}",
                                        storeToken: "${this.props.session.getCurrentUser.store_token}"
                                    })
                                })
                                .then(res => res.json())
                                .then(res => {
                                    var results = res.data.products.edges;
                                    if(results.length == 0){
                                        showResult.innerHTML = \`<li>No result for \$\{searchProduct\}</li>\`;
                                    } else {
                                        showResult.innerHTML = "";
                                        results.forEach(el => {
                                            showResult.innerHTML += \`<li class="shopify-products" data-prod-id="\$\{el.node.id\}" data-prod-name="\$\{el.node.title\}"><img src="\$\{el.node.images.edges.length == 0 ? "https://via.placeholder.com/40x40?text=N/A" : el.node.images.edges[0].node.originalSrc\}"> \$\{el.node.title\}</li>\`;
                                        })
                                        var selectedProduct = node.querySelectorAll(".shopify-products");
                                        selectedProduct.forEach(product => {
                                            product.onclick = event => {
                                                showResult.innerHTML = "";
                                                // search product by product id and get its variant
                                                fetch('/api/admin-get-product', {
                                                    method: "POST",
                                                    headers: {
                                                        'Content-Type': 'application/json'
                                                    },
                                                    body: JSON.stringify({
                                                        productid: event.target.getAttribute("data-prod-id"),
                                                        storeUrl: "${this.props.session.getCurrentUser.store_url}",
                                                        storeToken: "${this.props.session.getCurrentUser.store_token}"
                                                    })
                                                })
                                                .then(prodRes => prodRes.json())
                                                .then(prodRes => {
                                                    var shopifyVariant = prodRes.data.product.variants.edges;
                                                    var newVariants = [];
                                                    // create new variant as shopify variant
                                                    shopifyVariant.forEach(newVar => {
                                                        var p1 = parseFloat(newVar.node.price);
                                                        var p2 = parseFloat(newVar.node.compareAtPrice);
                                                        var disc = p1 && p2 ? Math.abs(((p1 - p2) / p2) * 100).toString() : "";
                                                        newVariants.push({
                                                            id: newVar.node.id.replace("gid://shopify/ProductVariant/",""),
                                                            isSuggest: false,
                                                            variant_name: newVar.node.title,
                                                            price: isUpsellOrDownsell ? newVar.node.price : p2 ? p2.toString() : p1.toString(),
                                                            discount: isUpsellOrDownsell ? "" : disc, // no need for discount
                                                            shopifyProduct: {
                                                                id: event.target.getAttribute("data-prod-id"),
                                                                name: event.target.getAttribute("data-prod-name"),
                                                                variant_group: newVar.node.selectedOptions
                                                            }
                                                        });
                                                    });
                                                    variants = newVariants;
                                                    updateValue(JSON.stringify(variants))
                                                });
                                            }
                                        })
                                    }
                                })
                            }, 1000)
                        }
                        // end search shopify product
                    }
                })
            });

            console.log("5. Initializing variant...");
            unlayer.registerTool({
                type: 'variant',
                category: 'contents',
                label: 'Variant',
                icon: '<svg class="svg-inline--fa fa-w-14 fa-w-20 fa-3x" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" viewBox="0 0 512 512"> <g fill="#fff"> <path d="M405.3,93.5C405.3,93.5,405,93.10000000000002,405,93.10000000000002C405,93.10000000000002,404.8,93.19999999999999,404.8,93.19999999999999C404.8,93.19999999999999,256,2.5,256,2.5C256,2.5,0,158.5,0,158.5C0,158.5,0,353.5,0,353.5C0,353.5,256,509.5,256,509.5C256,509.5,512,353.5,512,353.5C512,353.5,512,158.5,512,158.5C512,158.5,405.3,93.5,405.3,93.5C405.3,93.5,405.3,93.5,405.3,93.5M256,296.9C256,296.9,188.8,256,188.8,256C188.8,256,177.7,249.2,177.7,249.2C177.7,249.2,404.9,110.80000000000001,404.9,110.80000000000001C404.9,110.80000000000001,483.2,158.5,483.2,158.5C483.2,158.5,337.6,247.2,337.6,247.2C337.6,247.2,323.2,256,323.2,256C323.2,256,256,296.9,256,296.9C256,296.9,256,296.9,256,296.9M158.5,295.7C158.5,295.7,158.5,335.5,158.5,335.5C158.5,335.5,137.2,304.2,137.2,304.2C137.2,304.2,128.5,291.5,128.5,291.5C128.5,291.5,114.2,297.2,114.2,297.2C114.2,297.2,99,303.2,99,303.2C99,303.2,99,274.9,99,274.9C99,274.9,99,248.3,99,248.3C99,248.3,99,219,99,219C99,219,149.3,249.7,149.3,249.7C149.3,249.7,158.5,255.3,158.5,255.3C158.5,255.3,158.5,279.8,158.5,279.8C158.5,279.8,158.5,295.7,158.5,295.7C158.5,295.7,158.5,295.7,158.5,295.7M163.3,240.5C163.3,240.5,104.1,204.39999999999998,104.1,204.39999999999998C104.1,204.39999999999998,331.2,65.89999999999998,331.2,65.89999999999998C331.2,65.89999999999998,390.4,102,390.4,102C390.4,102,163.3,240.5,163.3,240.5C163.3,240.5,163.3,240.5,163.3,240.5M256,20.100000000000023C256,20.100000000000023,316.8,57.19999999999999,316.8,57.19999999999999C316.8,57.19999999999999,89.7,195.60000000000002,89.7,195.60000000000002C89.7,195.60000000000002,28.8,158.5,28.8,158.5C28.8,158.5,256,20.100000000000023,256,20.100000000000023C256,20.100000000000023,256,20.100000000000023,256,20.100000000000023M15,345.3C15,345.3,15,167.60000000000002,15,167.60000000000002C15,167.60000000000002,75.3,204.3,75.3,204.3C75.3,204.3,84.1,209.60000000000002,84.1,209.60000000000002C84.1,209.60000000000002,84.1,226.10000000000002,84.1,226.10000000000002C84.1,226.10000000000002,84.1,252.7,84.1,252.7C84.1,252.7,84.1,309,84.1,309C84.1,309,84.1,325.1,84.1,325.1C84.1,325.1,99.1,319.1,99.1,319.1C99.1,319.1,123,309.6,123,309.6C123,309.6,158.6,361.9,158.6,361.9C158.6,361.9,173.6,383.9,173.6,383.9C173.6,383.9,173.6,357.5,173.6,357.5C173.6,357.5,173.6,289.7,173.6,289.7C173.6,289.7,173.6,273.6,173.6,273.6C173.6,273.6,173.6,264.2,173.6,264.2C173.6,264.2,174.5,264.8,174.5,264.8C174.5,264.8,248.6,310,248.6,310C248.6,310,248.6,487.4,248.6,487.4C248.6,487.4,238.4,481.2,238.4,481.2C238.4,481.2,15,345.3,15,345.3C15,345.3,15,345.3,15,345.3M497,345C497,345,483.1,353.5,483.1,353.5C483.1,353.5,483.2,353.5,483.2,353.5C483.2,353.5,264.6,486.7,264.6,486.7C264.6,486.7,263.5,487.4,263.5,487.4C263.5,487.4,263.5,309.9,263.5,309.9C263.5,309.9,337.6,264.7,337.6,264.7C337.6,264.7,352,255.89999999999998,352,255.89999999999998C352,255.89999999999998,497,167.5,497,167.5C497,167.5,497,345,497,345C497,345,497,345,497,345M333.2,347C333.2,347,304.5,364.5,304.5,364.5C304.5,364.5,289.5,373.6,289.5,373.6C289.5,373.6,289.5,391.2,289.5,391.2C289.5,391.2,289.5,424.6,289.5,424.6C289.5,424.6,289.5,442.2,289.5,442.2C289.5,442.2,304.5,433.1,304.5,433.1C304.5,433.1,347.6,406.8,347.6,406.8C347.6,406.8,362,398,362,398C362,398,370.5,392.8,370.5,392.8C370.5,392.8,385.5,383.7,385.5,383.7C385.5,383.7,385.5,366.1,385.5,366.1C385.5,366.1,385.5,332.7,385.5,332.7C385.5,332.7,385.5,315.1,385.5,315.1C385.5,315.1,370.5,324.2,370.5,324.2C370.5,324.2,347.6,338.2,347.6,338.2C347.6,338.2,333.2,347,333.2,347C333.2,347,333.2,347,333.2,347M370.5,341.8C370.5,341.8,370.5,375.2,370.5,375.2C370.5,375.2,347.6,389.2,347.6,389.2C347.6,389.2,333.2,398,333.2,398C333.2,398,304.5,415.5,304.5,415.5C304.5,415.5,304.5,382.1,304.5,382.1C304.5,382.1,347.6,355.8,347.6,355.8C347.6,355.8,362,347,362,347C362,347,370.5,341.8,370.5,341.8C370.5,341.8,370.5,341.8,370.5,341.8" /> </g> </svg>',
                values: {},
                options: {
                    variant: {
                        title: "Variant | Settings", //april12
                        position: 1,
                        options: {
                            "autoConvert": {
                                "label": "Use Currency Converter",
                                "defaultValue": false,
                                "widget": "toggle"
                            },
                            "codCurrency": {
                                "label": "COD Currency",
                                "defaultValue": ${JSON.stringify(points.funnelEditorData.codCurrencyList)},
                                "widget": "custom_dropdown"
                            },
                            "product_name": {
                                "label": "Product Name (will overwrite if use shopify product)",
                                "defaultValue": "Product Name",
                                "widget": "text"
                            },
                            "variants": {
                                "label": "Variants",
                                "defaultValue": JSON.stringify([ { "isSuggest":false, "variant_name":"1x of your product", "price":"20", "discount":"10" } ]),
                                "widget": "variants"
                            },
                            "selectedStyle": {
                                "label": "Select Recommended Style",
                                "defaultValue": ${variantRecommendedStyle},
                                "widget": "custom_dropdown"
                            },
                            "styleText": {
                                "label": "Recommended Style Text",
                                "defaultValue": "Most Popular!",
                                "widget": "text"
                            },
                            "styleColors": {
                                "label": "Style Colors",
                                "defaultValue": {
                                    "color": "#FFF",
                                    "backgroundColor": "#14d889"
                                },
                                "widget": "button_color"
                            },
                            "fontSize": {
                                "label": "Font Size",
                                "defaultValue": "15px",
                                "widget": "px"
                            },
                            "fontColor": {
                                "label": "Font Color",
                                "defaultValue": "#121212",
                                "widget": "color_picker"
                            },
                            "discountColor": {
                                "label": "Discount Color",
                                "defaultValue": "#ff0000",
                                "widget": "color_picker"
                            },
                            "hoverColor": {
                                "label": "Hover Color",
                                "defaultValue": "#fef9ae",
                                "widget": "color_picker"
                            }
                        },
                    }
                },
                renderer: {
                    Viewer: unlayer.createViewer({
                        render(values) {
                            // start cod currency setup
                            if(typeof values.codCurrency === "object") values.codCurrency = JSON.stringify(values.codCurrency)
                            var codCurrency = JSON.parse(values.codCurrency).selected.split(",");
                            var currency = { word: codCurrency[0], code: codCurrency[1] };
                            // end cod currency setup
                            function priceCommafy(num){
                                var str = num.toString().split('.');
                                if (str[0].length >= 4) str[0] = str[0].replace(/(\\\d)(?=(\\\d{3})+$)/g, '$1,');
                                if (str[1] && str[1].length >= 4) str[1] = str[1].replace(/(\\\d{3})/g, '$1 ');
                                return str.join('.');
                            }
                            // check muna kng empty string laman ng values.variants kundi nmn i parse kc nka stringify ang pasa kase ni explain ko na sa kabilang comment.
                            var variants = "";
                            try {
                                // dko alam bkt ayaw ma parse pag may sobrang comma sa huli ng object pero sa console ok naman kaya binura ko nlng
                                values.variants = values.variants.replace(/,\}/g, "}");
                                if(values.variants) variants = JSON.parse(values.variants).filter(el => el && el.variant_name != "");
                            } catch(error) {
                                console.log("An error has occurred while parsing variant (Preview)");
                            }
                            if(variants != ""){
                                var discountList = [];
                                variants.forEach(el => {
                                    discountList.push(parseFloat(el.discount).toFixed(2))
                                })
                                window.discountList = discountList;
                                if(variants.length != 0){
                                    if(variants[0].id){  // for parsing the variant like shopify
                                        values.product_name = variants[0].shopifyProduct.name // update product name
                                        // var newObj = {}; // for shopify variant
                                        // variants.map((el,i) => {
                                        //     el.shopifyProduct.variant_group.forEach(vel => {
                                        //         var keyName = vel.name;
                                        //         if(!newObj[keyName]){
                                        //             newObj[keyName] = [];
                                        //         }
                                        //         if(!newObj[keyName].includes(vel.value)){
                                        //             newObj[keyName].push(vel.value)
                                        //         }
                                        //     })
                                        // });
                                        // var x = \`
                                        //     <style>
                                        //         .u_content_variant {
                                        //             overflow: hidden;
                                        //         }
                                        //         #\$\{values._meta.htmlID\} .each-variant {
                                        //             overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
                                        //             width: 100%; display: block; cursor: pointer; font-size: \$\{values.fontSize\}; color: \$\{values.fontColor\}; padding: 10px; margin: 0 10px 5px 0; border-radius: 5px; border: 1px solid #c1c1c1;
                                        //         }
                                        //         #\$\{values._meta.htmlID\} .each-variant-active {
                                        //             border: 1px solid transparent; background-color: \$\{values.hoverColor\};
                                        //         }
                                        //     </style>
                                        // \`;
                                        // for(keyName in newObj){
                                        //     x += \`<div style="clear: both;">
                                        //         <h3 style="margin: 10px 0;">\$\{keyName\}</h1>
                                        //         \$\{newObj[keyName].map(dd => {
                                        //             return \`
                                        //                 <label class="\$\{newObj[keyName].length == 1 ? "each-variant each-variant-active" : "each-variant"\}">
                                        //                     \$\{(() => {
                                        //                         if(newObj[keyName].length == 1) return \`<input type="radio" name="\$\{keyName\}" checked>\`
                                        //                         else return \`<input type="radio" name="\$\{keyName\}">\`
                                        //                     })()\}
                                        //                     <span class="display-price money" style="float:right;"></span>
                                        //                     <span style="padding-left: 10px;">\$\{dd\}</span>
                                        //                 </label>
                                        //             \`
                                        //         }).join('')\}
                                        //     </div>\`;
                                        // }
                                        // x += \`
                                        //     <div style="clear: both;padding: 10px 0 0;">
                                        //         <h3 class="price money" style="float: right;margin: 0;">$0.00</h3>
                                        //         <h3 style="margin: 0;">Total:</h3>
                                        //     </div>
                                        // \`;
                                        // return x;
                                    }

                                    // default view if not shopify variant
                                    var style = \`
                                        <style>
                                            #\$\{values._meta.htmlID\} input[type="radio"]:checked:before {
                                                border: 10px solid #fcfcfc; box-shadow: 0px 0px 3px 0px #00000040; width: 25px; height: 25px;
                                            }
                                            #\$\{values._meta.htmlID\} input[type="radio"]:checked:after {
                                                margin: 5px; width: 15px; height: 15px; border: 1px solid #45484C;
                                            }
                                            #\$\{values._meta.htmlID\} input[type="radio"]:checked:after, input[type="radio"]:checked:before {
                                                content: ''; background: linear-gradient(to bottom, #0fe469 0%, #145b32 100%); border-radius: 50%; position: absolute; top: 0; left: 20px; cursor: pointer;
                                            }
                                            #\$\{values._meta.htmlID\} input[type="radio"]:before {
                                                border: 10px solid #fcfcfc; box-shadow: 0px 0px 3px 0px #00000040; width: 25px; height: 25px;
                                            }
                                            #\$\{values._meta.htmlID\} input[type="radio"]:after {
                                                margin: 5px; width: 15px; height: 15px; border: 1px solid #45484C;
                                            }
                                            #\$\{values._meta.htmlID\} input[type="radio"]:after, input[type="radio"]:before {
                                                content: ''; background-color: #b3abab; border-radius: 50%; position: absolute; top: 0; left: 20px; cursor: pointer;
                                            }
                                        </style>
                                    \`;
                                    return style + variants.map((el,i) => {
                                        var discountedPrice = el.discount ? (el.price - (el.price * (el.discount / 100))).toFixed(2) : parseFloat(el.price).toFixed(2);
                                        let has_discount = el.discount && el.discount !== "0" ? true : false;
                                        var x = \`
                                            <label class="row plg_variants_list" style="position: relative; display: flex; align-items: center; cursor: pointer; font-size: \$\{values.fontSize\}; color: \$\{values.fontColor\}; border: 1px solid #ffffff00; padding: 10px 5px;" for=\$\{"check"+i\}>
                                                <!-- replaceSuggestImageHere -->
                                                <div class="col-2 u_column">
                                                    \$\{(() => {
                                                        if(el.isSuggest){
                                                            return \`<input type="radio" name="variants" id=\$\{"check"+i\} style="margin-left: 25px;" checked>\`
                                                        } else {
                                                            return \`<input type="radio" name="variants" id=\$\{"check"+i\} style="margin-left: 25px;">\`
                                                        }
                                                    })()\}
                                                </div>
                                                <div class="col-7 u_column">
                                                    <span id="variant_name">\$\{el.variant_name\}</span>
                                                    \$\{has_discount ? \`<span style="color: \$\{values.discountColor\} !important; display: block;">\$\{"(" + parseFloat(el.discount).toFixed(0) + "% Discount)"\}</span>\` : ""\}
                                                </div>
                                                <div class="col-3 u_column" style="text-align: right">
                                                    <span class="money" id="variant_price">\$\{currency.code + priceCommafy(discountedPrice)\}</span>
                                                    \$\{has_discount ? \`<strike class="money" style="color: \$\{values.discountColor\} !important; display: block;">\$\{currency.code + priceCommafy(parseFloat(el.price).toFixed(2))\}</strike>\` : ""\}
                                                </div>
                                            </label>
                                        \`
                                        if (el.isSuggest || el.ribbon_text) {
                                            typeof values.selectedStyle == "string" ? values.selectedStyle = JSON.parse(values.selectedStyle) : void 0;
                                            if (values.selectedStyle.selected == "2" || el.ribbon_text){
                                                x = x.replace("<!-- replaceSuggestImageHere -->", '<div style="width: 100%; margin-left: -5px; margin-bottom: 5px;"> <div style="text-align: center; max-width: 200px; background-color: '+values.styleColors.backgroundColor+'; color: '+values.styleColors.color+'; padding: 5px; position: relative; clip-path: polygon(0% 0%, 100% 0, 180px 50%, 100% 100%, 0% 100%);"> <label style="font-weight: 700;" class="variant_recommended">'+(el.ribbon_text || values.styleText)+'</label> </div> </div>');
                                            } else if (values.selectedStyle.selected == "1") {
                                                x = x.replace("<!-- replaceSuggestImageHere -->", '<img src="https://cdn.productlistgenie.com/images/1559588850495share.png" style="position: absolute; z-index: 1; left: -10px; top: 5px; transform: rotate(200deg) scaleX(-1);" width="30px" height="30px">');
                                            }
                                            x = x.replace('style="','style="background-color: '+values.hoverColor+'; filter: brightness(95%); ');
                                        }
                                        return x;
                                    }).join('');
                                } else {
                                    return \`
                                        <div style="text-align: center">
                                            <span>Click here to edit on the left panel.</span>
                                        </div>
                                    \`
                                }
                            } else {
                                return \`
                                    <div style="text-align: center">
                                        <span>Click here to edit on the left panel.</span>
                                    </div>
                                \`
                            }
                        }
                    }),
                    exporters: {
                        web: function (values) {
                            // start cod currency setup
                            if(typeof values.codCurrency === "object") values.codCurrency = JSON.stringify(values.codCurrency)
                            var codCurrency = JSON.parse(values.codCurrency).selected.split(",");
                            var currency = { word: codCurrency[0], code: codCurrency[1] };
                            // end cod currency setup
                            function priceCommafy(num){
                                var str = num.toString().split('.');
                                if (str[0].length >= 4) str[0] = str[0].replace(/(\\\d)(?=(\\\d{3})+$)/g, '$1,');
                                if (str[1] && str[1].length >= 4) str[1] = str[1].replace(/(\\\d{3})/g, '$1 ');
                                return str.join('.');
                            }
                            // check muna kng empty string laman ng values.variants kundi nmn i parse kc nka stringify ang pasa kase ni explain ko na sa kabilang comment.
                            var variants = values.variants ? JSON.parse(values.variants).filter(el => el && el.variant_name != "") : "";
                            if(variants != ""){
                                if(variants.length != 0){
                                    var addAutoConvert = \`
                                        <script src="https://convert.productlistgenie.com/CurrencyConverter/" async onload="convertAllMoneyClass()"></script> 
                                        <script>
                                            function convertAllMoneyClass() {
                                                var numberWithCommas = (x) => x.toString().replace(/\\\\B(?=(\\\\d{3})+(?!\\\\d))/g, ",");
                                                var currencyRegex = new RegExp(/.*[^\\\\d\.\\\\,\\\\s]/g);
                                                var priceRegex = new RegExp(/[\\\\d]|\\\\./g);
                                                var s = document.createElement("div");
                                                s.id = "c_value";
                                                s.innerHTML = c_value;
                                                s.style.display = "none";
                                                document.body.appendChild(s);
                                                document.querySelectorAll(".money").forEach((el, i) => {
                                                    var plgConverted = document.getElementById("c_value").innerText;
                                                    if(el.innerText){
                                                        var origPrice = el.innerText.match(priceRegex).toString().replace(/,/g, "");
                                                        var convertedCurrency = plgConverted.match(currencyRegex).toString();
                                                        var convertedPrice = plgConverted.match(priceRegex).toString().replace(/,/g, "");
                                                        var computedConvertedPrice = numberWithCommas((origPrice * convertedPrice).toFixed(2));
                                                        el.innerHTML = convertedCurrency + " " + computedConvertedPrice;
                                                    }
                                                });
                                            }
                                        </script>
                                    \`
                                    if(variants[0].id){  // for parsing the variant like shopify
                                        values.product_name = variants[0].shopifyProduct.name // update product name
                                        // var x = \`
                                        //     <style>
                                        //         .u_content_variant {
                                        //             overflow: hidden;
                                        //         }
                                        //         #\$\{values._meta.htmlID\} .each-variant {
                                        //             overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
                                        //             width: 100%; display: block; cursor: pointer; font-size: \$\{values.fontSize\}; color: \$\{values.fontColor\}; padding: 10px; margin: 0 10px 5px 0; border-radius: 5px; border: 1px solid #c1c1c1;
                                        //         }
                                        //         #\$\{values._meta.htmlID\} .each-variant-active {
                                        //             border: 1px solid transparent; background-color: \$\{values.hoverColor\};
                                        //         }
                                        //     </style>
                                        // \`;
                                        // if(values.autoConvert){
                                        //     x += addAutoConvert
                                        // }
                                        // var newObj = {}; // for shopify variant
                                        // var options = \`<option data-variant-id="" data-price="" value="">No Variant Selected</option>\`; // for select tag value
                                        // variants.map((el,i) => {
                                        //     el.shopifyProduct.variant_group.forEach(vel => {
                                        //         var keyName = vel.name;
                                        //         if(!newObj[keyName]){
                                        //             newObj[keyName] = [];
                                        //         }
                                        //         if(!newObj[keyName].includes(vel.value)){
                                        //             newObj[keyName].push(vel.value)
                                        //         }
                                        //     })
                                        //     options += \`
                                        //         <option data-variant-id="\$\{el.id\}" data-price="\$\{el.price\}" value="\$\{el.variant_name\}">\$\{el.variant_name\} - \$\{el.price\}</option>
                                        //     \`;
                                        // });
                                        // var index = 0;
                                        // for(keyName in newObj){
                                        //     x += \`<div style="clear: both;">
                                        //         <h3 style="margin: 10px 0;">\$\{keyName\}</h1>
                                        //         \$\{newObj[keyName].map(dd => {
                                        //             return \`
                                        //                 <label class="\$\{newObj[keyName].length == 1 ? "each-variant each-variant-active" : "each-variant"\}" data-group="\$\{keyName\}" data-group-value="\$\{dd\}" onclick="selectThisVariant(this)">
                                        //                     \$\{(() => {
                                        //                         var attr = "";
                                        //                         if(newObj[keyName].length == 1) attr = "checked";
                                        //                         else if(index != 0) attr = "disabled";
                                        //                         return \`<input type="radio" name="\$\{keyName\}" \$\{attr\}>\`
                                        //                     })()\}
                                        //                     <span class="display-price money" style="float:right;"></span>
                                        //                     <span style="padding-left: 10px;">\$\{dd\}</span>
                                        //                 </label>
                                        //             \`
                                        //         }).join('')\}
                                        //     </div>\`;
                                        //     index = index + 1;
                                        // }
                                        // x += \`
                                        //     <div style="clear: both;padding: 10px 0 0;">
                                        //         <h3 class="price money" style="float: right;margin: 0;">$0.00</h3>
                                        //         <h3 style="margin: 0;">Total:</h3>
                                        //     </div>
                                        //     <select name="selected_variant" onchange="updateVariantPrice(this)" style="display: none;">
                                        //         \$\{options\}
                                        //     </select>
                                        //     <script>
                                        //         var plg_price = 0;
                                        //         var isComplete = false;
                                        //         var warrantyPrice = {
                                        //             price: 0,
                                        //             variantname: "",
                                        //             variantid: ""
                                        //         };
                                        //         var plg_selectedVariant = {};
                                        //         var firstVariant = "";
                                        //         var restVariant = [];
                                        //         function selectThisVariant(element){
                                        //             if(element.querySelector("input:disabled")){
                                        //                 return;
                                        //             }
                                        //             var variantObject = \$\{JSON.stringify(newObj)\};
                                        //             var variantParent = element.parentNode.parentNode;
                                        //             element.parentNode.querySelectorAll(".each-variant").forEach(el => {
                                        //                 el.classList.remove("each-variant-active");
                                        //                 el.querySelector(".display-price").innerText = "";
                                        //             })
                                        //             element.classList.add("each-variant-active");
                                        //             var variantName = "";
                                        //             var isAllVariantSelected = true;
                                        //             var index = 0;
                                        //             for(keyName in variantObject){
                                        //                 var keyValue = document.querySelector('[data-group="'+keyName+'"].each-variant-active');
                                        //                 if(keyValue){
                                        //                     var value = keyValue.getAttribute("data-group-value");
                                        //                     variantName += value + " / ";
                                        //                 } else {
                                        //                     isAllVariantSelected = false;
                                        //                 }
                                        //                 // set initialization for checking the available variant
                                        //                 if(index == 0) firstVariant = keyName; 
                                        //                 else {
                                        //                     restVariant = [];
                                        //                     restVariant.push(keyName);
                                        //                 }
                                        //                 index++;
                                        //             }
                                        //             isComplete = isAllVariantSelected;
                                        //             variantName = variantName.substring(0, variantName.length-3);
                                        //             document.querySelector(".price").innerHTML = "$0.00";
                                        //             var variantSelectTag = document.querySelector('[name="selected_variant"]');
                                        //             variantSelectTag.value = variantName;
                                        //             variantSelectTag.dispatchEvent(new Event("change"))
                                        //             // keep disable the variant if not available
                                        //             disableVariant(variantName)
                                        //         }
                                        //         function updateVariantPrice(element){
                                        //             if(isComplete){
                                        //                 if(element.selectedIndex == -1){
                                        //                     plg_price = warrantyPrice.price ? warrantyPrice.price : 0;
                                        //                     return;
                                        //                 }
                                        //                 var variantID = element.options[element.selectedIndex].dataset.variantId;
                                        //                 var variantPrice = element.options[event.target.selectedIndex].dataset.price;
                                        //                 var variantName = element.value;
                                        //                 // set necessary variable
                                        //                 plg_price = parseFloat(variantPrice) + warrantyPrice.price;
                                        //                 plg_selectedVariant = {
                                        //                     price: currency.code+plg_price,
                                        //                     variant_name: variantName + (warrantyPrice.price ? " + "+warrantyPrice.variantname : ""),
                                        //                     product_name: "\$\{values.product_name\}",
                                        //                     variant_id: variantID + (warrantyPrice.variantid ? ", "+warrantyPrice.variantid : "")
                                        //                 }
                                        //                 document.querySelector(".price").innerHTML = plg_selectedVariant.price;
                                        //                 // display computed price
                                        //                 document.querySelectorAll(".each-variant-active").forEach(el => {
                                        //                     el.querySelector(".display-price").innerText = plg_selectedVariant.price;
                                        //                 })
                                        //                 typeof convertAllMoneyClass !== "undefined" ? convertAllMoneyClass() : void 0;
                                        //             } else {
                                        //                 console.log("must select all variant first")
                                        //             }
                                        //         }
                                        //         function getTheSelectedVariant(){
                                        //             // to update the price when product addon click
                                        //             document.querySelector(".each-variant-active").click();
                                        //         }
                                        //         function disableVariant(variantName){
                                        //             if(variantName){
                                        //                 // disable all first
                                        //                 restVariant.forEach(rest => {
                                        //                     var allRadio = document.querySelectorAll("[data-group='"+rest+"'] input");
                                        //                     allRadio.forEach(radio => {
                                        //                         radio.disabled = true;
                                        //                     })
                                        //                 });
                                        //                 var selectTag = document.querySelector('[name="selected_variant"]');
                                        //                 var selectedFristVariant = document.querySelector("[data-group='"+firstVariant+"'].each-variant-active").getAttribute("data-group-value");
                                        //                 for(var i=0; i<selectTag.length; i++){
                                        //                     var shouldNotDisable = selectTag.options[i].value.includes(selectedFristVariant);
                                        //                     if(shouldNotDisable){
                                        //                         var value = selectTag.options[i].value;
                                        //                         var nextVariants = value.split(" / ").splice(-1, 1);
                                        //                         restVariant.forEach(rest => {
                                        //                             nextVariants.forEach(variant => {
                                        //                                 var groupNameRadio = document.querySelector("[data-group='"+rest+"'][data-group-value='"+variant+"'] input");
                                        //                                 groupNameRadio.parentNode.style.cssText = "opacity: 1;";
                                        //                                 groupNameRadio.removeAttribute("disabled");
                                        //                             });
                                        //                         });
                                        //                     }
                                        //                 }
                                        //             }
                                        //             document.querySelectorAll(".each-variant input:disabled").forEach(el => {
                                        //                 el.parentNode.style.cssText = "opacity: 0.5;";
                                        //                 el.parentNode.classList.remove("each-variant-active");
                                        //                 el.parentNode.querySelector(".display-price").innerText = "";
                                        //             })
                                        //         }
                                        //         disableVariant();
                                        //     </script>
                                        // \`;
                                        // return x;
                                    }

                                    var style = \`
                                        <style>
                                            #\$\{values._meta.htmlID\} input[type="radio"]:checked:before {
                                                border: 10px solid #fcfcfc; box-shadow: 0px 0px 3px 0px #00000040; width: 25px; height: 25px;
                                            }
                                            #\$\{values._meta.htmlID\} input[type="radio"]:checked:after {
                                                margin: 4.5px; width: 15px; height: 15px; border: 1px solid #45484C;
                                            }
                                            #\$\{values._meta.htmlID\} input[type="radio"]:checked:after, #\$\{values._meta.htmlID\} input[type="radio"]:checked:before {
                                                content: ''; background: linear-gradient(to bottom, #0fe469 0%, #145b32 100%); border-radius: 50%; position: absolute; top: 0; left: 10px; cursor: pointer;
                                            }
                                            #\$\{values._meta.htmlID\} input[type="radio"]:before {
                                                border: 10px solid #fcfcfc; box-shadow: 0px 0px 3px 0px #00000040; width: 25px; height: 25px;
                                            }
                                            #\$\{values._meta.htmlID\} input[type="radio"]:after {
                                                margin: 4.5px; width: 15px; height: 15px; border: 1px solid #45484C;
                                            }
                                            #\$\{values._meta.htmlID\} input[type="radio"]:after, #\$\{values._meta.htmlID\} input[type="radio"]:before {
                                                content: ''; background-color: #b3abab; border-radius: 50%; position: absolute; top: 0; left: 10px; cursor: pointer;
                                            }
                                        </style>
                                    \`;
                                    var renderVariant = style + variants.map((el,i) => {
                                        var discountedPrice = el.discount ? (el.price - (el.price * (el.discount / 100))).toFixed(2) : parseFloat(el.price).toFixed(2);
                                        let has_discount = el.discount && el.discount !== "0" ? true : false;
                                        var x = \`
                                            <label class="row plg_variants_list" style="position: relative; display: flex; align-items: center; cursor: pointer; font-size: \$\{values.fontSize\}; color: \$\{values.fontColor\}; border: 1px solid #ffffff00; padding: 10px 5px;" for=\$\{"check"+i\}>
                                                <!-- replaceSuggestImageHere -->
                                                <div class="col-2 u_column">
                                                    \$\{(() => {
                                                        if(el.isSuggest){
                                                            return \`<input type="radio" name="variants" id=\$\{"check"+i\} onclick="typeof getTheSelectedVariant != 'undefined' ? getTheSelectedVariant() : void 0" style="margin-left: 15px;" checked>\`
                                                        } else {
                                                            return \`<input type="radio" name="variants" id=\$\{"check"+i\} onclick="typeof getTheSelectedVariant != 'undefined' ? getTheSelectedVariant() : void 0" style="margin-left: 15px;">\`
                                                        }
                                                    })()\}
                                                </div>
                                                <div class="col-7 u_column">
                                                    <span id="variant_name">\$\{el.variant_name\}</span>
                                                    \$\{has_discount ? \`<span style="color: \$\{values.discountColor\} !important; display: block;">\$\{"(" + parseFloat(el.discount).toFixed(0) + "% Discount)"\}</span>\` : ""\}
                                                </div>
                                                <div class="col-3 u_column" style="text-align: right;">
                                                
                                                    <span data-variant-id="\$\{el.id ? el.id : ""\}" data-variant-name="\$\{el.variant_name.replace(/[\\s\\/]+/g, '-')\}" data-qty="\$\{el.variant_qty ? el.variant_qty : 1 \}" data-sku="\$\{el.variant_sku ? el.variant_sku : ""\}" data-price="\$\{currency.code + discountedPrice\}" data-tag="\$\{el.tag ? el.tag : ''\}" class="money" id="variant_price">\$\{currency.code+priceCommafy(discountedPrice)\}</span>
                                                    \$\{has_discount ? \`<strike class="money" style="color: \$\{values.discountColor\} !important; display: block;">\$\{currency.code + priceCommafy(parseFloat(el.price).toFixed(2))\}</strike>\` : ""\}
                                                </div>
                                            </label>
                                        \`;
                                        if (el.isSuggest || el.ribbon_text) {
                                            typeof values.selectedStyle == "string" ? values.selectedStyle = JSON.parse(values.selectedStyle) : void 0;
                                            if (values.selectedStyle.selected == "2" || el.ribbon_text){
                                                x = x.replace("<!-- replaceSuggestImageHere -->", '<div style="width: 100%; margin-left: -5px; margin-bottom: 5px;"> <div style="text-align: center; max-width: 200px; background-color: '+values.styleColors.backgroundColor+'; color: '+values.styleColors.color+'; padding: 5px; position: relative; clip-path: polygon(0% 0%, 100% 0, 180px 50%, 100% 100%, 0% 100%);"> <label style="font-weight: 700;" class="variant_recommended">'+(el.ribbon_text || values.styleText)+'</label> </div> </div>');
                                            } else if (values.selectedStyle.selected == "1") {
                                                x = x.replace("<!-- replaceSuggestImageHere -->", '<img src="https://cdn.productlistgenie.com/images/1559588850495share.png" style="position: absolute; z-index: 1; left: -20px; top: 0; transform: rotate(210deg) scaleX(-1);" width="40px" height="40px">');
                                            }
                                            x = x.replace('style="','style="background-color: '+values.hoverColor+'; filter: brightness(95%); ');
                                        }
                                        if((i+1) == variants.length){
                                            x += \`
                                                <style>
                                                    .plg_variants_list{
                                                        padding: \$\{values.padding\};
                                                    }
                                                    .plg_variants_list:hover{
                                                        background-color: \$\{values.hoverColor\} !important;
                                                        border: 1px solid #00000033 !important;
                                                        border-radius: 4px;
                                                    }
                                                </style>
                                                <script>
                                                    var warrantyPrice = {
                                                        price: 0,
                                                        variantname: "",
                                                        variantid: "",
                                                        tag: ""
                                                    };
                                                    var plg_price = 0;
                                                    var plg_selectedVariant = {};
                                                    function priceToObject(string) {
                                                        var currencyRegex = new RegExp(/.*[^\\\\d\.\\\\,\\\\s]/g);
                                                        var priceRegex = new RegExp(/[\\\\d]|\\\\./g);
                                                        var price = string.match(priceRegex).toString().replace(/,/g, "");
                                                        var currency = string.match(currencyRegex).toString().replace(/,/g, "");
                                                        return { price, currency }
                                                    }
                                                    function getTheSelectedVariant(){
                                                        document.querySelectorAll(".plg_variants_list").forEach(el => {
                                                            if (el.querySelector("input[type=radio]").checked) {
                                                                var priceDOM = el.querySelector("#variant_price");
                                                                var priceObject = priceToObject(priceDOM.getAttribute("data-price"))
                                                                var isHaveShippingFee = typeof shippingFee !== "undefined" && shippingFee != 0 ? true : false;
                                                                var isHaveTaxFee = typeof taxFee !== "undefined" && taxFee != 0 ? true : false;
                                                                plg_selectedVariant = {
                                                                    price: priceObject.currency+(parseFloat(priceObject.price) + warrantyPrice.price + (isHaveShippingFee ? parseFloat(shippingFee) : 0) + (isHaveTaxFee ? parseFloat(taxFee) : 0)),
                                                                    variant_name: el.querySelector("#variant_name").innerText + (warrantyPrice.price ? " + "+warrantyPrice.variantname : "") + (isHaveShippingFee ? " + Shippping Fee" : "") + (isHaveTaxFee ? " + Tax Fee" : ""),
                                                                    product_name: "\$\{values.product_name\}",
                                                                    variant_id: priceDOM.getAttribute("data-variant-id") + (warrantyPrice.variantid ? ", "+warrantyPrice.variantid : ""),
                                                                    tags: [...priceDOM.getAttribute("data-tag").split(/[ ,]+/), plgQS()],
                                                                    currency: \$\{JSON.stringify(currency)\},
                                                                    variant_qty: priceDOM.getAttribute("data-qty") ? priceDOM.getAttribute("data-qty") : "1",
                                                                    variant_sku: priceDOM.getAttribute("data-sku") ? priceDOM.getAttribute("data-sku") : "",
                                                                    cog: priceDOM.getAttribute("data-cog") ? parseFloat(priceDOM.getAttribute("data-cog")) : 0
                                                                }
                                                                if(warrantyPrice.tag && !plg_selectedVariant.tags.includes(warrantyPrice.tag)) plg_selectedVariant.tags.push(warrantyPrice.tag);

                                                                // Apply selected Style like hover style
                                                                el.style.backgroundColor = "\$\{values.hoverColor\}";
                                                                el.style.border = "1px solid #00000033";
                                                                el.style.borderRadius = "4px";

                                                                // update plg_price
                                                                plg_price = parseFloat(priceToObject(plg_selectedVariant.price).price).toFixed(2);
                                                            } else {
                                                                // Remove Style and set it to default
                                                                el.style.backgroundColor = "inherit";
                                                                el.style.border = "1px solid #ffffff00";
                                                                el.style.borderRadius = "0px";
                                                            }
                                                        });

                                                        if(plg_selectedVariant.price && typeof changeVariantTotalReceipt !== "undefined") changeVariantTotalReceipt(); // if has selected variant call update price of total receipt
                                                    }
                                                    getTheSelectedVariant();

                                                    // experimentation
                                                    // function dynamicComputePrices(){
                                                    //     const variantList = document.querySelectorAll(".plg_variants_list");
                                                    //     var params = "";
                                                    //     variantList.forEach((el,i) => {
                                                    //         var sku = el.querySelector("[data-sku]").getAttribute("data-sku");
                                                    //         const qty = el.querySelector("[data-qty]").getAttribute("data-qty");
                                                    //         const price = priceToObject(el.querySelector("[data-price]").getAttribute("data-price")).price;
                                                    //         if(sku) {
                                                    //             sku = sku+"_"+i;
                                                    //             params += "data["+sku+"][qty]="+qty+"&data["+sku+"][price]="+price+"&data["+sku+"][currency]="+plg_selectedVariant.currency.word+"&";
                                                    //         }
                                                    //     })
                                                    //     params = params.substring(0, params.length-1);
                                                    //     fetch('https://cors-anywhere.herokuapp.com/https://fcdf796f.ngrok.io/cod-validate-prices?'+params)
                                                    //     .then(res => res.json())
                                                    //     .then(res => {
                                                    //         document.querySelectorAll(".plg_variants_list").forEach((el,i) => {
                                                    //             var sku = el.querySelector("[data-sku]").getAttribute("data-sku");
                                                    //             if(sku) {
                                                    //                 sku = sku+"_"+i;
                                                    //                 el.querySelector("[data-price]").setAttribute("data-price", plg_selectedVariant.currency.code+res[sku]);
                                                    //                 el.querySelector("[data-price]").innerHTML = plg_selectedVariant.currency.code+res[sku];
                                                    //             }
                                                    //         })
                                                    //     })
                                                    // }
                                                    // dynamicComputePrices();
                                                </script>
                                            \`
                                        }
                                        return x;
                                    }).join('');
                                    if(values.autoConvert){
                                        renderVariant += addAutoConvert
                                    }
                                    return renderVariant;
                                } else {
                                    return \`
                                        <div style="text-align: center">
                                            <span>Add Variant on the left side.</span>
                                        </div>
                                    \`
                                }
                            } else {
                                return \`
                                    <div style="text-align: center">
                                        <span>Add Variant on the left side.</span>
                                    </div>
                                \`
                            }
                        }
                    }
                }
            });   



     

            ${editorTools.getImageGalleryViewer(this.props.session.getCurrentUser)}
            console.log("77. Image Carousel Editor");
            unlayer.registerTool({
                type: 'image_carousel_editor',
                category: 'contents',
                label: 'Image Carousel',
                icon: '<svg aria-hidden="true" data-prefix="fab" data-icon="wpforms" class="svg-inline--fa fa-wpforms fa-w-14 fa-3x" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M448 75.2v361.7c0 24.3-19 43.2-43.2 43.2H43.2C19.3 480 0 461.4 0 436.8V75.2C0 51.1 18.8 32 43.2 32h361.7c24 0 43.1 18.8 43.1 43.2zm-37.3 361.6V75.2c0-3-2.6-5.8-5.8-5.8h-9.3L285.3 144 224 94.1 162.8 144 52.5 69.3h-9.3c-3.2 0-5.8 2.8-5.8 5.8v361.7c0 3 2.6 5.8 5.8 5.8h361.7c3.2.1 5.8-2.7 5.8-5.8zM150.2 186v37H76.7v-37h73.5zm0 74.4v37.3H76.7v-37.3h73.5zm11.1-147.3l54-43.7H96.8l64.5 43.7zm210 72.9v37h-196v-37h196zm0 74.4v37.3h-196v-37.3h196zm-84.6-147.3l64.5-43.7H232.8l53.9 43.7zM371.3 335v37.3h-99.4V335h99.4z"></path></svg>',
                values: {},
                options: {
                    products: {
                        title: "Image Carousel | Settings", //april12
                        position: 1,
                        options: {                            
                            "image_carousel_list": {
                                "label" : "Image Carousels",
                                "widget":"carousel_images",
                                "defaultValue": ""                            
                            },
                            "autoShowSlide": {
                                "label": "Auto Slide Show",
                                "defaultValue": false,
                                "widget": "toggle"
                            },
                            "containerHeight": { //april13
                                "label": "Container Height",
                                "defaultValue": "100%",
                                "widget": "width"
                            },
                            "VariantImage": {
                                "label": "Image Uploads",
                                "defaultValue": {
                                    "url": "",
                                    "width": 500,
                                    "height": 100
                                },
                                "widget": "image"
                            },                     
                        }
                    }
                },
                renderer: {
                    Viewer: unlayer.createViewer({
                        render(values) {     
                            let imageCarousel = values.image_carousel_list !== "" ? JSON.parse(values.image_carousel_list) : { images: [] };
                            
                            if(imageCarousel.images.length !== 0){
                                //image is not empty
                                console.log('the values from image linkser ', imageCarousel);                   
                            }else{
                                console.log("Image is now empty");
                            }
                            
                            return \`<div class="row">
                                <style>
                                .mySlides {display: none}
                                img {vertical-align: middle;}

                                .slideshow-container {
                                max-width: 1000px;
                                position: relative;
                                margin: auto;
                                }

                                .prev, .next {
                                cursor: pointer;
                                position: absolute;
                                top: 50%;
                                width: auto;
                                padding: 16px;
                                margin-top: -22px;
                                color: white;
                                font-weight: bold;
                                font-size: 18px;
                                transition: 0.6s ease;
                                border-radius: 0 3px 3px 0;
                                user-select: none;
                                }

                                .next {
                                right: 0;
                                border-radius: 3px 0 0 3px;
                                }

                                .prev:hover, .next:hover {
                                background-color: rgba(0,0,0,0.8);
                                }

                                .text {
                                color: #f2f2f2;
                                font-size: 15px;
                                padding: 8px 12px;
                                position: absolute;
                                bottom: 8px;
                                width: 100%;
                                text-align: center;
                                }

                                .numbertext {
                                color: #f2f2f2;
                                font-size: 12px;
                                padding: 8px 12px;
                                position: absolute;
                                top: 0;
                                }

                                .dot {
                                cursor: pointer;
                                height: 15px;
                                width: 15px;
                                margin: 0 2px;
                                background-color: #bbb;
                                border-radius: 50%;
                                display: inline-block;
                                transition: background-color 0.6s ease;
                                }

                                .active-imagecaoursel, .dot:hover {
                                background-color: #717171;
                                }

                                .fade {
                                -webkit-animation-name: fade;
                                -webkit-animation-duration: 1.5s;
                                animation-name: fade;
                                animation-duration: 1.5s;
                                }

                                @-webkit-keyframes fade {
                                from {opacity: .4} 
                                to {opacity: 1}
                                }

                                @keyframes fade {
                                from {opacity: .4} 
                                to {opacity: 1}
                                }

                                @media only screen and (max-width: 300px) {
                                .prev, .next,.text {font-size: 11px}
                                }
                                </style>
                                \$\{imageCarousel.images.length === 0 ? 
                                    \`<div class="col-12" style="text-align: center;"> Insert an image link in the editor </div>\` 
                                    : \`
                                    <div class="col-12">
                                        <div class="slideshow-container">
                                            <div class="mySlides fade active-imagecaoursel" style="display: block;">
                                            <div class="numbertext">1 / \$\{imageCarousel.images.length\}</div>
                                            <img src="\$\{imageCarousel.images[0]\}" style="width:100%">
                                            <div class="text"></div>
                                            </div>
                                            <a class="prev" >&#10094;</a>
                                            <a class="next" >&#10095;</a>
                                        </div>
                                        <br>
                                        <div style="text-align:center">
                                            \$\{imageCarousel.images.map(img => {
                                                return '<span class="dot"></span>'
                                            }).join("")\}    
                                        </div>
                                    </div>
                                    \` \}                                                            
                            </div>\`;
                        }
                    }),
                    exporters: {
                        web: function(values) {
                             
                            let imageCarousel = values.image_carousel_list !== "" ? JSON.parse(values.image_carousel_list) : { images: [] };
                            
                            if(imageCarousel.images.length !== 0){
                                //image is not empty
                                console.log('the values from image linkser ', imageCarousel);                   
                            }else{
                                console.log("Image is now empty");
                            }
                            
                            return \`<div class="row">
                                <style>
                                .mySlides {display: none}
                                img {vertical-align: middle;}

                                .slideshow-container {
                                max-width: 1000px;
                                position: relative;
                                margin: auto;
                                }

                                .prev, .next {
                                cursor: pointer;
                                position: absolute;
                                top: 50%;
                                width: auto;
                                padding: 16px;
                                margin-top: -22px;
                                color: white;
                                font-weight: bold;
                                font-size: 18px;
                                transition: 0.6s ease;
                                border-radius: 0 3px 3px 0;
                                user-select: none;
                                }

                                .next {
                                right: 0;
                                border-radius: 3px 0 0 3px;
                                }

                                .prev:hover, .next:hover {
                                background-color: rgba(0,0,0,0.8);
                                }

                                .text {
                                color: #f2f2f2;
                                font-size: 15px;
                                padding: 8px 12px;
                                position: absolute;
                                bottom: 8px;
                                width: 100%;
                                text-align: center;
                                }

                                .numbertext {
                                color: #f2f2f2;
                                font-size: 12px;
                                padding: 8px 12px;
                                position: absolute;
                                top: 0;
                                }

                                .dot {
                                cursor: pointer;
                                height: 15px;
                                width: 15px;
                                margin: 0 2px;
                                background-color: #bbb;
                                border-radius: 50%;
                                display: inline-block;
                                transition: background-color 0.6s ease;
                                }

                                .active, .dot:hover {
                                background-color: #717171;
                                }

                                .fade {
                                -webkit-animation-name: fade;
                                -webkit-animation-duration: 1.5s;
                                animation-name: fade;
                                animation-duration: 1.5s;
                                }

                                @-webkit-keyframes fade {
                                from {opacity: .4} 
                                to {opacity: 1}
                                }

                                @keyframes fade {
                                from {opacity: .4} 
                                to {opacity: 1}
                                }

                                @media only screen and (max-width: 300px) {
                                .prev, .next,.text {font-size: 11px}
                                }
                                </style>
                                \$\{imageCarousel.images.length === 0 ? 
                                    \`<div class="col-12" style="text-align: center;"></div>\` 
                                    : \`
                                    <div class="col-12">
                                        <div class="slideshow-container">
                                            <div id="image-container-dynamic">
                                            </div>       
                                            <a class="prev" onclick="\$\{values._meta.htmlID\}Function.plusSlides(-1)">&#10094;</a>
                                            <a class="next" onclick="\$\{values._meta.htmlID\}Function.plusSlides(1)">&#10095;</a>
                                        </div>
                                        <br>
                                        <div style="text-align:center" id="imageContainerNavigator">
                                        </div>  
                                    </div>
                                    \` \}
                                <script>
                                    const \$\{values._meta.htmlID\} = () => {
                                    let images = \$\{JSON.stringify(imageCarousel.images)\};
                                    let autoSlideBool = \$\{values.autoShowSlide\};
                                    let slideRoot = document.querySelector("#\$\{values._meta.htmlID\}")
                                    var slideIndex = 1;

                                    let myIndex = 0;

                                    function plusSlides(n) {
                                        showSlides(slideIndex += n);
                                    }

                                    function currentSlide(n) {
                                        showSlides(slideIndex = n);
                                    }

                                    function showSlides(n) {
                                        var i;
                                        var slides = slideRoot.getElementsByClassName("mySlides");
                                        var dots = slideRoot.getElementsByClassName("dot");
                                        if (n > slides.length) { slideIndex = 1 }
                                        if (n < 1) { slideIndex = slides.length }
                                        for (i = 0; i < slides.length; i++) {
                                            slides[i].style.display = "none";
                                        }
                                        for (i = 0; i < dots.length; i++) {
                                            dots[i].className = dots[i].className.replace(" active", "");
                                        }
                                        slides[slideIndex - 1].style.display = "block";
                                        dots[slideIndex - 1].className += " active";
                                    }

                                    let imageContainer = slideRoot.querySelector("#image-container-dynamic");
                                    let imageContainerNavigator = slideRoot.querySelector("#imageContainerNavigator");
                                    let imgHtmls = "";
                                    let imgNavigatorHTML = "";
                                    images.map((img, index) => {
                                        imgHtmls += \\\`
                                        <div class="mySlides fade">
                                            <div class="numbertext">\\\$\\\{index + 1\\\} / \\\$\\\{images.length\\\}</div>
                                            <img src="\\\$\{img\\\}" style="width:100%">
                                            <div class="text"></div>
                                        </div>
                                        \\\`;
                                    });

                                    images.map((img, index) => {
                                        imgNavigatorHTML += \\\`
                                        <span class="dot" onclick="\$\{values._meta.htmlID\}Function.currentSlide(\\\$\\\{index + 1\\\})"></span> 
                                        \\\`;
                                    });

                                imageContainer.innerHTML = imgHtmls;
                                imageContainerNavigator.innerHTML = imgNavigatorHTML;
                                if (autoSlideBool && images.length !== 1) {
                                    autoSlide();
                                } else {
                                    showSlides(slideIndex);
                                }
                        
                        
                        
                                function autoSlide() {
                                    let lengthImage = images.length;
                                    if (lengthImage === myIndex) {
                                        myIndex = 0;
                                    }
                                    myIndex++;                                    
                                    currentSlide(myIndex);
                                    setTimeout(autoSlide, 2000);
                                }
                                return {
                                    plusSlides:plusSlides,
                                    currentSlide:currentSlide
                                }
                            }
                            
                            const \$\{values._meta.htmlID\}Function = \$\{values._meta.htmlID\}()
                                </script>                               
                            </div>\`;
                        }
                    }
                }
            });

            //////////////////// Testing Duplicate Variant //////////////////////

            unlayer.registerTool({
                type: 'multiple_variant_tools',
                category: 'contents',
                label: 'Variant (pill)',
                icon: '<svg aria-hidden="true" data-prefix="fab" data-icon="wpforms" fill="#fff" class="svg-inline--fa fa-wpforms fa-w-14 fa-3x" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M 224 32 C 267.836 32 301.93 52.464 301.93 78.766 C 301.93 91.43 295.112 99.223 282.448 103.119 L 224 69.995 L 165.552 103.119 C 153.863 99.223 146.07 92.4 146.07 79.736 C 146.07 52.461 180.164 32 224 32 Z M 224 88.507 C 224 89.481 253.224 106.03 262.965 110.901 L 262.965 146.955 L 259.065 148.896 L 224 166.438 L 188.935 148.896 L 185.035 146.955 L 185.035 110.901 C 194.776 105.056 224 88.507 224 88.507 Z M 152.881 151.826 L 224 187.861 L 295.119 151.826 C 369.153 165.463 418.826 197.595 418.826 233.637 C 418.826 274.551 321.413 275.533 321.413 275.533 C 285.37 275.533 259.065 269.688 234.712 256.05 C 237.634 254.102 239.59 253.128 242.512 251.179 C 263.943 237.542 280.5 226.826 301.93 226.826 L 301.93 207.343 L 136.328 207.343 L 136.328 226.826 L 244.453 226.826 C 240.556 228.774 235.697 231.704 231.801 234.627 C 202.577 254.109 168.467 275.533 109.045 275.533 C 109.045 275.533 29.174 275.525 29.174 233.637 C 29.174 197.595 78.847 165.463 152.881 151.826 Z M 215.229 267.732 C 245.427 286.24 279.525 295.015 321.413 295.015 L 337.966 295.015 C 336.017 297.938 334.073 300.86 332.125 304.757 L 331.154 306.697 C 329.846 308.658 328.344 310.876 326.706 313.318 L 251.926 313.318 C 247.759 313.558 242.931 315.469 240.244 318.157 C 237.556 320.844 235.645 325.672 235.405 329.839 L 235.405 374.994 C 235.645 379.161 237.556 383.989 240.244 386.676 C 242.931 389.364 247.759 391.275 251.926 391.515 L 292.496 391.515 C 292.295 393.77 292.189 396.023 292.189 398.269 C 290.241 401.192 287.326 403.151 285.378 405.1 C 284.445 405.944 283.471 406.766 282.46 407.566 L 251.965 407.566 C 247.798 407.806 242.97 409.717 240.283 412.405 C 237.595 415.092 235.684 419.92 235.444 424.087 L 235.444 427.135 C 226.992 428.912 218.383 430.106 210.098 430.767 L 210.098 425.151 C 209.858 420.984 207.947 416.156 205.259 413.469 C 202.572 410.781 197.744 408.87 193.577 408.63 L 152.056 408.63 C 148.159 403.333 144.587 397.97 141.31 392.579 L 193.538 392.579 C 197.705 392.339 202.533 390.428 205.22 387.74 C 207.908 385.053 209.819 380.225 210.059 376.058 L 210.059 330.903 C 209.819 326.736 207.908 321.908 205.22 319.221 C 202.533 316.533 197.705 314.622 193.538 314.382 L 110.746 314.382 C 109.241 307.54 108.056 301.045 107.104 295.015 L 108.075 295.015 C 155.807 295.015 188.927 282.344 215.229 267.732 Z M 235.444 469.242 C 235.489 470.016 235.591 470.813 235.745 471.615 C 226.591 468.655 218.057 465.002 210.098 460.788 L 210.098 450.292 C 218.22 449.688 226.812 448.596 235.444 446.929 L 235.444 469.242 Z" style=""/> <path d="M 258.615 324.657 L 384.721 324.657 C 389.909 324.657 394.115 328.863 394.115 334.051 L 394.115 372.538 C 394.115 377.726 389.909 381.932 384.721 381.932 L 258.615 381.932 C 253.427 381.932 249.222 377.726 249.222 372.538 L 249.222 334.051 C 249.222 328.863 253.427 324.657 258.615 324.657 Z" style="stroke-width: 11px; fill: rgb(71, 187, 144);"/> <path d="M 257.368 421.203 L 383.473 421.203 C 388.661 421.203 392.867 425.409 392.867 430.597 L 392.867 469.084 C 392.867 474.272 388.661 478.478 383.473 478.478 L 257.368 478.478 C 252.18 478.478 247.974 474.272 247.974 469.084 L 247.974 430.597 C 247.974 425.409 252.18 421.203 257.368 421.203 Z" style="stroke-width: 11px; fill: rgb(217, 236, 107);"/> <path d="M 62.992 323.516 L 189.098 323.516 C 194.286 323.516 198.492 327.722 198.492 332.91 L 198.492 371.397 C 198.492 376.585 194.286 380.791 189.098 380.791 L 62.992 380.791 C 57.804 380.791 53.599 376.585 53.599 371.397 L 53.599 332.91 C 53.599 327.722 57.804 323.516 62.992 323.516 Z" style="stroke-width: 11px; fill: rgb(153, 149, 205);"/> <path d="M 61.745 420.062 L 187.85 420.062 C 193.038 420.062 197.244 424.268 197.244 429.456 L 197.244 467.943 C 197.244 473.131 193.038 477.337 187.85 477.337 L 61.745 477.337 C 56.557 477.337 52.351 473.131 52.351 467.943 L 52.351 429.456 C 52.351 424.268 56.557 420.062 61.745 420.062 Z" style="stroke-width: 11px; fill: rgb(228, 88, 88);"/></svg>',        
                values: {},
                options: {
                    variant: {
                        title: "Variant v2 | Settings", //april12
                        position: 1,
                        options: {
                            // "autoConvert": {
                            //     "label": "Use Currency Converter",
                            //     "defaultValue": false,
                            //     "widget": "toggle"
                            // },
                            // "codCurrency": {
                            //     "label": "COD Currency",
                            //     "defaultValue": ${JSON.stringify(points.funnelEditorData.codCurrencyList)},
                            //     "widget": "custom_dropdown"
                            // },
                            "product_name": {
                                "label": "Product Name (will overwrite if use shopify product)",
                                "defaultValue": "Product Name",
                                "widget": "text"
                            },
                            "variants": {
                                "label": "Variants",
                                "defaultValue": JSON.stringify([ { "isSuggest":false, "variant_name":"1x of your product", "price":"20", "discount":"10" } ]),
                                "widget": "variants"
                            },
                            "selectedStyle": {
                                "label": "Select Recommended Style",
                                "defaultValue": ${variantRecommendedStyle},
                                "widget": "custom_dropdown"
                            },
                            "styleText": {
                                "label": "Recommended Style Text",
                                "defaultValue": "Most Popular!",
                                "widget": "text"
                            },
                            "styleColors": {
                                "label": "Style Colors",
                                "defaultValue": {
                                    "color": "#FFF",
                                    "backgroundColor": "#14d889",
                                    "hoverColor": "#c87668"
                                },
                                "widget": "button_color"
                            },
                            //Added
                            "showPricing": { //done
                                "label": "Show Selected Variant Price",
                                "defaultValue": true,
                                "widget": "toggle"
                            },
                            "showPricingColor": { //done
                                "label": "Pricing Font Color",
                                "defaultValue": "#121212",
                                "widget": "color_picker"
                            },
                            "highlightColor": { //done
                                "label": "Selected Swatch (Border Color)",
                                "defaultValue": "#121212",
                                "widget": "color_picker"
                            },
                            "highlightColorBorder": { //done
                                "label": "Selected Swatch (Border Size)",
                                "defaultValue": "2px",
                                "widget": "px"
                            },
                            "qtyfontColor": { //done
                                "label": "Label Text Color",
                                "defaultValue": "#121212",
                                "widget": "color_picker"
                            },
                            "swatch_text_color": { //done
                                "label": "Swatch Text Color",
                                "defaultValue": "#373a3c",
                                "widget": "color_picker"
                            },
                            "qtyBGColor": { //DOne
                                "label": "Swatch Background Color",
                                "defaultValue": "#26c686",
                                "widget": "color_picker"
                            },
                            "fontSize": {
                                "label": "Font Size",
                                "defaultValue": "15px",
                                "widget": "px"
                            },
                            "fontColor": {
                                "label": "Font Color",
                                "defaultValue": "#121212",
                                "widget": "color_picker"
                            },
                            "discountColor": {
                                "label": "Discount Color",
                                "defaultValue": "#ff0000",
                                "widget": "color_picker"
                            },
                            "hoverColor": {
                                "label": "Hover Color",
                                "defaultValue": "#fef9ae",
                                "widget": "color_picker"
                            }
                        },
                    }
                },
                renderer: {
                    Viewer: unlayer.createViewer({
                        render(values) {
                            // start cod currency setup
                                // if(typeof values.codCurrency === "object") values.codCurrency = JSON.stringify(values.codCurrency)
                                // var codCurrency = JSON.parse(values.codCurrency).selected.split(",");
                                // var currency = { word: codCurrency[0], code: codCurrency[1] };
                                
                                var currency = { word: "USD", code: "$" }
                            // end cod currency setup
                            function priceCommafy(num){
                                var str = num.toString().split('.');
                                if (str[0].length >= 4) str[0] = str[0].replace(/(\\\d)(?=(\\\d{3})+$)/g, '$1,');
                                if (str[1] && str[1].length >= 4) str[1] = str[1].replace(/(\\\d{3})/g, '$1 ');
                                return str.join('.');
                            }
                            // check muna kng empty string laman ng values.variants kundi nmn i parse kc nka stringify ang pasa kase ni explain ko na sa kabilang comment.
                            var variants = "";
                            try {
                                // dko alam bkt ayaw ma parse pag may sobrang comma sa huli ng object pero sa console ok naman kaya binura ko nlng
                                values.variants = values.variants.replace(/,\}/g, "}");
                                if(values.variants) variants = JSON.parse(values.variants).filter(el => el && el.variant_name != "");
                            } catch(error) {
                                console.log("An error has occurred while parsing variant (Preview)");
                            }
                            if(variants != ""){
                                var discountList = [];
                                variants.forEach(el => {
                                    discountList.push(parseFloat(el.discount).toFixed(2))
                                })
                                window.discountList = discountList;
                                if(variants.length != 0){
                                    if(variants[0].id){  // for parsing the variant like shopify
                                        values.product_name = variants[0].shopifyProduct.name // update product name
                                        // var newObj = {}; // for shopify variant
                                        // variants.map((el,i) => {
                                        //     el.shopifyProduct.variant_group.forEach(vel => {
                                        //         var keyName = vel.name;
                                        //         if(!newObj[keyName]){
                                        //             newObj[keyName] = [];
                                        //         }
                                        //         if(!newObj[keyName].includes(vel.value)){
                                        //             newObj[keyName].push(vel.value)
                                        //         }
                                        //     })
                                        // });
                                        // var x = \`
                                        //     <style>
                                        //         .u_content_variant {
                                        //             overflow: hidden;
                                        //         }
                                        //         #\$\{values._meta.htmlID\} .each-variant {
                                        //             overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
                                        //             width: 100%; display: block; cursor: pointer; font-size: \$\{values.fontSize\}; color: \$\{values.fontColor\}; padding: 10px; margin: 0 10px 5px 0; border-radius: 5px; border: 1px solid #c1c1c1;
                                        //         }
                                        //         #\$\{values._meta.htmlID\} .each-variant-active {
                                        //             border: 1px solid transparent; background-color: \$\{values.hoverColor\};
                                        //         }
                                        //     </style>
                                        // \`;
                                        // for(keyName in newObj){
                                        //     x += \`<div style="clear: both;">
                                        //         <h3 style="margin: 10px 0;">\$\{keyName\}</h1>
                                        //         \$\{newObj[keyName].map(dd => {
                                        //             return \`
                                        //                 <label class="\$\{newObj[keyName].length == 1 ? "each-variant each-variant-active" : "each-variant"\}">
                                        //                     \$\{(() => {
                                        //                         if(newObj[keyName].length == 1) return \`<input type="radio" name="\$\{keyName\}" checked>\`
                                        //                         else return \`<input type="radio" name="\$\{keyName\}">\`
                                        //                     })()\}
                                        //                     <span class="display-price money" style="float:right;"></span>
                                        //                     <span style="padding-left: 10px;">\$\{dd\}</span>
                                        //                 </label>
                                        //             \`
                                        //         }).join('')\}
                                        //     </div>\`;
                                        // }
                                        // x += \`
                                        //     <div style="clear: both;padding: 10px 0 0;">
                                        //         <h3 class="price money" style="float: right;margin: 0;">$0.00</h3>
                                        //         <h3 style="margin: 0;">Total:</h3>
                                        //     </div>
                                        // \`;
                                        // return x;
                                    }

                                    // default view if not shopify variant
                                    var style = \`
                                        <style>
                                            #\$\{values._meta.htmlID\} input[type="radio"]:checked:before {
                                                border: 10px solid #fcfcfc; box-shadow: 0px 0px 3px 0px #00000040; width: 25px; height: 25px;
                                            }
                                            #\$\{values._meta.htmlID\} input[type="radio"]:checked:after {
                                                margin: 5px; width: 15px; height: 15px; border: 1px solid #45484C;
                                            }
                                            #\$\{values._meta.htmlID\} input[type="radio"]:checked:after, input[type="radio"]:checked:before {
                                                content: ''; background: linear-gradient(to bottom, #0fe469 0%, #145b32 100%); border-radius: 50%; position: absolute; top: 0; left: 20px; cursor: pointer;
                                            }
                                            #\$\{values._meta.htmlID\} input[type="radio"]:before {
                                                border: 10px solid #fcfcfc; box-shadow: 0px 0px 3px 0px #00000040; width: 25px; height: 25px;
                                            }
                                            #\$\{values._meta.htmlID\} input[type="radio"]:after {
                                                margin: 5px; width: 15px; height: 15px; border: 1px solid #45484C;
                                            }
                                            #\$\{values._meta.htmlID\} input[type="radio"]:after, input[type="radio"]:before {
                                                content: ''; background-color: #b3abab; border-radius: 50%; position: absolute; top: 0; left: 20px; cursor: pointer;
                                            }
                                        </style>
                                    \`;
                                    function groupByDesign(objectArray, property) {
                                        return objectArray.reduce(function (acc, obj) {
                                          var key = obj[property];
                                          if (!acc[key]) {
                                            acc[key] = [];
                                          }
                                          !acc[key].includes(obj.value) ? acc[key].push(obj.value) : void 0;
                                          return acc;
                                        }, {});
                                    
                                      }
                                      var tpl = 'background-color:greenyellow; border:3px solid orange; font-size:18px; font-weight: bold;padding:3px 5px;color:';
                                      
                                      const flatarrDesign = arr => arr.flat(1)
                                      var compiledVariantDesign = [] 
                                    
                                    return style + variants.map((el,i) => {
                                        
                                        if(el.shopifyProduct){
                                            el.shopifyProduct.variant_group.map(el => {
                                                
                                                compiledVariantDesign.push(el)
                                                
                                            })
                                        }
                                    var groupedD = groupByDesign(flatarrDesign(compiledVariantDesign), 'name');
                                    const variantNameIterateDesign = Object.keys(groupedD)
                                    function swatchEditor() {

                                    let vselectorDesign = \` 

                                    <div style="overflow-wrap: break-word;padding: 10px; display: \$\{values.showPricing ? "block;" : "none;"\}">
                                    <div style="color:\$\{values.showPricingColor\};line-height:140%;text-align:right;word-wrap:break-word" >
                                                <p style="font-size: 14px; line-height: 140%;">
                                                <span style="font-size: 34px; line-height: 47.6px;">$\$\{parseInt(priceCommafy(variants[0].price)).toFixed(2)\}</span>
                                                </p>
                                                </div>
                                            </div>
                                        <style> .active_plg_multi { border: \$\{values.highlightColorBorder\} solid \$\{values.highlightColor\} !important; } </style>
                                        <div class="country-selector">
                                        <div class="row">
                                        <div class="col-12" style="display: flex; align-items: center; justify-content: center;flex-flow: column;">
                                    \`
                                    variantNameIterateDesign.map(vn => {
                                        vselectorDesign += \`<input type="hidden" value="\$\{groupedD[vn][0]\}" class="multi-level-variant \$\{vn.toLowerCase()\}" \\>
                                    <p style="align-self: flex-start; font-size: 15px; padding:10px; color: \$\{values.qtyfontColor\}">\$\{vn.toUpperCase()\}<\\/p>
                                    <div style="display: flex; flex-flow: row; flex-wrap: wrap; width: 100%; justify-content: center;" class="multi-level-variant-button">\`
                                    groupedD[vn].map((vv, i) => {

                                            if (vn.toLowerCase().includes('color')) {
                                                vselectorDesign += \`<div data-\$\{vn.toLowerCase()\}="\$\{vv.toLowerCase()\}" class="\$\{i === 0? 'active_plg_multi': ''\}" onclick="updateMultiple('\$\{vn.toLowerCase()\}',this)" style="cursor: pointer; box-shadow: 1px 1px 1px 1px #abababbf; border-radius: 5px; padding: 5px; background-color: \$\{vv.toLowerCase()\}; margin-bottom: 1rem; max-width: 45%; width: 15%; height: 2.4rem; margin-right: 0.865rem; line-height: 1;"><\\/div>\`
                                            } else {
                                                vselectorDesign += \`<div data-\$\{vn.toLowerCase()\}="\$\{vv.toLowerCase()\}" class="\$\{i === 0? 'active_plg_multi': ''\}" onclick="updateMultiple('\$\{vn.toLowerCase()\}',this)" style="border: 2px solid \$\{values.qtyBGColor\}; cursor: pointer; color: \$\{values.swatch_text_color\};box-shadow: 1px 1px 1px 1px #abababbf; border-radius: 5px; padding: 5px; background-color: \$\{values.qtyBGColor\}; margin-bottom: 1rem; max-width: 45%; margin-right: 0.865rem; min-width: 50px; text-align: center; line-height:1;">\$\{vv.toUpperCase()\}<\\/div>\`
                                            }
                                        }).join('')
                                        vselectorDesign += \`<\\/div>\`
                                    }).join('')
                                    vselectorDesign += \`<\\/div><\\/div><\\/div>\`
                                        return vselectorDesign
                                }
                                      
                                        
                                        var discountedPrice = el.discount ? (el.price - (el.price * (el.discount / 100))).toFixed(2) : parseFloat(el.price).toFixed(2);
                                        let has_discount = el.discount && el.discount !== "0" ? true : false;
                                        if(el.shopifyProduct) {

                                            if((i+1) == variants.length){
                                                
                                                var x = swatchEditor();
                                                
                                            } 
                                        } else {
                                            
                                        var x = \`
                                            <label class="row plg_variants_list" style="position: relative; display: flex; align-items: center; cursor: pointer; font-size: \$\{values.fontSize\}; color: \$\{values.fontColor\}; border: 1px solid #ffffff00; padding: 10px 5px;" for=\$\{"check"+i\}>
                                                <!-- replaceSuggestImageHere -->
                                                <div class="col-2 u_column">
                                                    \$\{(() => {
                                                        if(el.isSuggest){
                                                            return \`<input type="radio" name="variants" id=\$\{"check"+i\} style="margin-left: 25px;" checked>\`
                                                        } else {
                                                            return \`<input type="radio" name="variants" id=\$\{"check"+i\} style="margin-left: 25px;">\`
                                                        }
                                                    })()\}
                                                </div>
                                                <div class="col-7 u_column">
                                                    <span id="variant_name">\$\{el.variant_name\}</span>
                                                    \$\{has_discount ? \`<span style="color: \$\{values.discountColor\} !important; display: block;">\$\{"(" + parseFloat(el.discount).toFixed(0) + "% Discount)"\}</span>\` : ""\}
                                                </div>
                                                <div class="col-3 u_column" style="text-align: right">
                                                    <span class="money" id="variant_price">\$\{currency.code + priceCommafy(discountedPrice)\}</span>
                                                    \$\{has_discount ? \`<strike class="money" style="color: \$\{values.discountColor\} !important; display: block;">\$\{currency.code + priceCommafy(parseFloat(el.price).toFixed(2))\}</strike>\` : ""\}
                                                </div>
                                            </label>
                                        \`
                                        if (el.isSuggest || el.ribbon_text) {
                                            typeof values.selectedStyle == "string" ? values.selectedStyle = JSON.parse(values.selectedStyle) : void 0;
                                            if (values.selectedStyle.selected == "2" || el.ribbon_text){
                                                x = x.replace("<!-- replaceSuggestImageHere -->", '<div style="width: 100%; margin-left: -5px; margin-bottom: 5px;"> <div style="text-align: center; max-width: 200px; background-color: '+values.styleColors.backgroundColor+'; color: '+values.styleColors.color+'; padding: 5px; position: relative; clip-path: polygon(0% 0%, 100% 0, 180px 50%, 100% 100%, 0% 100%);"> <label style="font-weight: 700;" class="variant_recommended">'+(el.ribbon_text || values.styleText)+'</label> </div> </div>');
                                            } else if (values.selectedStyle.selected == "1") {
                                                x = x.replace("<!-- replaceSuggestImageHere -->", '<img src="https://cdn.productlistgenie.com/images/1559588850495share.png" style="position: absolute; z-index: 1; left: -10px; top: 5px; transform: rotate(200deg) scaleX(-1);" width="30px" height="30px">');
                                            }
                                            x = x.replace('style="','style="background-color: '+values.hoverColor+'; filter: brightness(95%); ');
                                        }
                                        }
                                        return x;
                                    }).join('');
                                } else {
                                    return \`
                                    <div style="text-align: center">
                                    <span>Click here to edit on the left panel.</span>
                                    </div>
                                    \`
                                }
                            } else {
                                
                                return \`
                                    <div style="text-align: center">
                                        <span>Click here to edit on the left panel.</span>
                                    </div>
                                \`
                            }
                        }
                    }),
                    exporters: {
                        web: function (values) {
                            // start cod currency setup
                                    // if(typeof values.codCurrency === "object") values.codCurrency = JSON.stringify(values.codCurrency)
                                    // var codCurrency = JSON.parse(values.codCurrency).selected.split(",");
                                    // var currency = { word: codCurrency[0], code: codCurrency[1] };
                                    
                                var currency = { word: "USD", code: "$" }
                            // end cod currency setup
                            function priceCommafy(num){
                                var str = num.toString().split('.');
                                if (str[0].length >= 4) str[0] = str[0].replace(/(\\\d)(?=(\\\d{3})+$)/g, '$1,');
                                if (str[1] && str[1].length >= 4) str[1] = str[1].replace(/(\\\d{3})/g, '$1 ');
                                return str.join('.');
                            }
                            // check muna kng empty string laman ng values.variants kundi nmn i parse kc nka stringify ang pasa kase ni explain ko na sa kabilang comment.
                            var variants = values.variants ? JSON.parse(values.variants).filter(el => el && el.variant_name != "") : "";
                            if(variants != ""){
                                if(variants.length != 0){
                                    var addAutoConvert = \`
                                        <script src="https://convert.productlistgenie.com/CurrencyConverter/" async onload="convertAllMoneyClass()"></script> 
                                        <script>
                                            function convertAllMoneyClass() {
                                                var numberWithCommas = (x) => x.toString().replace(/\\\\B(?=(\\\\d{3})+(?!\\\\d))/g, ",");
                                                var currencyRegex = new RegExp(/.*[^\\\\d\.\\\\,\\\\s]/g);
                                                var priceRegex = new RegExp(/[\\\\d]|\\\\./g);
                                                var s = document.createElement("div");
                                                s.id = "c_value";
                                                s.innerHTML = c_value;
                                                s.style.display = "none";
                                                document.body.appendChild(s);
                                                document.querySelectorAll(".money").forEach((el, i) => {
                                                    var plgConverted = document.getElementById("c_value").innerText;
                                                    if(el.innerText){
                                                        var origPrice = el.innerText.match(priceRegex).toString().replace(/,/g, "");
                                                        var convertedCurrency = plgConverted.match(currencyRegex).toString();
                                                        var convertedPrice = plgConverted.match(priceRegex).toString().replace(/,/g, "");
                                                        var computedConvertedPrice = numberWithCommas((origPrice * convertedPrice).toFixed(2));
                                                        el.innerHTML = convertedCurrency + " " + computedConvertedPrice;
                                                    }
                                                });
                                            }
                                        </script>
                                    \`
                                    if(variants[0].id){  // for parsing the variant like shopify
                                        values.product_name = variants[0].shopifyProduct.name // update product name
                                        // var x = \`
                                        //     <style>
                                        //         .u_content_variant {
                                        //             overflow: hidden;
                                        //         }
                                        //         #\$\{values._meta.htmlID\} .each-variant {
                                        //             overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
                                        //             width: 100%; display: block; cursor: pointer; font-size: \$\{values.fontSize\}; color: \$\{values.fontColor\}; padding: 10px; margin: 0 10px 5px 0; border-radius: 5px; border: 1px solid #c1c1c1;
                                        //         }
                                        //         #\$\{values._meta.htmlID\} .each-variant-active {
                                        //             border: 1px solid transparent; background-color: \$\{values.hoverColor\};
                                        //         }
                                        //     </style>
                                        // \`;
                                        // if(values.autoConvert){
                                        //     x += addAutoConvert
                                        // }
                                        // var newObj = {}; // for shopify variant
                                        // var options = \`<option data-variant-id="" data-price="" value="">No Variant Selected</option>\`; // for select tag value
                                        // variants.map((el,i) => {
                                        //     el.shopifyProduct.variant_group.forEach(vel => {
                                        //         var keyName = vel.name;
                                        //         if(!newObj[keyName]){
                                        //             newObj[keyName] = [];
                                        //         }
                                        //         if(!newObj[keyName].includes(vel.value)){
                                        //             newObj[keyName].push(vel.value)
                                        //         }
                                        //     })
                                        //     options += \`
                                        //         <option data-variant-id="\$\{el.id\}" data-price="\$\{el.price\}" value="\$\{el.variant_name\}">\$\{el.variant_name\} - \$\{el.price\}</option>
                                        //     \`;
                                        // });
                                        // var index = 0;
                                        // for(keyName in newObj){
                                        //     x += \`<div style="clear: both;">
                                        //         <h3 style="margin: 10px 0;">\$\{keyName\}</h1>
                                        //         \$\{newObj[keyName].map(dd => {
                                        //             return \`
                                        //                 <label class="\$\{newObj[keyName].length == 1 ? "each-variant each-variant-active" : "each-variant"\}" data-group="\$\{keyName\}" data-group-value="\$\{dd\}" onclick="selectThisVariant(this)">
                                        //                     \$\{(() => {
                                        //                         var attr = "";
                                        //                         if(newObj[keyName].length == 1) attr = "checked";
                                        //                         else if(index != 0) attr = "disabled";
                                        //                         return \`<input type="radio" name="\$\{keyName\}" \$\{attr\}>\`
                                        //                     })()\}
                                        //                     <span class="display-price money" style="float:right;"></span>
                                        //                     <span style="padding-left: 10px;">\$\{dd\}</span>
                                        //                 </label>
                                        //             \`
                                        //         }).join('')\}
                                        //     </div>\`;
                                        //     index = index + 1;
                                        // }
                                        // x += \`
                                        //     <div style="clear: both;padding: 10px 0 0;">
                                        //         <h3 class="price money" style="float: right;margin: 0;">$0.00</h3>
                                        //         <h3 style="margin: 0;">Total:</h3>
                                        //     </div>
                                        //     <select name="selected_variant" onchange="updateVariantPrice(this)" style="display: none;">
                                        //         \$\{options\}
                                        //     </select>
                                        //     <script>
                                        //         var plg_price = 0;
                                        //         var isComplete = false;
                                        //         var warrantyPrice = {
                                        //             price: 0,
                                        //             variantname: "",
                                        //             variantid: ""
                                        //         };
                                        //         var plg_selectedVariant = {};
                                        //         var firstVariant = "";
                                        //         var restVariant = [];
                                        //         function selectThisVariant(element){
                                        //             if(element.querySelector("input:disabled")){
                                        //                 return;
                                        //             }
                                        //             var variantObject = \$\{JSON.stringify(newObj)\};
                                        //             var variantParent = element.parentNode.parentNode;
                                        //             element.parentNode.querySelectorAll(".each-variant").forEach(el => {
                                        //                 el.classList.remove("each-variant-active");
                                        //                 el.querySelector(".display-price").innerText = "";
                                        //             })
                                        //             element.classList.add("each-variant-active");
                                        //             var variantName = "";
                                        //             var isAllVariantSelected = true;
                                        //             var index = 0;
                                        //             for(keyName in variantObject){
                                        //                 var keyValue = document.querySelector('[data-group="'+keyName+'"].each-variant-active');
                                        //                 if(keyValue){
                                        //                     var value = keyValue.getAttribute("data-group-value");
                                        //                     variantName += value + " / ";
                                        //                 } else {
                                        //                     isAllVariantSelected = false;
                                        //                 }
                                        //                 // set initialization for checking the available variant
                                        //                 if(index == 0) firstVariant = keyName; 
                                        //                 else {
                                        //                     restVariant = [];
                                        //                     restVariant.push(keyName);
                                        //                 }
                                        //                 index++;
                                        //             }
                                        //             isComplete = isAllVariantSelected;
                                        //             variantName = variantName.substring(0, variantName.length-3);
                                        //             document.querySelector(".price").innerHTML = "$0.00";
                                        //             var variantSelectTag = document.querySelector('[name="selected_variant"]');
                                        //             variantSelectTag.value = variantName;
                                        //             variantSelectTag.dispatchEvent(new Event("change"))
                                        //             // keep disable the variant if not available
                                        //             disableVariant(variantName)
                                        //         }
                                        //         function updateVariantPrice(element){
                                        //             if(isComplete){
                                        //                 if(element.selectedIndex == -1){
                                        //                     plg_price = warrantyPrice.price ? warrantyPrice.price : 0;
                                        //                     return;
                                        //                 }
                                        //                 var variantID = element.options[element.selectedIndex].dataset.variantId;
                                        //                 var variantPrice = element.options[event.target.selectedIndex].dataset.price;
                                        //                 var variantName = element.value;
                                        //                 // set necessary variable
                                        //                 plg_price = parseFloat(variantPrice) + warrantyPrice.price;
                                        //                 plg_selectedVariant = {
                                        //                     price: currency.code+plg_price,
                                        //                     variant_name: variantName + (warrantyPrice.price ? " + "+warrantyPrice.variantname : ""),
                                        //                     product_name: "\$\{values.product_name\}",
                                        //                     variant_id: variantID + (warrantyPrice.variantid ? ", "+warrantyPrice.variantid : "")
                                        //                 }
                                        //                 document.querySelector(".price").innerHTML = plg_selectedVariant.price;
                                        //                 // display computed price
                                        //                 document.querySelectorAll(".each-variant-active").forEach(el => {
                                        //                     el.querySelector(".display-price").innerText = plg_selectedVariant.price;
                                        //                 })
                                        //                 typeof convertAllMoneyClass !== "undefined" ? convertAllMoneyClass() : void 0;
                                        //             } else {
                                        //                 console.log("must select all variant first")
                                        //             }
                                        //         }
                                        //         function getTheSelectedVariant(){
                                        //             // to update the price when product addon click
                                        //             document.querySelector(".each-variant-active").click();
                                        //         }
                                        //         function disableVariant(variantName){
                                        //             if(variantName){
                                        //                 // disable all first
                                        //                 restVariant.forEach(rest => {
                                        //                     var allRadio = document.querySelectorAll("[data-group='"+rest+"'] input");
                                        //                     allRadio.forEach(radio => {
                                        //                         radio.disabled = true;
                                        //                     })
                                        //                 });
                                        //                 var selectTag = document.querySelector('[name="selected_variant"]');
                                        //                 var selectedFristVariant = document.querySelector("[data-group='"+firstVariant+"'].each-variant-active").getAttribute("data-group-value");
                                        //                 for(var i=0; i<selectTag.length; i++){
                                        //                     var shouldNotDisable = selectTag.options[i].value.includes(selectedFristVariant);
                                        //                     if(shouldNotDisable){
                                        //                         var value = selectTag.options[i].value;
                                        //                         var nextVariants = value.split(" / ").splice(-1, 1);
                                        //                         restVariant.forEach(rest => {
                                        //                             nextVariants.forEach(variant => {
                                        //                                 var groupNameRadio = document.querySelector("[data-group='"+rest+"'][data-group-value='"+variant+"'] input");
                                        //                                 groupNameRadio.parentNode.style.cssText = "opacity: 1;";
                                        //                                 groupNameRadio.removeAttribute("disabled");
                                        //                             });
                                        //                         });
                                        //                     }
                                        //                 }
                                        //             }
                                        //             document.querySelectorAll(".each-variant input:disabled").forEach(el => {
                                        //                 el.parentNode.style.cssText = "opacity: 0.5;";
                                        //                 el.parentNode.classList.remove("each-variant-active");
                                        //                 el.parentNode.querySelector(".display-price").innerText = "";
                                        //             })
                                        //         }
                                        //         disableVariant();
                                        //     </script>
                                        // \`;
                                        // return x;
                                    }

                                    var style = \`
                                        <style>
                                            #\$\{values._meta.htmlID\} input[type="radio"]:checked:before {
                                                border: 10px solid #fcfcfc; box-shadow: 0px 0px 3px 0px #00000040; width: 25px; height: 25px;
                                            }
                                            #\$\{values._meta.htmlID\} input[type="radio"]:checked:after {
                                                margin: 4.5px; width: 15px; height: 15px; border: 1px solid #45484C;
                                            }
                                            #\$\{values._meta.htmlID\} input[type="radio"]:checked:after, #\$\{values._meta.htmlID\} input[type="radio"]:checked:before {
                                                content: ''; background: linear-gradient(to bottom, #0fe469 0%, #145b32 100%); border-radius: 50%; position: absolute; top: 0; left: 10px; cursor: pointer;
                                            }
                                            #\$\{values._meta.htmlID\} input[type="radio"]:before {
                                                border: 10px solid #fcfcfc; box-shadow: 0px 0px 3px 0px #00000040; width: 25px; height: 25px;
                                            }
                                            #\$\{values._meta.htmlID\} input[type="radio"]:after {
                                                margin: 4.5px; width: 15px; height: 15px; border: 1px solid #45484C;
                                            }
                                            #\$\{values._meta.htmlID\} input[type="radio"]:after, #\$\{values._meta.htmlID\} input[type="radio"]:before {
                                                content: ''; background-color: #b3abab; border-radius: 50%; position: absolute; top: 0; left: 10px; cursor: pointer;
                                            }
                                        </style>
                                    \`;
                                    function groupBy(objectArray, property) {
                                        return objectArray.reduce(function (acc, obj) {
                                          var key = obj[property];
                                          if (!acc[key]) {
                                            acc[key] = [];
                                          }
                                          !acc[key].includes(obj.value) ? acc[key].push(obj.value) : void 0;
                                          return acc;
                                        }, {});
                                    
                                      }
                                    const flatarr = arr => arr.flat(1)
                                    var compiledVariant = [] 
                                    
                                    var renderVariant = style + variants.map((el,i) => {
                                        

                                        
                                        if(el.shopifyProduct){
                                            const shopifyVariants = el.shopifyProduct.variant_group.map(el => {
                                                return el
                                            })
                                            compiledVariant.push(shopifyVariants)
                                        }


                                        
                                        var discountedPrice = el.discount ? (el.price - (el.price * (el.discount / 100))).toFixed(2) : parseFloat(el.price).toFixed(2);
                                        let has_discount = el.discount && el.discount !== "0" ? true : false;
                                        var x = \`
                                            <label class="row plg_variants_list" style="position: relative; display: none; align-items: center; cursor: pointer; font-size: \$\{values.fontSize\}; color: \$\{values.fontColor\}; border: 1px solid #ffffff00; padding: 10px 5px;" for=\$\{"check"+i\}>
                                                <!-- replaceSuggestImageHere -->
                                                <div class="col-2 u_column">
                                                    \$\{(() => {
                                                        
                                                        if(el.isSuggest){ 
                                                            return \`<input type="radio" name="variants" data-variant-name="\$\{el.variant_name.replace(/ \\/ /g, '_').replace(/[\\s\\W\\/]+/g, '').replace(/_/g, '-').toLowerCase()\}" id=\$\{"check"+i\} data-price="\$\{currency.code + discountedPrice\}" onclick="typeof getTheSelectedVariant != 'undefined' ? getTheSelectedVariant() : void 0" style="margin-left: 15px;" checked>\`
                                                        } else {
                                                            return \`<input type="radio" name="variants" data-variant-name="\$\{el.variant_name.replace(/ \\/ /g, '_').replace(/[\\s\\W\\/]+/g, '').replace(/_/g, '-').toLowerCase()\}" id=\$\{"check"+i\} data-price="\$\{currency.code + discountedPrice\}" onclick="typeof getTheSelectedVariant != 'undefined' ? getTheSelectedVariant() : void 0" style="margin-left: 15px;">\`
                                                        }
                                                    })()\}
                                                </div>
                                                <div class="col-7 u_column">
                                                    <span id="variant_name">\$\{el.variant_name\}</span>
                                                    \$\{has_discount ? \`<span style="color: \$\{values.discountColor\} !important; display: block;">\$\{"(" + parseFloat(el.discount).toFixed(0) + "% Discount)"\}</span>\` : ""\}
                                                </div>
                                                <div class="col-3 u_column" style="text-align: right;">
                                                
                                                    <span data-variant-id="\$\{el.id ? el.id : ""\}" data-variant-htmlid="\$\{values._meta.htmlID\}" data-qty="\$\{el.variant_qty ? el.variant_qty : 1 \}" data-sku="\$\{el.variant_sku ? el.variant_sku : ""\}" data-price="\$\{currency.code + discountedPrice\}" data-tag="\$\{el.tag ? el.tag : ''\}" data-cog="\$\{el.cog ? el.cog : ''\}" class="money" id="variant_price">\$\{currency.code+priceCommafy(discountedPrice)\}</span>
                                                    \$\{has_discount ? \`<strike class="money" style="color: \$\{values.discountColor\} !important; display: block;">\$\{currency.code + priceCommafy(parseFloat(el.price).toFixed(2))\}</strike>\` : ""\}
                                                </div>
                                            </label>
                                        \`;
                                        if (el.isSuggest || el.ribbon_text) {
                                            typeof values.selectedStyle == "string" ? values.selectedStyle = JSON.parse(values.selectedStyle) : void 0;
                                            
                                            if (values.selectedStyle.selected == "2" || el.ribbon_text){
                                                x = x.replace("<!-- replaceSuggestImageHere -->", '<div style="width: 100%; margin-left: -5px; margin-bottom: 5px;"> <div style="text-align: center; max-width: 200px; background-color: '+values.styleColors.backgroundColor+'; color: '+values.styleColors.color+'; padding: 5px; position: relative; clip-path: polygon(0% 0%, 100% 0, 180px 50%, 100% 100%, 0% 100%);"> <label style="font-weight: 700;" class="variant_recommended">'+(el.ribbon_text || values.styleText)+'</label> </div> </div>');
                                            } else if (values.selectedStyle.selected == "1") {
                                                x = x.replace("<!-- replaceSuggestImageHere -->", '<img src="https://cdn.productlistgenie.com/images/1559588850495share.png" style="position: absolute; z-index: 1; left: -20px; top: 0; transform: rotate(210deg) scaleX(-1);" width="40px" height="40px">');
                                            }
                                            x = x.replace('style="','style="background-color: '+values.hoverColor+'; filter: brightness(95%); ');
                                        }
                                        if((i+1) == variants.length){
                                            x += \`
                                                <style>
                                                    .plg_variants_list{
                                                        padding: \$\{values.padding\};
                                                    }
                                                    .plg_variants_list:hover{
                                                        background-color: \$\{values.hoverColor\} !important;
                                                        border: 1px solid #00000033 !important;
                                                        border-radius: 4px;
                                                    }
                                                </style>
                                                <script>
                                                    var warrantyPrice = {
                                                        price: 0,
                                                        variantname: "",
                                                        variantid: "",
                                                        tag: ""
                                                    };
                                                    var plg_price = 0;
                                                    var plg_selectedVariant = {};
                                                    function priceToObject(string) {
                                                        var currencyRegex = new RegExp(/.*[^\\\\d\.\\\\,\\\\s]/g);
                                                        var priceRegex = new RegExp(/[\\\\d]|\\\\./g);
                                                        var price = string.match(priceRegex).toString().replace(/,/g, "");
                                                        var currency = string.match(currencyRegex).toString().replace(/,/g, "");
                                                        return { price, currency }
                                                    }
                                                    function getTheSelectedVariant(){
                                                        document.querySelectorAll(".plg_variants_list").forEach(el => {
                                                            if (el.querySelector("input[type=radio]").checked) {
                                                                var priceDOM = el.querySelector("#variant_price");
                                                                var priceObject = priceToObject(priceDOM.getAttribute("data-price"))
                                                                var isHaveShippingFee = typeof shippingFee !== "undefined" && shippingFee != 0 ? true : false;
                                                                var isHaveTaxFee = typeof taxFee !== "undefined" && taxFee != 0 ? true : false;
                                                                plg_selectedVariant = {
                                                                    price: priceObject.currency+(parseFloat(priceObject.price) + warrantyPrice.price + (isHaveShippingFee ? parseFloat(shippingFee) : 0) + (isHaveTaxFee ? parseFloat(taxFee) : 0)),
                                                                    variant_name: el.querySelector("#variant_name").innerText + (warrantyPrice.price ? " + "+warrantyPrice.variantname : "") + (isHaveShippingFee ? " + Shippping Fee" : "") + (isHaveTaxFee ? " + Tax Fee" : ""),
                                                                    product_name: "\$\{values.product_name\}",
                                                                    variant_id: priceDOM.getAttribute("data-variant-id") + (warrantyPrice.variantid ? ", "+warrantyPrice.variantid : ""),
                                                                    tags: [...priceDOM.getAttribute("data-tag").split(/[ ,]+/), plgQS()],
                                                                    currency: \$\{JSON.stringify(currency)\},
                                                                    variant_qty: priceDOM.getAttribute("data-qty") ? priceDOM.getAttribute("data-qty") : "1",
                                                                    variant_sku: priceDOM.getAttribute("data-sku") ? priceDOM.getAttribute("data-sku") : "",
                                                                    cog: priceDOM.getAttribute("data-cog") ? parseFloat(priceDOM.getAttribute("data-cog")) : 0,
                                                                }
                                                                if(warrantyPrice.tag && !plg_selectedVariant.tags.includes(warrantyPrice.tag)) plg_selectedVariant.tags.push(warrantyPrice.tag);

                                                                // Apply selected Style like hover style
                                                                el.style.backgroundColor = "\$\{values.hoverColor\}";
                                                                el.style.border = "1px solid #00000033";
                                                                el.style.borderRadius = "4px";

                                                                // update plg_price
                                                                plg_price = parseFloat(priceToObject(plg_selectedVariant.price).price).toFixed(2);
                                                            } else {
                                                                // Remove Style and set it to default
                                                                el.style.backgroundColor = "inherit";
                                                                el.style.border = "1px solid #ffffff00";
                                                                el.style.borderRadius = "0px";
                                                            }
                                                        });

                                                        if(plg_selectedVariant.price && typeof changeVariantTotalReceipt !== "undefined") changeVariantTotalReceipt(); // if has selected variant call update price of total receipt
                                                    }
                                                    getTheSelectedVariant();

                                                    // experimentation
                                                    // function dynamicComputePrices(){
                                                    //     const variantList = document.querySelectorAll(".plg_variants_list");
                                                    //     var params = "";
                                                    //     variantList.forEach((el,i) => {
                                                    //         var sku = el.querySelector("[data-sku]").getAttribute("data-sku");
                                                    //         const qty = el.querySelector("[data-qty]").getAttribute("data-qty");
                                                    //         const price = priceToObject(el.querySelector("[data-price]").getAttribute("data-price")).price;
                                                    //         if(sku) {
                                                    //             sku = sku+"_"+i;
                                                    //             params += "data["+sku+"][qty]="+qty+"&data["+sku+"][price]="+price+"&data["+sku+"][currency]="+plg_selectedVariant.currency.word+"&";
                                                    //         }
                                                    //     })
                                                    //     params = params.substring(0, params.length-1);
                                                    //     fetch('https://cors-anywhere.herokuapp.com/https://fcdf796f.ngrok.io/cod-validate-prices?'+params)
                                                    //     .then(res => res.json())
                                                    //     .then(res => {
                                                    //         document.querySelectorAll(".plg_variants_list").forEach((el,i) => {
                                                    //             var sku = el.querySelector("[data-sku]").getAttribute("data-sku");
                                                    //             if(sku) {
                                                    //                 sku = sku+"_"+i;
                                                    //                 el.querySelector("[data-price]").setAttribute("data-price", plg_selectedVariant.currency.code+res[sku]);
                                                    //                 el.querySelector("[data-price]").innerHTML = plg_selectedVariant.currency.code+res[sku];
                                                    //             }
                                                    //         })
                                                    //     })
                                                    // }
                                                    // dynamicComputePrices();
                                                </script>
                                            \`
                                        }
                                        
                                        return x;
                                    }).join('');



                                if(compiledVariant !== 0){
                                    var grouped = groupBy(flatarr(compiledVariant), 'name');
                                    const variantNameIterate = Object.keys(grouped)
                                    
                                    var vselector = \`

                                        
                                        <div style="overflow-wrap: break-word;padding: 10px; display: \$\{values.showPricing ? "block;" : "none;"\}">
                                            <div style="color:\$\{values.showPricingColor\};line-height:140%;text-align:right;word-wrap:break-word" >
                                                <p style="font-size: 14px; line-height: 140%;">
                                                <span class="swatch-show-price" style="font-size: 34px; line-height: 47.6px;">$\$\{parseInt(priceCommafy(variants[0].price)).toFixed(2)\}</span>
                                                </p>
                                            </div>
                                        </div>
                                        <style> .active_plg_multi { border: \$\{values.highlightColorBorder\} solid \$\{values.highlightColor\} !important; } </style>
                                        <div class="country-selector">
                                        <div class="row">
                                        <div class="col-12" style="display: flex; align-items: center; justify-content: center;flex-flow: column;">
                                    \`
                                    variantNameIterate.map(vn => {
                                        vselector += \`<input type="hidden" value="\$\{grouped[vn][0]\}" class="multi-level-variant \$\{vn.toLowerCase()\}" \\>
                                    <p style="align-self: flex-start; font-size: 15px; padding:10px; color: \$\{values.qtyfontColor\}">\$\{vn.toUpperCase()\}<\\/p>
                                    <div style="display: flex; flex-flow: row; flex-wrap: wrap; width: 100%; justify-content: center;" class="multi-level-variant-button">\`
                                    grouped[vn].map((vv, i) => {

                                            if (vn.toLowerCase().includes('color')) {
                                                vselector += \`<div data-\$\{vn.toLowerCase()\}="\$\{vv.replace(/[\\s\\W\\/]+/g, '').toLowerCase()\}" class="\$\{i === 0? 'active_plg_multi': ''\}" onclick="updateMultiple('\$\{vn.toLowerCase()\}',this)" style="cursor: pointer; box-shadow: 1px 1px 1px 1px #abababbf; border-radius: 5px; padding: 5px; background-color: \$\{vv.toLowerCase()\}; margin-bottom: 1rem; max-width: 45%; width: 15%; height: 2.4rem; margin-right: 0.865rem; line-height: 1;"><\\/div>\`
                                            } else {
                                                vselector += \`<div data-\$\{vn.toLowerCase()\}="\$\{vv.replace(/[\\s\\W\\/]+/g, '').toLowerCase()\}" class="\$\{i === 0? 'active_plg_multi': ''\}" onclick="updateMultiple('\$\{vn.toLowerCase()\}',this)" style="border: 2px solid \$\{values.qtyBGColor\}; cursor: pointer; color: \$\{values.swatch_text_color\};box-shadow: 1px 1px 1px 1px #abababbf; border-radius: 5px; padding: 5px; background-color: \$\{values.qtyBGColor\}; margin-bottom: 1rem; max-width: 45%; margin-right: 0.865rem; min-width: 50px; text-align: center; line-height:1;">\$\{vv.toUpperCase()\}<\\/div>\`
                                            }
                                        }).join('')
                                        vselector += \`<\\/div>\`
                                    }).join('')
                                    vselector += \`<\\/div><\\/div><\\/div>\`

                                    vselector += \`
                                        <script>
                                            let isUsingPOD = false;
                                            let design_url = "";
                                            const preSelect = toSelectElement => {
                                                document.querySelectorAll('#' + toSelectElement + ' input[name="variants"]').forEach((el, i) => {
                                                    if (el.checked) {
                                                        console.log(el.checked, el);
                                                        var splited = el.getAttribute("data-variant-name").split('-')
                                                        document.querySelectorAll('input.multi-level-variant').forEach((kk, k) => {
                                                            console.log(kk.getAttribute("class").replace('multi-level-variant ', ''));
                                                            kk.value = splited[k]
                                                            document.querySelector(\\\`.multi-level-variant-button [data-\\$\\{kk.getAttribute('class').replace('multi-level-variant ', '')\\}='\\$\\{splited[k]\\}']\\\`).click()
                                                        })
                                                        
                                                    } 
                                                    
                                                })
                                            }     
                                            const toSelect = toSelectElement => {
                                                const selectedCombinedVariants = Array.from(document.querySelectorAll('#' + toSelectElement + ' input.multi-level-variant')).map(el => {
                                                     return el.value.toLowerCase()
                                                 }).join('-');

                                                 const findAndSelect = (variantChoice) => {
                                                     document.querySelectorAll('#' + toSelectElement + ' input[name="variants"]').forEach((el, i) => {
                                                         if(variantChoice == el.getAttribute("data-variant-name")) {
                                                             el.click()
                                                             document.querySelectorAll('.swatch-show-price').forEach(ss => ss.innerText = el.getAttribute("data-price"))
                                                         }
                                                     });
                                                 }
                                                 findAndSelect(selectedCombinedVariants)
                                        }       
                                        preSelect("\$\{values._meta.htmlID\}")
                                            function updateMultiple(variantType, element) {
                                                try{
                                        \`
                                        variantNameIterate.map(vn => {
                                            
                                                vselector += \`if (variantType == '\$\{vn.toLowerCase()\}') {
                                                    document.querySelectorAll('.multi-level-variant-button div').forEach(e => {
                                                        if (e.getAttribute('data-\$\{vn.toLowerCase()\}')) {
                                                            e.classList.remove('active_plg_multi')
                                                        }
                                                    });
                                                    document.querySelector('.multi-level-variant.\$\{vn.toLowerCase()\}').value = element.getAttribute('data-\$\{vn.toLowerCase()\}');
                                                    element.classList.toggle('active_plg_multi');
                                                }\`
                                            
                                        }).join('')

                                        vselector += \`
                                        
                                        toSelect("\$\{values._meta.htmlID\}")
                                        } catch (e) { }
                                    }<\\/script>\`
                                }
                                    
                                    
                                    if(values.autoConvert){
                                        renderVariant += addAutoConvert
                                    }
                                     if(compiledVariant !== 0){
                                        return renderVariant += vselector;
                                    } else {
                                        return renderVariant 
                                    }
                                } else {
                                    return \`
                                        <div style="text-align: center">
                                            <span>Add Variant on the left side.</span>
                                        </div>
                                    \`
                                }
                            } else {
                                return \`
                                    <div style="text-align: center">
                                        <span>Add Variant on the left side.</span>
                                    </div>
                                \`
                            }
                        }
                    }
                }
            });   

            //////////////////// End Testing Duplicate Variant //////////////////////

            ${editorTools.getMultipleGenieVariantWidget(this.props.session.getCurrentUser, isUpsellOrDownsell)}
            console.log("47, New Genie Multiple Variant");
            unlayer.registerTool({
                type: 'old_multiple_variant_tools',
                category: 'contents',
                label: 'Old Genie Variant',
                icon: '<svg aria-hidden="true" data-prefix="fab" data-icon="wpforms" fill="#fff" class="svg-inline--fa fa-wpforms fa-w-14 fa-3x" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d=" M 224 32 C 180.164 32 146.07 52.461 146.07 79.736 C 146.07 92.4 153.863 99.223 165.552 103.119 L 224 69.995 L 282.448 103.119 C 295.112 99.223 301.93 91.43 301.93 78.766 C 301.93 52.464 267.836 32 224 32 L 224 32 L 224 32 L 224 32 Z M 224 88.507 C 224 88.507 194.776 105.056 185.035 110.901 L 185.035 138.184 L 185.035 146.955 L 188.935 148.896 L 224 166.438 L 259.065 148.896 L 262.965 146.955 L 262.965 138.184 L 262.965 110.901 C 253.224 106.03 224 89.481 224 88.507 L 224 88.507 L 224 88.507 L 224 88.507 Z M 152.881 151.826 C 78.847 165.463 29.174 197.595 29.174 233.637 C 29.174 275.525 109.045 275.533 109.045 275.533 C 168.467 275.533 202.577 254.109 231.801 234.627 C 235.697 231.704 240.556 228.774 244.453 226.826 L 136.328 226.826 L 136.328 207.343 L 301.93 207.343 L 301.93 226.826 C 280.5 226.826 263.943 237.542 242.512 251.179 C 239.59 253.128 237.634 254.102 234.712 256.05 C 259.065 269.688 285.37 275.533 321.413 275.533 C 321.413 275.533 418.826 274.551 418.826 233.637 C 418.826 197.595 369.153 165.463 295.119 151.826 L 224 187.861 L 152.881 151.826 L 152.881 151.826 L 152.881 151.826 Z M 215.229 267.732 C 188.927 282.344 155.807 295.015 108.075 295.015 L 107.104 295.015 C 112.949 332.032 127.557 386.583 171.393 431.393 L 194.776 431.393 C 224.974 431.393 264.921 423.608 285.378 405.1 C 287.326 403.151 290.241 401.192 292.189 398.269 C 292.189 362.226 319.465 324.232 331.154 306.697 L 332.125 304.757 C 334.073 300.86 336.017 297.938 337.966 295.015 L 321.413 295.015 C 279.525 295.015 245.427 286.24 215.229 267.732 L 215.229 267.732 Z M 296.089 420.682 C 270.762 443.087 225.948 450.876 194.776 450.876 L 193.806 450.876 C 219.133 468.41 251.276 480.1 292.189 480.1 C 326.284 480.1 357.456 469.388 374.99 459.647 L 407.144 441.135 L 370.12 441.135 L 365.249 441.135 L 351.607 441.135 C 336.021 441.135 321.413 442.101 306.801 433.334 C 301.93 429.438 299.012 425.552 296.089 420.682 Z "></path></svg>',        
                values: {},
                options: {
                    variant: {
                        title: 'POD Multiple Variant Genie | Settings', //april12
                        position: 1,
                        options: {
                            "activatePOD": {
                                "label": "Use Genie POD",
                                "defaultValue": true,
                                "widget": "toggle"
                            },
                            "VariantImage": {
                                "label": "POD Design",
                                "defaultValue": {
                                    "url": "",
                                    "width": 500,
                                    "height": 100
                                },
                                "widget": "image"
                            },
                            "multiple_variant" : {
                                "label": "Multiple Variants",
                                "defaultValue": "",
                                "widget": "multiple_genie_variants"
                            },                            
                            "highlightColor": {
                                "label": "Border Color",
                                "defaultValue": "#121212",
                                "widget": "color_picker"
                            },
                            "qtyfontColor": {
                                "label": "Size Button Font Color",
                                "defaultValue": "#121212",
                                "widget": "color_picker"
                            },
                            "qtyBGColor": {
                                "label": "Size Button Background Color",
                                "defaultValue": "#26c686",
                                "widget": "color_picker"
                            },
                            "colors_size": {
                                "label": "Color & Size Label Font Size",
                                "defaultValue": "15px",
                                "widget": "px"
                            },
                            "colors_color": {
                                "label": "Color & Size Label Font Color",
                                "defaultValue": "#121212",
                                "widget": "color_picker"
                            },
                            "colors_label": {
                                "label": "Colors Label",
                                "defaultValue": "Colors",
                                "widget": "text"
                            },                            
                            "sizes_label": {
                                "label": "Sizes Label",
                                "defaultValue": "Sizes",
                                "widget": "text"
                            },
                        }
                    }
                },
                renderer: {
                    Viewer: unlayer.createViewer({
                        render(values) {
                            
                            let variant = values.multiple_variant ? JSON.parse(values.multiple_variant) : { selected_iso2: "US", useColors: true, useSizes: true };
                            
                            return \`                            
                            <div class="country-selector">
                                <div class="row">
                                    
                                    <div class="col-12" style="display: flex; align-items: center; justify-content: center;flex-flow: column; ">
                                        \$\{variant.useColors ? \`<select class="multi-level-variant color" style="display: none;"></select>
                                        <p style="align-self: flex-start; font-size: \$\{values.colors_size\}; color: \$\{values.colors_color\};">\$\{values.colors_label\}</p>
                                        <div style="display: flex; flex-flow: row; flex-wrap: wrap; width: 100%; justify-content: center;"
                                            class="multi-level-variant-button">
                                            \$\{variant.colors ? variant.colors.map( (color,index) => {
                                                return \`
                                                <div data-color="\$\{color\}" onclick="updateMultiple('color',this)"
                                                style="box-shadow: 1px 1px 1px 1px #abababbf; border-radius: 5px;border:\$\{index == 0 ? '2px solid ' + values.highlightColor+ ' !important' : 'none'\} ; padding: 5px; background-color: \$\{color\}; margin-bottom: 1rem; max-width: 45%; width: 15%; height: 2.4rem; line-height: 1; margin-right: 0.865rem;">
                                            </div>                                                
                                                \`;
                                            }).join("") : \`<span>No Colors Added</span>\` \}                                          
                                        </div>\` : \`<span></span>\`\}
                                        \$\{variant.useSizes ? \`<select class="multi-level-variant size" style="display: none;"></select>
                                        <p style="align-self: flex-start; font-size: \$\{values.colors_size\}; color: \$\{values.colors_color\};">\$\{values.sizes_label\}</p>
                                        <div style="display: flex; flex-flow: row; flex-wrap: wrap; width: 100%; justify-content: center;"
                                            class="multi-level-variant-button">
                                            \$\{variant.sizes ? variant.sizes.map((size, index) => {
                                                return \`
                                                <div data-size="\$\{size\}" onclick="updateMultiple('size',this)"
                                                style="cursor: pointer; color: \$\{values.qtyfontColor\};border:\$\{index == 0 ? '2px solid ' + values.highlightColor+ ' !important' : \`2px solid \$\{values.qtyBGColor\} !important\`\} ;box-shadow: 1px 1px 1px 1px #abababbf; border-radius: 5px; padding: 5px; background-color: \$\{values.qtyBGColor\}; margin-bottom: 1rem; max-width: 45%; line-height: 1; margin-right: 0.865rem;">
                                                \$\{size\}
                                                </div>                                                      
                                                \`;
                                            }).join("") : \`<span>No Sizes Added</span>\` \}                                             
                                        </div>\` : \`<span></span>\`\}
                                    </div>
                                </div>
                            </div>                         
                            \`;
                        }
                    }),
                    exporters: {
                        web: function (values) {
                            let variant = values.multiple_variant ? JSON.parse(values.multiple_variant) : { selected_iso2: "US", useColors: true, useSizes: true };
                            return \`
                            <style>
                            .active_plg_multi {
                                border: 2px solid \$\{values.highlightColor\} !important;
                            }
                            </style>
                            <div class="country-selector">
                                <div class="row">
                                    
                                    <div class="col-12" style="display: flex; align-items: center; justify-content: center;flex-flow: column; ">
                                        \$\{variant.useColors ? \`<input type="hidden" value="\$\{variant.colors[0]\}" class="multi-level-variant color" style="display: none;">
                                        <p style="align-self: flex-start; font-size: \$\{values.colors_size\}; color: \$\{values.colors_color\};">\$\{values.colors_label\}</p>
                                        <div style="display: flex; flex-flow: row; flex-wrap: wrap; width: 100%; justify-content: center;"
                                            class="multi-level-variant-button">
                                            \$\{variant.colors ? variant.colors.map( (color, index) => {
                                                return \`
                                                <div data-color="\$\{color\}" class="\$\{index == 0 ? 'active_plg_multi' : ''\}" onclick="updateMultiple('color',this)"
                                                style="cursor: pointer; box-shadow: 1px 1px 1px 1px #abababbf; border-radius: 5px; padding: 5px; background-color: \$\{color\}; margin-bottom: 1rem; max-width: 45%; width: 15%; height: 2.4rem; margin-right: 0.865rem; line-height: 1;">
                                            </div>                                                
                                                \`;
                                            }).join("") : \`<span></span>\` \}                                  
                                        </div>\` : \`<span></span>\` \}
                                        \$\{variant.useSizes ? \`<input type="hidden" value="\$\{variant.sizes[0]\}" class="multi-level-variant size" style="display: none;">
                                        <p style="align-self: flex-start; font-size: \$\{values.colors_size\}; color: \$\{values.colors_color\}">\$\{values.sizes_label\}</p>
                                        <div style="display: flex; flex-flow: row; flex-wrap: wrap; width: 100%; justify-content: center;"
                                            class="multi-level-variant-button">                                        
                                            \$\{variant.sizes.map((size, index) => {
                                                return \`
                                                <div data-size="\$\{size\}" class="\$\{index == 0 ? 'active_plg_multi' : ''\}" onclick="updateMultiple('size',this)"
                                                style="border: 2px solid \$\{values.qtyBGColor\}; cursor: pointer; color: \$\{values.qtyfontColor\};box-shadow: 1px 1px 1px 1px #abababbf; border-radius: 5px; padding: 5px; background-color: \$\{values.qtyBGColor\}; margin-bottom: 1rem; max-width: 45%; margin-right: 0.865rem; line-height: 1;">
                                                \$\{size\}
                                                </div>                                                      
                                                \`;
                                            }).join("")\}                                             
                                        </div>\` : \`<span></span>\`\}
                                    </div>
                                </div>
                            </div>         
                            <script>
                            let isUsingPOD = \$\{values.activatePOD\};
                            let design_url = "\$\{values.VariantImage.url\}";
                            let multiple_variant_name = \$\{variant.useSizes ? \`document.querySelector('.multi-level-variant.size').value + " - "\` : \`""\`\}  + \$\{variant.useColors ? \`document.querySelector('.multi-level-variant.color').value + " - "\` : \`""\`\};
                            function updateMultiple(variantType, element) {
                                try{
                                    plg_selectedVariant.multiple_variant = '';
                                }catch(e) {}
                                if (variantType == 'color') {
                                    document.querySelectorAll('.multi-level-variant-button div').forEach(e => {
                                        if (e.getAttribute('data-color')) {
                                            e.classList.remove('active_plg_multi')
                                        }
                                    });
                                    document.querySelector('.multi-level-variant.color').value = element.getAttribute('data-color');

                                    element.classList.toggle('active_plg_multi');
                                }
                                if (variantType == 'size') {
                                    document.querySelectorAll('.multi-level-variant-button div').forEach(e => {
                                        if (e.getAttribute('data-size')) {
                                            e.classList.remove('active_plg_multi')
                                        }
                                    });
                                    document.querySelector('.multi-level-variant.size').value = element.getAttribute('data-size');

                                    element.classList.toggle('active_plg_multi');
                                }

                                multiple_variant_name = \$\{variant.useSizes ? \`document.querySelector('.multi-level-variant.size').value + " - "\` : \`""\`\}  + \$\{variant.useColors ? \`document.querySelector('.multi-level-variant.color').value + " - " \`  : \`""\`\};
                                
                            }
                            </script>                
                            \`;
                        }
                    }
                }
            });
            ${editorTools.getMultiCountryVariantCreditCardWidget(this.props.session.getCurrentUser, isUpsellOrDownsell)}            
            console.log("7. New Multi Country Variant");            
            unlayer.registerTool({
                type: 'multi_variants_two',
                category: 'contents',
                label: 'Genie Variant',
                icon: '<svg aria-hidden="true" data-prefix="fab" data-icon="wpforms" fill="#fff" class="svg-inline--fa fa-wpforms fa-w-14 fa-3x" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d=" M 224 32 C 180.164 32 146.07 52.461 146.07 79.736 C 146.07 92.4 153.863 99.223 165.552 103.119 L 224 69.995 L 282.448 103.119 C 295.112 99.223 301.93 91.43 301.93 78.766 C 301.93 52.464 267.836 32 224 32 L 224 32 L 224 32 L 224 32 Z M 224 88.507 C 224 88.507 194.776 105.056 185.035 110.901 L 185.035 138.184 L 185.035 146.955 L 188.935 148.896 L 224 166.438 L 259.065 148.896 L 262.965 146.955 L 262.965 138.184 L 262.965 110.901 C 253.224 106.03 224 89.481 224 88.507 L 224 88.507 L 224 88.507 L 224 88.507 Z M 152.881 151.826 C 78.847 165.463 29.174 197.595 29.174 233.637 C 29.174 275.525 109.045 275.533 109.045 275.533 C 168.467 275.533 202.577 254.109 231.801 234.627 C 235.697 231.704 240.556 228.774 244.453 226.826 L 136.328 226.826 L 136.328 207.343 L 301.93 207.343 L 301.93 226.826 C 280.5 226.826 263.943 237.542 242.512 251.179 C 239.59 253.128 237.634 254.102 234.712 256.05 C 259.065 269.688 285.37 275.533 321.413 275.533 C 321.413 275.533 418.826 274.551 418.826 233.637 C 418.826 197.595 369.153 165.463 295.119 151.826 L 224 187.861 L 152.881 151.826 L 152.881 151.826 L 152.881 151.826 Z M 215.229 267.732 C 188.927 282.344 155.807 295.015 108.075 295.015 L 107.104 295.015 C 112.949 332.032 127.557 386.583 171.393 431.393 L 194.776 431.393 C 224.974 431.393 264.921 423.608 285.378 405.1 C 287.326 403.151 290.241 401.192 292.189 398.269 C 292.189 362.226 319.465 324.232 331.154 306.697 L 332.125 304.757 C 334.073 300.86 336.017 297.938 337.966 295.015 L 321.413 295.015 C 279.525 295.015 245.427 286.24 215.229 267.732 L 215.229 267.732 Z M 296.089 420.682 C 270.762 443.087 225.948 450.876 194.776 450.876 L 193.806 450.876 C 219.133 468.41 251.276 480.1 292.189 480.1 C 326.284 480.1 357.456 469.388 374.99 459.647 L 407.144 441.135 L 370.12 441.135 L 365.249 441.135 L 351.607 441.135 C 336.021 441.135 321.413 442.101 306.801 433.334 C 301.93 429.438 299.012 425.552 296.089 420.682 Z "></path></svg>',        
                values: {},
                options: {
                    variant: {
                        title: "Genie Variant | Settings", //april12
                        position: 1,
                        options: {
                            "product_name": {
                                "label": "Product Name (will overwrite if use shopify product)",
                                "defaultValue": "Product Name",
                                "widget": "text"
                            },
                            "quantity_label": {
                                "label": "Quantity Label",
                                "defaultValue": "Quantity",
                                "widget": "text"
                            },
                            "qtyalign": {
                                "label": "Quality Label Alignment",
                                "defaultValue": "center",
                                "widget": "alignment"
                            },  
                            "qtyfontSize": {
                                "label": "Font Size",
                                "defaultValue": "15px",
                                "widget": "px"
                            },
                            "qtyfontColor": {
                                "label": "Font Color",
                                "defaultValue": "#121212",
                                "widget": "color_picker"
                            },
                            "qtyBGColor": {
                                "label": "Quantity Background Color",
                                "defaultValue": "#26c686",
                                "widget": "color_picker"
                            },
                            "qtyInputColor": {
                                "label": "Quantity Font Color",
                                "defaultValue": "#fff",
                                "widget": "color_picker"
                            },                                                     
                            "qtyTextfontSize": {
                                "label": "Quantity Input Font Size",
                                "defaultValue": "15px",
                                "widget": "px"
                            },                           
                            "multi_variants": {
                                "label": "Variant",
                                "defaultValue": "",
                                "widget": "multi_variants_cc"
                            },
                            "styleColors": {
                                "label": "Ribbon Colors",
                                "defaultValue": {
                                    "color": "#FFF",
                                    "backgroundColor": "#14d889"
                                },
                                "widget": "button_color"
                            },
                            "fontSize": {
                                "label": "Font Size",
                                "defaultValue": "15px",
                                "widget": "px"
                            },
                            "fontColor": {
                                "label": "Font Color",
                                "defaultValue": "#121212",
                                "widget": "color_picker"
                            },
                            "compareFontColor": {
                                "label": "Compare Font Color",
                                "defaultValue": "#ff0000",
                                "widget": "color_picker"
                            },
                            "hoverColor": {
                                "label": "Hover Color",
                                "defaultValue": "#fef9ae",
                                "widget": "color_picker"
                            }
                        },
                    }
                },
                renderer: {
                    Viewer: unlayer.createViewer({
                        render(values) {
                            let variant = values.multi_variants ? JSON.parse(values.multi_variants) : "";
                            if(!variant) return \`<h3 style="text-align: center;">Please Configure Variant</h3>\`;
                            let selected_iso2 = variant.selected_iso2;
                            if(!variant[selected_iso2]) return \`<h3 style="text-align: center;">Please Configure Variant</h3>\`;
                            let selected_variant = variant[selected_iso2].variants;
                            let selected_country = ${JSON.stringify(points.cod_available_country("no_country"))};
                            if(selected_iso2) selected_country = selected_country.filter(e => e.iso2 === selected_iso2)[0];
                            let content_style = variantStyleFn(values);
                            let selected_style = variant[selected_iso2];   
                            let activateCOD = variant[selected_iso2].activateCOD;                         
                            let activateCreditCard = variant[selected_iso2].activateCreditCard;                         
                            function insertRibbon(text) {
                                if (selected_style.selected_style == 2 || text) {
                                    return \`<div class="selected_style_content_2"><div><label>\$\{text || selected_style.ribbon_text\}</label></div></div>\`;
                                } else if (selected_style.selected_style == 1) {
                                    return \`<img class="selected_style_content_1" src="https://cdn.productlistgenie.com/images/1559588850495share.png">\`;
                                } else return "";
                            }
                            return \`
                                \$\{content_style\}
                                <style>
                                button.cc_btn_quantity {
                                    border: none;
                                    width: 100%;
                                    height: 100%;
                                    background-color: \$\{values.qtyBGColor\};
                                    color: \$\{values.qtyInputColor\};
                                    font-size: \$\{values.qtyTextfontSize\};
                                    text-align: center;
                                }
                                input.cc_btn_quantity {
                                    border: none;
                                    width: 100%;
                                    height: 100%;
                                    background-color: \$\{values.qtyBGColor\};
                                    color: \$\{values.qtyInputColor\};
                                    font-size: \$\{values.qtyTextfontSize\};
                                    text-align: center;
                                }                                
                                </style>
                                <div class="country-selector">
                                    \$\{Object.keys(variant).filter(e => e.length == 2).map(country => {
                                        let cObject = ${JSON.stringify(points.cod_available_country("no_country"))}.filter(e => e.iso2 === country)[0];
                                        return \`<Label class="\$\{selected_iso2 === country ? "plg_variants_active" : ""\}"><img src="\$\{cObject.flag\}" style="width: 20px; height: 20px; margin-right: 5px;" /> \$\{cObject.name\}</label>\`;
                                    }).join("")\}
                                </div>
                                <div class="row">
                                <div class="col-9">
                                \$\{selected_variant.map((v, i) => {
                                    let is_completed = v.quantity && v.name && v.price ? true : false;                                    
                                    if(!is_completed) return \`<div class="row plg_variants_no_result" style="justify-content: center; margin: 10px;">Please Complete the variant to display result</div>\`;
                                    // start discount computation
                                    let compare_price = v.compare, selling_price = v.price, discounted = 0;
                                    if((selling_price && compare_price) && (selling_price < compare_price)) discounted = 100 - parseInt(selling_price / compare_price * 100);
                                    // end discount computation
                                    if(i == 0 && activateCOD ) {
                                    return \`
                                        <label class="row plg_variants" style="\$\{v.selected ? "background-color: " + values.hoverColor : ""\}">
                                            \$\{v.selected || v.ribbon_text ? insertRibbon(v.ribbon_text) : ""\}                                                                                        
                                            <div class="col-2 u_column">                                               
                                                <input class="variant"  name="variant" type="radio" \$\{v.selected ? "checked" : ""\} />
                                            </div>
                                            <div class="col-3 u_column">
                                                <span class="variant_name">\$\{v.name\}</span>                                                
                                                \$\{discounted ? \`<span class="variant_compare">(\$\{discounted\}% Discount)</span>\` : ""\}
                                            </div>
                                            <div class="col-3 u_column" style="text-align: right">
                                                <span class="variant_price">\$\{selected_iso2 ? selected_country.cs : "$"\}\$\{v.price\}</span>
                                                \$\{discounted ? \`<strike class="variant_compare">\$\{selected_iso2 ? selected_country.cs : "$"\}\$\{v.compare\}</strike>\` : ""\}
                                            </div>
                                        </label>
                                    \`;
                                    } else if(i == 1 && activateCreditCard){
                                        return \`
                                        <label class="row plg_variants" style="\$\{v.selected ? "background-color: " + values.hoverColor : ""\}">
                                            \$\{v.selected || v.ribbon_text ? insertRibbon(v.ribbon_text) : ""\}                                                                                        
                                            <div class="col-2 u_column">                                               
                                                <input class="variant"  name="variant" type="radio" \$\{v.selected ? "checked" : ""\} />
                                            </div>
                                            <div class="col-3 u_column">
                                                <span class="variant_name">\$\{v.name\}</span>                                                
                                                \$\{discounted ? \`<span class="variant_compare">(\$\{discounted\}% Discount)</span>\` : ""\}
                                            </div>
                                            <div class="col-3 u_column" style="text-align: right">
                                                <span class="variant_price">\$\{selected_iso2 ? selected_country.cs : "$"\}\$\{v.price\}</span>
                                                \$\{discounted ? \`<strike class="variant_compare">\$\{selected_iso2 ? selected_country.cs : "$"\}\$\{v.compare\}</strike>\` : ""\}
                                            </div>
                                        </label>
                                    \`;                                        
                                    }else{
                                        return \`<div></div>\`;
                                    }                                   
                                }).join("")\}
                                </div> 
                                <div class="col-3" style="justify-content: center;align-content: center; display: grid; padding-left: 0.876rem;">
                                <div style="text-align: \$\{values.qtyalign\};">
                                    <label for="" style="font-size: \$\{values.qtyfontSize\} ; color: \$\{values.qtyfontColor\};">\$\{values.quantity_label\}</label>
                                <div class="row" style="box-shadow: 1px 1px 1px 1px #abababbf; border-radius: 5px; padding: 5px; background-color: \$\{values.qtyBGColor\}; max-width: 10rem;height: 3rem;">
                                    <div class="col-3"> <button style="height: 100%;" type="button"
                                            data-cc-quantity-btn="-" class="cc_btn_quantity">-</button>
                                    </div>
                                    <div class="col-6" style="text-align: center;">
                                        <input type="text" min="1" name="" value="1" step="1" class="cc_btn_quantity"
                                            onkeypress='return event.charCode >= 48 && event.charCode <= 57'
                                            id="cc_quantity"                                                        
                                            readonly>
                                    </div>
                                    <div class="col-3"> <button style="height: 100%;" type="button"
                                            data-cc-quantity-btn="+" class="cc_btn_quantity">+</button>
                                    </div>
                                </div>                                      
                                </div>
                                </div>
                                </div>

                            \`;
                        }
                    }),
                    exporters: {
                        web: function (values) {
                            
                            let variant = values.multi_variants ? JSON.parse(values.multi_variants) : "";
                            if(!variant) return \`<h3 style="text-align: center;">Please Configure Variant</h3>\`;
                            let selected_iso2 = variant.selected_iso2;
                            if(!variant[selected_iso2]) return \`<h3 style="text-align: center;">Please Configure Variant</h3>\`;
                            let selected_variant = variant[selected_iso2].variants;
                            let activateCOD = variant[selected_iso2].activateCOD;                         
                            let activateCreditCard = variant[selected_iso2].activateCreditCard; 
                            let selected_country = ${JSON.stringify(points.cod_available_country("no_country"))}//.filter(e => e.iso2 === selected_iso2)[0];
                            if(selected_iso2) selected_country = selected_country.filter(e => e.iso2 === selected_iso2)[0];
                            let content_style = variantStyleFn(values);
                            function generateVariantDOM(location, array, country, selected_style) {
                                function insertRibbon(text) {
                                    if (selected_style.selected_style == 2 || text) {
                                        return \`<div class="selected_style_content_2"><div><label>\$\{text || selected_style.ribbon_text\}</label></div></div>\`;
                                    } else if (selected_style.selected_style == 1) {
                                        return \`<img class="selected_style_content_1" src="https://cdn.productlistgenie.com/images/1559588850495share.png">\`;
                                    } else return "";
                                }
                                

                                return array.map((v , i )=> {
                                    let currencyGlobal = ${JSON.stringify(currencyGlobal)};
                                    let activateCOD = selected_style.activateCOD;                         
                                    let activateCreditCard = selected_style.activateCreditCard; 
                                    let is_completed = v.quantity && v.name && v.price ? true : false;
                                    if(!is_completed) return \`<div class="row plg_variants_no_result" style="justify-content: center; margin: 10px;">Please Complete the variant to display result</div>\`;
                                    // start discount computation
                                    let compare_price = v.compare, selling_price = v.price, discounted = 0;
                                    if((selling_price && compare_price) && (selling_price < compare_price)) discounted = 100 - parseInt(selling_price / compare_price * 100);
                                    // end discount computation
                                    if(i == 0 && activateCOD) {
                                        return \`
                                        <label class="row plg_variants \$\{v.selected ? "plg_variants_active" : ""\}"
                                            data-cword="\$\{location ? country.cw : "USD"\}"
                                            data-ccdiscount="\$\{9 * currencyGlobal.rates[country.cw]\}"
                                            data-csymbol="\$\{location ? country.cs : "$"\}"
                                            data-quantity="\$\{v.quantity\}"
                                            data-name="\$\{v.name\}"   
                                            data-payment="cod"                                         
                                            data-price="\$\{v.price\}"
                                            data-baseprice="\$\{v.price\}"
                                            data-sku="\$\{v.sku || ""\}"
                                            data-shopifyid="\$\{v.id || ""\}"
                                            data-tags="\$\{v.tags || ""\}">
                                            \$\{v.selected || v.ribbon_text ? insertRibbon(v.ribbon_text) : ""\}
                                            <div class="col-2 u_column">
                                                <input class="variant" name="variant" type="radio" \$\{v.selected ? "checked" : ""\} onclick="getSelectedVariant()" />
                                            </div>
                                            <div class="col-7 u_column">
                                                <span class="variant_name">\$\{v.name\}</span>                                                
                                                \$\{discounted ? \`<span class="variant_compare">(\$\{discounted\}% Discount)</span>\` : ""\}
                                            </div>
                                            <div class="col-3 u_column" style="text-align: right">
                                                <span class="variant_price">\$\{location ? country.cs : "$"\}\$\{v.price\}</span>
                                                \$\{discounted ? \`<br/><strike class="variant_compare">\$\{location ? country.cs : "$"\}\$\{v.compare\}</strike>\` : ""\}
                                            </div>
                                        </label>
                                       \`;
                                    }else if(i == 1 && activateCreditCard) {
                                        return \`
                                        <label class="row plg_variants \$\{v.selected ? "plg_variants_active" : ""\}"
                                            data-cword="\$\{location ? country.cw : "USD"\}"
                                            data-ccdiscount="\$\{9 * currencyGlobal.rates[country.cw]\}"
                                            data-csymbol="\$\{location ? country.cs : "$"\}"
                                            data-quantity="\$\{v.quantity\}"
                                            data-payment="credit-card"
                                            data-name="\$\{v.name\}"                                            
                                            data-price="\$\{v.price\}"
                                            data-baseprice="\$\{v.price\}"
                                            data-sku="\$\{v.sku || ""\}"
                                            data-shopifyid="\$\{v.id || ""\}"
                                            data-tags="\$\{v.tags || ""\}">
                                            \$\{v.selected || v.ribbon_text ? insertRibbon(v.ribbon_text) : ""\}
                                            <div class="col-2 u_column">
                                                <input class="variant" name="variant" type="radio" \$\{v.selected ? "checked" : ""\} onclick="getSelectedVariant()" />
                                            </div>
                                            <div class="col-7 u_column">
                                                <span class="variant_name">\$\{v.name\}</span>                                                
                                                \$\{discounted ? \`<span class="variant_compare">(\$\{discounted\}% Discount)</span>\` : ""\}
                                            </div>
                                            <div class="col-3 u_column" style="text-align: right">
                                                <span class="variant_price">\$\{location ? country.cs : "$"\}\$\{v.price\}</span>
                                                \$\{discounted ? \`<br/><strike class="variant_compare">\$\{location ? country.cs : "$"\}\$\{v.compare\}</strike>\` : ""\}
                                            </div>
                                        </label>
                                       \`;
                                    }else {
                                        return \`<div></div>\`
                                    }
                                    
                                }).join("");
                            }
                            return \`
                                \$\{content_style\}
                                <style>
                                button.cc_btn_quantity {
                                    border: none;
                                    width: 100%;
                                    height: 100%;
                                    cursor: pointer;
                                    background-color: \$\{values.qtyBGColor\};
                                    color: \$\{values.qtyInputColor\};
                                    font-size: \$\{values.qtyTextfontSize\};
                                    text-align: center;
                                }
                                input.cc_btn_quantity {
                                    border: none;
                                    width: 100%;
                                    height: 100%;
                                    background-color: \$\{values.qtyBGColor\};
                                    color: \$\{values.qtyInputColor\};
                                    font-size: \$\{values.qtyTextfontSize\};
                                    text-align: center;
                                }                                
                                </style>
                                <div class="country-selector">
                                    \$\{Object.keys(variant).filter(e => e.length == 2).map(country => {
                                        let cObject = ${JSON.stringify(points.cod_available_country("no_country"))}.filter(e => e.iso2 === country)[0];
                                        return \`<Label class="\$\{selected_iso2 === country ? "plg_variants_active" : ""\}" onclick="button_change_location(this)" data-iso2="\$\{cObject.iso2\}" data-iso3="\$\{cObject.iso3\}"><img src="\$\{cObject.flag\}" style="width: 20px; height: 20px; margin-right: 5px;" /> \$\{cObject.name\}</label>\`;
                                    }).join("")\}
                                </div>
                                <div class="row">
                                    <div class="col-lg-9 col-sm-12">
                                        <div class="variant_container">
                                        \$\{generateVariantDOM(selected_country, selected_variant, selected_country, variant[selected_iso2])\}
                                        </div>  
                                    </div>
                                    <div class="col-lg-3 col-sm-12" style="justify-content: center;align-content: center; display: grid; padding-left: 0.876rem;">
                                    <div style="text-align: \$\{values.qtyalign\};">
                                        <label for="" style="font-size: \$\{values.qtyfontSize\} ; color: \$\{values.qtyfontColor\}">\$\{values.quantity_label\}</label>
                                        <div class="row" style="box-shadow: 1px 1px 1px 1px #abababbf; border-radius: 5px; padding: 5px; background-color: \$\{values.qtyBGColor\};max-width: 10rem;height: 3rem;">
                                            <div class="col-3"> <button style="height: 100%;" type="button"
                                                    data-cc-quantity-btn="-" class="cc_btn_quantity">-</button>
                                            </div>
                                            <div class="col-6" style="text-align: center;">
                                                <input type="text" min="1" name="" value="1" step="1" class="cc_btn_quantity"
                                                onkeypress='return event.charCode >= 48 && event.charCode <= 57'
                                                id="cc_quantity"                                               
                                                readonly>
                                            </div>
                                            <div class="col-3"> <button style="height: 100%;" type="button"
                                                data-cc-quantity-btn="+" class="cc_btn_quantity">+</button>
                                            </div>
                                        </div>                                                                               
                                    </div>
                                    </div>
                                </div>
                                <script>
                                    let multivariantIsUsingCC = false;
                                    let warrantyPrice = { price: 0, variantname: "", variantid: "", tag: "" }, plg_price = 0, plg_ccdiscount = 0, plg_selectedVariant = {};
                                    let new_quantity = 0;

                                    document.querySelectorAll('.cc_btn_quantity').forEach(el => {
                                        el.addEventListener("click", (event) => {
                                            let cc_quantity = document.querySelector("#cc_quantity").value;
                                            switch (el.getAttribute('data-cc-quantity-btn')) {
                                                case "+":
                                                    document.querySelector("#cc_quantity").value = parseInt(cc_quantity) + 1;
                                                    
                                                    break;
                                                case "-":
                                                    document.querySelector("#cc_quantity").value = cc_quantity > 1 ? parseInt(cc_quantity) - 1 : cc_quantity;
                                                    
                                                    break;
                                                default:
                                                    break;
                                            }
                                            let cc_new_val = document.querySelector("#cc_quantity").value;
                                            plg_selectedVariant.variant_qty = parseFloat(cc_new_val);
                                            document.querySelectorAll(".plg_variants").forEach(el => {
                                                el.setAttribute("data-quantity", cc_new_val);
                                                plg_selectedVariant.variant_qty = cc_new_val;

                                                if (el.querySelector("input[type=radio]").checked) {
                                                    let price = parseFloat(el.getAttribute("data-baseprice"));
                                                    let qty = parseInt(el.getAttribute("data-quantity"));
                                                    el.setAttribute("data-price", (price * qty).toFixed(2));
                                                    getSelectedVariant();
                                                }                                                
                                                changeOrderDetailsStatus();
                                            });
                                        })
                                    });                                    

                                    ["change", "keyup"].forEach((evt) => {
                                        document.querySelector("#cc_quantity").addEventListener(evt, (event) => {                                            
                                            new_quantity = event.target.value;
                                            if (new_quantity) {
                                                document.querySelectorAll(".plg_variants").forEach(el => {
                                                        el.setAttribute("data-quantity", new_quantity);
                                                        plg_selectedVariant.variant_qty = new_quantity;
                                                        changeOrderDetailsStatus();
                                                });
                                            }
                                        });
                                    })
                                    function multivariantupdatePriceOnDiscount() {
                                        // var toggleClass = (el, className) => el.classList.toggle(className);
                                        // document.querySelectorAll('.variant_container .plg_variants').forEach(el => {
                                        //     var discountedPrice =  parseFloat(el.getAttribute('data-price')) - (parseFloat(el.getAttribute('data-quantity')) * parseFloat(el.getAttribute('data-ccdiscount')))                                        
                                        //     el.querySelector('.variant_price').innerText = discountedPrice.toFixed(2) + el.getAttribute('data-csymbol')
                                        //     toggleClass(el.querySelector('.variant_price'), 'updating');
                                        //     setTimeout(function () {
                                        //         toggleClass(el.querySelector('.variant_price'), 'updating');
                                        //     }, 800);
    
                                        // });
                                    }                 
                                    
                                    function multivariantupdatePriceOnCOD() {
                                        // var toggleClass = (el, className) => el.classList.toggle(className);
                                        // document.querySelectorAll('.variant_container .plg_variants').forEach(el => {                                                                                
                                        //     el.querySelector('.variant_price').innerText = el.getAttribute('data-price') + el.getAttribute('data-csymbol')
                                        //     toggleClass(el.querySelector('.variant_price'), 'updating');
                                        //     setTimeout(function () {
                                        //         toggleClass(el.querySelector('.variant_price'), 'updating');
                                        //     }, 800);
    
                                        // });
                                    } 
                                    function getSelectedVariant() {
                                        let has_selected = false;
                                        document.querySelectorAll(".plg_variants").forEach(el => {
                                            try{
                                                if (document.querySelectorAll(".plg_variants")[0].querySelector("input[type=radio]").checked) {
                                                    // cod
                                                    showCODOnlyEvent();
                                                    multivariantIsUsingCC = false;
                                                    document.getElementById("submit_cod_form").classList.remove("prepaid");
                                                } 
                                                if (document.querySelectorAll(".plg_variants")[1].querySelector("input[type=radio]").checked) {
                                                    //credit cart
                                                    showCreditOnlyEvent();
                                                    multivariantIsUsingCC = true;
                                                    document.getElementById("submit_cod_form").classList.add("prepaid");
                                                } 
                                                if (!document.querySelectorAll(".plg_variants")[0].querySelector("input[type=radio]").checked
                                                    && !document.querySelectorAll(".plg_variants")[1].querySelector("input[type=radio]").checked) {
                                                    showCODOnlyEvent();
                                                    multivariantIsUsingCC = false;                
                                                    document.getElementById("submit_cod_form").classList.remove("prepaid");                                    
                                                    var genie_new_items_qty = document.getElementById("genie_new_items_qty");
                                                    var genie_new_items_price = document.getElementById("genie_new_items_price");
                                                    var genie_new_items_order_total = document.getElementById("genie_new_items_order_total");

                                                    genie_new_items_qty.innerText = "Items(0)";

                                                    genie_new_items_price.innerHTML = "0";

                                                    genie_new_items_order_total.innerText = "0";
                                                }                                                
                                            }catch(e){
                                                changeOrderDetailsStatus();
                                            }                                           
                                            if (el.querySelector("input[type=radio]").checked) {
                                                has_selected = true;
                                                el.classList.add("plg_variants_active");

                                                let paymentGenieType = el.getAttribute("data-payment");
                                                if(paymentGenieType == "cod"){
                                                    showCODOnlyEvent();
                                                }
                                                if(paymentGenieType == "credit-card"){
                                                    showCreditOnlyEvent();
                                                }
                                                el.setAttribute("data-quantity", document.querySelector("#cc_quantity").value);
                                                
                                                let cword = el.getAttribute("data-cword");
                                                let csymbol = el.getAttribute("data-csymbol");
                                                let sku = el.getAttribute("data-sku");
                                                let shopifyid = el.getAttribute("data-shopifyid");
                                                let tags = el.getAttribute("data-tags");
                                                let quantity = parseInt(el.getAttribute("data-quantity"));
                                                let name = el.getAttribute("data-name");
                                                let price = parseFloat(el.getAttribute("data-baseprice")) * quantity;
                                                let ccdiscount = parseFloat(el.getAttribute("data-ccdiscount"));
                                                el.setAttribute("data-price", price);

                                                let isHaveShippingFee = typeof shippingFee !== "undefined" && shippingFee != 0 ? true : false;
                                                let isHaveTaxFee = typeof taxFee !== "undefined" && taxFee != 0 ? true : false;

                                                plg_selectedVariant = {
                                                    price: price + warrantyPrice.price + (isHaveShippingFee ? parseFloat(shippingFee) : 0) + (isHaveTaxFee ? parseFloat(taxFee) : 0),
                                                    variant_name: name + (warrantyPrice.price ? " + "+warrantyPrice.variantname : "") + (isHaveShippingFee ? " + Shippping Fee" : "") + (isHaveTaxFee ? " + Tax Fee" : ""),
                                                    product_name: "\$\{values.product_name\}",
                                                    variant_id: [shopifyid, warrantyPrice.variantid].filter(e => e).toString(),
                                                    tags: [...tags.split(/[ ,]+/), plgQS()].filter(item => item),
                                                    currency: { word: cword, code: csymbol },
                                                    variant_qty: quantity || 1,
                                                    variant_sku: sku,
                                                    ccdiscount: ccdiscount
                                                }
                                                plg_price = plg_selectedVariant.price;
                                                plg_ccdiscount = plg_selectedVariant.ccdiscount;
                                                plg_selectedVariant.price = csymbol + plg_selectedVariant.price.toString();

                                                if(warrantyPrice.tag && !plg_selectedVariant.tags.includes(warrantyPrice.tag)) plg_selectedVariant.tags.push(warrantyPrice.tag);
                                            } else {
                                                el.classList.remove("plg_variants_active");
                                                if (!has_selected) {
                                                    plg_selectedVariant = {};
                                                    plg_price = 0;
                                                }
                                            }
                                        });
                                        changeOrderDetailsStatus();
                                        multivariantIsUsingCC ? multivariantupdatePriceOnDiscount() : multivariantupdatePriceOnCOD();
                                    }

                                    function change_to_user_country(user_country) {
                                        let container = document.querySelector("#\$\{values._meta.htmlID\} .variant_container");
                                        let available_country = ${JSON.stringify(points.cod_available_country("no_country"))};
                                        let variants = \$\{values.multi_variants\};
                                        let text =  "\$\{values.styleText\}";
                                        variants.selected_iso2 = user_country;
                                        if(!variants[variants.selected_iso2]) variants.selected_iso2 = ""; // for the location that is not been setup yet by the seller make it USD or default
                                        container.innerHTML = generateVariantDOM(variants.selected_iso2, variants[variants.selected_iso2].variants, available_country.filter(e => e.iso2 === variants.selected_iso2)[0], variants[variants.selected_iso2]);
                                    }

                                    localStorage.removeItem("checkout_user_country_iso2");
                                    function button_change_location(element) {
                                        let container = document.querySelector("#\$\{values._meta.htmlID\} .country-selector");
                                        let iso2 = "", iso3 = "";
                                        if(element) {
                                            iso2 = element.getAttribute("data-iso2");
                                            iso3 = element.getAttribute("data-iso3");
                                            container.querySelector(".plg_variants_active").classList.remove("plg_variants_active");
                                            element.classList.add("plg_variants_active");
                                            localStorage.setItem("checkout_user_country_iso2", iso2);
                                            change_to_user_country(iso2);
                                        } else {
                                            iso2 = container.querySelector(".plg_variants_active").getAttribute("data-iso2");
                                            iso3 = container.querySelector(".plg_variants_active").getAttribute("data-iso3");
                                            localStorage.setItem("checkout_user_country_iso2", iso2);
                                        }

                                        // update country form hidden form and the form itself
                                        if (element) {
                                            document.querySelector('[name="country"]').value = iso3;
                                            reload_form(iso2, iso3);
                                            getSelectedVariant();
                                        } else {
                                            isExist("[name='country']", null, () => {
                                                let country_dom = document.querySelector('[name="country"]');
                                                if (country_dom.value !== iso3) {
                                                    isExist(null, "reload_form", () => reload_form(iso2, iso3));
                                                }
                                                country_dom.value = iso3;
                                                getSelectedVariant();
                                            });
                                        }
                                    }

                                    \$\{generateVariantDOM\}

                                    // start auto selection of country
                                    let getCookie = \$\{getCookie\}, isExist = \$\{isExist\};
                                    let iso2 = getCookie("loc_iso2") || "", iso3 = getCookie("loc_iso3") || "";
                                    if(iso2 && iso3 && document.querySelector("#\$\{values._meta.htmlID\} [data-iso2=" + iso2 + "]")) {
                                        document.querySelector("#\$\{values._meta.htmlID\} .country-selector").style.display = "none";
                                        isExist(null, "reload_form", () => {
                                            document.querySelector("#\$\{values._meta.htmlID\} [data-iso2=" + iso2 + "]").click();
                                        });
                                    } else {
                                        button_change_location(); // to re initialize cod form
                                    }
                                    // end auto selection of country
                                </script>
                            \`;
                        }
                    }
                }
            });

            ${editorTools.getMultiCountryVariantWidget(this.props.session.getCurrentUser, isUpsellOrDownsell)}
            console.log("6. Initializing multi variant...");
            unlayer.registerTool({
                type: 'multi_variants',
                category: 'contents',
                label: 'Multi Country',
                icon: '<svg class="svg-inline--fa fa-w-14 fa-w-20 fa-3x" fill="#ffffff" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><title>Commercial delivery </title><path d="M472.916,224H448.007a24.534,24.534,0,0,0-23.417-18H398V140.976a6.86,6.86,0,0,0-3.346-6.062L207.077,26.572a6.927,6.927,0,0,0-6.962,0L12.48,134.914A6.981,6.981,0,0,0,9,140.976V357.661a7,7,0,0,0,3.5,6.062L200.154,472.065a7,7,0,0,0,3.5.938,7.361,7.361,0,0,0,3.6-.938L306,415.108v41.174A29.642,29.642,0,0,0,335.891,486H472.916A29.807,29.807,0,0,0,503,456.282v-202.1A30.2,30.2,0,0,0,472.916,224Zm-48.077-4A10.161,10.161,0,0,1,435,230.161v.678A10.161,10.161,0,0,1,424.839,241H384.161A10.161,10.161,0,0,1,374,230.839v-.678A10.161,10.161,0,0,1,384.161,220ZM203.654,40.717l77.974,45.018L107.986,185.987,30.013,140.969ZM197,453.878,23,353.619V153.085L197,253.344Zm6.654-212.658-81.668-47.151L295.628,93.818,377.3,140.969ZM306,254.182V398.943l-95,54.935V253.344L384,153.085V206h.217A24.533,24.533,0,0,0,360.8,224H335.891A30.037,30.037,0,0,0,306,254.182Zm183,202.1A15.793,15.793,0,0,1,472.916,472H335.891A15.628,15.628,0,0,1,320,456.282v-202.1A16.022,16.022,0,0,1,335.891,238h25.182a23.944,23.944,0,0,0,23.144,17H424.59a23.942,23.942,0,0,0,23.143-17h25.183A16.186,16.186,0,0,1,489,254.182Z"/><path d="M343.949,325h7.327a7,7,0,1,0,0-14H351V292h19.307a6.739,6.739,0,0,0,6.655,4.727A7.019,7.019,0,0,0,384,289.743v-4.71A7.093,7.093,0,0,0,376.924,278H343.949A6.985,6.985,0,0,0,337,285.033v32.975A6.95,6.95,0,0,0,343.949,325Z"/><path d="M344,389h33a7,7,0,0,0,7-7V349a7,7,0,0,0-7-7H344a7,7,0,0,0-7,7v33A7,7,0,0,0,344,389Zm7-33h19v19H351Z"/><path d="M351.277,439H351V420h18.929a7.037,7.037,0,0,0,14.071.014v-6.745A7.3,7.3,0,0,0,376.924,406H343.949A7.191,7.191,0,0,0,337,413.269v32.975A6.752,6.752,0,0,0,343.949,453h7.328a7,7,0,1,0,0-14Z"/><path d="M393.041,286.592l-20.5,20.5-6.236-6.237a7,7,0,1,0-9.9,9.9l11.187,11.186a7,7,0,0,0,9.9,0l25.452-25.452a7,7,0,0,0-9.9-9.9Z"/><path d="M393.041,415.841l-20.5,20.5-6.236-6.237a7,7,0,1,0-9.9,9.9l11.187,11.186a7,7,0,0,0,9.9,0l25.452-25.452a7,7,0,0,0-9.9-9.9Z"/><path d="M464.857,295H420.891a7,7,0,0,0,0,14h43.966a7,7,0,0,0,0-14Z"/><path d="M464.857,359H420.891a7,7,0,0,0,0,14h43.966a7,7,0,0,0,0-14Z"/><path d="M464.857,423H420.891a7,7,0,0,0,0,14h43.966a7,7,0,0,0,0-14Z"/></svg>',
                values: {},
                options: {
                    variant: {
                        title: "Multi Country | Settings",
                        position: 1,
                        options: {
                            "product_name": {
                                "label": "Product Name (will overwrite if use shopify product)",
                                "defaultValue": "Product Name",
                                "widget": "text"
                            },
                            "multi_variants": {
                                "label": "Variant",
                                "defaultValue": "",
                                "widget": "multi_variants"
                            },
                            "styleColors": {
                                "label": "Ribbon Colors",
                                "defaultValue": {
                                    "color": "#FFF",
                                    "backgroundColor": "#14d889"
                                },
                                "widget": "button_color"
                            },
                            "fontSize": {
                                "label": "Font Size",
                                "defaultValue": "15px",
                                "widget": "px"
                            },
                            "fontColor": {
                                "label": "Font Color",
                                "defaultValue": "#121212",
                                "widget": "color_picker"
                            },
                            "compareFontColor": {
                                "label": "Compare Font Color",
                                "defaultValue": "#ff0000",
                                "widget": "color_picker"
                            },
                            "hoverColor": {
                                "label": "Hover Color",
                                "defaultValue": "#fef9ae",
                                "widget": "color_picker"
                            }
                        },
                    }
                },
                renderer: {
                    Viewer: unlayer.createViewer({
                        render(values) {
                            let variant = values.multi_variants ? JSON.parse(values.multi_variants) : "";
                            if(!variant) return \`<h3 style="text-align: center;">Please Configure Variant</h3>\`;
                            let selected_iso2 = variant.selected_iso2;
                            let useNewDisplay = variant.useNewDisplay ? variant.useNewDisplay : false;
                            if(!variant[selected_iso2]) return \`<h3 style="text-align: center;">Please Configure Variant</h3>\`;
                            let selected_variant = variant[selected_iso2].variants;
                            let selected_country = ${JSON.stringify(points.cod_available_country("no_country"))};
                            if(selected_iso2) selected_country = selected_country.filter(e => e.iso2 === selected_iso2)[0];
                            let content_style = variantStyleFn(values);
                            let selected_style = variant[selected_iso2];                            
                            function insertRibbon(text) {
                                if (selected_style.selected_style == 2 || text) {
                                    return \`<div class="selected_style_content_2"><div><label>\$\{text || selected_style.ribbon_text\}</label></div></div>\`;
                                } else if (selected_style.selected_style == 1) {
                                    return \`<img class="selected_style_content_1" src="https://cdn.productlistgenie.com/images/1559588850495share.png">\`;
                                } else return "";
                            }

                            function generateCardRibbon(text) {
                                if (selected_style.selected_style == 2 || text) {                                    
                                    return \`<div class="ribbon">\$\{text || selected_style.ribbon_text\}</div>\`
                                } else return "";
                            }

                            return \`
                                \$\{content_style\}                               
                                <div class="country-selector">
                                    \$\{Object.keys(variant).filter(e => e.length == 2).map(country => {
                                        let cObject = ${JSON.stringify(points.cod_available_country("no_country"))}.filter(e => e.iso2 === country)[0];
                                        return \`<Label class="\$\{selected_iso2 === country ? "plg_variants_active" : ""\}"><img src="\$\{cObject.flag\}" style="width: 20px; height: 20px; margin-right: 5px;" /> \$\{cObject.name\}</label>\`;
                                    }).join("")\}
                                </div>
                                <div class="pricer-table">                                
                                \$\{useNewDisplay ? selected_variant.map(v => {
                                    let is_completed = v.quantity && v.name && v.price ? true : false;
                                    if(!is_completed) return \`<div class="row plg_variants_no_result" style="justify-content: center; margin: 10px;">Please Complete the variant to display result</div>\`;
                                    // start discount computation
                                    let compare_price = v.compare, selling_price = v.price, discounted = 0;
                                    if((selling_price && compare_price) && (selling_price < compare_price)) discounted = 100 - parseInt(selling_price / compare_price * 100);
                                    // end discount computation
                                    return \`                                    
                                    <div class="pricer-childs" align="center">
                                        <div class="item \$\{v.selected ? 'selectedPriceTable' : ''\}">
                                            \$\{v.selected || v.ribbon_text ? generateCardRibbon(v.ribbon_text) : ""\}                                            
                                            <div class="heading">
                                                <h3 style="margin: 10px 0px;"><span class="variant_name">\$\{v.name\}</span></h3>
                                            </div>
                                            <p style="margin: 7px 0px;">\$\{v.subtitleheader ? v.subtitleheader : "" \}</p>
                                            <div class="row">
                                                <div style="height:300px; width: 300px; margin: 0px auto; background-image:url('\$\{v.imgLink\}'); background-repeat:no-repeat; background-size:cover;background-position: center">
                                               </div>                                                
                                            </div>
                                            <div class="price">
                                                <h4>\$\{selected_iso2 ? selected_country.cs : "$"\}\$\{v.price\}</h4>
                                            </div>
                                            <div class="price heading text-center" style="border: none;">
                                                <div class="row">
                                                    <div class="col-7 u_column">                                                        
                                                        \$\{discounted ? \`<span class="variant_compare">(\$\{discounted\}% Discount)</span>\` : ""\}
                                                    </div>
                                                    <div class="col-3 u_column" style="text-align: right">                                                        
                                                        \$\{discounted ? \`<strike class="variant_compare">\$\{selected_iso2 ? selected_country.cs : "$"\}\$\{v.compare\}</strike>\` : ""\}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    \`;
                                }).join("") : ""\}
                                </div>
                                \$\{!useNewDisplay ? selected_variant.map(v => {
                                    let is_completed = v.quantity && v.name && v.price ? true : false;
                                    if(!is_completed) return \`<div class="row plg_variants_no_result" style="justify-content: center; margin: 10px;">Please Complete the variant to display result</div>\`;
                                    // start discount computation
                                    let compare_price = v.compare, selling_price = v.price, discounted = 0;
                                    if((selling_price && compare_price) && (selling_price < compare_price)) discounted = 100 - parseInt(selling_price / compare_price * 100);
                                    // end discount computation
                                    return \`
                                        <label class="row plg_variants" style="\$\{v.selected ? "background-color: " + values.hoverColor : ""\}">
                                            \$\{v.selected || v.ribbon_text ? insertRibbon(v.ribbon_text) : ""\}
                                            <div class="col-2 u_column">
                                                <input class="variant"  name="variant" type="radio" \$\{v.selected ? "checked" : ""\} />
                                            </div>
                                            <div class="col-7 u_column">
                                                <span class="variant_name">\$\{v.name\}</span>
                                                \$\{discounted ? \`<span class="variant_compare">(\$\{discounted\}% Discount)</span>\` : ""\}
                                            </div>
                                            <div class="col-3 u_column" style="text-align: right">
                                                <span class="variant_price">\$\{selected_iso2 ? selected_country.cs : "$"\}\$\{v.price\}</span>
                                                \$\{discounted ? \`<strike class="variant_compare">\$\{selected_iso2 ? selected_country.cs : "$"\}\$\{v.compare\}</strike>\` : ""\}
                                            </div>
                                        </label>
                                    \`;
                                }).join("") : ""\}
                            \`;
                        }
                    }),
                    exporters: {
                        web: function (values) {
                            
                            let variant = values.multi_variants ? JSON.parse(values.multi_variants) : "";
                            if(!variant) return \`<h3 style="text-align: center;">Please Configure Variant</h3>\`;
                            let selected_iso2 = variant.selected_iso2;
                            let useNewDisplay = variant.useNewDisplay ? variant.useNewDisplay : false;
                            if(!variant[selected_iso2]) return \`<h3 style="text-align: center;">Please Configure Variant</h3>\`;
                            let selected_variant = variant[selected_iso2].variants;
                            let selected_country = ${JSON.stringify(points.cod_available_country("no_country"))}//.filter(e => e.iso2 === selected_iso2)[0];
                            if(selected_iso2) selected_country = selected_country.filter(e => e.iso2 === selected_iso2)[0];
                            let content_style = variantStyleFn(values);
                            console.log("UPDATED VARIANTS VALUES EXPORTERS ==>> ",variant);
                            function generateVariantDOM(location, array, country, selected_style) {
                                function insertRibbon(text) {
                                    if (selected_style.selected_style == 2 || text) {
                                        return \`<div class="selected_style_content_2"><div><label>\$\{text || selected_style.ribbon_text\}</label></div></div>\`;
                                    } else if (selected_style.selected_style == 1) {
                                        return \`<img class="selected_style_content_1" src="https://cdn.productlistgenie.com/images/1559588850495share.png">\`;
                                    } else return "";
                                }

                                function generateCardRibbon(text) {
                                    if (selected_style.selected_style == 2 || text) {                                    
                                        return \`<div class="ribbon">\$\{text || selected_style.ribbon_text\}</div>\`
                                    } else return "";
                                }
                                
                                if(useNewDisplay){
                                    return array.map((v,index) => {
                                        let currencyGlobal = ${JSON.stringify(currencyGlobal)};
                                        let is_completed = v.quantity && v.name && v.price ? true : false;
                                        if(!is_completed) return \`<div class="row plg_variants_no_result" style="justify-content: center; margin: 10px;">Please Complete the variant to display result</div>\`;
                                        // start discount computation
                                        let compare_price = v.compare, selling_price = v.price, discounted = 0;
                                        if((selling_price && compare_price) && (selling_price < compare_price)) discounted = 100 - parseInt(selling_price / compare_price * 100);
                                        // end discount computation
                                        return \`
                                        
                                        <div class="pricer-childs" align="center">
                                            <label class="row plg_variants \$\{v.selected ? "plg_variants_active" : ""\}"
                                                data-cword="\$\{location ? country.cw : "USD"\}"
                                                data-ccdiscount="\$\{9 * currencyGlobal.rates[country.cw]\}"
                                                data-csymbol="\$\{location ? country.cs : "$"\}"
                                                data-quantity="\$\{v.quantity\}"
                                                data-name="\$\{v.name\}"                                            
                                                data-price="\$\{v.price\}"
                                                data-sku="\$\{v.sku || ""\}"
                                                data-shopifyid="\$\{v.id || ""\}"
                                                data-tags="\$\{v.tags || ""\}" for="selecting\$\{index\}"  style="padding: 0px; height: 100%;">
                                                    <div class="item \$\{v.selected ? 'selectedPriceTable' : ''\}">
                                                        \$\{v.selected || v.ribbon_text ? generateCardRibbon(v.ribbon_text) : ""\}                                            
                                                        <div class="heading">
                                                            <h3><span class="variant_name">\$\{v.name\}</span></h3>
                                                            <input id="selecting\$\{index\}" class="variant" name="variant" type="radio" \$\{v.selected ? "checked" : ""\} onclick="getSelectedVariant()"   style="visibility: hidden;"/>
                                                        </div>
                                                        <p style="margin: 7px 0px;">\$\{v.subtitleheader ? v.subtitleheader : "" \}</p>
                                                        <div class="row">
                                                            <div style="height:300px; width: 300px; background-image:url('\$\{v.imgLink\}'); margin: 0px auto; background-repeat:no-repeat; background-size:cover;background-position: center">
                                                        </div>                                                
                                                        </div>
                                                        <div class="price">
                                                            <h4>\$\{location ? country.cs : "$"\}\$\{v.price\}</h4>
                                                        </div>
                                                        <div class="price heading text-center" style="border: none;">
                                                            <div class="row">
                                                                <div class="col-7 u_column">                                                        
                                                                    \$\{discounted ? \`<span class="variant_compare">(\$\{discounted\}% Discount)</span>\` : ""\}
                                                                </div>
                                                                <div class="col-3 u_column" style="text-align: right">                                                        
                                                                    \$\{discounted ? \`<strike class="variant_compare">\$\{location ? country.cs : "$"\}\$\{v.compare\}</strike>\` : ""\}
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    </label>
                                                </div>
                                        \`;
                                    }).join("");
                                }else{
                                    return array.map(v => {
                                        let currencyGlobal = ${JSON.stringify(currencyGlobal)};
                                        let is_completed = v.quantity && v.name && v.price ? true : false;
                                        if(!is_completed) return \`<div class="row plg_variants_no_result" style="justify-content: center; margin: 10px;">Please Complete the variant to display result</div>\`;
                                        // start discount computation
                                        let compare_price = v.compare, selling_price = v.price, discounted = 0;
                                        if((selling_price && compare_price) && (selling_price < compare_price)) discounted = 100 - parseInt(selling_price / compare_price * 100);
                                        // end discount computation
                                        return \`
                                            <label class="row plg_variants \$\{v.selected ? "plg_variants_active" : ""\}"
                                                data-cword="\$\{location ? country.cw : "USD"\}"
                                                data-ccdiscount="\$\{9 * currencyGlobal.rates[country.cw]\}"
                                                data-csymbol="\$\{location ? country.cs : "$"\}"
                                                data-quantity="\$\{v.quantity\}"
                                                data-name="\$\{v.name\}"                                            
                                                data-price="\$\{v.price\}"
                                                data-sku="\$\{v.sku || ""\}"
                                                data-shopifyid="\$\{v.id || ""\}"
                                                data-tags="\$\{v.tags || ""\}">
                                                \$\{v.selected || v.ribbon_text ? insertRibbon(v.ribbon_text) : ""\}
                                                <div class="col-2 u_column">
                                                    <input  class="variant" name="variant" type="radio" \$\{v.selected ? "checked" : ""\} onclick="getSelectedVariant()"/>
                                                </div>
                                                <div class="col-7 u_column">
                                                    <span class="variant_name">\$\{v.name\}</span>
                                                    \$\{discounted ? \`<span class="variant_compare">(\$\{discounted\}% Discount)</span>\` : ""\}
                                                </div>
                                                <div class="col-3 u_column" style="text-align: right">
                                                    <span class="variant_price">\$\{location ? country.cs : "$"\}\$\{v.price\}</span>
                                                    \$\{discounted ? \`<br/><strike class="variant_compare">\$\{location ? country.cs : "$"\}\$\{v.compare\}</strike>\` : ""\}
                                                </div>
                                            </label>
                                        \`;
                                    }).join("");
                                }

                            }
                            return \`
                                \$\{content_style\}
                                <style>
                                    .pricing-table {
                                        background-color: #eee;            
                                        color: rgb(74, 74, 74);
                                    }
                                
                                    .pricing-table .block-heading {
                                        padding-top: 50px;
                                        margin-bottom: 40px;
                                        text-align: center;
                                    }

                                    .selectedPriceTable{
                                        border-top: 2px solid #0cf41c !important;
                                    }
                                
                                    .pricing-table .block-heading h2 {
                                        color: #bd2525;
                                        /* Header TOP h2 Colors */
                                    }
                                
                                    .pricing-table .block-heading p {
                                        text-align: center;
                                        max-width: 420px;
                                        margin: auto;
                                        opacity: 0.7;
                                        direction: rtl;
                                    }
                                
                                    .pricing-table .heading {
                                        text-align: center;
                                        padding-bottom: 10px;
                                        border-bottom: 1px solid rgba(0, 0, 0, 0.1);
                                    }
                                
                                    .pricing-table .item {
                                        background-color: #fbfbfb;
                                        /* Main Card BG Colors */
                                        cursor: pointer;
                                        box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.075);
                                        border-top: 2px solid #0e8fff;
                                        /* MAIN CARD Border Top Colors */
                                        padding: 30px;
                                        overflow: hidden;
                                        position: relative;
                                    }
                                
                                    .pricing-table .col-md-5:not(:last-child) .item {
                                        margin-bottom: 30px;
                                    }
                                
                                    .pricing-table .item button {
                                        font-weight: 600;
                                    }
                                
                                    .pricing-table .ribbon {
                                        width: 160px;
                                        height: 32px;
                                        font-size: 12px;
                                        text-align: center;
                                        color: #fff;
                                        font-weight: bold;
                                        box-shadow: 0px 2px 3px rgba(136, 136, 136, 0.25);
                                        background: #4dbe3b;
                                        /* Ribbon BG Colors */
                                        transform: rotate(45deg);
                                        position: absolute;
                                        right: -42px;
                                        top: 20px;
                                        padding-top: 7px;
                                    }
                                
                                    .pricing-table .item p {
                                        text-align: center;
                                        margin-top: 20px;
                                        opacity: 0.7;
                                        direction: rtl;
                                    }
                                
                                    .pricing-table .features .feature {
                                        font-weight: 600;
                                    }
                                
                                    .pricing-table .features h4 {
                                        text-align: center;
                                        font-size: 18px;
                                        padding: 5px;
                                    }
                                
                                    .pricing-table .price h4 {
                                        margin: 15px 0;
                                        font-size: 45px;
                                        text-align: center;
                                        color: #262626;
                                        /* Bottom Prices Colors */
                                    }
                                
                                    .pricing-table .buy-now button {
                                        text-align: center;
                                        margin: auto;
                                        font-weight: 600;
                                        padding: 9px 0;
                                        background-color: turquoise !important;
                                    }
                                </style>
                                <div class="country-selector">
                                    \$\{Object.keys(variant).filter(e => e.length == 2).map(country => {
                                        let cObject = ${JSON.stringify(points.cod_available_country("no_country"))}.filter(e => e.iso2 === country)[0];
                                        return \`<Label class="\$\{selected_iso2 === country ? "plg_variants_active" : ""\}" onclick="button_change_location(this)" data-iso2="\$\{cObject.iso2\}" data-iso3="\$\{cObject.iso3\}"><img src="\$\{cObject.flag\}" style="width: 20px; height: 20px; margin-right: 5px;" /> \$\{cObject.name\}</label>\`;
                                    }).join("")\}
                                </div>
                                <div class="variant_container \$\{useNewDisplay ? 'pricer-table' : ''\}">
                                    \$\{generateVariantDOM(selected_country, selected_variant, selected_country, variant[selected_iso2])\}
                                </div>
                                <script>
                                    let multivariantIsUsingCC = false;
                                    let useNewDisplay = \$\{useNewDisplay\};
                                    let warrantyPrice = { price: 0, variantname: "", variantid: "", tag: "" }, plg_price = 0, plg_ccdiscount = 0, plg_selectedVariant = {};
                                    function multivariantupdatePriceOnDiscount() {
                                        if(useNewDisplay){
                                            console.log("using new display");
                                        }else{
                                            var toggleClass = (el, className) => el.classList.toggle(className);
                                            document.querySelectorAll('.variant_container .plg_variants').forEach(el => {
                                                var discountedPrice =  parseFloat(el.getAttribute('data-price')) - (parseFloat(el.getAttribute('data-quantity')) * parseFloat(el.getAttribute('data-ccdiscount')))                                        
                                                el.querySelector('.variant_price').innerText = discountedPrice.toFixed(2) + el.getAttribute('data-csymbol')
                                                toggleClass(el.querySelector('.variant_price'), 'updating');
                                                setTimeout(function () {
                                                    toggleClass(el.querySelector('.variant_price'), 'updating');
                                                }, 800);
        
                                            });
                                        }
                                    }                 
                                    
                                    function multivariantupdatePriceOnCOD() {
                                        if(useNewDisplay){
                                            console.log("using new display");
                                        }else{  
                                            var toggleClass = (el, className) => el.classList.toggle(className);
                                            document.querySelectorAll('.variant_container .plg_variants').forEach(el => {                                                                                
                                                el.querySelector('.variant_price').innerText = el.getAttribute('data-price') + el.getAttribute('data-csymbol')
                                                toggleClass(el.querySelector('.variant_price'), 'updating');
                                                setTimeout(function () {
                                                    toggleClass(el.querySelector('.variant_price'), 'updating');
                                                }, 800);
                                            });
                                        }
    
                                    } 
                                    function getSelectedVariant() {
                                        let has_selected = false;
                                        document.querySelectorAll(".plg_variants").forEach(el => {
                                            if (el.querySelector("input[type=radio]").checked) {
                                                has_selected = true;
                                                el.classList.add("plg_variants_active");

                                                if(useNewDisplay){
                                                    el.querySelector('.item').classList.add("selectedPriceTable");
                                                }
                                                
                                                let cword = el.getAttribute("data-cword");
                                                let csymbol = el.getAttribute("data-csymbol");
                                                let sku = el.getAttribute("data-sku");
                                                let shopifyid = el.getAttribute("data-shopifyid");
                                                let tags = el.getAttribute("data-tags");
                                                let quantity = parseInt(el.getAttribute("data-quantity"));
                                                let name = el.getAttribute("data-name");
                                                let price = parseFloat(el.getAttribute("data-price"));
                                                let ccdiscount = parseFloat(el.getAttribute("data-ccdiscount"));

                                                let isHaveShippingFee = typeof shippingFee !== "undefined" && shippingFee != 0 ? true : false;
                                                let isHaveTaxFee = typeof taxFee !== "undefined" && taxFee != 0 ? true : false;

                                                plg_selectedVariant = {
                                                    price: price + warrantyPrice.price + (isHaveShippingFee ? parseFloat(shippingFee) : 0) + (isHaveTaxFee ? parseFloat(taxFee) : 0),
                                                    variant_name: name + (warrantyPrice.price ? " + "+warrantyPrice.variantname : "") + (isHaveShippingFee ? " + Shippping Fee" : "") + (isHaveTaxFee ? " + Tax Fee" : ""),
                                                    product_name: "\$\{values.product_name\}",
                                                    variant_id: [shopifyid, warrantyPrice.variantid].filter(e => e).toString(),
                                                    tags: [...tags.split(/[ ,]+/), plgQS()].filter(item => item),
                                                    currency: { word: cword, code: csymbol },
                                                    variant_qty: quantity || 1,
                                                    variant_sku: sku,
                                                    ccdiscount: ccdiscount
                                                }
                                                plg_price = plg_selectedVariant.price;
                                                plg_ccdiscount = plg_selectedVariant.ccdiscount;
                                                plg_selectedVariant.price = csymbol + plg_selectedVariant.price.toString();

                                                if(warrantyPrice.tag && !plg_selectedVariant.tags.includes(warrantyPrice.tag)) plg_selectedVariant.tags.push(warrantyPrice.tag);
                                            } else {
                                                el.classList.remove("plg_variants_active");
                                                if(useNewDisplay){
                                                    el.querySelector('.item').classList.remove("selectedPriceTable");
                                                }
                                                if (!has_selected) {
                                                    plg_selectedVariant = {};
                                                    plg_price = 0;
                                                }
                                            }
                                        });

                                        multivariantIsUsingCC ? multivariantupdatePriceOnDiscount() : multivariantupdatePriceOnCOD();
                                    }

                                    function change_to_user_country(user_country) {
                                        let container = document.querySelector("#\$\{values._meta.htmlID\} .variant_container");
                                        let available_country = ${JSON.stringify(points.cod_available_country("no_country"))};
                                        let variants = \$\{values.multi_variants\};
                                        let text =  "\$\{values.styleText\}";
                                        variants.selected_iso2 = user_country;
                                        if(!variants[variants.selected_iso2]) variants.selected_iso2 = ""; // for the location that is not been setup yet by the seller make it USD or default
                                        container.innerHTML = generateVariantDOM(variants.selected_iso2, variants[variants.selected_iso2].variants, available_country.filter(e => e.iso2 === variants.selected_iso2)[0], variants[variants.selected_iso2]);
                                    }

                                    localStorage.removeItem("checkout_user_country_iso2");
                                    function button_change_location(element) {
                                        let container = document.querySelector("#\$\{values._meta.htmlID\} .country-selector");
                                        let iso2 = "", iso3 = "";
                                        if(element) {
                                            iso2 = element.getAttribute("data-iso2");
                                            iso3 = element.getAttribute("data-iso3");
                                            container.querySelector(".plg_variants_active").classList.remove("plg_variants_active");
                                            element.classList.add("plg_variants_active");
                                            localStorage.setItem("checkout_user_country_iso2", iso2);
                                            change_to_user_country(iso2);
                                        } else {
                                            iso2 = container.querySelector(".plg_variants_active").getAttribute("data-iso2");
                                            iso3 = container.querySelector(".plg_variants_active").getAttribute("data-iso3");
                                            localStorage.setItem("checkout_user_country_iso2", iso2);
                                        }

                                        // update country form hidden form and the form itself
                                        if (element) {
                                            document.querySelector('[name="country"]').value = iso3;
                                            reload_form(iso2, iso3);
                                            getSelectedVariant();
                                        } else {
                                            isExist("[name='country']", null, () => {
                                                let country_dom = document.querySelector('[name="country"]');
                                                if (country_dom.value !== iso3) {
                                                    isExist(null, "reload_form", () => reload_form(iso2, iso3));
                                                }
                                                country_dom.value = iso3;
                                                getSelectedVariant();
                                            });
                                        }
                                    }

                                    \$\{generateVariantDOM\}

                                    // start auto selection of country
                                    let getCookie = \$\{getCookie\}, isExist = \$\{isExist\};
                                    let iso2 = getCookie("loc_iso2") || "", iso3 = getCookie("loc_iso3") || "";
                                    if(iso2 && iso3 && document.querySelector("#\$\{values._meta.htmlID\} [data-iso2=" + iso2 + "]")) {
                                        document.querySelector("#\$\{values._meta.htmlID\} .country-selector").style.display = "none";
                                        isExist(null, "reload_form", () => {
                                            document.querySelector("#\$\{values._meta.htmlID\} [data-iso2=" + iso2 + "]").click();
                                        });
                                    } else {
                                        button_change_location(); // to re initialize cod form
                                    }
                                    // end auto selection of country
                                </script>
                            \`;
                        }
                    }
                }
            });

            console.log("7. Initializing multi variant upsell button...");
            unlayer.registerTool({
                type: 'multi_variants_upsell_button',
                category: 'contents',
                label: 'Multi Country Upsell',
                icon: '<svg class="svg-inline--fa fa-w-14 fa-w-20 fa-3x" fill="#ffffff" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><g><path d="m92.514 55.675c0-21.104 7.799-40.409 20.641-55.229-28.29 2.492-50.555 26.303-50.555 55.229v51.065h29.914z"/><path d="m287.478 265.996v-159.256h-55.049v59.396h-30.069v-59.396h30.069v-51.065c0-30.58-24.878-55.458-55.458-55.458-30.579 0-55.457 24.878-55.457 55.458v51.065h30.069v-51.065c0-14 11.389-25.389 25.388-25.389 14 0 25.389 11.389 25.389 25.389v51.065h-50.777v59.396h-30.069v-59.396h-28.845v405.043h136.597v-245.787z"/><path d="m0 106.74h62.6v405.043h-62.6z"/><path d="m258.266 294.996v124.572h253.734v-124.572h-71.067v60.646h-30.069v-60.646h-52.244v60.646h-30.069v-60.646h30.069v-47.038c0-14.404 11.718-26.122 26.122-26.122s26.122 11.718 26.122 26.122v47.038h30.069v-47.038c0-30.984-25.207-56.191-56.191-56.191s-56.191 25.207-56.191 56.191v47.038z"/><path d="m258.266 449.637h253.734v62.146h-253.734z"/></g></svg>',
                values: {},
                options: {
                    variant: {
                        title: "Multi Country Upsell | Upsell Variant", //april12
                        position: 1,
                        options: {
                            "product_name": {
                                "label": "Product Name (will overwrite if use shopify product)",
                                "defaultValue": "Product Name",
                                "widget": "text"
                            },
                            "multi_variants_upsell": {
                                "label": "Variant",
                                "defaultValue": "",
                                "widget": "multi_variants"
                            }
                        },
                    },
                    button: {
                        title: "Button Action & Style",
                        position: 2,
                        options: ${editorTools.config_button("fbInitiate,text,subText")}
                    },
                    confirmation: {
                        title: "Upsell Confirmation",
                        position: 3,
                        options: ${editorTools.config_confirmation()}
                    }
                },
                renderer: {
                    Viewer: unlayer.createViewer({
                        render(values) {
                            let button_style = btnStyleFn(values);
                            let upsell_variant = values.multi_variants_upsell ? JSON.parse(values.multi_variants_upsell) : null;
                            let selected_variant = upsell_variant ? upsell_variant[upsell_variant.selected_iso2] ? upsell_variant[upsell_variant.selected_iso2].variants[0] : null : null;
                            if(!selected_variant) return \`<h3 style="text-align: center; margin: 0;">Set Upsell Product</h3>\`;
                            return \`
                                \$\{button_style\}
                                <button class="\$\{values.animation\}">
                                    \$\{selected_variant.variant_text || ""\}
                                    <div class="subtext">\$\{selected_variant.variant_sub_text || ""\}</div>
                                </button>
                            \`;
                        }
                    }),
                    exporters: {
                        web: function (values) {
                            let button_style = btnStyleFn(values);
                            let upsell_variant = values.multi_variants_upsell ? JSON.parse(values.multi_variants_upsell) : null;
                            let selected_variant = upsell_variant ? upsell_variant[upsell_variant.selected_iso2] ? upsell_variant[upsell_variant.selected_iso2].variants[0] : null : null;
                            if(!selected_variant) return \`<h3 style="text-align: center; margin: 0;">Set Upsell Product</h3>\`;
                            return \`                            
                            <style>
                                .cc_modal {
                                    display: none;
                                    position: fixed;
                                    top: 0;
                                    z-index: 120;
                                    height: 100%;
                                    background-color: #000000c7;
                                }

                                .cc_modal .container {
                                    min-width: 320px;
                                    max-width: 700px !important;
                                    position: relative;
                                    background-color: #fff;
                                    align-items: center;
                                    display: flex;
                                    flex-direction: column;
                                    margin: auto;
                                    min-height: 500px;
                                    justify-content: center;
                                    border-radius: 5px;
                                }
                            </style>
                            <div class="credit_card cc_modal"
                                style="width: 100%;padding-top: 6rem;position: fixed;top: 0;left: 0;right: 0;"
                                id="plg_modal_credit_card_upsell">
                                <div class="container">
                                    <div class="row">
                                        <div class="col-12 text-center">
                                            <h2 id="cc_modal_msg">Loading ... </h2>
                                        </div>
                                    </div>
                                    <iframe id="iframe_cc_process" src="" width="120" height="120"
                                        style="width: 100%; height: 28rem; border: none;"></iframe>
                                </div>
                            </div>
                                \$\{button_style\}
                                <button class="\$\{values.animation\} upsell_button" onclick="multi_variant_upsell_downsell(this)"
                                    data-parentid="\$\{values._meta.htmlID\}"
                                    data-defaultproductname="\$\{values.product_name\}"
                                    data-link="\$\{values.buttonLink.url\}"
                                    data-target="\$\{values.buttonLink.target\}"
                                    data-variantlist="\$\{btoa(unescape(encodeURIComponent(values.multi_variants_upsell)))\}"
                                    data-trackaddtocart="\$\{values.fbTrack\}"
                                    data-initiatecheckout="\$\{values.fbInitiate\}"
                                    data-trackpurchased="\$\{values.fbPurchase\}"
                                    data-useconfirmation="\$\{values.use_confirmation\}"
                                    data-header="\$\{values.header\}"
                                    data-ptext="\$\{values.positive_button\}"
                                    data-ntext="\$\{values.negative_button\}"
                                >
                                    \$\{selected_variant.variant_text || ""\}
                                    <div class="subtext">\$\{selected_variant.variant_sub_text || ""\}</div>
                                </button>
                                <script
                                    src="https://cdnjs.cloudflare.com/ajax/libs/bluebird/3.3.4/bluebird.min.js"></script>
                                <script src="https://secure.gosell.io/js/sdk/tap.min.js"></script>                                
                                <script>
                                // * Script for the Credit Card
                                var cc_credentials = JSON.parse(localStorage.getItem("cc_credentials"));
                                var cc_details = JSON.parse(localStorage.getItem("cc_details"));

                                var isUsingCreditCard = (cc_credentials && cc_details) ? true : false;

                                var cc_modal = window.document.getElementById("plg_modal_credit_card_upsell");
                                // ? dont think i need it 
                                var cc_customer = JSON.parse(localStorage.getItem("cod_data"));
                                // =========
                                var cc_iframe = window.document.getElementById("iframe_cc_process");

                                var cc_modal_msg = window.document.getElementById("cc_modal_msg");

                                var isCCDone = false;

                                // var tap = Tapjsli('pk_test_0WJVYyBOCw4Z5sxGFi9kcvpf');
                                var tap = Tapjsli('pk_live_LEBPYCraDqHuUmQO75dgtpnx');

                                function setCCDONE() {
                                    isCCDone = true;
                                    return true;
                                }

                                function saveUpsellCCToLocal(response) {
                                    console.log('save local storage for upsell ', response);
                                    localStorage.setItem("receipt_cc", response.receipt.id);
                                    localStorage.setItem("cc_upsell_details", JSON.stringify(response));
                                }

                                function cc_modalDimiss() {
                                    try {
                                        cc_modal.style.display = "none";
                                    } catch (error) {
                                        console.log('error cc_modal :: ', error);
                                    }
                                }



                                let thisInterval = setInterval(() => {
                                    if (isCCDone) {
                                        // proceed to next step 
                                        // credit card was authorize by this time
                                        document.getElementsByClassName("upsell_button")[0].click();
                                        clearInterval(thisInterval);
                                    }
                                }, 1000);


                                // =========== Modal Event Here Get Promise
                                let ccPromise = (upsellData) => new Promise((resolve, reject) => {
                                    cc_iframe.setAttribute("src", "");
                                    cc_modal.style.display = "unset";
                                    cc_modal_msg.innerText = "Please wait authenticating payment."
                                    try {
                                        var auth = cc_details.auth_respo;
                                        fetch('/v2/api/token-upsell-user', {
                                            method: "POST",
                                            headers: {
                                                'Content-Type': 'application/json'
                                            },
                                            body: JSON.stringify({
                                                card_id: auth.card.id,
                                                customer_id: auth.customer.id,
                                                upsell_data: upsellData,
                                            })
                                        }).then(token => token.json()).then((token) => {
                                            console.log("frontend testing cc upsell ", token);
                                            if (!token.response) {
                                                cc_modal_msg.innerText = token.message;
                                            } else {
                                                cc_modal_msg.innerText = "";
                                                cc_modal_msg.style.display = "none";
                                                cc_iframe.style.display = "unset";
                                                cc_iframe.setAttribute("src", token.data.transaction.url);
                                            }
                                        }).catch((error) => {
                                            reject({
                                                response: false,
                                                message: "Network Error. Please try again.",
                                                error: error
                                            });
                                        });
                                    } catch (error) {
                                        reject({
                                            response: false,
                                            message: "Something went wrong getting your credentials",
                                            error: error
                                        });
                                    }
                                });
                                /*
                                upsell flow to tap pay 
                                 token retrieve => authorize => charge
                                */                                
                                    function insert_data_item_to_button(user_country) {
                                        let buttons = document.querySelectorAll(".upsell_button");
                                        buttons.forEach(el => {
                                            let variants = JSON.parse(decodeURIComponent(escape(atob(el.getAttribute("data-variantlist")))));
                                            variants.selected_iso2 = user_country;
                                            if(!variants[variants.selected_iso2]) variants.selected_iso2 = ""; // for the location that is not been setup yet by the seller make it USD or default
                                            let selected_variant = variants[variants.selected_iso2].variants.filter(e => e.selected)[0];

                                            // set data item to dom depending on the selected variant of the button
                                            el.setAttribute("data-shopifyid", selected_variant.id || "");
                                            el.setAttribute("data-quantity", selected_variant.quantity);
                                            if(variants[variants.selected_iso2].use_shopify) el.setAttribute("data-productname", variants[variants.selected_iso2].shopify_search);
                                            else el.setAttribute("data-productname", el.getAttribute("data-defaultproductname"));
                                            el.setAttribute("data-variantname", selected_variant.name);
                                            el.setAttribute("data-price", selected_variant.price);
                                            el.setAttribute("data-sku", selected_variant.sku);
                                            el.setAttribute("data-tags", selected_variant.tags);
                                            el.innerHTML = selected_variant.variant_text + "<div class='subtext'>" + selected_variant.variant_sub_text + "</div>";
                                        });
                                    }

                                    // start decide of what country of user depending on the checkout
                                    if(localStorage.getItem("checkout_user_country_iso2")){
                                        let iso2 = localStorage.getItem("checkout_user_country_iso2");
                                        insert_data_item_to_button(iso2);
                                    } else {
                                        alert("Did not go through checkout.");
                                    }
                                    // end decide of what country of user depending on the checkout

                                    function multi_variant_upsell_downsell(element) {

                                        // end of await 
                                        let shopify_id = element.getAttribute('data-shopifyid');
                                        let quantity = element.getAttribute('data-quantity');
                                        let product_name = element.getAttribute('data-productname')
                                        let variant_name = element.getAttribute('data-variantname');
                                        let price = element.getAttribute('data-price');
                                        let sku = element.getAttribute('data-sku');
                                        let tags = element.getAttribute('data-tags');
                                        let track_add_to_cart = element.getAttribute('data-trackaddtocart');
                                        let track_initiate_checkout = element.getAttribute('data-initiatecheckout');
                                        let track_purchased = element.getAttribute('data-trackpurchased');
                                        let redirect_link = element.getAttribute('data-link');
                                        let redirect_target = element.getAttribute('data-target');
                                        // let redirect_target = "_blank";

                                        // Button if creadit card here await first !                                         
                                        if (isUsingCreditCard) {
                                            if (isCCDone) {
                                                // run
                                                multi_variant_upsell_downsell_hide_show_confirmation(element, () => {
                                                    if (localStorage.getItem("cod_data") && localStorage.getItem("plg_prod_list")) {
                                                        hide_show_loading();
                                                        upsell_cod_function(price, product_name, variant_name, shopify_id, redirect_link, redirect_target, track_add_to_cart, track_initiate_checkout, track_purchased, sku, quantity);
                                                    } else if (localStorage.getItem("authorize_customer_ids")) {
                                                        hide_show_loading();
                                                        upsell_authorize_function(price, product_name, variant_name, shopify_id, redirect_link, redirect_target, quantity);
                                                    } else {
                                                        alert("Did not go through checkout.");
                                                    }
                                                });
                                            } else {
                                                // do the promise here
                                                const upsell_data = {
                                                    currency: JSON.parse(localStorage.getItem("cod_currency")),
                                                    data_upsell: {
                                                        shopify_id: shopify_id,
                                                        quantity: quantity,
                                                        product_name: product_name,
                                                        variant_name: variant_name,
                                                        price: price * quantity,
                                                        sku: sku,
                                                        tags: tags,
                                                        track_add_to_cart: track_add_to_cart,
                                                        track_initiate_checkout: track_initiate_checkout,
                                                        track_purchased: track_purchased,
                                                        redirect_link: redirect_link,
                                                        redirect_target: redirect_target,
                                                    }
                                                };

                                                ccPromise(upsell_data).then((res) => {
                                                    console.log('ccPromise exec then ', res);
                                                }).catch((error) => {
                                                    console.log('promise ccPromise error exec ', error);
                                                });
                                            }
                                        } else {
                                            multi_variant_upsell_downsell_hide_show_confirmation(element, () => {
                                                if (localStorage.getItem("cod_data") && localStorage.getItem("plg_prod_list")) {
                                                    hide_show_loading();
                                                    upsell_cod_function(price, product_name, variant_name, shopify_id, redirect_link, redirect_target, track_add_to_cart, track_initiate_checkout, track_purchased, sku, quantity);
                                                } else if (localStorage.getItem("authorize_customer_ids")) {
                                                    hide_show_loading();
                                                    upsell_authorize_function(price, product_name, variant_name, shopify_id, redirect_link, redirect_target, quantity);
                                                } else {
                                                    alert("Did not go through checkout.");
                                                }
                                            });
                                        }

                                    }

                                    function upsell_cod_function(dataprouctPrice, dataproductName, datavariantname, datavariantid, datalink, datatarget, isAddToCart, isInitiateCheckout, isPurchased, dataprouctSku, dataprouctQty){
                                        dataprouctPrice = dataprouctPrice ? dataprouctPrice : 0;
                                        let customerData = JSON.parse(localStorage.getItem("cod_data"));
                                        sendFBaddToCartAndInitiateCheckout(isAddToCart, isInitiateCheckout, customerData.email);
                                        customerData.productPrice = dataprouctPrice;
                                        customerData.productName = dataproductName;
                                        customerData.variantName = datavariantname;
                                        customerData.pageid = "${state.page_data.funnel_id}";
                                        customerData.fplg = "${state.page_data.is_fulfill_by_plg}";
                                        customerData.receipt_cc = typeof isUsingCreditCard !== "undefined" ? isUsingCreditCard ? localStorage.getItem("receipt_cc") != null ? localStorage.getItem("receipt_cc") : null : null : null;
                                        customerData.variant_id = datavariantid; // for shopify variant id
                                        customerData.variantQty = dataprouctQty ? dataprouctQty : "1"; // for variant quantity
                                        customerData.variantSku = dataprouctSku ? dataprouctSku : ""; // for variant sku
                                        customerData.source_link = window.location.href; // for order link
                                        fetch("/create-customer-charge", {
                                            method: "POST",
                                            headers: {
                                                'Content-Type': 'application/json'
                                            },
                                            body: JSON.stringify(customerData)
                                        })
                                        .then(result => {
                                            sendFBPurchaseEvent(isPurchased, dataprouctPrice);
                                            let upsell_localStorage = JSON.parse(localStorage.getItem("plg_prod_list"));
                                            upsell_localStorage.push({
                                                product_url: window.location.href,
                                                product_name: dataproductName,
                                                variant_name: datavariantname,
                                                product_price: parseFloat(dataprouctPrice)
                                            })
                                            localStorage.setItem("plg_prod_list", JSON.stringify(upsell_localStorage));
                                            window.open(datalink, datatarget);
                                        })
                                        .catch(err => {
                                            // send error error email
                                            const email_payload = { toEmail: "tech@themillionairemastermind.com", fromEmail: "fg_error@gmail.com", subjectEmail: "Funnel creating order failed.", textEmail: "COD Upsell Funnel Error: "+err+", Link: "+window.location.href, htmlEmail: "COD Upsell Funnel Error: "+err+", Link: "+window.location.href };
                                            fetch("https://stats.productlistgenie.io/console", { method: "POST", headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(email_payload) });

                                            hide_show_loading();
                                            alert("Server Error occurred. Please try again.");
                                        })
                                    }

                                    function multi_variant_upsell_downsell_hide_show_confirmation(element, callback) {
                                        window.callback = callback;
                                        let use_confirmation = element.getAttribute('data-useconfirmation');
                                        let header = element.getAttribute('data-header');
                                        let positive_text = element.getAttribute('data-ptext');
                                        let negative_text = element.getAttribute('data-ntext');
                                        if(use_confirmation === "true") {
                                            if(document.getElementById("upsell_confirmation")){
                                                closeConfirmationModal();
                                            } else {
                                                var confirmation = \\\`
                                                    <style>
                                                        #upsell_confirmation button { border-radius: 5px; font-size: 20px; padding: 10px; cursor: pointer; border: none; }
                                                        #upsell_confirmation button.positive-button { color: #ffffff; background-color: #26c686; }
                                                        #upsell_confirmation button.positive-button:hover { background-color: #2a92bf; }
                                                        #upsell_confirmation button.negative-button { color: #ffffff; background-color: #d33b22; }
                                                        #upsell_confirmation button.negative-button:hover { background-color: #c87668; }
                                                    </style>
                                                    <div style="position: fixed; width: 100%; height: 100vh; overflow: scroll; z-index: 9999; top: 0; left: 0;">
                                                        <div style="align-items: center; display: flex; flex-direction: column; margin: auto; min-height: 100%; justify-content: center; background-color: #00000078;">
                                                        <div style="padding: 20px; background-color: #ffffff; border-radius:\$\{values.borderRadius_popup\};">
                                                                <h1 style="margin: 0 0 10px;">\\\$\\\{header\\\}</h1>
                                                                <div style="display: flex; flex-flow: row wrap; -webkit-flex-flow: row wrap; justify-content: space-around;">
                                                                    <button class="positive-button" style="width: 48%; margin: 0 1%;" onclick="closeConfirmationModal(); window.callback();">\\\$\\\{positive_text\\\}</button>
                                                                    <button class="negative-button" style="width: 48%; margin: 0 1%;" onclick="closeConfirmationModal()">\\\$\\\{negative_text\\\}</button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                \\\`;
                                                var div = document.createElement("div");
                                                div.id = "upsell_confirmation";
                                                div.innerHTML = confirmation;
                                                document.body.appendChild(div);
                                            }
                                        } else {
                                            callback();
                                        }
                                    }

                                    function sendFBaddToCartAndInitiateCheckout(isAddEnable, isInitiateEnable, email){
                                        if(isAddEnable){
                                            if(typeof fbq !== 'undefined'){
                                                console.log("fire facebook add to cart")
                                                fbq('track', 'AddToCart');
                                            }
                                            if(typeof snaptr !== 'undefined'){
                                                console.log("fire snapchat add to cart")
                                                snaptr('track','ADD_CART');
                                            }
                                        }
                                        if(isInitiateEnable) {
                                            if(typeof fbq !== 'undefined'){
                                                console.log("fire facebook initiate checkout")
                                                fbq('track', 'InitiateCheckout');
                                            }
                                            if(typeof snaptr !== 'undefined'){
                                                console.log("fire snapchat initiate checkout")
                                                snaptr('init', '${this.state.page_data.funnel_snapchat_id}', {'user_email':email});
                                                snaptr('track','SIGN_UP');
                                            }
                                        }
                                    }
                                    //RECENT: Disable purchase event for upsell
                                    function sendFBPurchaseEvent(isEnable, price){
                                        if(isEnable) {
                                            if(typeof fbq !== 'undefined'){
                                                console.log("fire facebook purchase triggered but not fired")
                                                // fbq('track', 'Purchase', {value: parseFloat(price), currency: localStorage.getItem("cod_data") ? JSON.parse(localStorage.getItem("cod_data")).currencyWord : "USD"})
                                            }
                                            if(typeof snaptr !== 'undefined'){
                                                console.log("fire snapchat purchase event triggered but not fired")
                                                // snaptr('track', 'PURCHASE', {'currency': localStorage.getItem("cod_data") ? JSON.parse(localStorage.getItem("cod_data")).currencyWord : "USD", 'price': parseFloat(price)});
                                            }
                                        }
                                    }

                                    function hide_show_loading(){
                                        if(document.getElementById("upsell_loading")){
                                            document.getElementById("upsell_loading").remove();
                                        } else {
                                            var xx = '<style> #spinner { position: relative; width: 100%; height: 100%; } #spinner:after { content: ""; display: block; position: absolute; width: 80px; height: 80px; margin-left: -40px; margin-top: -40px; border: 5px solid #d1faeb; -moz-border-radius: 50%; -webkit-border-radius: 50%; border-radius: 50%; border-top-color: #26c686; border-right-color: #26c686; -moz-animation: rotate 0.5s linear infinite; -webkit-animation: rotate 0.5s linear infinite; animation: rotate 0.5s linear infinite; } @-moz-keyframes rotate { 0% { -moz-transform: rotateZ(-360deg); transform: rotateZ(-360deg); } 50% { -moz-transform: rotateZ(-180deg); transform: rotateZ(-180deg); } 100% { -moz-transform: rotateZ(0deg); transform: rotateZ(0deg); } } @-webkit-keyframes rotate { 0% { -webkit-transform: rotateZ(-360deg); transform: rotateZ(-360deg); } 50% { -webkit-transform: rotateZ(-180deg); transform: rotateZ(-180deg); } 100% { -webkit-transform: rotateZ(0deg); transform: rotateZ(0deg); } } @keyframes rotate { 0% { -moz-transform: rotateZ(-360deg); -ms-transform: rotateZ(-360deg); -webkit-transform: rotateZ(-360deg); transform: rotateZ(-360deg); } 50% { -moz-transform: rotateZ(-180deg); -ms-transform: rotateZ(-180deg); -webkit-transform: rotateZ(-180deg); transform: rotateZ(-180deg); } 100% { -moz-transform: rotateZ(0deg); -ms-transform: rotateZ(0deg); -webkit-transform: rotateZ(0deg); transform: rotateZ(0deg); } } </style> <div style="position: fixed; width: 100%; height: 100vh; overflow: scroll; z-index: 9999; top: 0; left: 0;"><div style="align-items: center; display: flex; flex-direction: column; margin: auto; min-height: 100%; justify-content: center; background-color: #00000078;"><div style="display: flex; align-items: center; padding: 100px;"><div id="spinner"></div></div></div></div>';
                                            var div = document.createElement("div");
                                            div.id="upsell_loading";
                                            div.innerHTML = xx;
                                            document.body.appendChild(div);
                                        }
                                    }

                                    function closeConfirmationModal(){
                                        document.getElementById("upsell_confirmation").remove();
                                    }
                                </script>
                            \`;
                        }
                    }
                }
            });

            console.log("8. Initializing product addons...");
            unlayer.registerTool({
                type: 'product_addons',
                category: 'contents',
                label: 'Order Bump',
                icon: '<svg class="svg-inline--fa fa-edge fa-w-16 fa-3x" fill="#fff" xmlns="http://www.w3.org/2000/svg" version="1.1" id="Capa_1" x="0px" y="0px" viewBox="0 0 512 512"> <g> <g> <g> <path d="M181.333,277.333c-5.896,0-10.667,4.771-10.667,10.667v21.333c0,5.896,4.771,10.667,10.667,10.667 c5.896,0,10.667-4.771,10.667-10.667V288C192,282.104,187.229,277.333,181.333,277.333z"/> <path d="M224,277.333c-5.896,0-10.667,4.771-10.667,10.667v21.333c0,5.896,4.771,10.667,10.667,10.667 s10.667-4.771,10.667-10.667V288C234.667,282.104,229.896,277.333,224,277.333z"/> <path d="M266.667,277.333c-5.896,0-10.667,4.771-10.667,10.667v21.333c0,5.896,4.771,10.667,10.667,10.667 c5.896,0,10.667-4.771,10.667-10.667V288C277.333,282.104,272.563,277.333,266.667,277.333z"/> <circle cx="448" cy="298.667" r="21.333"/> <circle cx="384" cy="298.667" r="21.333"/> <path d="M181.333,384c-5.896,0-10.667,4.771-10.667,10.667V416c0,5.896,4.771,10.667,10.667,10.667 c5.896,0,10.667-4.771,10.667-10.667v-21.333C192,388.771,187.229,384,181.333,384z"/> <path d="M224,384c-5.896,0-10.667,4.771-10.667,10.667V416c0,5.896,4.771,10.667,10.667,10.667s10.667-4.771,10.667-10.667 v-21.333C234.667,388.771,229.896,384,224,384z"/> <path d="M266.667,384c-5.896,0-10.667,4.771-10.667,10.667V416c0,5.896,4.771,10.667,10.667,10.667 c5.896,0,10.667-4.771,10.667-10.667v-21.333C277.333,388.771,272.563,384,266.667,384z"/> <circle cx="448" cy="405.333" r="21.333"/> <circle cx="384" cy="405.333" r="21.333"/> <path d="M512,234.667c0-35.292-23.917-64-53.333-64c-12.917,0-30.958,5.594-47,14.573c3.354-40.938,9.708-79.635,14.458-104.885 c1.729-9.198-0.729-18.625-6.75-25.875c-6.208-7.51-15.458-11.813-25.354-11.813H301.5c-7.792,0-14.958,4.229-18.667,11.052 c-3.75,6.844-3.438,15.188,0.813,21.792c9.854,15.302,15.021,32.625,15.021,41.823c0,17.646-19.146,32-42.667,32 s-42.667-14.354-42.667-32c0-9.198,5.167-26.521,15.042-41.844c4.229-6.583,4.542-14.927,0.792-21.771 c-3.708-6.823-10.875-11.052-18.667-11.052h-92.521c-9.896,0-19.146,4.302-25.354,11.813c-6.021,7.25-8.479,16.677-6.75,25.875 c4.75,25.25,11.104,63.948,14.521,104.917c-16.104-9.01-34.146-14.604-47.063-14.604c-29.417,0-53.333,28.708-53.333,64 c0,35.292,23.917,64,53.333,64c12.917,0,30.958-5.594,47-14.583c-3.354,40.948-9.708,79.646-14.458,104.896 c-1.729,9.198,0.729,18.625,6.75,25.875c6.229,7.51,15.458,11.813,25.354,11.813H128c0,23.531,19.146,42.667,42.667,42.667 h298.667c23.521,0,42.667-19.135,42.667-42.667V384c0-12.805-5.786-24.174-14.746-32c8.96-7.826,14.746-19.195,14.746-32v-42.667 c0-6.689-1.684-12.94-4.439-18.579C510.273,250.897,512,242.861,512,234.667z M490.667,426.667 c0,11.76-9.563,21.333-21.333,21.333H170.667c-11.771,0-21.333-9.573-21.333-21.333V384c0-11.76,9.563-21.333,21.333-21.333 h298.667c11.771,0,21.333,9.573,21.333,21.333V426.667z M490.667,320c0,11.76-9.563,21.333-21.333,21.333H170.667 c-11.771,0-21.333-9.573-21.333-21.333v-42.667c0-11.76,9.563-21.333,21.333-21.333h298.667c11.771,0,21.333,9.573,21.333,21.333 V320z M490.082,240.284c-6.169-3.471-13.181-5.617-20.749-5.617H170.667c-23.521,0-42.667,19.135-42.667,42.667V320 c0,12.805,5.786,24.174,14.746,32c-8.96,7.826-14.746,19.195-14.746,32v21.333h-10.021c-3.521,0-6.792-1.5-8.938-4.104 c-1.146-1.375-2.958-4.292-2.208-8.313c4.854-25.75,11.354-65.229,14.75-107.083c0.667-7.885-3.063-15.438-9.708-19.719 c-6.625-4.281-15.042-4.49-21.896-0.677C75.292,273.656,61,277.333,53.333,277.333c-17.646,0-32-19.135-32-42.667 S35.688,192,53.333,192c7.667,0,21.958,3.677,36.646,11.885c6.833,3.833,15.208,3.604,21.896-0.667 c6.646-4.281,10.375-11.844,9.708-19.708c-3.417-41.865-9.896-81.344-14.75-107.094c-0.75-4.021,1.063-6.938,2.208-8.313 c2.146-2.615,5.417-4.104,8.938-4.104l92.458-0.052C199.417,81.052,192,102.51,192,117.333c0,29.406,28.708,53.333,64,53.333 s64-23.927,64-53.333c0-14.823-7.417-36.281-18.5-53.333h92.521c3.521,0,6.792,1.49,8.938,4.104 c1.146,1.375,2.958,4.292,2.208,8.313c-4.854,25.75-11.333,65.229-14.75,107.073c-0.667,7.885,3.063,15.448,9.708,19.729 c6.646,4.26,15.021,4.542,21.896,0.677C436.708,195.677,451,192,458.667,192c17.646,0,32,19.135,32,42.667 C490.667,236.552,490.289,238.411,490.082,240.284z"/> </g> </g> </g> </svg>',
                values: {},
                options: {
                    product_addons: {
                        title: "Order Bump (Product addons) Settings",
                        position: 1,
                        options: {
                            "addonPrice": {
                                "label": "Product Addon Price (COD currency will use in variant selector)",
                                "defaultValue": "20",
                                "widget": "text"
                            },
                            "variants": {
                                "label": "Variants",
                                "defaultValue": JSON.stringify([]),
                                "widget": "variants"
                            },
                            "addonText": {
                                "label": "Product Addon Text",
                                "defaultValue": "YES, I Want Lifetime Protection PLUS Expedited Shipping!",
                                "widget": "text"
                            },
                            "undeline": {
                                "label": "Use Underline",
                                "defaultValue": false,
                                "widget": "toggle"
                            },
                            "checked": {
                                "label": "Selected",
                                "defaultValue": false,
                                "widget": "toggle"
                            },
                            "fontSize": {
                                "label": "Font Size",
                                "defaultValue": "15px",
                                "widget": "px"
                            },
                            "fontColor": {
                                "label": "Font Color",
                                "defaultValue": "#fff",
                                "widget": "color_picker"
                            },
                            "backgroundColor": {
                                "label": "Background Color",
                                "defaultValue": "#989797",
                                "widget": "color_picker"
                            }
                        },
                    }
                },
                renderer: {
                    Viewer: unlayer.createViewer({
                        render(values) {
                            return \`
                                <style>
                                    .checkbox-arrow-slide-right{ left: 10px; width: 20px; z-index: 1; -webkit-animation: slide-right .5s cubic-bezier(.25,.46,.45,.94) infinite alternate both; animation: slide-right .5s cubic-bezier(.25,.46,.45,.94) infinite alternate both; } @-webkit-keyframes slide-right {0% {-webkit-transform: translateX(0);transform: translateX(0);}100% {-webkit-transform: translateX(10px);transform: translateX(10px);}}
                                    .product-addons { display: flex; align-items: center; position: relative; background-color: \$\{values.backgroundColor\}; padding: 5px; border-radius: 5px; color: \$\{values.fontColor\}; }
                                    .p_add_on:checked:after { content: '\\\\2714'; font-size: 15px; font-weight: 700; color: #fff; background: linear-gradient(to bottom, #0fe469 0%, #145b32 100%); display: flex; align-items: center; justify-content: center; }
                                    .p_add_on:after { content: ''; border: 1px solid #505256; background-color: #b3abab; width: 20px; height: 20px; position: absolute; top: -30%; left: -30%; border-radius: 5px; }
                                </style>
                                <div class="product-addons">
                                    <img class="checkbox-arrow-slide-right" src="https://cdn.productlistgenie.com/images/NWMwYTg1ZjA3NzMwMDEzMjdiMDM5MDRj/1560786344044256-256-7f4d535dc832b66d90d5c0cb72ec8690-arrow.png">
                                    <input type="checkbox" class="p_add_on" style="margin-left: 15px; position: relative;" \$\{values.checked ? ' checked' : ''\}>
                                    <label style="margin-left: 5px; text-decoration: \$\{values.undeline ? 'underline' : 'unset'\};">\$\{values.addonText\}</label>
                                </div>
                            \`
                        }
                    }),
                    exporters: {
                        web: function(values) {
                            var selectedVariant = JSON.parse(values.variants).filter(el => el.isSuggest);
                            var variantid = "";
                            var variantname = "Add-ons";
                            var tag = "";
                            if(selectedVariant.length != 0){
                                variantid = selectedVariant[0].id;
                                variantname = selectedVariant[0].variant_name;
                                values.addonPrice = selectedVariant[0].price;
                                tag = selectedVariant[0].tag ? selectedVariant[0].tag : "";
                            }
                            return \`
                                <style>
                                    .checkbox-arrow-slide-right{ left: 10px; width: 20px; z-index: 1; -webkit-animation: slide-right .5s cubic-bezier(.25,.46,.45,.94) infinite alternate both; animation: slide-right .5s cubic-bezier(.25,.46,.45,.94) infinite alternate both; } @-webkit-keyframes slide-right {0% {-webkit-transform: translateX(0);transform: translateX(0);}100% {-webkit-transform: translateX(10px);transform: translateX(10px);}}
                                    .product-addons { display: flex; align-items: center; position: relative; background-color: \$\{values.backgroundColor\}; padding: 5px; border-radius: 5px; color: \$\{values.fontColor\}; }
                                    .p_add_on:checked:after { content: '\\\\2714'; font-size: 15px; font-weight: 700; color: #fff; background: linear-gradient(to bottom, #0fe469 0%, #145b32 100%); display: flex; align-items: center; justify-content: center; }
                                    .p_add_on:after { content: ''; border: 1px solid #505256; background-color: #b3abab; width: 20px; height: 20px; position: absolute; top: -30%; left: -30%; border-radius: 5px; }
                                </style>
                                <div class="product-addons">
                                    <img class="checkbox-arrow-slide-right" src="https://cdn.productlistgenie.com/images/NWMwYTg1ZjA3NzMwMDEzMjdiMDM5MDRj/1560786344044256-256-7f4d535dc832b66d90d5c0cb72ec8690-arrow.png">
                                    \$\{values.checked ? ' <input type="checkbox" class="p_add_on" style="margin-left: 15px; position: relative;" onchange="addProductAddonPrice(this)" onload="setTimeout(() => typeof addProductAddonPrice != \\'undefined\\' ? addProductAddonPrice(event) : void 0, 1000)" checked />' : '<input type="checkbox" class="p_add_on" style="margin-left: 15px; position: relative;" onclick="typeof addProductAddonPrice != \\'undefined\\' ? addProductAddonPrice(event) : void 0" />'\} 
                                    <label style="margin-left: 5px; text-decoration: \$\{values.undeline ? 'underline' : 'unset'\};">\$\{values.addonText\}</label>
                                </div>
                                <script>
                                    function addProductAddonPrice(event){
                                        // also converting those local price to multiple country add on price...
                                        var addonPrice = \$\{values.addonPrice\};
                                        if(event.checked){
                                            warrantyPrice = {
                                                price: addonPrice,
                                                variantname: "\$\{variantname\}",
                                                variantid: "\$\{variantid\}",
                                                tag: "\$\{tag\}"
                                            };
                                        } else {
                                            warrantyPrice = {
                                                price: 0,
                                                variantname: "",
                                                variantid: "",
                                                tag: ""
                                            };
                                        }
                                        getTheSelectedVariant();
                                        // for the new variants with multiple and multi country.. 
                                        // getSelectedVariant();
                                    }
                                    function addProductAddonPriceSelected(){
                                        console.log("addProductAddonPriceSelected")
                                        var addonPrice = \$\{values.addonPrice\};
                                        warrantyPrice = {
                                            price: addonPrice,
                                            variantname: "\$\{variantname\}",
                                            variantid: "\$\{variantid\}",
                                            tag: "\$\{tag\}"
                                        };
                                        getTheSelectedVariant();
                                    }
                                    \$\{values.checked ? 'addProductAddonPriceSelected()' : ''\}
                                </script>
                            \`
                        }
                    }
                }
            });

            console.log("9. Initializing notifier...");
            unlayer.registerTool({
                type: 'notifier',
                category: 'contents',
                label: 'Notifier',
                icon: '<svg class="svg-inline--fa fa-w-14 fa-w-20 fa-3x" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" viewBox="0 0 512 512"> <g fill="#fff"> <path d="M436.933,385.47999999999996C435.929,385.47999999999996,435.125,384.67599999999993,435.125,383.67099999999994C435.125,383.67099999999994,435.125,227.20699999999994,435.125,227.20699999999994C435.125,143.09599999999995,376.941,72.35099999999994,298.759,53.05699999999996C299.261,50.34299999999996,299.563,47.62999999999994,299.563,44.815999999999974C299.563,20.698999999999955,279.867,1.0019999999999527,255.749,1.0019999999999527C231.631,1.0019999999999527,211.935,20.597999999999956,211.935,44.815999999999974C211.935,47.62999999999994,212.236,50.34299999999996,212.739,53.05699999999996C145.511,69.63799999999998,93.054,124.30399999999997,79.689,192.73899999999998C34.167,206.00299999999993,0.804,248.20899999999995,0.804,297.952C0.804,338.852,23.314,374.52599999999995,56.576,393.419C52.557,397.84,50.044,403.669,50.044,410.09999999999997C50.044,410.09999999999997,50.044,422.76199999999994,50.044,422.76199999999994C50.044,437.63399999999996,62.204,449.794,77.076,449.794C77.076,449.794,198.67,449.794,198.67,449.794C198.469,451.40199999999993,198.469,453.10999999999996,198.469,454.71799999999996C198.469,486.37199999999996,224.195,512.098,255.849,512.098C287.504,512.098,313.229,486.37199999999996,313.229,454.71799999999996C313.229,453.00899999999996,313.129,451.40199999999993,313.028,449.794C313.028,449.794,434.622,449.794,434.622,449.794C449.495,449.794,461.654,437.63399999999996,461.654,422.76199999999994C461.654,422.76199999999994,461.654,410.09999999999997,461.654,410.09999999999997C461.453,396.43299999999994,450.5,385.47999999999996,436.933,385.47999999999996C436.933,385.47999999999996,436.933,385.47999999999996,436.933,385.47999999999996M15.878,297.952C15.878,257.4549999999999,41.503,222.88599999999997,77.277,209.41999999999996C82.302,207.51099999999997,87.527,206.10399999999993,92.954,205.09899999999993C98.581,204.09399999999994,104.41,203.49099999999993,110.339,203.49099999999993C118.78,203.49099999999993,126.92,204.59699999999998,134.658,206.70699999999994C141.491,208.51599999999996,148.023,211.12799999999993,154.153,214.34399999999994C154.153,214.34399999999994,174.251,209.11899999999997,174.251,209.11899999999997C174.251,209.11899999999997,199.976,202.38599999999997,199.976,202.38599999999997C200.077,202.38599999999997,200.278,202.28499999999997,200.479,202.58699999999993C200.68,202.78799999999995,200.68,202.98899999999998,200.579,203.08899999999994C200.579,203.08899999999994,192.842,226.10199999999998,192.842,226.10199999999998C192.842,226.10199999999998,187.114,243.08399999999995,187.114,243.08399999999995C191.033,248.51099999999997,194.349,254.43999999999994,197.062,260.66999999999996C202.087,272.126,204.9,284.88899999999995,204.9,298.25399999999996C204.9,350.308,162.493,392.715,110.439,392.715C103.505,392.715,96.773,391.91099999999994,90.241,390.50399999999996C84.915,389.39899999999994,79.79,387.691,74.866,385.6809999999999C40.196,371.41099999999994,15.878,337.44499999999994,15.878,297.952C15.878,297.952,15.878,297.952,15.878,297.952M255.749,497.02399999999994C232.435,497.02399999999994,213.442,478.0319999999999,213.442,454.71799999999996C213.442,453.00899999999996,213.543,451.40199999999993,213.744,449.794C213.744,449.794,297.754,449.794,297.754,449.794C297.955,451.40199999999993,298.055,453.00899999999996,298.055,454.71799999999996C298.055,478.0319999999999,279.063,497.02399999999994,255.749,497.02399999999994C255.749,497.02399999999994,255.749,497.02399999999994,255.749,497.02399999999994M446.48,422.76199999999994C446.48,422.76199999999994,446.48,422.76199999999994,446.48,422.76199999999994C446.38,429.39399999999995,441.054,434.71999999999997,434.421,434.71999999999997C434.421,434.71999999999997,77.076,434.71999999999997,77.076,434.71999999999997C70.444,434.71999999999997,65.118,429.39399999999995,65.118,422.76199999999994C65.118,422.76199999999994,65.118,410.09999999999997,65.118,410.09999999999997C65.118,405.578,68.334,401.75899999999996,72.554,400.85499999999996C84.312,405.17599999999993,97.074,407.58799999999997,110.339,407.58799999999997C170.734,407.58799999999997,219.874,358.448,219.874,298.053C219.874,277.04999999999995,213.945,257.4549999999999,203.695,240.77299999999997C203.695,240.77299999999997,214.849,207.81199999999995,214.849,207.81199999999995C216.658,202.38599999999997,215.452,196.35599999999994,211.533,192.13599999999997C207.614,187.91499999999996,201.685,186.20699999999994,196.158,187.71399999999994C196.158,187.71399999999994,155.761,198.26599999999996,155.761,198.26599999999996C141.893,191.93499999999995,126.518,188.41799999999995,110.339,188.41799999999995C105.415,188.41799999999995,100.591,188.71899999999994,95.868,189.42199999999997C110.138,129.02799999999996,157.77,81.49499999999995,218.165,67.32599999999996C223.592,66.01999999999998,229.018,65.01499999999993,234.646,64.31199999999995C231.028,60.39199999999994,228.516,55.46799999999996,227.511,50.14199999999994C227.209,48.43399999999997,227.008,46.72599999999994,227.008,44.91699999999997C227.008,29.03899999999993,239.871,16.176999999999964,255.749,16.176999999999964C271.626,16.176999999999964,284.489,29.03899999999993,284.489,44.91699999999997C284.489,46.72599999999994,284.288,48.43399999999997,283.987,50.14199999999994C282.982,55.56899999999996,280.469,60.49299999999994,276.852,64.31199999999995C282.479,65.01499999999993,287.906,66.01999999999998,293.332,67.32599999999996C365.887,84.40999999999997,420.051,149.62799999999993,420.051,227.30699999999996C420.051,227.30699999999996,420.051,383.77099999999996,420.051,383.77099999999996C420.051,384.37399999999997,420.051,385.078,420.152,385.6809999999999C420.152,385.6809999999999,197.263,385.6809999999999,197.263,385.6809999999999C193.143,385.6809999999999,189.726,389.097,189.726,393.21799999999996C189.726,397.33799999999997,193.143,400.75399999999996,197.263,400.75399999999996C197.263,400.75399999999996,434.924,400.75399999999996,434.924,400.75399999999996C434.924,400.75399999999996,434.924,400.453,434.924,400.453C435.527,400.55299999999994,436.23,400.55299999999994,436.933,400.55299999999994C442.159,400.55299999999994,446.48,404.77399999999994,446.48,410.09999999999997C446.48,410.09999999999997,446.48,422.76199999999994,446.48,422.76199999999994C446.48,422.76199999999994,446.48,422.76199999999994,446.48,422.76199999999994M268.109,43.710999999999956C268.109,50.54399999999998,262.582,56.07099999999997,255.749,56.07099999999997C248.915,56.07099999999997,243.388,50.54399999999998,243.388,43.710999999999956C243.388,36.87799999999993,248.915,31.350999999999942,255.749,31.350999999999942C262.582,31.350999999999942,268.109,36.87799999999993,268.109,43.710999999999956C268.109,43.710999999999956,268.109,43.710999999999956,268.109,43.710999999999956M12.561,153.84899999999993C12.561,153.84899999999993,12.863,153.54699999999997,12.863,153.54699999999997C14.27,152.13999999999993,14.973,150.23099999999994,14.973,148.32199999999995C14.973,148.32199999999995,14.973,148.32199999999995,14.973,148.32199999999995C14.973,141.68899999999996,15.476,135.05699999999996,16.38,128.72599999999994C25.123,71.14499999999998,70.645,25.622999999999934,128.126,16.97999999999996C134.557,15.975999999999942,141.089,15.573999999999955,147.721,15.573999999999955C147.721,15.573999999999955,147.721,15.573999999999955,147.721,15.573999999999955C149.731,15.573999999999955,151.54,14.769999999999982,152.947,13.462999999999965C152.947,13.462999999999965,153.248,13.161999999999978,153.248,13.161999999999978C157.971,8.438999999999965,154.756,0.5,148.224,0.5C148.023,0.5,147.922,0.5,147.721,0.5C146.716,0.5,145.611,0.5,144.606,0.5C65.62,2.20799999999997,1.708,66.11999999999995,0,145.10599999999994C0,146.11099999999993,0,147.21599999999995,0,148.22099999999995C0,148.42199999999997,0,148.52299999999997,0,148.72399999999993C0,155.25599999999997,7.939,158.47099999999995,12.561,153.84899999999993C12.561,153.84899999999993,12.561,153.84899999999993,12.561,153.84899999999993M30.147,176.25799999999998C30.147,177.26299999999998,30.147,178.36799999999994,30.147,179.37299999999993C30.147,179.57399999999996,30.147,179.67499999999995,30.147,179.87599999999998C30.147,186.40799999999996,38.086,189.62299999999993,42.709,185.00099999999998C42.709,185.00099999999998,43.01,184.69899999999996,43.01,184.69899999999996C44.417,183.29299999999995,45.12,181.38299999999998,45.12,179.47399999999993C45.12,179.47399999999993,45.12,179.47399999999993,45.12,179.47399999999993C45.12,172.84099999999995,45.623,166.20899999999995,46.527,159.87799999999993C55.069,102.39799999999997,100.591,56.87499999999994,158.072,48.333999999999946C164.503,47.32899999999995,171.035,46.926999999999964,177.668,46.926999999999964C177.668,46.926999999999964,177.668,46.926999999999964,177.668,46.926999999999964C179.677,46.926999999999964,181.486,46.122999999999934,182.893,44.815999999999974C182.893,44.815999999999974,183.195,44.51499999999993,183.195,44.51499999999993C187.817,39.89199999999994,184.601,31.95399999999995,178.069,31.95399999999995C177.868,31.95399999999995,177.768,31.95399999999995,177.567,31.95399999999995C176.562,31.95399999999995,175.457,31.95399999999995,174.452,31.95399999999995C95.768,33.35999999999996,31.856,97.27199999999993,30.147,176.25799999999998C30.147,176.25799999999998,30.147,176.25799999999998,30.147,176.25799999999998M512,145.10599999999994C510.292,66.11999999999995,446.38,2.20799999999997,367.394,0.5C366.389,0.5,365.284,0.5,364.279,0.5C364.078,0.5,363.977,0.5,363.776,0.5C357.244,0.5,354.029,8.438999999999965,358.651,13.060999999999979C358.651,13.060999999999979,358.953,13.362999999999943,358.953,13.362999999999943C360.36,14.769999999999982,362.269,15.472999999999956,364.178,15.472999999999956C364.178,15.472999999999956,364.178,15.472999999999956,364.178,15.472999999999956C370.811,15.472999999999956,377.443,15.975999999999942,383.774,16.87999999999994C441.255,25.42199999999997,486.777,70.94399999999996,495.319,128.42499999999995C496.323,134.85599999999994,496.725,141.38799999999998,496.725,148.01999999999998C496.725,148.01999999999998,496.725,148.01999999999998,496.725,148.01999999999998C496.725,150.02999999999997,497.529,151.83899999999994,498.836,153.24599999999998C498.836,153.24599999999998,499.137,153.54699999999997,499.137,153.54699999999997C503.76,158.16999999999996,511.699,154.95399999999995,511.699,148.42199999999997C511.699,148.22099999999995,511.699,148.12099999999998,511.699,147.91999999999996C512,147.21599999999995,512,146.11099999999993,512,145.10599999999994C512,145.10599999999994,512,145.10599999999994,512,145.10599999999994M337.247,31.65199999999993C336.242,31.65199999999993,335.136,31.65199999999993,334.132,31.65199999999993C333.931,31.65199999999993,333.83,31.65199999999993,333.629,31.65199999999993C327.097,31.65199999999993,323.881,39.59099999999995,328.504,44.212999999999965C328.504,44.212999999999965,328.805,44.51499999999993,328.805,44.51499999999993C330.212,45.92199999999997,332.122,46.62499999999994,334.031,46.62499999999994C334.031,46.62499999999994,334.031,46.62499999999994,334.031,46.62499999999994C340.663,46.62499999999994,347.296,47.12799999999993,353.627,48.03199999999998C411.107,56.573999999999955,456.63,102.09599999999995,465.171,159.57699999999994C466.176,166.00799999999998,466.578,172.53999999999996,466.578,179.17199999999997C466.578,179.17199999999997,466.578,179.17199999999997,466.578,179.17199999999997C466.578,181.18199999999996,467.382,182.99099999999993,468.689,184.39799999999997C468.689,184.39799999999997,468.99,184.69899999999996,468.99,184.69899999999996C473.613,189.32199999999995,481.551,186.10599999999994,481.551,179.57399999999996C481.551,179.37299999999993,481.551,179.27299999999997,481.551,179.07199999999995C481.551,178.06699999999995,481.551,176.96199999999993,481.551,175.95699999999994C480.144,97.27199999999993,416.232,33.35999999999996,337.247,31.65199999999993C337.247,31.65199999999993,337.247,31.65199999999993,337.247,31.65199999999993M76.875,297.852C76.875,307.198,69.238,314.8349999999999,59.892,314.8349999999999C50.547,314.8349999999999,42.91,307.198,42.91,297.852C42.91,288.506,50.547,280.8689999999999,59.892,280.8689999999999C69.238,280.8689999999999,76.875,288.506,76.875,297.852C76.875,297.852,76.875,297.852,76.875,297.852M128.126,297.852C128.126,307.198,120.488,314.8349999999999,111.143,314.8349999999999C101.797,314.8349999999999,94.16,307.198,94.16,297.852C94.16,288.506,101.797,280.8689999999999,111.143,280.8689999999999C120.488,280.8689999999999,128.126,288.506,128.126,297.852C128.126,297.852,128.126,297.852,128.126,297.852M179.376,297.852C179.376,307.198,171.739,314.8349999999999,162.393,314.8349999999999C153.047,314.8349999999999,145.41,307.198,145.41,297.852C145.41,288.506,153.047,280.8689999999999,162.393,280.8689999999999C171.739,280.8689999999999,179.376,288.506,179.376,297.852C179.376,297.852,179.376,297.852,179.376,297.852" /> </g> </svg>',
                values: {},
                options: {
                    notifier: {
                        title: "Notifier Settings",
                        position: 1,
                        options: {
                            "notifierIcon": {
                                "label": "Notification Image",
                                "defaultValue": {
                                    "url": "https://via.placeholder.com/100x100?text=ICON",
                                    "width": 500,
                                    "height": 100
                                },
                                "widget": "image"
                            },
                            "enableNotifier1": {
                                "label": "Enable notifier 1",
                                "defaultValue": true,
                                "widget": "toggle"
                            },
                            "notifierFontStyle": {
                                "label": "Font Family",
                                "defaultValue": {
                                    label: "Arial",
                                    value: "arial,helvetica,sans-serif"
                                },
                                "widget": "font_family"
                            },
                            "notifierUsers": {
                                "label": "Customer List (e.g: Juan H.,Justin,Brandon)",
                                "defaultValue": "Mayur H.,Beverley R.,Mariyah H.,Arandeep H.,Cali G.,Zavier A.,Kenan C.,Phyllis L.,Gloria S.,Arnav B.,Dimitri C.,Sian H.,Isla-Mae M.,Susannah M.,Mylie S.,Isa H.,Sabiha S.,Jaylen M.,Cieran M.,Taryn T.",
                                "widget": "text"
                            },
                            "notifierLocations": {
                                "label": "Place List (e.g: USA,CANADA,FLORIDA,NEW YORK)",
                                "defaultValue": "Alabama,Alaska,Arizona,Arkansas,California,Colorado,Connecticut,Delaware,Florida,Georgia,Hawaii,Idaho,Illinois,Indiana,Iowa,Kansas,Kentucky,Louisiana,Maine,Maryland,Massachusetts,Michigan,Minnesota,Mississippi,Missouri,Montana,Nebraska,Nevada,New Hampshire,New Jersey,New Mexico,New York,North Carolina,North Dakota,Ohio,Oklahoma,Oregon,Pennsylvania,Rhode Island,South Carolina,South Dakota,Tennessee,Texas,Utah,Vermont,Virginia,Washington,West Virginia,Wisconsin,Wyoming",
                                "widget": "text"
                            },
                            "extraText": {
                                "label": "",
                                "defaultValue": "just bought",
                                "widget": "text"
                            },
                            "notifierProducts": {
                                "label": "Product Name",
                                "defaultValue": "Product Name",
                                "widget": "text"
                            },
                            "notifierTimes": {
                                "label": "Time List (e.g: a minute ago,3 hours ago)",
                                "defaultValue": "a minute ago,3 minutes ago,5 minutes ago,10 minutes ago",
                                "widget": "text"
                            },
                            "enableNotifier2": {
                                "label": "Enable notifier 2",
                                "defaultValue": true,
                                "widget": "toggle"
                            },
                            "notifierViewingMinRange": {
                                "label": "Viewing minimum count range",
                                "defaultValue": 20,
                                "widget": "counter"
                            },
                            "notifierViewingMaxRange": {
                                "label": "Viewing max count range",
                                "defaultValue": 50,
                                "widget": "counter"
                            }
                        },
                    }
                },
                renderer: {
                    Viewer: unlayer.createViewer({
                        render(values) {
                            var selectedProduct = values.notifierProducts.split(",");
                            var selectedUser = values.notifierUsers.split(",");
                            var selectedCountry = values.notifierLocations.split(",");
                            var selectedTime = values.notifierTimes.split(",");
                            function getRandomValueFromArray(array){
                                var random = Math.floor(Math.random() * Math.floor((array.length-1)));
                                return array[random];
                            }
                            return \`
                                <div id="notifier_box" class="row" style="display: none; align-items: center; border: 1px solid #d2cfcf; padding: 5px; font-family: \$\{values.notifierFontStyle.value\}; position: fixed; bottom: 12px; right: 12px; z-index: 999; background-color: #fff; width: 250px; cursor: pointer;">
                                    <span style="margin: 0 auto;"> Click here to open notifier settings </span>
                                </div>
                            \`
                            return \`
                                <div id="notifier_box" class="row" style="align-items: center; border: 1px solid #d2cfcf; padding: 5px; font-family: \$\{values.notifierFontStyle.value\}; position: fixed; bottom: 12px; right: 12px; z-index: 999; background-color: #fff; width: 400px; cursor: pointer;">
                                    <div class="col-3 u_column">
                                        <img src="\$\{values.notifierIcon.url\}" width="100%">
                                    </div>
                                    <div class="col-8 u_column" style="margin-left: 10px;">
                                        <label style="font-size: 15px;"><strong>\$\{getRandomValueFromArray(selectedUser).toString().trim()\}</strong> from <strong>\$\{getRandomValueFromArray(selectedCountry).toString().trim()\}</strong> \$\{values.extraText\}</label>
                                        <div style="color: #2e7754; font-weight: 900; font-size: 17px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; width: 100%;">\$\{getRandomValueFromArray(selectedProduct).toString().trim()\}</div>
                                        <div style="text-align: right; font-size: 13px">\$\{getRandomValueFromArray(selectedTime).toString().trim()\}</div>
                                    </div>
                                </div>
                            \`
                        }
                    }),
                    exporters: {
                        web: function (values) {
                            var selectedProduct = values.notifierProducts;
                            var selectedUser = values.notifierUsers;
                            var selectedCountry = values.notifierLocations;
                            var selectedTime = values.notifierTimes;
                            return \`
                                <style>
                                    #notifier #notifier_box { visibility: hidden; min-width: 250px; background-color: #fff; color: rgb(24, 23, 23); box-shadow: 0px 1px 6px 1px #797979; border-radius: 2px; padding: 16px; position: fixed; z-index: 1; left: 3%; font-family: sans-serif; bottom: 30px; font-size: 15px; display: flex; border: 1px solid #9c9c9c; border-radius: 20px; } #notifier #notifier_box_2{ visibility: hidden; min-width: 250px; background-color: #fff; color: rgb(24, 23, 23); box-shadow: 0px 1px 6px 1px #797979; border-radius: 2px; position: fixed; z-index: 2; left: 3%; font-family: sans-serif; bottom: 30px; margin-bottom:110px; font-size: 15px; display: flex; border: 1px solid #9c9c9c; border-radius: 20px; } #notifier #notifier_box.show { visibility: visible; -webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s; animation: fadein 0.5s, fadeout 0.5s 2.5s; } #notifier #notifier_box_2.show2 { visibility: visible; -webkit-animation: fadein 1.5s, fadeout 1.5s 3.5s; animation: fadein 1.5s, fadeout 1.5s 3.5s; } @-webkit-keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} } @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} } @-webkit-keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} } @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} } #notifier #min_message_text{ position: absolute; right: 0; bottom: 0; padding: 10px; } #notifier .product_name{ display: flex; flex-wrap: wrap; align-content: center; height: 50%; color:rgb(24, 211, 77); } #notifier .people_number_text{ padding:20px 20px 20px 25px } #notifier .img_icon{ width: 90px; height: 85px; background: url(https://cdn.productlistgenie.com/images/NWMwYTg1ZjA3NzMwMDEzMjdiMDM5MDRj/1560461058839person2.png); background-position: center; background-size: cover; border: 0px; border-bottom-left-radius: 20px; border-top-left-radius: 20px; } @media only screen and (max-width: 600px) { #notifier #notifier_box { width: auto; height:13vh; color: rgb(24, 23, 23); box-shadow: 0px 0px 4px 0px #9e9e9e; border-radius: 2px; padding: 10px; position: fixed; z-index: 2; display: flex; border: 0px; left: 0; right: 0; top:0; } #notifier #notifier_box_2 { width: auto; height:70px; color: rgb(24, 23, 23); box-shadow: 0px 0px 4px 0px #9e9e9e; border-radius: 2px; position: fixed; z-index:1; display: flex; border: 0px; left: 0; right: 0; top:0; } #notifier #min_message_text{ padding: 5px; } #notifier .people_number_text{ padding:10px 10px 10px 15px } #notifier .img_icon{ width: 20%; height: 70px; background: url(https://cdn.productlistgenie.com/images/NWMwYTg1ZjA3NzMwMDEzMjdiMDM5MDRj/1560461058839person2.png); background-position: center; background-size: cover; border: 0px; border-bottom-left-radius: 0px; border-top-left-radius: 0px; } }
                                </style>
                                <div id="notifier" style="font-family: \$\{values.notifierFontStyle.value\}">
                                    <div id="notifier_box">
                                        <img src="\$\{values.notifierIcon.url\}" width="80px" height="60px" style="padding:0 20px 0 0;">
                                        <span id="message_text"></span>
                                        <span id="min_message_text"></span>
                                    </div>
                                    <div id="notifier_box_2" class=".notifier_box_2">
                                        <span class="img_icon"> </span>
                                        <span class="people_number_text">
                                            Currently
                                            <span id="people_number"></span>
                                            people are looking at this<br> product
                                        </span>
                                    </div>
                                </div>
                                <script>
                                var myVar = setInterval(notifierFunction, 6000);
                                function notifierFunction() {
                                    if(\$\{values.enableNotifier1\}){
                                        var extra_text = "\$\{values.extraText\}";
                                        var product_name = "\$\{selectedProduct\}".split(",");
                                        var names = "\$\{selectedUser\}".split(",");
                                        var country = "\$\{selectedCountry\}".split(",");
                                        var min = "\$\{selectedTime\}".split(",");
                                        var randomCountry = country[Math.floor(Math.random() * country.length)];
                                        var randomNames = names[Math.floor(Math.random() * names.length)];
                                        var randomMin = min[Math.floor(Math.random() * min.length)];
                                        var randomProduct_name = product_name[Math.floor(Math.random() * product_name.length)];
                                        document.getElementById("message_text").innerHTML = "<strong>"+randomNames+"</strong> from <strong>"+randomCountry+"</strong> "+extra_text+"<strong class='product_name'>"+randomProduct_name+"</strong>";
                                        document.getElementById("min_message_text").innerHTML = randomMin;
                                        var x = document.getElementById("notifier_box");
                                        x.className = "show";
                                        setTimeout(function () {
                                            x.className = x.className.replace("show", "");
                                        }, 3000);
                                    }

                                    if(\$\{values.enableNotifier2\}){
                                        // var people_number = ["39", "30", "42"];
                                        // var randomPeople_number = people_number[Math.floor(Math.random() * people_number.length)];
                                        var randomPeople_number = Math.floor(Math.random() * (\$\{values.notifierViewingMaxRange\} - \$\{values.notifierViewingMinRange\}) + \$\{values.notifierViewingMinRange\});
                                        document.getElementById("people_number").innerHTML = '<strong style="color:red;">'+randomPeople_number+'</strong>';
                                        var y = document.getElementById("notifier_box_2");
                                        y.className = "show2";
                                        setTimeout(function() {
                                            y.className = y.className.replace("show2", "");
                                        }, 5000);
                                    }
                                }
                                </script>
                            
                            \`
                        }
                    }
                }
            });

            // Navigation Menu
            unlayer.registerPropertyEditor({
                name: 'navigation',
                layout: 'bottom',
                Widget: unlayer.createWidget({
                    render(value) {
                        return \`
                            <div class="blockbuilder-widget blockbuilder-link-widget" id="navigation-settings-container">
                                <div class="row">
                                    <div class="blockbuilder-widget-label col-6">
                                        <label class="blockbuilder-label-primary">
                                            <span>Link Text</span>
                                        </label> <br/>
                                    </div>
                                    <div class="blockbuilder-widget-label col-6">
                                        <label class="blockbuilder-label-primary">
                                            <span>Link</span>
                                        </label> <br/>
                                    </div>
                                </div>
                                <div class="row navigation_links" style="margin-top: 5px;">
                                    <div class="blockbuilder-widget-label col-6">
                                        <input type="text" class="link_text form-control" style="background-color: #555555; border: 1px solid #777; color: #fff; font-size: 12px;">
                                    </div>
                                    <div class="blockbuilder-widget-label col-6">
                                        <input list="pages1" class="link_value form-control" onclick="this.select()" style="background-color: #555555; border: 1px solid #777; color: #fff; font-size: 12px;">
                                        <datalist id="pages1">
                                            ${(() => {
                                                return window.params.pages.map(el => {
                                                    return `<option value="${el}">${el}</option>`
                                                })
                                            })()}
                                        </datalist>
                                    </div>
                                </div>
                                <div class="row navigation_links" style="margin-top: 5px;">
                                    <div class="blockbuilder-widget-label col-6">
                                        <input type="text" class="link_text form-control" style="background-color: #555555; border: 1px solid #777; color: #fff; font-size: 12px;">
                                    </div>
                                    <div class="blockbuilder-widget-label col-6">
                                        <input list="pages2" class="link_value form-control" onclick="this.select()" style="background-color: #555555; border: 1px solid #777; color: #fff; font-size: 12px;">
                                        <datalist id="pages2">
                                            ${(() => {
                                                return window.params.pages.map(el => {
                                                    return `<option value="${el}">${el}</option>`
                                                })
                                            })()}
                                        </datalist>
                                    </div>
                                </div>
                                <div class="row navigation_links" style="margin-top: 5px;">
                                    <div class="blockbuilder-widget-label col-6">
                                        <input type="text" class="link_text form-control" style="background-color: #555555; border: 1px solid #777; color: #fff; font-size: 12px;">
                                    </div>
                                    <div class="blockbuilder-widget-label col-6">
                                        <input list="pages3" class="link_value form-control" onclick="this.select()" style="background-color: #555555; border: 1px solid #777; color: #fff; font-size: 12px;">
                                        <datalist id="pages3">
                                            ${(() => {
                                                return window.params.pages.map(el => {
                                                    return `<option value="${el}">${el}</option>`
                                                })
                                            })()}
                                        </datalist>
                                    </div>
                                </div>
                                <div class="row navigation_links" style="margin-top: 5px;">
                                    <div class="blockbuilder-widget-label col-6">
                                        <input type="text" class="link_text form-control" style="background-color: #555555; border: 1px solid #777; color: #fff; font-size: 12px;">
                                    </div>
                                    <div class="blockbuilder-widget-label col-6">
                                        <input list="pages4" class="link_value form-control" onclick="this.select()" style="background-color: #555555; border: 1px solid #777; color: #fff; font-size: 12px;">
                                        <datalist id="pages4">
                                            ${(() => {
                                                return window.params.pages.map(el => {
                                                    return `<option value="${el}">${el}</option>`
                                                })
                                            })()}
                                        </datalist>
                                    </div>
                                </div>
                                <div class="row navigation_links" style="margin-top: 5px;">
                                    <div class="blockbuilder-widget-label col-6">
                                        <input type="text" class="link_text form-control" style="background-color: #555555; border: 1px solid #777; color: #fff; font-size: 12px;">
                                    </div>
                                    <div class="blockbuilder-widget-label col-6">
                                        <input list="pages5" class="link_value form-control" onclick="this.select()" style="background-color: #555555; border: 1px solid #777; color: #fff; font-size: 12px;">
                                        <datalist id="pages5">
                                            ${(() => {
                                                return window.params.pages.map(el => {
                                                    return `<option value="${el}">${el}</option>`
                                                })
                                            })()}
                                        </datalist>
                                    </div>
                                </div>
                            </div>
                        \`
                    },
                    mount(node, value, updateValue) {
                        var navigationLinks = document.querySelectorAll(".navigation_links");
                        
                        var links = JSON.parse(value);
                        navigationLinks.forEach((el,i) => {
                            var linkText = el.querySelector(".link_text");
                            var linkVal = el.querySelector(".link_value");
                            if(links[i]){
                                linkText.value = links[i].text;
                                linkVal.value = links[i].url;
                            }

                            linkText.onchange = () => {
                                if(links[i]){
                                    links[i].text = linkText.value;
                                } else {
                                    links[i] = {
                                        text: linkText.value,
                                        url: "",
                                    }
                                }
                                updateValue(JSON.stringify(links))
                            }
                            linkVal.onchange = () => {
                                if(links[i]){
                                    links[i].url = linkVal.value;
                                } else {
                                    links[i] = {
                                        text: "",
                                        url: linkVal.value
                                    }
                                }
                                updateValue(JSON.stringify(links))
                            }
                        })
                    }
                })
            });

            console.log("10. Initializing navbar...");
            unlayer.registerTool({
                type: 'navbar',
                category: 'contents',
                label: 'NavBar',
                icon: '<svg class="svg-inline--fa fa-w-14 fa-w-20 fa-3x" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" viewBox="0 0 512 512"> <g fill="#fff"> <path d="M420.3,101.19999999999999C420.3,101.19999999999999,184.7,101.19999999999999,184.7,101.19999999999999C165.5,101.19999999999999,149.9,116.80000000000001,149.9,136C149.9,155.2,165.5,170.8,184.7,170.8C184.7,170.8,420.2,170.8,420.2,170.8C439.4,170.8,455,155.2,455,136C455.1,116.80000000000001,439.5,101.19999999999999,420.3,101.19999999999999C420.3,101.19999999999999,420.3,101.19999999999999,420.3,101.19999999999999M420.3,155.8C420.3,155.8,184.7,155.8,184.7,155.8C173.8,155.8,164.9,146.89999999999998,164.9,136C164.9,125.10000000000002,173.8,116.19999999999999,184.7,116.19999999999999C184.7,116.19999999999999,420.2,116.19999999999999,420.2,116.19999999999999C431.1,116.19999999999999,440,125.10000000000002,440,136C440,146.89999999999998,431.2,155.8,420.3,155.8C420.3,155.8,420.3,155.8,420.3,155.8M420.3,341.2C420.3,341.2,184.7,341.2,184.7,341.2C165.5,341.2,149.9,356.8,149.9,376C149.9,395.2,165.5,410.8,184.7,410.8C184.7,410.8,420.2,410.8,420.2,410.8C439.4,410.8,455,395.2,455,376C455.1,356.8,439.5,341.2,420.3,341.2C420.3,341.2,420.3,341.2,420.3,341.2M420.3,395.8C420.3,395.8,184.7,395.8,184.7,395.8C173.8,395.8,164.9,386.9,164.9,376C164.9,365.1,173.8,356.2,184.7,356.2C184.7,356.2,420.2,356.2,420.2,356.2C431.1,356.2,440,365.1,440,376C440,386.9,431.2,395.8,420.3,395.8C420.3,395.8,420.3,395.8,420.3,395.8M420.3,221.2C420.3,221.2,184.7,221.2,184.7,221.2C165.5,221.2,149.9,236.8,149.9,256C149.9,275.2,165.5,290.8,184.7,290.8C184.7,290.8,420.2,290.8,420.2,290.8C439.4,290.8,455,275.2,455,256C455.1,236.8,439.5,221.2,420.3,221.2C420.3,221.2,420.3,221.2,420.3,221.2M420.3,275.8C420.3,275.8,184.7,275.8,184.7,275.8C173.8,275.8,164.9,266.9,164.9,256C164.9,245.10000000000002,173.8,236.2,184.7,236.2C184.7,236.2,420.2,236.2,420.2,236.2C431.1,236.2,440,245.10000000000002,440,256C440,266.9,431.2,275.8,420.3,275.8C420.3,275.8,420.3,275.8,420.3,275.8M94.2,101.19999999999999C94.2,101.19999999999999,92.7,101.19999999999999,92.7,101.19999999999999C73.5,101.19999999999999,57.9,116.80000000000001,57.9,136C57.9,155.2,73.5,170.8,92.7,170.8C92.7,170.8,94.2,170.8,94.2,170.8C113.4,170.8,129,155.2,129,136C129,116.80000000000001,113.4,101.19999999999999,94.2,101.19999999999999C94.2,101.19999999999999,94.2,101.19999999999999,94.2,101.19999999999999M94.2,155.8C94.2,155.8,92.7,155.8,92.7,155.8C81.8,155.8,72.9,146.89999999999998,72.9,136C72.9,125.10000000000002,81.8,116.19999999999999,92.7,116.19999999999999C92.7,116.19999999999999,94.2,116.19999999999999,94.2,116.19999999999999C105.1,116.19999999999999,114,125.10000000000002,114,136C114,146.89999999999998,105.1,155.8,94.2,155.8C94.2,155.8,94.2,155.8,94.2,155.8M94.2,341.2C94.2,341.2,92.7,341.2,92.7,341.2C73.5,341.2,57.9,356.8,57.9,376C57.9,395.2,73.5,410.8,92.7,410.8C92.7,410.8,94.2,410.8,94.2,410.8C113.4,410.8,129,395.2,129,376C129,356.8,113.4,341.2,94.2,341.2C94.2,341.2,94.2,341.2,94.2,341.2M94.2,395.8C94.2,395.8,92.7,395.8,92.7,395.8C81.8,395.8,72.9,386.9,72.9,376C72.9,365.1,81.8,356.2,92.7,356.2C92.7,356.2,94.2,356.2,94.2,356.2C105.1,356.2,114,365.1,114,376C114,386.9,105.1,395.8,94.2,395.8C94.2,395.8,94.2,395.8,94.2,395.8M94.2,221.2C94.2,221.2,92.7,221.2,92.7,221.2C73.5,221.2,57.9,236.8,57.9,256C57.9,275.2,73.5,290.8,92.7,290.8C92.7,290.8,94.2,290.8,94.2,290.8C113.4,290.8,129,275.2,129,256C129,236.8,113.4,221.2,94.2,221.2C94.2,221.2,94.2,221.2,94.2,221.2M94.2,275.8C94.2,275.8,92.7,275.8,92.7,275.8C81.8,275.8,72.9,266.9,72.9,256C72.9,245.10000000000002,81.8,236.2,92.7,236.2C92.7,236.2,94.2,236.2,94.2,236.2C105.1,236.2,114,245.10000000000002,114,256C114,266.9,105.1,275.8,94.2,275.8C94.2,275.8,94.2,275.8,94.2,275.8M464.2,0C464.2,0,48.8,0,48.8,0C22.2,0,0.5,21.600000000000023,0.5,48.30000000000001C0.5,48.30000000000001,0.5,463.6,0.5,463.6C0.5,490.3,22.2,512,48.8,512C48.8,512,464.1,512,464.1,512C490.8,512,512.4,490.3,512.4,463.6C512.4,463.6,512.4,48.30000000000001,512.4,48.30000000000001C512.5,21.600000000000023,490.8,0,464.2,0C464.2,0,464.2,0,464.2,0M497.5,463.6C497.5,482,482.5,497,464.2,497C464.2,497,48.8,497,48.8,497C30.5,497,15.5,482,15.5,463.6C15.5,463.6,15.5,48.30000000000001,15.5,48.30000000000001C15.5,30,30.5,15,48.8,15C48.8,15,464.1,15,464.1,15C482.5,15,497.5,30,497.5,48.30000000000001C497.5,48.30000000000001,497.5,463.6,497.5,463.6C497.5,463.6,497.5,463.6,497.5,463.6" /> </g> </svg>',
                values: {},
                options: {
                    navigation: {
                        title: "Navigation Settings",
                        position: 1,
                        options: {
                            "navigation": {
                                "label": "Navigation Menu",
                                "defaultValue": JSON.stringify([{
                                    "text": "Home",
                                    "url": "#"
                                }]),
                                "widget": "navigation"
                            },
                            "textColor": {
                                "label": "Text Color",
                                "defaultValue": "#fff",
                                "widget": "color_picker"
                            },
                            "backgroundColor": {
                                "label": "Background Color",
                                "defaultValue": "inherit",
                                "widget": "color_picker"
                            },
                            "hoverColor": {
                                "label": "Hover Color",
                                "defaultValue": "#121212",
                                "widget": "color_picker"
                            },
                            "fontSize": {
                                "label": "Font Size",
                                "defaultValue": "17px",
                                "widget": "px"
                            },
                            "fontStyle": {
                                "label": "Font Family",
                                "defaultValue": {
                                    label: "Arial",
                                    value: "arial,helvetica,sans-serif"
                                },
                                "widget": "font_family"
                            }
                        },
                    }
                },
                renderer: {
                    Viewer: unlayer.createViewer({
                        render(values) {
                            var navigation = JSON.parse(values.navigation);
                            var blockID = "block_"+(parseInt(values._meta.htmlID.replace("block_",""))-1);
                            var menu = \`
                                <style>
                                    #\$\{blockID\} .u_row .row, #\$\{values._meta.htmlID\} .u_row .row {
                                        align-items: center;
                                    }
                                    #\$\{blockID\} .u_row .row, #\$\{values._meta.htmlID\} .u_row .row a {
                                        text-decoration: none;
                                    }
                                    #\$\{blockID\} .u_row .row, #\$\{values._meta.htmlID\} .u_row .row a:hover {
                                        color: #fff;
                                    }
                                    #\$\{blockID\} #navigation-menu .topnav, #\$\{values._meta.htmlID\} #navigation-menu .topnav {
                                        overflow: hidden;
                                        background-color: \$\{values.backgroundColor\};
                                    }
                                    #\$\{blockID\} #navigation-menu a span, #\$\{values._meta.htmlID\} #navigation-menu a span {
                                        border: 2px solid \$\{values.textColor\};
                                        width: 30px;
                                        margin-top: 3px;
                                        display: flex;
                                    }
                                    #\$\{blockID\} #navigation-menu .topnav a, #\$\{values._meta.htmlID\} #navigation-menu .topnav a {
                                        float: right;
                                        display: block;
                                        color: \$\{values.textColor\};
                                        padding: 14px 16px;
                                        text-decoration: none;
                                        font-size: \$\{values.fontSize\};
                                        font-family: \$\{values.fontStyle ? values.fontStyle.value : 'inherit'\};
                                        text-align: right;
                                    }
                                    #\$\{blockID\} #navigation-menu .topnav a:hover, #\$\{values._meta.htmlID\} #navigation-menu .topnav a:hover {
                                        color: \$\{values.hoverColor\};
                                    }
                                    #\$\{blockID\} #navigation-menu .active, #\$\{values._meta.htmlID\} #navigation-menu .active {
                                        background-color: #4caf50;
                                        color: white;
                                    }
                                    #\$\{blockID\} #navigation-menu .topnav .icon, #\$\{values._meta.htmlID\} #navigation-menu .topnav .icon {
                                        display: none;
                                    }
                                    @media screen and (max-width: 767px) {
                                        #\$\{blockID\} #navigation-menu .topnav a:not(:first-child), #\$\{values._meta.htmlID\} #navigation-menu .topnav a:not(:first-child) {
                                            display: none;
                                        }
                                        #\$\{blockID\} #navigation-menu .topnav a.icon, #\$\{values._meta.htmlID\} #navigation-menu .topnav a.icon {
                                            float: right;
                                            display: block;
                                        }
                                    }
                                    @media screen and (max-width: 767px) {
                                        #\$\{blockID\} #navigation-menu .topnav.responsive, #\$\{values._meta.htmlID\} #navigation-menu .topnav.responsive {
                                            position: relative;
                                        }
                                        #\$\{blockID\} #navigation-menu .topnav.responsive .icon, #\$\{values._meta.htmlID\} #navigation-menu .topnav.responsive .icon {
                                            position: absolute;
                                            right: 0;
                                            top: 0;
                                        }
                                        #\$\{blockID\} #navigation-menu .topnav.responsive a, #\$\{values._meta.htmlID\} #navigation-menu .topnav.responsive a {
                                            float: none;
                                            display: block;
                                            text-align: left;
                                        }
                                    }
                                </style>
                                <div id="navigation-menu">
                                    <div class="topnav" id="myTopnav">
                                        <a href="javascript:void(0);" class="icon">
                                            <span></span>
                                            <span></span>
                                            <span></span>
                                        </a>
                                        <!-- Menu -->
                                    </div>
                                </div>
                            \`;
                            
                            var menuStr = "";
                            navigation.reverse().forEach(nav => {
                                menuStr += '<a href="'+nav.url+'">'+nav.text+'</a>';
                            })
                            menu = menu.replace("<!-- Menu -->", menuStr);
                            
                            return menu;
                        }
                    }),
                    exporters: {
                        web: function (values) {
                            var navigation = JSON.parse(values.navigation);
                            var navigation_classes = [];
                            window.navigation_ID_list.forEach((el,index) => {
                                navigation_classes.push("#"+el+" .row");
                            })
                            var menu =  \`
                                <style>
                                    \$\{navigation_classes.toString()\} {
                                        align-items: center;
                                    }
                                    \$\{navigation_classes.toString()\} a {
                                        text-decoration: none;
                                    }
                                    \$\{navigation_classes.toString()\} a:hover {
                                        color: #fff;
                                    }
                                    #\$\{values._meta.htmlID\} #navigation-menu .topnav {
                                        overflow: hidden;
                                        background-color: \$\{values.backgroundColor\};
                                    }
                                    #\$\{values._meta.htmlID\} #navigation-menu a span {
                                        border: 2px solid \$\{values.textColor\};
                                        width: 30px;
                                        margin-top: 3px;
                                        display: flex;
                                    }
                                    #\$\{values._meta.htmlID\} #navigation-menu .topnav a {
                                        float: right;
                                        display: block;
                                        color: \$\{values.textColor\};
                                        padding: 14px 16px;
                                        text-decoration: none;
                                        font-size: 17px;
                                        font-family: \$\{values.fontStyle ? values.fontStyle.value : ""\};
                                        text-align: right;
                                    }
                                    #\$\{values._meta.htmlID\} #navigation-menu .topnav a:hover {
                                        color: \$\{values.hoverColor\};
                                    }
                                    #\$\{values._meta.htmlID\} #navigation-menu .active {
                                        background-color: #4caf50;
                                        color: white;
                                    }
                                    #\$\{values._meta.htmlID\} #navigation-menu .topnav .icon {
                                        display: none;
                                    }
                                    @media screen and (max-width: 767px) {
                                        #\$\{values._meta.htmlID\} #navigation-menu .topnav a:not(:first-child) {
                                            display: none;
                                        }
                                        #\$\{values._meta.htmlID\} #navigation-menu .topnav a.icon {
                                            float: right;
                                            display: block;
                                        }
                                    }
                                    @media screen and (max-width: 767px) {
                                        #\$\{values._meta.htmlID\} #navigation-menu .topnav.responsive {
                                            position: relative;
                                        }
                                        #\$\{values._meta.htmlID\} #navigation-menu .topnav.responsive .icon {
                                            position: absolute;
                                            right: 0;
                                            top: 0;
                                        }
                                        #\$\{values._meta.htmlID\} #navigation-menu .topnav.responsive a {
                                            float: none;
                                            display: block;
                                            text-align: left;
                                        }
                                    }
                                </style>
                                <div id="navigation-menu">
                                    <div class="topnav" id="myTopnav">
                                        <a href="javascript:void(0);" class="icon" onclick="typeof navigationFunction != 'undefined' ? navigationFunction() : void 0">
                                            <span></span>
                                            <span></span>
                                            <span></span>
                                        </a>
                                        <!-- Menu -->
                                    </div>
                                </div>
                                <script>
                                    function navigationFunction() {
                                        var x = document.getElementById("myTopnav");
                                        if (x.className === "topnav") {
                                            x.className += " responsive";
                                        } else {
                                            x.className = "topnav";
                                        }
                                    }
                                </script>
                            \`;
                            
                            var menuStr = "";
                            navigation.reverse().forEach(nav => {
                                menuStr += '<a href="'+nav.url+'">'+nav.text+'</a>';
                            })
                            menu = menu.replace("<!-- Menu -->", menuStr);
                            
                            return menu;
                        }
                    }
                }
            });

            console.log("11. Initializing Scarcity Timer...");
            unlayer.registerTool({
                type: 'timer',
                category: 'contents',
                label: 'Timer',
                icon: '<svg class="svg-inline--fa fa-w-14 fa-w-20 fa-3x" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" viewBox="0 0 512 512"> <g fill="#fff"> <path d="M413.034,138.87099999999998C413.034,138.87099999999998,425.058,126.84800000000001,425.058,126.84800000000001C425.058,126.84800000000001,426.461,128.25,426.461,128.25C431.571,133.36,438.184,135.865,444.897,135.865C451.61,135.865,458.223,133.36,463.333,128.25C463.333,128.25,463.333,128.25,463.333,128.25C473.553,118.031,473.553,101.59800000000001,463.333,91.37799999999999C463.333,91.37799999999999,420.148,48.19400000000002,420.148,48.19400000000002C415.038,43.084,408.425,40.57900000000001,401.712,40.57900000000001C394.999,40.57900000000001,388.386,43.084,383.276,48.19400000000002C383.276,48.19400000000002,383.276,48.19400000000002,383.276,48.19400000000002C373.056,58.41399999999999,373.056,74.846,383.276,85.06599999999997C383.276,85.06599999999997,366.043,102.30000000000001,366.043,102.30000000000001C341.595,88.17200000000003,314.241,78.654,285.085,74.846C285.085,74.846,285.085,52.101999999999975,285.085,52.101999999999975C285.085,52.101999999999975,287.088,52.101999999999975,287.088,52.101999999999975C301.517,52.101999999999975,313.139,40.478999999999985,313.139,26.050999999999988C313.139,26.050999999999988,313.139,26.050999999999988,313.139,26.050999999999988C313.139,11.62299999999999,301.517,0,287.088,0C287.088,0,225.969,0,225.969,0C211.541,0,199.918,11.62299999999999,199.918,26.050999999999988C199.918,26.050999999999988,199.918,26.050999999999988,199.918,26.050999999999988C199.918,40.478999999999985,211.541,52.101999999999975,225.969,52.101999999999975C225.969,52.101999999999975,225.969,52.101999999999975,225.969,52.101999999999975C225.969,52.101999999999975,225.969,75.24700000000001,225.969,75.24700000000001C196.912,79.255,169.659,88.97399999999999,145.512,103.30200000000002C145.512,103.30200000000002,127.176,85.166,127.176,85.166C127.176,85.166,127.176,85.166,127.176,85.166C137.396,74.94600000000003,137.396,58.51400000000001,127.176,48.29399999999998C127.176,48.29399999999998,127.176,48.29399999999998,127.176,48.29399999999998C122.066,43.184000000000026,115.453,40.678999999999974,108.74,40.678999999999974C102.027,40.678999999999974,95.414,43.184000000000026,90.304,48.29399999999998C90.304,48.29399999999998,47.12,91.47899999999998,47.12,91.47899999999998C36.9,101.69900000000001,36.9,118.13099999999997,47.12,128.351C52.23,133.461,58.843,135.966,65.556,135.966C72.269,135.966,78.882,133.461,83.992,128.351C83.992,128.351,85.395,126.94799999999998,85.395,126.94799999999998C85.395,126.94799999999998,98.62,140.17399999999998,98.62,140.17399999999998C60.446,179.651,37,233.356,37,292.571C37,413.808,135.192,512,256.429,512C377.665,512,475.857,413.808,475.857,292.571C475.857,232.755,451.91,178.54899999999998,413.034,138.87099999999998C413.034,138.87099999999998,413.034,138.87099999999998,413.034,138.87099999999998M393.897,58.91500000000002C396.001,56.81099999999998,398.706,55.709,401.712,55.709C404.618,55.709,407.423,56.81099999999998,409.528,58.91500000000002C409.528,58.91500000000002,452.712,102.09899999999999,452.712,102.09899999999999C457.02,106.40800000000002,457.02,113.42200000000003,452.712,117.73000000000002C450.608,119.834,447.903,120.93599999999998,444.897,120.93599999999998C441.991,120.93599999999998,439.186,119.834,437.081,117.73000000000002C437.081,117.73000000000002,393.897,74.54599999999999,393.897,74.54599999999999C389.589,70.23700000000002,389.589,63.22300000000001,393.897,58.91500000000002C393.897,58.91500000000002,393.897,58.91500000000002,393.897,58.91500000000002M393.897,95.78699999999998C393.897,95.78699999999998,414.437,116.327,414.437,116.327C414.437,116.327,402.213,128.551,402.213,128.551C394.899,122.03800000000001,387.184,116.02699999999999,379.068,110.61599999999999C379.068,110.61599999999999,393.897,95.78699999999998,393.897,95.78699999999998C393.897,95.78699999999998,393.897,95.78699999999998,393.897,95.78699999999998M214.847,26.050999999999988C214.847,19.93900000000002,219.757,15.028999999999996,225.869,15.028999999999996C225.869,15.028999999999996,286.988,15.028999999999996,286.988,15.028999999999996C293.1,15.028999999999996,298.01,19.93900000000002,298.01,26.050999999999988C298.01,32.16300000000001,293.1,37.072,286.988,37.072C286.988,37.072,225.869,37.072,225.869,37.072C219.757,37.072,214.847,32.16300000000001,214.847,26.050999999999988C214.847,26.050999999999988,214.847,26.050999999999988,214.847,26.050999999999988M240.898,52.101999999999975C240.898,52.101999999999975,269.955,52.101999999999975,269.955,52.101999999999975C269.955,52.101999999999975,269.955,73.54399999999998,269.955,73.54399999999998C265.446,73.243,260.937,73.14299999999997,256.429,73.14299999999997C251.218,73.14299999999997,246.008,73.34300000000002,240.898,73.74400000000003C240.898,73.74400000000003,240.898,52.101999999999975,240.898,52.101999999999975C240.898,52.101999999999975,240.898,52.101999999999975,240.898,52.101999999999975M65.556,120.93599999999998C62.65,120.93599999999998,59.845,119.834,57.741,117.73000000000002C53.432,113.42200000000003,53.432,106.40800000000002,57.741,102.09899999999999C57.741,102.09899999999999,100.925,58.91500000000002,100.925,58.91500000000002C103.029,56.81099999999998,105.734,55.709,108.74,55.709C111.646,55.709,114.451,56.81099999999998,116.555,58.91500000000002C120.864,63.22300000000001,120.864,70.23700000000002,116.555,74.54599999999999C116.555,74.54599999999999,73.371,117.73000000000002,73.371,117.73000000000002C71.267,119.834,68.461,120.93599999999998,65.556,120.93599999999998C65.556,120.93599999999998,65.556,120.93599999999998,65.556,120.93599999999998M116.555,95.78699999999998C116.555,95.78699999999998,132.386,111.618,132.386,111.618C124.371,117.12900000000002,116.656,123.24099999999999,109.441,129.753C109.441,129.753,96.015,116.327,96.015,116.327C96.015,116.327,116.555,95.78699999999998,116.555,95.78699999999998C116.555,95.78699999999998,116.555,95.78699999999998,116.555,95.78699999999998M400.911,437.054C382.174,455.79,360.231,470.619,335.984,480.839C310.835,491.46,283.982,496.87,256.429,496.87C228.875,496.87,202.022,491.46,176.873,480.839C152.526,470.519,130.683,455.79,111.946,437.054C93.11,418.317,78.381,396.474,68.061,372.127C57.44,346.978,52.029,320.125,52.029,292.571C52.029,265.01800000000003,57.44,238.16500000000002,68.061,213.01600000000002C78.381,188.668,93.11,166.82600000000002,111.846,148.089C130.583,129.353,152.526,114.524,176.773,104.30399999999997C201.922,93.68299999999999,228.775,88.27199999999999,256.328,88.27199999999999C283.882,88.27199999999999,310.735,93.68299999999999,335.884,104.30399999999997C360.231,114.62400000000002,382.074,129.353,400.811,148.089C419.547,166.82600000000002,434.376,188.769,444.596,213.01600000000002C455.217,238.16500000000002,460.627,265.01800000000003,460.627,292.571C460.627,320.125,455.217,346.978,444.596,372.127C434.476,396.474,419.748,418.317,400.911,437.054C400.911,437.054,400.911,437.054,400.911,437.054M256.429,123.64100000000002C163.146,123.64100000000002,87.499,199.289,87.499,292.571C87.499,385.854,163.146,461.501,256.429,461.501C349.711,461.501,425.359,385.854,425.359,292.571C425.359,199.289,349.711,123.64100000000002,256.429,123.64100000000002C256.429,123.64100000000002,256.429,123.64100000000002,256.429,123.64100000000002M365.241,401.384C337.888,428.73699999999997,302.118,444.468,263.743,446.272C263.743,446.272,263.743,416.113,263.743,416.113C263.743,412.005,260.336,408.598,256.228,408.598C252.12,408.598,248.714,412.005,248.714,416.113C248.714,416.113,248.714,446.272,248.714,446.272C210.439,444.368,174.769,428.637,147.516,401.384C120.263,374.131,104.432,338.361,102.628,300.086C102.628,300.086,132.687,300.086,132.687,300.086C136.795,300.086,140.202,296.679,140.202,292.571C140.202,288.46299999999997,136.795,285.057,132.687,285.057C132.687,285.057,102.628,285.057,102.628,285.057C104.432,246.78199999999998,120.263,211.012,147.516,183.75900000000001C174.769,156.50599999999997,210.439,140.675,248.714,138.87099999999998C248.714,138.87099999999998,248.714,169.02999999999997,248.714,169.02999999999997C248.714,173.13799999999998,252.12,176.54500000000002,256.228,176.54500000000002C260.336,176.54500000000002,263.743,173.13799999999998,263.743,169.02999999999997C263.743,169.02999999999997,263.743,138.87099999999998,263.743,138.87099999999998C302.118,140.675,337.888,156.40499999999997,365.241,183.75900000000001C392.494,211.012,408.325,246.78199999999998,410.129,285.057C410.129,285.057,379.769,285.057,379.769,285.057C375.661,285.057,372.255,288.46299999999997,372.255,292.571C372.255,296.679,375.661,300.086,379.769,300.086C379.769,300.086,410.129,300.086,410.129,300.086C408.325,338.361,392.595,374.131,365.241,401.384C365.241,401.384,365.241,401.384,365.241,401.384M339.391,276.64C339.391,276.64,259.034,261.411,259.034,261.411C259.034,261.411,258.633,261.31,258.633,261.31C249.615,260.108,240.497,262.813,233.584,268.825C226.67,274.837,222.763,283.454,222.763,292.571C222.763,301.68899999999996,226.67,310.30600000000004,233.584,316.318C239.395,321.328,246.71,324.033,254.324,324.033C255.727,324.033,257.23,323.933,258.633,323.73199999999997C258.633,323.73199999999997,339.29,308.503,339.29,308.503C347.106,307.3,353.017,300.48699999999997,353.017,292.571C353.017,284.656,347.206,277.84299999999996,339.391,276.64C339.391,276.64,339.391,276.64,339.391,276.64M337.086,293.674C337.086,293.674,256.429,308.903,256.429,308.903C251.719,309.505,247.01,308.102,243.503,304.996C239.896,301.89,237.892,297.281,237.892,292.571C237.892,287.86199999999997,239.996,283.253,243.503,280.147C246.509,277.54200000000003,250.417,276.039,254.324,276.039C255.026,276.039,255.727,276.039,256.429,276.139C256.429,276.139,336.685,291.369,336.685,291.369C336.685,291.369,337.086,291.469,337.086,291.469C337.587,291.56899999999996,338.088,291.97,338.088,292.571C338.088,293.173,337.587,293.573,337.086,293.674C337.086,293.674,337.086,293.674,337.086,293.674" /> </g> </svg>',
                values: {},
                options: {
                    timer: {
                        title: "Timer Settings",
                        position: 1,
                        options: {
                            "timerHeader": {
                                "label": "Header",
                                "defaultValue": "The sale will be over once the timer hits zero!",
                                "widget": "text"
                            },
                            "timerFontColor": {
                                "label": "Timer Font Color",
                                "defaultValue": "#121212",
                                "widget": "color_picker"
                            },
                            "timerBGColor": {
                                "label": "Timer Background Color",
                                "defaultValue": "#25de63",
                                "widget": "color_picker"
                            },
                            "timerDays": {
                                "label": "Day",
                                "defaultValue": "00",
                                "widget": "text"
                            },
                            "timerHours": {
                                "label": "Hours",
                                "defaultValue": "00",
                                "widget": "text"
                            },
                            "timerMinutes": {
                                "label": "Minutes",
                                "defaultValue": "00",
                                "widget": "text"
                            },
                            "timerSeconds": {
                                "label": "Seconds",
                                "defaultValue": "60",
                                "widget": "text"
                            }
                        }
                    }
                },
                renderer: {
                    Viewer: unlayer.createViewer({
                        render(values) {
                            return \`
                                <style>
                                    .\$\{values._meta.htmlID\} {  }.\$\{values._meta.htmlID\} #clock-ticker { display: block; margin-bottom: 15px; text-align: center; color: #000; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; } .\$\{values._meta.htmlID\} #clock-ticker .block { position: relative; display: inline-block; text-align: center; background: \$\{values.timerBGColor\}; padding: 5px 0px; color: \$\{values.timerFontColor\}; margin: 0px 2px 0px 0px; } .\$\{values._meta.htmlID\} #clock-ticker .block .flip-top { width: 88px; height: 39px; line-height: 40px; font-size: 35px; padding: 0px 10px; text-align: center; font-weight: 100; font-family: inherit; } .\$\{values._meta.htmlID\} #clock-ticker .block .labell { font-weight: 700; margin: 5px; font-size: 12px; text-transform: uppercase; width: 88px; line-height: 50px; text-align: center; font-family: inherit; } .\$\{values._meta.htmlID\} .timer-text { text-align: center; font-size: 14px; margin-bottom: 20px; font-family: inherit; }
                                </style>
                                <div class="\$\{values._meta.htmlID\}">
                                    <div id="clock-ticker" class="clearfix">
                                        <div class="timer-text">\$\{values.timerHeader\}</div>
                                        <div style="justify-content: center;display: flex;">
                                            <div class="block">
                                                <span class="flip-top" id="numdays">\$\{values.timerDays\}</span>
                                                <br/>
                                                <span class="labell">Days</span>
                                            </div>
                                            <div class="block">
                                                <span class="flip-top" id="numhours">\$\{values.timerHours\}</span>
                                                <br/>
                                                <span class="labell">Hours</span>
                                            </div>
                                            <div class="block">
                                                <span class="flip-top" id="nummins">\$\{values.timerMinutes\}</span>
                                                <br/>
                                                <span class="labell">Minutes</span>
                                            </div>
                                            <div class="block">
                                                <span class="flip-top" id="numsecs">\$\{values.timerSeconds\}</span>
                                                <br/>
                                                <span class="labell">Seconds</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            \`
                        }
                    }),
                    exporters: {
                        web: function (values) {
                            return \`
                                <style>
                                    .\$\{values._meta.htmlID\} {  }.\$\{values._meta.htmlID\} #clock-ticker { display: block; margin-bottom: 15px; text-align: center; color: #000; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; } .\$\{values._meta.htmlID\} #clock-ticker .block { position: relative; display: inline-block; text-align: center; background: \$\{values.timerBGColor\}; padding: 5px 0px; color: \$\{values.timerFontColor\}; margin: 0px 2px 0px 0px; } .\$\{values._meta.htmlID\} #clock-ticker .block .flip-top { width: 88px; height: 39px; line-height: 40px; font-size: 35px; padding: 0px 10px; text-align: center; font-weight: 100; font-family: inherit; } .\$\{values._meta.htmlID\} #clock-ticker .block .labell { font-weight: 700; margin: 5px; font-size: 12px; text-transform: uppercase; width: 88px; line-height: 50px; text-align: center; font-family: inherit; } .\$\{values._meta.htmlID\} .timer-text { text-align: center; font-size: 14px; margin-bottom: 20px; font-family: inherit; }
                                </style>
                                <div class="\$\{values._meta.htmlID\}">
                                    <div id="clock-ticker" class="clearfix">
                                        <div class="timer-text">\$\{values.timerHeader\}</div>
                                        <div class="block">
                                            <span class="flip-top" id="numdays">\$\{values.timerDays\}</span>
                                            <br/>
                                            <span class="labell">Days</span>
                                        </div>
                                    
                                        <div class="block">
                                            <span class="flip-top" id="numhours">\$\{values.timerHours\}</span>
                                            <br/>
                                            <span class="labell">Hours</span>
                                        </div>
                                    
                                        <div class="block">
                                            <span class="flip-top" id="nummins">\$\{values.timerMinutes\}</span>
                                            <br/>
                                            <span class="labell">Minutes</span>
                                        </div>
                                    
                                        <div class="block">
                                            <span class="flip-top" id="numsecs">\$\{values.timerSeconds\}</span>
                                            <br/>
                                            <span class="labell">Seconds</span>
                                        </div>
                                    </div>
                                </div>
                                <script>
                                    function runTimer(containerClassName) {
                                        var timerContainer = document.querySelector("." + containerClassName);
                                        var deleteCookie = (name) => {
                                            document.cookie = name + '=; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';
                                        }
                                        var serializeCookie = (name, val) => encodeURIComponent(name)+"="+encodeURIComponent(val);
                                        var parseCookie = str =>
                                            str.split(';').map(v => v.split('=')).reduce((acc, v) => {
                                                acc[decodeURIComponent(v[0].trim())] = decodeURIComponent(v[1].trim());
                                                return acc;
                                            }, {});
                                        document.cookie = serializeCookie("init", "init");
                                        var setDay = parseInt("\$\{values.timerDays\}");
                                        var setHour = parseInt("\$\{values.timerHours\}");
                                        var setMinutes = parseInt("\$\{values.timerMinutes\}");
                                        var setSeconds = parseInt("\$\{values.timerSeconds\}");
                                        var nn = (setDay * 1000 * 60 * 60 * 24) + (setHour * 1000 * 60 * 60) + (setMinutes * 1000 * 60) + (setSeconds * 1000);
                                        var curtime = new Date().getTime();
                                        var ff = curtime + nn;
                                        var x = setInterval(function() {
                                            var now = new Date().getTime();
                                            var distance = ff - now;
                                            if (parseCookie(document.cookie).lastSession !== undefined) {
                                                distance = distance - (curtime - parseCookie(document.cookie).lastSession);
                                            } else {
                                                document.cookie = serializeCookie("lastSession", now)
                                            }
                                            var days = Math.floor(distance / (1000 * 60 * 60 * 24));
                                            var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                            var mins = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                                            var seconds = Math.floor((distance % (1000 * 60)) / 1000);
                                            
                                            timerContainer.querySelector("#numdays").innerText = ('0' + days).slice(-2);
                                            timerContainer.querySelector("#numhours").innerText = ('0' + hours).slice(-2);
                                            timerContainer.querySelector("#nummins").innerText = ('0' + mins).slice(-2);
                                            timerContainer.querySelector("#numsecs").innerText = ('0' + seconds).slice(-2);
                                            if (distance < 0) {
                                                clearInterval(x);
                                                deleteCookie("lastSession");
                                                timerContainer.querySelector("#numdays").innerText = "00";
                                                timerContainer.querySelector("#numhours").innerText = "00";
                                                timerContainer.querySelector("#nummins").innerText = "00";
                                                timerContainer.querySelector("#numsecs").innerText = "00";
                                        
                                            }
                                        }, 1000);
                                    }
                                    runTimer("\$\{values._meta.htmlID\}");
                                </script>
                            \`
                        }
                    }
                }
            });
            
            // survey widget
            unlayer.registerPropertyEditor({
                name: 'survey_form',
                layout: 'bottom',
                Widget: unlayer.createWidget({
                    render(value) {
                        return \`<div class="blockbuilder-widget blockbuilder-link-widget">
                            <div class="row eiCcjJ">
                                <div class="blockbuilder-widget-label col-5">
                                    <label class="blockbuilder-label-primary text-center">
                                        <span>Question</span>
                                    </label>
                                </div>
                                <div class="blockbuilder-widget-label col-7">
                                    <label class="blockbuilder-label-primary text-center">
                                        <span>Choices (Separated by comma)</span>
                                    </label>
                                </div>
                            </div>
                            <div class="survey-form-container">
                                <!-- Survey form will insert here -->
                            </div>
                        </div>\`
                    },
                    mount(node, value, updateValue) {
                        var surveyContainer = node.querySelector(".survey-form-container");
                        // add one more field so user can add new questionaire
                        surveyContainer.innerHTML = \`<div class="row eiCcjJ" style="margin-top: 5px;"> <div class="col-5"> <input type="text" class="form-control survey-form-question" /> </div> <div class="col-7"> <input type="text" class="form-control survey-form-choices" /> </div> </div>\`;
                        // parse value and create input tag for it.
                        var parsedValue = JSON.parse(value);
                        parsedValue.forEach(q => {
                            surveyContainer.innerHTML += \`
                                <div class="row eiCcjJ" style="margin-top: 5px;">
                                    <div class="col-5">
                                        <input type="text" class="form-control survey-form-question" />
                                    </div>
                                    <div class="col-7">
                                        <input type="text" class="form-control survey-form-choices" />
                                    </div>
                                </div>
                            \`;
                        })

                        var questions = node.querySelectorAll(".survey-form-question");
                        var choices = node.querySelectorAll(".survey-form-choices");
                        // onchange listeners
                        questions.forEach((element,i) => {
                            element.value = parsedValue[i] ? parsedValue[i].question : "";
                            element.onchange = event => {
                                parsedValue[i] = {
                                    question: event.target.value,
                                    choices: parsedValue[i] ? parsedValue[i].choices : ""
                                }
                                updateValue(JSON.stringify(parsedValue));
                            }
                        })
                        choices.forEach((element,i) => {
                            element.value = parsedValue[i] ? parsedValue[i].choices : "";
                            element.onchange = event => {
                                parsedValue[i] = {
                                    question: parsedValue[i] ? parsedValue[i].question : "",
                                    choices: event.target.value
                                }
                                updateValue(JSON.stringify(parsedValue));
                            }
                        })
                    }
                })
            });
            
            // klaviyo email 
            unlayer.registerPropertyEditor({
                name: 'klaviyo_email_list',
                layout: 'bottom',
                Widget: unlayer.createWidget({
                    render(value) {
                        return \`
                            <div class="blockbuilder-widget blockbuilder-link-widget">
                                <div class="row eiCcjJ">
                                    <div class="blockbuilder-widget-label col-12">
                                        <label class="blockbuilder-label-primary">
                                            <span>Send email via klaviyo</span>
                                        </label>
                                        <!-- start toggle button for shopify variant options -->
                                        <label class="blockbuilder-label-right">
                                            <div class="react-toggle">
                                                <div class="react-toggle-track">
                                                    <div class="react-toggle-track-check">
                                                        <svg width="14" height="11" viewBox="0 0 14 11">
                                                            <title>switch-check</title>
                                                            <path d="M11.264 0L5.26 6.004 2.103 2.847 0 4.95l5.26 5.26 8.108-8.107L11.264 0" fill="#fff" fill-rule="evenodd"></path>
                                                        </svg>
                                                    </div>
                                                    <div class="react-toggle-track-x">
                                                        <svg width="10" height="10" viewBox="0 0 10 10">
                                                            <title>switch-x</title>
                                                            <path d="M9.9 2.12L7.78 0 4.95 2.828 2.12 0 0 2.12l2.83 2.83L0 7.776 2.123 9.9 4.95 7.07 7.78 9.9 9.9 7.776 7.072 4.95 9.9 2.12" fill="#fff" fill-rule="evenodd"></path>
                                                        </svg>
                                                    </div>
                                                </div>
                                                <div class="react-toggle-thumb"></div>
                                                <input class="react-toggle-screenreader-only" type="checkbox">
                                            </div>
                                        </label>
                                        <!-- end toggle button for shopify variant options -->
                                        <div style="width: 100%; position: relative;">
                                            <ul class="shopify-show-result" style="border-bottom: 5px solid #293039;">
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div id="blockbuilder-widget-variant-menu" style="overflow-y: auto; max-height: 245px; overflow-x: hidden;">
                                    <!-- Dynamic email list Will Appear here -->
                                </div>
                            </div>
                        \`
                    },
                    mount(node, value, updateValue) {
                        var showResult = node.querySelector(".shopify-show-result");
                        var toggleParent = node.querySelector(".react-toggle");
                        var toggleCheckbox = node.querySelector("input[type='checkbox']");
                        var klaviyoPK = "${state.klaviyoPK}";
                        if(value){
                            toggleParent.classList.add("react-toggle--checked");
                            toggleCheckbox.checked = true;
                        }
                        toggleCheckbox.onclick = event => {
                            toggleParent.classList.toggle("react-toggle--checked");
                            if(event.target.checked){
                                showResult.innerHTML = \`<li>Getting klaviyo email list please wait...</li>\`
                                fetch('/getKlaviyoSegments/'+klaviyoPK)
                                .then(res => res.json())
                                .then(res => {
                                    res = JSON.parse(res);
                                    showResult.innerHTML = \`<li>Select Email List</li>\`
                                    res.forEach(el => {
                                        showResult.innerHTML += \`<li class="email_listid" data-listid="\$\{el.list_id\}">\$\{el.list_name\}</li>\`
                                    })
                                    node.querySelectorAll(".email_listid").forEach(el => {
                                        el.onclick = event => {
                                            var listid = event.target.getAttribute("data-listid");
                                            value = listid;
                                            showResult.innerHTML = "";
                                            updateValue(value);
                                        }
                                    })
                                })
                            } else {
                                showResult.innerHTML = "";
                                updateValue("");
                            }
                        }
                    }
                })
            });

            console.log("12. Initializing Survey form...");
            unlayer.registerTool({
                type: 'survey',
                category: 'contents',
                label: 'Survey Form',
                icon: '<svg class="svg-inline--fa fa-w-14 fa-w-20 fa-3x" fill="#fff" version="1.1" viewBox="0 0 512 512"> <g> <circle cx="53.333" cy="74.667" r="10.667"/> <circle cx="96" cy="74.667" r="10.667"/> <circle cx="138.667" cy="74.667" r="10.667"/> <path d="M117.333,234.667H352c5.896,0,10.667-4.771,10.667-10.667s-4.771-10.667-10.667-10.667H117.333 c-5.896,0-10.667,4.771-10.667,10.667S111.438,234.667,117.333,234.667z"/> <path d="M245.333,341.333h-128c-5.896,0-10.667,4.771-10.667,10.667c0,5.896,4.771,10.667,10.667,10.667h128 c5.896,0,10.667-4.771,10.667-10.667C256,346.104,251.229,341.333,245.333,341.333z"/> <path d="M471.167,149.333c-0.618,0-1.217,0.155-1.833,0.184V64c0-23.531-19.146-42.667-42.667-42.667h-384 C19.146,21.333,0,40.469,0,64v384c0,23.531,19.146,42.667,42.667,42.667h384c23.521,0,42.667-19.135,42.667-42.667V249.745 l30.708-30.703c0,0,0,0,0-0.01c7.604-7.604,11.958-18.125,11.958-28.865C512,167.646,493.688,149.333,471.167,149.333z M21.333,64c0-11.76,9.563-21.333,21.333-21.333h384C438.438,42.667,448,52.24,448,64v42.667H21.333V64z M448,448 c0,11.76-9.563,21.333-21.333,21.333h-384c-11.771,0-21.333-9.573-21.333-21.333V128H448v28.62 c-2.025,1.392-3.962,2.923-5.708,4.672l-116.06,116.042H117.333c-5.896,0-10.667,4.771-10.667,10.667s4.771,10.667,10.667,10.667 h191.785l-10.243,51.24c-0.708,3.5,0.396,7.115,2.917,9.635c2.021,2.021,4.75,3.125,7.542,3.125c0.688,0,1.396-0.073,2.083-0.208 l53.313-10.667c2.083-0.417,3.979-1.427,5.458-2.917L448,271.076V448z M357.396,331.51l-34.458,6.896l6.896-34.5l96.828-96.828 l27.587,27.587L357.396,331.51z M484.958,203.958l-15.625,15.625l-27.589-27.589l15.63-15.63 c3.625-3.615,8.646-5.698,13.792-5.698c10.75,0,19.5,8.75,19.5,19.5C490.667,195.292,488.583,200.323,484.958,203.958z"/> </g> </svg>',
                values: {},
                options: {
                    timer: {
                        title: "Survey Form Settings",
                        position: 1,
                        options: {
                            "questionaire": {
                                "label": "Header",
                                "defaultValue": JSON.stringify([{question: "Question 1", choices: "Yes,No"},{question: "Question 2", choices: "Yes, No, Maybe"}]),
                                "widget": "survey_form"
                            },
                            "fbTracking": {
                                "label": "Track facebook",
                                "defaultValue": false,
                                "widget": "toggle"
                            },
                            "requireEmail": {
                                "label": "Track facebook",
                                "defaultValue": "",
                                "widget": "klaviyo_email_list"
                            },
                            "h1FontWeight": {
                                "label": "Header 1 Font Weight",
                                "defaultValue": "700",
                                "widget": "counter"
                            },
                            "successHeader1": {
                                "label": "Success Header 1",
                                "defaultValue": "Checking against our proprietary Smart Match System™",
                                "widget": "text"
                            },
                            "h1FontSize": {
                                "label": "Header 1 Font Size",
                                "defaultValue": "20px",
                                "widget": "px"
                            },
                            "h2FontWeight": {
                                "label": "Header 2 Font Weight",
                                "defaultValue": "700",
                                "widget": "counter"
                            },
                            "successHeader2": {
                                "label": "Success Header 2",
                                "defaultValue": "Congratulations! Clicking the button below confirms that the answers you have just given are true and qualify you to view the presentation that teaches you how to start receiving the rent checks that you are entitled to.",
                                "widget": "text"
                            },
                            "h2FontSize": {
                                "label": "Header 2 Font Size",
                                "defaultValue": "18px",
                                "widget": "px"
                            },
                            "successButtonText": {
                                "label": "Success Button Text",
                                "defaultValue": "I QUALIFY TO WATCH!",
                                "widget": "text"
                            },
                            "successLink": {
                                "label": "Link",
                                "defaultValue": {
                                    url: "#",
                                    target: "_self"
                                },
                                "widget": "link_list"
                            },
                            "fontSize": {
                                "label": "Question & Button Font Size",
                                "defaultValue": "15px",
                                "widget": "px"
                            },
                            "fontColor": {
                                "label": "Question Color",
                                "defaultValue": "#373a3c",
                                "widget": "color_picker"
                            },
                            "backgroundColor": {
                                "label": "Background Color",
                                "defaultValue": "",
                                "widget": "color_picker"
                            },
                            "buttonPadding": {
                                "label": "Button Padding",
                                "defaultValue": "10px 20px",
                                "widget": "padding"
                            },
                            "buttonColors": {
                                "label": "Button Color",
                                "defaultValue": {
                                    "color": "#FFF",
                                    "backgroundColor": "#26c686",
                                    "hoverColor": "#2A92BF"
                                },
                                "widget": "button_color"
                            },
                        }
                    }
                },
                renderer: {
                    Viewer: unlayer.createViewer({
                        render(values) {
                            var questionaire = JSON.parse(values.questionaire);
                            return \`
                                <style>
                                    .\$\{values._meta.htmlID\} {
                                        text-align: center;
                                    }
                                    .\$\{values._meta.htmlID\} .q-container label, .\$\{values._meta.htmlID\} .q-container p {
                                        font-size: \$\{values.fontSize\}; color: \$\{values.fontColor\};
                                    }
                                    .\$\{values._meta.htmlID\} .q-container button, #checkingvalid button {
                                        font-size: \$\{values.fontSize\}; color: \$\{values.buttonColors.color\}; background-color: \$\{values.buttonColors.backgroundColor\}; border: 1px solid \$\{values.buttonColors.backgroundColor\}; padding: \$\{values.buttonPadding\}; border-radius: 5px; margin: 0 5px; cursor: pointer;
                                    }
                                    .\$\{values._meta.htmlID\} .q-container button:hover, #checkingvalid button:hover {
                                        background-color: \$\{values.buttonColors.hoverColor\}; border: 1px solid \$\{values.buttonColors.hoverColor\};
                                    }
                                    .\$\{values._meta.htmlID\} .q-container, #checkingvalid {
                                        width: -webkit-fill-available; display: none; padding: 15px 30px; background-color: \$\{values.backgroundColor\}; text-align: center;
                                    }
                                    #checkingvalid .title {
                                        font-size: \$\{values.h1FontSize\}; font-weight: \$\{values.h1FontWeight\}; margin-bottom: 20px;
                                    }
                                    #checkingvalid .questions {
                                        font-size: \$\{values.h2FontSize\}; font-weight: \$\{values.h2FontWeight\}; margin-top: 20px;
                                    }
                                    #checkingvalid p {
                                        font-size: \$\{values.fontSize\}; color: \$\{values.fontColor\};
                                    }
                                </style>
                                <div class="\$\{values._meta.htmlID\} q-parent-container">
                                    \$\{(() => {
                                        return questionaire.map((arr, index) => {
                                            var choices = arr.choices.split(',');
                                            var buttonDOMS = "";
                                            choices.forEach(choice => {
                                                buttonDOMS += \`<button>\$\{choice.trim()\}</button>\`;
                                            })
                                            if(index == 0){
                                                return \`
                                                    <div class="q-container" style="display: block;">
                                                        <div style="margin: 10px 0;">
                                                            <label>\$\{arr.question\}</label>
                                                        </div>
                                                        \$\{buttonDOMS\}
                                                    </div>
                                                \`;
                                            }
                                            return \`
                                                <div class="q-container">
                                                    <div style="margin: 10px 0;">
                                                        <label>\$\{arr.question\}</label>
                                                    </div>
                                                    \$\{buttonDOMS\}
                                                </div>
                                            \`;
                                        }).join('')
                                    })()\}
                                </div>
                            \`
                        }
                    }),
                    exporters: {
                        web: function (values) {
                            var questionaire = JSON.parse(values.questionaire);
                            return \`
                                <style>
                                    .\$\{values._meta.htmlID\} {
                                        text-align: center;
                                    }
                                    .\$\{values._meta.htmlID\} .q-container label, .\$\{values._meta.htmlID\} .q-container p {
                                        font-size: \$\{values.fontSize\}; color: \$\{values.fontColor\};
                                    }
                                    .\$\{values._meta.htmlID\} .q-container button, #checkingvalid button {
                                        font-size: \$\{values.fontSize\}; color: \$\{values.buttonColors.color\}; background-color: \$\{values.buttonColors.backgroundColor\}; border: 1px solid \$\{values.buttonColors.backgroundColor\}; padding: \$\{values.buttonPadding\}; border-radius: 5px; margin: 0 5px; cursor: pointer;
                                    }
                                    .\$\{values._meta.htmlID\} .q-container button:hover, #checkingvalid button:hover {
                                        background-color: \$\{values.buttonColors.hoverColor\}; border: 1px solid \$\{values.buttonColors.hoverColor\};
                                    }
                                    .\$\{values._meta.htmlID\} .q-container, #checkingvalid {
                                        width: -webkit-fill-available; display: none; padding: 15px 30px; background-color: \$\{values.backgroundColor\}; text-align: center;
                                    }
                                    #checkingvalid .title {
                                        font-size: \$\{values.h1FontSize\}; font-weight: \$\{values.h1FontWeight\}; margin-bottom: 20px;
                                    }
                                    #checkingvalid .questions {
                                        font-size: \$\{values.h2FontSize\}; font-weight: \$\{values.h2FontWeight\}; margin-top: 20px;
                                    }
                                    #checkingvalid p {
                                        font-size: \$\{values.fontSize\}; color: \$\{values.fontColor\};
                                    }
                                </style>
                                <div class="\$\{values._meta.htmlID\} q-parent-container">
                                    \$\{(() => {
                                        return questionaire.map((arr, index) => {
                                            var choices = arr.choices.split(',');
                                            var buttonDOMS = "";
                                            choices.forEach(choice => {
                                                buttonDOMS += \`<button onclick="nextq()">\$\{choice.trim()\}</button>\`;
                                            })
                                            if(index == 0){
                                                return \`
                                                    <div class="q-container" style="display: block;">
                                                        <div style="margin: 10px 0;">
                                                            <label>\$\{arr.question\}</label>
                                                        </div>
                                                        \$\{buttonDOMS\}
                                                    </div>
                                                \`;
                                            }
                                            return \`
                                                <div class="q-container">
                                                    <div style="margin: 10px 0;">
                                                        <label>\$\{arr.question\}</label>
                                                    </div>
                                                    \$\{buttonDOMS\}
                                                </div>
                                            \`;
                                        }).join('')
                                    })()\}
                                </div>
                                <div id="checkingvalid">
                                    <p class="title">\$\{values.successHeader1\}</p>
                                    <div id="qtext"></div>
                                    <p class="questions"><img src="https://cdn.productlistgenie.com/images/NWMwYTg1ZjA3NzMwMDEzMjdiMDM5MDRj/1565889735571loadingforvalid.gif" width="30%" /></p>
                                </div>
                                <script>
                                    var questionaire = \$\{JSON.stringify(questionaire)\}
                                    var questions = document.querySelectorAll(".q-container");
                                    var counter = 0;
                                    function nextq() {
                                        questions[counter].style.display = "none"; // hide previous step
                                        counter++;
                                        if (counter == questions.length) {
                                            document.getElementById("checkingvalid").style.display = "block";
                                            var text = "";
                                            var i;
                                            for (i = 0; i < questions.length; i++) {
                                                text += "<div class='allQuestion' >"+questionaire[i].question+"</div>";
                                            }
                                            counter = 0;
                                            populateAllQuestion()
                                        } else {
                                            questions[counter].style.display = "block"; // show next step
                                        }
                                    }
                                    function populateAllQuestion() {
                                        var allQuestion = questions.length;
                                        boboelemet = "";
                                        var intervalId = setInterval(function () {
                                            if (counter <= allQuestion) {
                                                boboelemet += "<p id='validtext' >Question "+(counter+1)+": Valid!</p>";
                                                counter++;
                                            }
                                            document.getElementById("qtext").innerHTML = boboelemet;
                                            if (counter == allQuestion) {
                                                setTimeout(function () {
                                                    boboelemet += "<div id='extradiv'></div>";
                                                    document.getElementById("qtext").innerHTML = boboelemet;
                                                    var questionspass = '<p class="questions">\$\{values.successHeader2\}</p>';
                                                    document.getElementsByClassName("questions")[0].innerHTML = questionspass;
                                                    var klaviyoID = "\$\{values.requireEmail\}";
                                                    if(klaviyoID){
                                                        document.getElementsByClassName("questions")[0].innerHTML += \\\`<br><input placeholder="Enter Name" type="text" name="firstName" style="border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204); padding: 10px; color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); font-size: 12px; width: 100%; max-width: 320px; border-radius: 0px;"><br><input placeholder="Enter Email" type="email" name="email" style="border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204); padding: 10px; color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); font-size: 12px; width: 100%; max-width: 320px; border-radius: 0px; margin: 10px 0;">\\\`;
                                                        document.getElementsByClassName("questions")[0].innerHTML += \\\`<br> <button style="min-width: 300;" onclick="sendSurvey(this)">\$\{values.successButtonText\}</button>\\\`;
                                                    } else {
                                                        document.getElementsByClassName("questions")[0].innerHTML += \\\`<br> <button style="min-width: 300;" onclick="window.open('\$\{values.successLink.url\}','\$\{values.successLink.target\}')">\$\{values.successButtonText\}</button>\\\`;
                                                    }

                                                    // fbq
                                                    var useTrack = \$\{values.fbTracking\};
                                                    if(useTrack && fbq){
                                                        fbq('track', 'AddToCart');
                                                    }
                                                    clearInterval(intervalId)
                                                }, 1000);
                        
                                            }
                                        }, 1200);
                                    }
                                    function sendSurvey(element){
                                        // klviyo email
                                        var name = element.parentNode.querySelector("[name='firstName']").value;
                                        var email = element.parentNode.querySelector("[name='email']").value;
                                        var usePLGabandonment = ${this.state.page_data.funnel_use_email_abandonment};
                                        var klaviyoID = "\$\{values.requireEmail\}";
                                        if(usePLGabandonment && name && email){
                                            var url = "/send_order_confirmation?pk=${state.klaviyoPK}&ocid="+klaviyoID+"&name="+name+"&email="+email+"&product=survey&price=1&quantity=1&a=yes";
                                            fetch(url)
                                            .then(result => {
                                                console.log("survey send success.");
                                                window.open('\$\{values.successLink.url\}','\$\{values.successLink.target\}');
                                            })
                                        } else {
                                            alert("please complete the form above.");
                                        }
                                        // end klaviyo email
                                    }
                                </script>
                            \`
                        }
                    }
                }
            });

            console.log("13. Initializing MoneyBackGuarantee...");
            unlayer.registerTool({
                type: 'MoneyBackGuarantee',
                category: 'contents',
                label: 'Money Back',
                icon: '<svg class="svg-inline--fa fa-w-14 fa-w-20 fa-3x" fill="#fff" version="1.1" viewBox="0 0 512 512"> <g> <circle cx="53.333" cy="74.667" r="10.667"/> <circle cx="96" cy="74.667" r="10.667"/> <circle cx="138.667" cy="74.667" r="10.667"/> <path d="M117.333,234.667H352c5.896,0,10.667-4.771,10.667-10.667s-4.771-10.667-10.667-10.667H117.333 c-5.896,0-10.667,4.771-10.667,10.667S111.438,234.667,117.333,234.667z"/> <path d="M245.333,341.333h-128c-5.896,0-10.667,4.771-10.667,10.667c0,5.896,4.771,10.667,10.667,10.667h128 c5.896,0,10.667-4.771,10.667-10.667C256,346.104,251.229,341.333,245.333,341.333z"/> <path d="M471.167,149.333c-0.618,0-1.217,0.155-1.833,0.184V64c0-23.531-19.146-42.667-42.667-42.667h-384 C19.146,21.333,0,40.469,0,64v384c0,23.531,19.146,42.667,42.667,42.667h384c23.521,0,42.667-19.135,42.667-42.667V249.745 l30.708-30.703c0,0,0,0,0-0.01c7.604-7.604,11.958-18.125,11.958-28.865C512,167.646,493.688,149.333,471.167,149.333z M21.333,64c0-11.76,9.563-21.333,21.333-21.333h384C438.438,42.667,448,52.24,448,64v42.667H21.333V64z M448,448 c0,11.76-9.563,21.333-21.333,21.333h-384c-11.771,0-21.333-9.573-21.333-21.333V128H448v28.62 c-2.025,1.392-3.962,2.923-5.708,4.672l-116.06,116.042H117.333c-5.896,0-10.667,4.771-10.667,10.667s4.771,10.667,10.667,10.667 h191.785l-10.243,51.24c-0.708,3.5,0.396,7.115,2.917,9.635c2.021,2.021,4.75,3.125,7.542,3.125c0.688,0,1.396-0.073,2.083-0.208 l53.313-10.667c2.083-0.417,3.979-1.427,5.458-2.917L448,271.076V448z M357.396,331.51l-34.458,6.896l6.896-34.5l96.828-96.828 l27.587,27.587L357.396,331.51z M484.958,203.958l-15.625,15.625l-27.589-27.589l15.63-15.63 c3.625-3.615,8.646-5.698,13.792-5.698c10.75,0,19.5,8.75,19.5,19.5C490.667,195.292,488.583,200.323,484.958,203.958z"/> </g> </svg>',
                values: {},
                options: {
                    timer: {
                        title: "Money Back Guarantee | Settings", //april12
                        position: 1,
                        options: {
                            "MoneyBackGuaranteeIcon": {
                                "label": "Badge Image(Recommended Size 200x200 pixels)",
                                "defaultValue": {
                                    "url": "https://via.placeholder.com/100x100?text=ICON",
                                    "width": 500,
                                    "height": 100
                                },
                                "widget": "image"
                            },
                            "curvedWidth": {
                                "label": "Width",
                                "defaultValue": "60%",
                                "widget": "width"
                            },                        
                            "backgroundColor": {
                                "label": "Background Color",
                                "defaultValue": "#ececec",
                                "widget": "color_picker"
                            },
                            "Title": {
                                "label": "Test",
                                "defaultValue": "30 Day Money Back Guarantee",
                                "widget": "text"
                            },
                            "TitleFontColor": {
                                "label": "Title Color",
                                "defaultValue": "#373a3c",
                                "widget": "color_picker"
                            },
                            "SubText": {
                                "label": "SubText",
                                "defaultValue": "100% Iron-Clad Guarantee that Straight Comfort will work for you! You risk nothing! if you are not completely satisfied with purchase, we offer a 30 day 100% money back guarantee ",
                                "widget": "text"
                            },
                            "SubTextFontColor": {
                                "label": "Text Color",
                                "defaultValue": "#373a3c",
                                "widget": "color_picker"
                            }
                        }
                    }
                },
                renderer: {
                    Viewer: unlayer.createViewer({
                        render(values) {
                            var containerID = values._meta.htmlID;
                            return \`
                                <style>
                                    .\$\{containerID\}-curved {
                                        margin: 0 auto;
                                        width: \$\{values.curvedWidth\};                       
                                        height: 300px;
                                        background: \$\{values.backgroundColor\};
                                        position: relative;
                                        border-radius: 3px;
                                        text-align: center;
                                        padding: 20px;
                                        box-shadow: rgba(111, 101, 101, 0.75) 0px 0px 2px 0px;
                                    }
                                    .\$\{containerID\}-curved:after{
                                        background: white;
                                        position: absolute;
                                        content: "";
                                        left:0;
                                        margin: 0 auto;
                                        right:0;
                                        top: -55px; 
                                        height: 117px; 
                                        width: 130px;
                                        border-radius: 20% 20% 60% 60%;
                                    }
                                </style>
                                <div class="\$\{containerID\}-container">     
                                    <div class="\$\{containerID\}-curved" style="margin-top: 100px;display: flex;flex-wrap: wrap;justify-content: center;word-break: break-all;height:auto;"> 
                                        <img src="\$\{values.MoneyBackGuaranteeIcon.url\}" style="width: 120px;height: 120px;top: -70px;position: absolute;z-index: 99;">
                                        <h2 style="font-size: 1.5em;padding: 40px 0px 0px 0px;font-weight: 900;font-family: sans-serif;color:\$\{values.TitleFontColor\};">\$\{values.Title\}</h2>
                                        <p style="margin-bottom: 10px;font-size: 1em;font-weight: 100;font-family: sans-serif;color:\$\{values.SubTextFontColor\};">\$\{values.SubText\}</p>
                                    </div>
                                </div>
                            \`
                        }
                    }),
                    exporters: {
                        web: function (values) {
                            var containerID = values._meta.htmlID;
                            return \`
                                <style>
                                    .\$\{containerID\}-curved {
                                        margin: 0 auto;
                                        width: \$\{values.curvedWidth\};    
                                        height: 300px;
                                        background: \$\{values.backgroundColor\};
                                        position: relative;
                                        border-radius: 3px;
                                        text-align: center;
                                        padding: 20px;
                                        box-shadow: rgba(111, 101, 101, 0.75) 0px 0px 2px 0px;
                                    }
                                    .\$\{containerID\}-curved:after{
                                        background: white;
                                        position: absolute;
                                        content: "";
                                        left:0;
                                        margin: 0 auto;
                                        right:0;
                                        top: -55px; 
                                        height: 117px; 
                                        width: 130px;
                                        border-radius: 20% 20% 60% 60%;
                                    }
                                </style>
                                <div class="\$\{containerID\}-container">     
                                    <div class="\$\{containerID\}-curved" style="margin-top: 100px;display: flex;flex-wrap: wrap;justify-content: center;word-break: break-all;height:auto;"> 
                                        <img src="\$\{values.MoneyBackGuaranteeIcon.url\}" style="width: 120px;height: 120px;top: -70px;position: absolute;z-index: 99;">
                                        <h2 style="font-size: 1.5em;padding: 40px 0px 0px 0px;font-weight: 900;font-family: sans-serif;color:\$\{values.TitleFontColor\};">\$\{values.Title\}</h2>
                                        <p style="margin-bottom: 10px;font-size: 1em;font-weight: 100;font-family: sans-serif;color:\$\{values.SubTextFontColor\};">\$\{values.SubText\}</p>
                                    </div>
                                </div>
                            \`
                        }
                    }
                }
            });

            console.log("14. Initializing Receipt Form...");
            unlayer.registerTool({
                type: 'Receipt',
                category: 'contents',
                label: 'Payment Breakdown',
                icon: '<svg class="svg-inline--fa fa-w-14 fa-w-20 fa-3x" fill="#fff" version="1.1" viewBox="0 0 512 512"> <g> <circle cx="53.333" cy="74.667" r="10.667"/> <circle cx="96" cy="74.667" r="10.667"/> <circle cx="138.667" cy="74.667" r="10.667"/> <path d="M117.333,234.667H352c5.896,0,10.667-4.771,10.667-10.667s-4.771-10.667-10.667-10.667H117.333 c-5.896,0-10.667,4.771-10.667,10.667S111.438,234.667,117.333,234.667z"/> <path d="M245.333,341.333h-128c-5.896,0-10.667,4.771-10.667,10.667c0,5.896,4.771,10.667,10.667,10.667h128 c5.896,0,10.667-4.771,10.667-10.667C256,346.104,251.229,341.333,245.333,341.333z"/> <path d="M471.167,149.333c-0.618,0-1.217,0.155-1.833,0.184V64c0-23.531-19.146-42.667-42.667-42.667h-384 C19.146,21.333,0,40.469,0,64v384c0,23.531,19.146,42.667,42.667,42.667h384c23.521,0,42.667-19.135,42.667-42.667V249.745 l30.708-30.703c0,0,0,0,0-0.01c7.604-7.604,11.958-18.125,11.958-28.865C512,167.646,493.688,149.333,471.167,149.333z M21.333,64c0-11.76,9.563-21.333,21.333-21.333h384C438.438,42.667,448,52.24,448,64v42.667H21.333V64z M448,448 c0,11.76-9.563,21.333-21.333,21.333h-384c-11.771,0-21.333-9.573-21.333-21.333V128H448v28.62 c-2.025,1.392-3.962,2.923-5.708,4.672l-116.06,116.042H117.333c-5.896,0-10.667,4.771-10.667,10.667s4.771,10.667,10.667,10.667 h191.785l-10.243,51.24c-0.708,3.5,0.396,7.115,2.917,9.635c2.021,2.021,4.75,3.125,7.542,3.125c0.688,0,1.396-0.073,2.083-0.208 l53.313-10.667c2.083-0.417,3.979-1.427,5.458-2.917L448,271.076V448z M357.396,331.51l-34.458,6.896l6.896-34.5l96.828-96.828 l27.587,27.587L357.396,331.51z M484.958,203.958l-15.625,15.625l-27.589-27.589l15.63-15.63 c3.625-3.615,8.646-5.698,13.792-5.698c10.75,0,19.5,8.75,19.5,19.5C490.667,195.292,488.583,200.323,484.958,203.958z"/> </g> </svg>',
                values: {},
                options: {
                    timer: {
                        title: "Payment Breakdown Settings",
                        position: 1,
                        options: {
                            "backgroundColor": {
                                "label": "Background Color",
                                "defaultValue": "#ececec",
                                "widget": "color_picker"
                            },
                            "container2Width": {
                                "label": "Width",
                                "defaultValue": "60%",
                                "widget": "width"
                            },
                            "Shipping": {
                                "label": "Shipping Price",
                                "defaultValue": "0",
                                "widget": "text"
                            },
                            "TaxesAndFees": {
                                "label": "Taxes and Fees (Percentage)",
                                "defaultValue": "0",
                                "widget": "text"
                            },
                            "TitleFontColor": {
                                "label": "Title Color",
                                "defaultValue": "#373a3c",
                                "widget": "color_picker"
                            },
                            "PriceFontColor": {
                                "label": "Price Text Color",
                                "defaultValue": "#373a3c",
                                "widget": "color_picker"
                            },
                            "BotBorderColor": {
                                "label": "Bottom Border Color",
                                "defaultValue": "#cfd3d6",
                                "widget": "color_picker"
                            }
                        }
                    }
                },
                renderer: {
                    Viewer: unlayer.createViewer({
                        render(values) {                        
                            var containerID = values._meta.htmlID;
                            return \`
                                <style>
                                    .\$\{containerID\}-container2{
                                        margin: 0 auto;
                                        width:\$\{values.container2Width\};
                                        height: auto;
                                        background: \$\{values.backgroundColor\};
                                        position: relative;
                                        border-radius: 3px;
                                        text-align: center;
                                        overflow: hidden;
                                        padding: 20px;
                                        box-shadow: rgba(111, 101, 101, 0.75) 0px 0px 2px 0px;
                                    }
                                    .\$\{containerID\}-table {
                                        font-family: arial, sans-serif;
                                        border-collapse: collapse;
                                        width: 100%;
                                    }
                                    .\$\{containerID\}-td, .\$\{containerID\}-th {
                                        border-bottom: 1px solid \$\{values.BotBorderColor\};
                                        text-align: left;
                                        padding: 8px;
                                        font-weight: 100;font-family: sans-serif;
                                    }
                                    .\$\{containerID\}-right{
                                        text-align: end;
                                        font-weight: 400;font-family: sans-serif;
                                    }
                                </style>
                                <div class="\$\{containerID\}-container2">
                                    <table class="\$\{containerID\}-table">
                                        <tr>
                                            <td style="color:\$\{values.TitleFontColor\};" class="\$\{containerID\}-td">Subtotal</td>
                                            <td style="color:\$\{values.PriceFontColor\};font-weight:lighter; text-align: right;" class="totalreceipt \$\{containerID\}-td \$\{containerID\}-td" id="test">$0</td>
                                        </tr>
                                        <tr>
                                            <td style="color:\$\{values.TitleFontColor\};" class="\$\{containerID\}-td">Shipping</td>
                                            <td style="color:\$\{values.PriceFontColor\};font-weight:lighter;text-align: right;"class="\$\{containerID\}-td \$\{containerID\}-td">$\$\{values.Shipping\}</td>
                                        </tr>
                                        <tr>
                                            <td style="color:\$\{values.TitleFontColor\};" class="\$\{containerID\}-td">Taxes and Fees</td>
                                            <td style="color:\$\{values.PriceFontColor\};font-weight:lighter;text-align: right;"class="\$\{containerID\}-td \$\{containerID\}-td">\$\{values.TaxesAndFees\}%</td>
                                        </tr>
                                        <tr>
                                            <td style="color:\$\{values.TitleFontColor\};" class="\$\{containerID\}-td">Total</td>
                                            <td id="total" style="color:\$\{values.PriceFontColor\}; text-align: right;font-weight:bold;font-size: 1.5em;" class="totalreceipt \$\{containerID\}-td \$\{containerID\}-td">$0</td>                          
                                        </tr>
                                    </table>
                                </div>
                            \`
                        }
                    }),
                    exporters: {
                        web: function (values) {
                            var containerID = values._meta.htmlID;
                            return \`
                                <style>
                                    .\$\{containerID\}-container2{
                                        margin: 0 auto;
                                        width:\$\{values.container2Width\};
                                        height: auto;
                                        background: \$\{values.backgroundColor\};
                                        position: relative;
                                        border-radius: 3px;
                                        text-align: center;
                                        padding: 20px;
                                        box-shadow: rgba(111, 101, 101, 0.75) 0px 0px 2px 0px;
                                    }
                                    .\$\{containerID\}-table {
                                        font-family: arial, sans-serif;
                                        border-collapse: collapse;
                                        width: 100%;
                                    }
                                    .\$\{containerID\}-td, .\$\{containerID\}-th {
                                        border-bottom: 1px solid \$\{values.BotBorderColor\};
                                        text-align: left;
                                        padding: 8px;
                                        font-weight: 100;font-family: sans-serif;
                                    }
                                    .\$\{containerID\}-right{
                                        text-align: end;
                                        font-weight: 400;font-family: sans-serif;
                                    }
                                </style>
                                <div class="\$\{containerID\}-container2">
                                    <table class="\$\{containerID\}-table">
                                        <tr>
                                            <td style="color:\$\{values.TitleFontColor\};" class="\$\{containerID\}-td">Subtotal</td>
                                            <td style="color:\$\{values.PriceFontColor\};font-weight:lighter;text-align: right;" class="totalreceipt \$\{containerID\}-td \$\{containerID\}-td">$0</td>
                                        </tr>
                                        <tr>
                                            <td style="color:\$\{values.TitleFontColor\};" class="\$\{containerID\}-td">Shipping</td>
                                            <td id="shipping" style="color:\$\{values.PriceFontColor\};font-weight:lighter;text-align: right;"class="\$\{containerID\}-td \$\{containerID\}-td">$\$\{values.Shipping\}</td>
                                        </tr>
                                        <tr>
                                            <td style="color:\$\{values.TitleFontColor\};" class="\$\{containerID\}-td">Taxes and Fees</td>
                                            <td id="tax" style="color:\$\{values.PriceFontColor\};font-weight:lighter;text-align: right;"class="\$\{containerID\}-td \$\{containerID\}-td">\$\{values.TaxesAndFees\}%</td>
                                        </tr>
                                        <tr>
                                            <td style="color:\$\{values.TitleFontColor\};" class="\$\{containerID\}-td">Total</td>
                                            <td id="total" style="color:\$\{values.PriceFontColor\};font-weight:bold;text-align: right;font-size: 1.5em;" class="totalreceipt \$\{containerID\}-td \$\{containerID\}-td">$0</td>                          
                                        </tr>
                                    </table>
                                </div>
                                <script>
                                    var shippingFee = "\$\{values.Shipping ? values.Shipping : 0\}";
                                    var taxPercentage = "\$\{values.TaxesAndFees ? values.TaxesAndFees : 0\}";
                                    var taxFee = "\$\{values.TaxesAndFees ? values.TaxesAndFees : 0\}";
                                    function changeVariantTotalReceipt() { 
                                        var computedTax = computeTax();
                                        document.querySelector("#shipping").innerHTML = plg_selectedVariant.currency.code+shippingFee;
                                        document.querySelector("#tax").innerHTML = plg_selectedVariant.currency.code+computedTax;
                                        document.querySelector("#total").innerHTML = plg_selectedVariant.price
                                        document.querySelector(".totalreceipt").innerHTML = plg_selectedVariant.currency.code+(plg_price - computedTax - parseFloat(shippingFee)).toFixed(2);
                                    }
                                    function computeTax() {
                                        var computed = ((plg_price * parseFloat(taxPercentage))/100).toFixed(2);
                                        taxFee = computed;
                                        var x = priceToObject(plg_selectedVariant.price);
                                        var computedTotalPrice = (parseFloat(x.price) ).toFixed(2); // TODO: (parseFloat(x.price) + parseFloat(computed) + parseFloat(shippingFee)
                                         plg_price = parseFloat(computedTotalPrice);
                                         plg_selectedVariant.price = x.currency + parseFloat(computedTotalPrice); // TODO:
                                        return computed;
                                    }
                                    typeof getTheSelectedVariant !== "undefined" ? getTheSelectedVariant() : void 0; // to call update price of selected variant
                                </script>
                            \`
                        }
                    }
                }
            });

            var u_body = document.getElementById("u_body");
            u_body.style.marginBottom = "115px";

            var dragScrollTop = document.createElement("div");
            dragScrollTop.style.cssText = "position: fixed; z-index: 999; width: calc(100% - 425px); height: 75px; display: none; background-color: #e4e1e1; border: 1px dashed #000; border-top: none; opacity: 0.5; text-align: center; font-size: 30px; line-height: 2.5;";
            dragScrollTop.id = "scroll-top";
            dragScrollTop.innerHTML = "scroll to top";

            var dragScrollBottom = document.createElement("div");
            dragScrollBottom.style.cssText = "position: fixed; z-index: 999; width: calc(100% - 425px); height: 75px; bottom: 0; display: none; background-color: #e4e1e1; border: 1px dashed #000; border-bottom: none; opacity: 0.5; text-align: center; font-size: 30px; line-height: 2.5;";
            dragScrollBottom.id = "scroll-bottom";
            dragScrollBottom.innerHTML = "scroll to bottom";

            var dragoverlay = document.createElement("div");
            dragoverlay.id = "editor-overlay";
            dragoverlay.style.cssText = "width: calc(100% - 425px); height: 100vh; position: fixed; top: 0; right: 0; z-index: 999; background-color: #04040482; display: none;";

            u_body.insertBefore(dragoverlay, u_body.firstChild)
            u_body.insertBefore(dragScrollTop, u_body.firstChild)
            u_body.appendChild(dragScrollBottom);

            var scrollTop = document.getElementById("scroll-top");
            var scrollBottom = document.getElementById("scroll-bottom");
            scrollTop.addEventListener("dragenter",(e) => {
                clearInterval(window.intervalTop)
                var x = -10;
                window.intervalTop = setInterval(e => {
                    document.querySelector(".design-web").scrollBy(0, x)
                    setTimeout(() => {
                        x -= 10;
                    }, 1000)
                }, 10)
            });
            scrollTop.addEventListener("dragend",(e) => {
                clearInterval(window.intervalTop)
            });
            scrollTop.addEventListener("dragleave",(e) => {
                clearInterval(window.intervalTop)
            });
            scrollTop.addEventListener("drop",(e) => {
                clearInterval(window.intervalTop)
                clearInterval(window.intervalBottom)
            });
            scrollBottom.addEventListener("dragenter",(e) => {
                clearInterval(window.intervalBottom)
                var x = 10;
                window.intervalBottom = setInterval(e => {
                    document.querySelector(".design-web").scrollBy(0, x)
                    setTimeout(() => {
                        x += 10;
                    }, 1000)
                }, 10)
            });
            scrollBottom.addEventListener("dragend",(e) => {
                clearInterval(window.intervalBottom)
            });
            scrollBottom.addEventListener("dragleave",(e) => {
                clearInterval(window.intervalBottom)
            });
            scrollBottom.addEventListener("drop",(e) => {
                clearInterval(window.intervalTop)
                clearInterval(window.intervalBottom)
            });
            document.querySelectorAll(".blockbuilder-layer-drag").forEach(el => {
                el.ondrag = () => {
                    scrollTop.style.display = "block";
                    scrollBottom.style.display = "block";
                }
                el.ondragend = () => {
                    scrollTop.style.display = "none";
                    scrollBottom.style.display = "none";
                }
            })
            
            // center navigation
            window.navigation_ID_list = [];
            document.querySelectorAll(".u_content_navbar").forEach(el => {
                el.parentNode.parentNode.parentNode.parentNode.parentNode.style = "align-items: center;";
                window.navigation_ID_list.push(el.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.getAttribute("id"));
            })

            // add blur effect on notifier
            setTimeout(() => {
                document.querySelectorAll(".blockbuilder-content-tool").forEach(el => {
                    if (el.querySelector(".blockbuilder-content-tool-name").innerText.toLowerCase() == "notifier") {
                        el.ondrag = () => {
                            document.getElementById("editor-overlay").style.display = "block";
                            if (document.querySelector(".blockbuilder-placeholder-active")) {
                                document.querySelector(".blockbuilder-placeholder-active").style.opacity = "0";
                            } else {
                                document.querySelector(".blockbuilder-placeholder").style.opacity = "1";
                            }
                            el.ondragend = () => {
                                document.getElementById("editor-overlay").style.display = "none";
                            }
                        }
                    }
                })
            }, 2000)

            // popup button on the left panel
            var li_container = document.createElement("li");
            li_container.className = "nav-item";
            li_container.innerHTML = '<a role="button" class="nav-link"><span class="nav-icon"><svg class="svg-inline--fa fa-palette fa-w-16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="16" height="16" viewBox="0 0 16 16" fill="#fff"> <path d="M0 4v11h16v-14h-16v3zM14 2h1v1h-1v-1zM1 4h14v10h-14v-10z"></path> <path d="M3 6h2v1h-2v-1z"></path> <path d="M6 6h7v1h-7v-1z"></path> <path d="M3 8h2v1h-2v-1z"></path> <path d="M6 8h7v1h-7v-1z"></path> <path d="M3 10h2v1h-2v-1z"></path> <path d="M6 10h7v1h-7v-1z"></path> </svg></span><span class="nav-name"><span>Popup</span></span></a>';
            li_container.onclick = () => {
                if(!document.querySelector(".plg_modal")){
                    alert("Popup modal unavailable");
                    return; // just return if no plg_modal class found
                }
                document.querySelectorAll(".nav-link").forEach(el => {
                    // replace active to active-nav
                    el.classList.replace("active", "active-nav");
                    el.onclick = () => {
                        li_container.querySelector("a").classList.remove("active");
                        document.querySelector(".plg_modal").style.display = "none";
                        // replace active-nav to active
                        document.querySelector(".active-nav").classList.replace("active-nav", "active");
                        // for scrolling through modal container to drop content smoothly then remove height
                        document.querySelector(".plg_modal").parentNode.style.height = "0";
                    }
                })
                li_container.querySelector("a").classList.add("active");
                if(!document.querySelector(".plg_modal").style.display || document.querySelector(".plg_modal").style.display == "none"){
                    document.querySelector(".plg_modal").style.display = "flex";

                    // for scrolling through modal container to drop content smoothly
                    document.querySelector(".plg_modal").parentNode.style.height = "100vh";
                    document.querySelector(".plg_modal").parentNode.scrollIntoView();
                } else {
                    document.querySelector(".plg_modal").style.display = "none";

                    // for scrolling through modal container to drop content smoothly then remove height
                    document.querySelector(".plg_modal").parentNode.style.height = "0";
                }
            }
            document.querySelector(".nav.flex-column.nav-tabs").appendChild(li_container)
            
            // add button to edit page as mobile (search .edit-mobile) (Now Preview button)
            var li_edit_mobile = document.createElement("li");
            li_edit_mobile.className = "nav-item";
            li_edit_mobile.innerHTML = '<a role="button" class="nav-link"><span class="nav-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="#fff" class="svg-inline--fa fa-palette fa-w-16" viewBox="0 0 100 100"> <g id="Layer_1"> <path d="M91.7,29.9h-5.5V7.3c0-2.6-2.2-4.8-4.8-4.8h-72c-2.6,0-4.8,2.2-4.8,4.8v65.3c0,2.6,2.2,4.8,4.8,4.8h52.9v16.5 c0,2,1.6,3.6,3.6,3.6h25.8c2,0,3.6-1.6,3.6-3.6V33.5C95.4,31.5,93.7,29.9,91.7,29.9z M17.8,8.2h63c0.8,0,1.4,0.6,1.4,1.4 c0,0.8-0.6,1.4-1.4,1.4h-63c-0.8,0-1.4-0.6-1.4-1.4C16.4,8.8,17,8.2,17.8,8.2z M12,7.2c1.3,0,2.4,1.1,2.4,2.4S13.3,12,12,12 s-2.4-1.1-2.4-2.4C9.7,8.2,10.7,7.2,12,7.2z M62.3,62.8v10.4c0,0-52.9,0-52.9,0c-0.3,0-0.6-0.3-0.6-0.6V15.9H82v14H65.9 c-2,0-3.6,1.6-3.6,3.6v4.2 M62.3,55.5V60 M62.3,48v4.7 M62.3,40.5v4.7 M78.8,95.9c-1.3,0-2.4-1.1-2.4-2.4s1.1-2.4,2.4-2.4 s2.4,1.1,2.4,2.4C81.3,94.8,80.2,95.9,78.8,95.9z M93.1,88.9c0,0.3-0.2,0.5-0.5,0.5H65.1c-0.3,0-0.5-0.2-0.5-0.5V38.5 c0-0.3,0.2-0.5,0.5-0.5h27.5c0.3,0,0.5,0.2,0.5,0.5V88.9z"/> </g> </svg></span><span class="nav-name"><span>Preview</span></span></a>';
            li_edit_mobile.onclick = () => {
                document.querySelectorAll('.sc-brqgnP div a')[2].click();
            }
            document.querySelector(".nav.flex-column.nav-tabs").appendChild(li_edit_mobile);
        `];

        // show order list on thank you page
        // TODO :: SEND ORDER CONFIRMATION
        if(state.page_data.page_type == "thank-you-page"){
            customJS.push(`
                console.log("15. Initializing order list...");
                unlayer.registerTool({
                    type: 'order_list',
                    category: 'contents',
                    label: 'Order List',
                    icon: '<svg class="svg-inline--fa fa-w-14 fa-w-20 fa-3x" fill="#fff" xmlns="http://www.w3.org/2000/svg" height="512" viewBox="0 0 64 64"><g id="Check_List" data-name="Check List"><path d="m25 29h6v6h-6z"/><path d="m24 43v14h27v-22.758l-17.606 17.607-.018-.017a.991.991 0 0 1 -.242.2l-5.657 2.828a1 1 0 0 1 -1.342-1.342l2.828-5.657a.988.988 0 0 1 .2-.243l-.017-.017 19.511-19.501a1 1 0 0 1 0-1.414l2.343-2.343v-13.343h-5.026a.979.979 0 0 1 -.186.615 1 1 0 0 1 -.788.385h-20a1 1 0 0 1 -.788-.385.979.979 0 0 1 -.186-.615h-5.026v29h2a3 3 0 0 1 3 3zm11-28h12v2h-12zm0 4h12v2h-12zm0 8h8v2h-8zm0 4h6v2h-6zm-12-15a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v8a1 1 0 0 1 -1 1h-8a1 1 0 0 1 -1-1zm0 12a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v8a1 1 0 0 1 -1 1h-8a1 1 0 0 1 -1-1z"/><path d="m4 46h6v-4h-5a1 1 0 0 0 -1 1z"/><path d="m5 60h16a1 1 0 0 0 1-1v-11h-6v3a1 1 0 0 1 -1.707.707l-1.293-1.293-1.293 1.293a1 1 0 0 1 -1.707-.707v-3h-6v11a1 1 0 0 0 1 1z"/><path d="m22 43a1 1 0 0 0 -1-1h-5v4h6z"/><path d="m25 17h6v6h-6z"/><path d="m13.707 48.293.293.293v-6.586h-2v6.586l.293-.293a1 1 0 0 1 1.414 0z"/><path d="m16 40h1v-30a1 1 0 0 1 1-1h6.47l.25-1h-7.72a1 1 0 0 0 -1 1z"/><path d="m43.72 10-1.311-5.242a1 1 0 0 0 -.971-.758h-12.876a1 1 0 0 0 -.971.758l-1.311 5.242zm-7.72-4h4v2h-4zm-6 0h4v2h-4z"/><path d="m30.998 50.868-.866-.867-.867 1.734z"/><path d="m54 59v-26.447a.946.946 0 0 1 -1-.142v25.589a1 1 0 0 1 -1 1h-28a2.966 2.966 0 0 1 -.184 1h29.184a1 1 0 0 0 1-1z"/><path d="m59.264 23.151a1 1 0 0 0 0-1.415 1.025 1.025 0 0 0 -1.414 0l-3.537 3.536 1.415 1.414z"/><path d="m51.9 26.101h2v4h-2z" transform="matrix(.707 -.707 .707 .707 -4.376 45.636)"/><path d="m54 22.758v-13.758a1 1 0 0 0 -1-1h-7.72l.25 1h6.47a1 1 0 0 1 1 1v13.757z"/><path d="m28.086 38.621h26.586v2h-26.586z" transform="matrix(.707 -.707 .707 .707 -15.897 40.865)"/></g></svg>',
                    values: {},
                    options: {
                        timer: {
                            title: "Order List",
                            position: 1,
                            options: {
                                "autoConvert": {
                                    "label": "Use Currency Converter",
                                    "defaultValue": false,
                                    "widget": "toggle"
                                },
                                "fontFamily": {
                                    "label": "Font Family",
                                    "defaultValue": {
                                        label: "Arial",
                                        value: "arial,helvetica,sans-serif"
                                    },
                                    "widget": "font_family"
                                }
                            },
                        }
                    },
                    renderer: {
                        Viewer: unlayer.createViewer({
                            render(values) {
                                return \`
                                    <div class="row" style="display: flex; align-items: center; font-family: \$\{values.fontFamily.value\}">
                                        <div class="col-2" style="padding-right: 5px;">
                                            <img src="https://cdn.productlistgenie.com/images/NWMwYTg1ZjA3NzMwMDEzMjdiMDM5MDRj/1561058395742flatt3d-box-512.png" style="border: 1px solid #e5e5e5; border-radius: 5px; width: 60px; max-width: 100%;">
                                        </div>
                                        <div class="col-7">
                                            <strong>Product Name</strong> <br/>
                                            <span>Variant Name</span>
                                        </div>
                                        <div class="col-3" style="text-align: right">
                                            $49.49
                                        </div>
                                    </div>
                                    <hr/>
                                    <div class="row" style="font-family: \$\{values.fontFamily.value\}">
                                        <div class="col-6">
                                            Total
                                        </div>
                                        <div class="col-6" style="text-align: right;">
                                            $49.99
                                        </div>
                                    </div>
                                \`
                            }
                        }),
                        exporters: {
                            web: function (values) {
                                var autoCurrency = "";
                                if(values.autoConvert){
                                    autoCurrency = \`
                                        <script src="https://convert.productlistgenie.com/CurrencyConverter/" async onload="convertAllMoneyClass()"></script>
                                        <script>
                                            function convertAllMoneyClass() {
                                                var numberWithCommas = (x) => x.toString().replace(/\\\\B(?=(\\\\d{3})+(?!\\\\d))/g, ",");
                                                var currencyRegex = new RegExp(/.*[^\\\\d\.\\\\,\\\\s]/g);
                                                var priceRegex = new RegExp(/[\\\\d]|\\\\./g);
                                                var s = document.createElement("div");
                                                s.id = "c_value";
                                                s.innerHTML = c_value;
                                                s.style.display = "none";
                                                document.body.appendChild(s);
                                                document.querySelectorAll(".money").forEach((el, i) => {
                                                    var plgConverted = document.getElementById("c_value").innerText;
                                            
                                                    var origPrice = el.innerText.match(priceRegex).toString().replace(/,/g, "");
                                            
                                                    var convertedCurrency = plgConverted.match(currencyRegex).toString();
                                                    var convertedPrice = plgConverted.match(priceRegex).toString().replace(/,/g, "");
                                            
                                                    var computedConvertedPrice = numberWithCommas((origPrice * convertedPrice).toFixed(2));
                                                    el.innerHTML = convertedCurrency + " " + computedConvertedPrice;
                                                });
                                            }
                                        </script>
                                    \`
                                }
                                return \`
                                    <div id="orders_\$\{values._meta.htmlID\}">
                                        <div class="row" style="display: flex; align-items: center; font-family: \$\{values.fontFamily.value\}">
                                            <div class="col-2" style="padding-right: 5px;">
                                                <img src="https://cdn.productlistgenie.com/images/NWMwYTg1ZjA3NzMwMDEzMjdiMDM5MDRj/1561058395742flatt3d-box-512.png" style="border: 1px solid #e5e5e5; border-radius: 5px; width: 60px; max-width: 100%;">
                                            </div>
                                            <div class="col-7">
                                                <strong>Product Name</strong> <br/>
                                                <span>Variant Name</span>
                                            </div>
                                            <div class="col-3 money" style="text-align: right">
                                                $49.49
                                            </div>
                                        </div>
                                    </div>
                                    <hr/>
                                    <div class="row" style="font-family: \$\{values.fontFamily.value\}">
                                        <div class="col-6">
                                            Total
                                        </div>
                                        <div class="col-6" style="text-align: right;">
                                            <span class="money" id="total_orders_\$\{values._meta.htmlID\}">$49.99</span>
                                        </div>
                                    </div>
                                    <script>
                                        if(localStorage.getItem("plg_prod_list")){
                                            // one time execute
                                            sendOrderConfirmation(localStorage.getItem("plg_prod_list"), localStorage.getItem("funnel_customer_name"), localStorage.getItem("funnel_customer_email"))

                                            var saveThankyou = {
                                                currency: localStorage.getItem("cod_data") ? JSON.parse(localStorage.getItem("cod_data")).currencySymbol : "$",
                                                data: JSON.parse(localStorage.getItem("plg_prod_list"))
                                            };
                                            localStorage.setItem("plg_prod_thankyou_list", JSON.stringify(saveThankyou));
                                            localStorage.removeItem("plg_prod_list");
                                            // remove stripe session
                                            localStorage.removeItem("stripe_user_id");
                                            localStorage.removeItem("stripe_currency");
                                            // remove authorize session
                                            localStorage.removeItem("authorize_customer_ids")
                                            // remove flag session as paypal
                                            localStorage.removeItem("paypal_as_checkout")
                                            // remove flag as cod payment
                                            // localStorage.removeItem("cod_data");
                                            localStorage.removeItem("plg_conekta");
                                            // remove email id
                                            localStorage.removeItem("plg_email_id");
                                            
                                            let list = Object.keys(localStorage).filter(e => e.includes("u_content_thankyou_upsell"));
                                            list.forEach(e => {
                                                localStorage.removeItem(e); // admin thank you page upsell disable button
                                            })
                                        }

                                        render_cart();

                                        function render_cart () {
                                            let initial = "", total = 0, currencyCode = "";
                                            if(localStorage.getItem("plg_prod_thankyou_list")){
                                                var list = JSON.parse(localStorage.getItem("plg_prod_thankyou_list"));
                                                list.data.forEach(prod => {
                                                    initial += '<div class="row" style="display: flex; align-items: center; font-family: arial,helvetica,sans-serif"><div class="col-2" style="padding-right: 5px;"><img src="https://cdn.productlistgenie.com/images/NWMwYTg1ZjA3NzMwMDEzMjdiMDM5MDRj/1561058395742flatt3d-box-512.png" style="border: 1px solid #e5e5e5; border-radius: 5px; width: 60px; max-width: 100%;"></div><div class="col-7" style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"><strong>'+prod.product_name+'</strong> <br><span>'+prod.variant_name+'</span></div><div class="col-3 money" style="text-align: right">'+list.currency+(parseFloat(prod.product_price).toFixed(2))+'</div></div>';
                                                    total += parseFloat(prod.product_price);
                                                    currencyCode = list.currency;
                                                });

                                                document.getElementById("orders_\$\{values._meta.htmlID\}").innerHTML = initial;
                                                document.getElementById("total_orders_\$\{values._meta.htmlID\}").innerHTML = currencyCode + total.toFixed(2);
                                            }
                                        }

                                        function sendOrderConfirmation(data, name, email){
                                            var apiKey = "${state.klaviyoPK}";
                                            var ocID = "${state.orderConfirmation}";
                                            var url = "/send_order_confirmation?pk="+apiKey+"&ocid="+ocID+"&name="+name+"&email="+email;
                                            JSON.parse(data).forEach(el => {
                                                url += "&product="+encodeURI(el.product_name)+"&price="+el.product_price+"&quantity=1";
                                            })
                                            if(apiKey && ocID){
                                                fetch(url)
                                                .then(result => {
                                                    console.log("sending email order confirmation success.")
                                                })
                                            }
                                        }
                                    </script>
                                    \$\{autoCurrency\}
                                \`
                            }
                        }
                    }
                });
            `);

            customJS.push(`
                // start create yala genie widget
                unlayer.registerPropertyEditor({
                    name: 'yala_genie_widget',
                    layout: 'bottom',
                    Widget: unlayer.createWidget({
                        render(value) {
                            return \`
                                <div class="blockbuilder-widget blockbuilder-link-widget">
                                    <div class="col-12" style="padding: 0;">
                                        <div class="blockbuilder-widget-label">
                                            <label class="blockbuilder-label-primary">
                                                <span>Yala Product List (default price USD)</span>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-12" style="padding: 0; margin-top: 5px;">
                                        <div id="blockbuilder-widget-variant-menu" style="overflow-y: auto; max-height: 300px; overflow-x: hidden;">
                                            <!-- Dynamic Variant Will Appear here -->
                                        </div>
                                    </div>
                                </div>
                            \`;
                        },
                        mount(node, value, updateValue) {
                            let list = JSON.parse(value), container = document.getElementById("blockbuilder-widget-variant-menu");
                            let container_child = "", product_count = list.filter(e => e.yala_name != "" && e.yala_price != "" && e.yala_img != "" && e.yala_sku != "").length;
                            for(var i = 0; i <= product_count; i++) {
                                container_child += \`
                                    <div class="row eiCcjJ" style="padding: 5px 0; border-bottom: 1px solid #5a5a5a;">
                                        <div class="blockbuilder-widget-label" style="padding: 0; width: 25px;">
                                            <div style="width: 0; height: 0; border-top: 20px solid transparent; border-bottom: 20px solid transparent; border-left: 20px solid #989898;"></div>
                                        </div>
                                        <div class="blockbuilder-widget-label" style="padding: 0; width: calc(100% - 25px)">
                                            <div class="blockbuilder-widget-label col-4" style="padding-right: 5px;">
                                                <label class="blockbuilder-label-primary">
                                                    <span>Product Name</span>
                                                </label>
                                                <input type="text" name="yala_name" class="form-control" style="background-color: #555555; border: 1px solid #777; color: #fff; font-size: 12px; margin-top: 5px;" placeholder="Product Name">
                                            </div>
                                            <div class="blockbuilder-widget-label col-4" style="padding: 0 5px;">
                                                <label class="blockbuilder-label-primary">
                                                    <span>Regular Price</span>
                                                </label>
                                                <input type="number" name="yala_price" class="form-control" style="background-color: #555555; border: 1px solid #777; color: #fff; font-size: 12px; margin-top: 5px;" placeholder="Product Price">
                                            </div>
                                            <div class="blockbuilder-widget-label col-4" style="padding-left: 5px;">
                                                <label class="blockbuilder-label-primary">
                                                    <span>Discount (%)</span>
                                                </label>
                                                <input type="number" name="yala_discount" class="form-control" style="background-color: #555555; border: 1px solid #777; color: #fff; font-size: 12px; margin-top: 5px;" placeholder="Product Discount">
                                            </div>
                                            <div class="blockbuilder-widget-label col-12" style="margin-top: 5px;">
                                                <div class="col-3" style="padding: 0;">
                                                    <label class="blockbuilder-label-primary">
                                                        <span>PLG SKU</span>
                                                    </label>
                                                </div>
                                                <div class="col-9" style="padding: 0 0 0 5px;">
                                                    <input type="text" name="yala_sku" class="form-control" style="background-color: #555555; border: 1px solid #777; color: #fff; font-size: 12px;" placeholder="Variant SKU">
                                                </div>
                                            </div>
                                            <div class="blockbuilder-widget-label col-12" style="position: relative; display: block;">
                                                <ul class="shopify-show-result" style="display: none;"></ul>
                                            </div>
                                            <div class="blockbuilder-widget-label col-12" style="margin-top: 5px;">
                                                <div class="col-3" style="padding: 0;">
                                                    <label class="blockbuilder-label-primary">
                                                        <span>Product Image</span>
                                                    </label>
                                                </div>
                                                <div class="col-9" style="padding: 0 0 0 5px;">
                                                    <input type="text" name="yala_img" class="form-control" style="background-color: #555555; border: 1px solid #777; color: #fff; font-size: 12px;" placeholder="Product Image Link">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                \`;
                            }

                            container.innerHTML = container_child;
                            
                            let timeout = null;
                            container.querySelectorAll(".row.eiCcjJ").forEach((el, index) => {
                                let inputs = el.querySelectorAll("input");
                                inputs.forEach(input => {
                                    if(list[index] && list[index][input.name]) input.value = list[index][input.name]; // setting the value of saved data
                                    function save_data_to_editor(){
                                        if(!list[index]) list[index] = {};
                                        list[index][input.name] = input.value;
                                        updateValue(JSON.stringify(list));
                                    }
                                    input.onchange = function(){
                                        if(input.name != "yala_sku") save_data_to_editor();
                                    }
                                    if(input.name == "yala_sku") {
                                        let product_container = el.querySelector(".shopify-show-result");
                                        input.onkeyup = function() {
                                            if(!input.value) {
                                                product_container.style.display = "none";
                                                product_container.innerHTML = "";
                                                save_data_to_editor();
                                            } else {
                                                product_container.style.display = "block";
                                                product_container.innerHTML = "<li>Loading...</li>";

                                                clearTimeout(timeout);
                                                timeout = setTimeout(function(){
                                                    const payload = { query: \`query($search: String) { getFunnelProducts(search: $search, limit: 5, page: 1){ id productName productSku productSrp } }\`, variables: { search: input.value } }
                                                    fetch('/graphql', { method: "POST", headers: { 'Content-Type': 'application/json', }, body: JSON.stringify(payload) }).then(res => res.json())
                                                    .then(res => {
                                                        const data = res.data.getFunnelProducts;
                                                        var result = "";
                                                        if(data.length != 0) {
                                                            data.forEach(d => {
                                                                result += \`<li id="\$\{d.id\}" data-price="\$\{d.productSrp\}" class="plg_cod_product">\$\{d.productName\} - \$\{d.productSku\}</li>\`;
                                                            });
                                                        } else {
                                                            result = "<li>No Result Found.</li>";
                                                        }
                                                        product_container.innerHTML = result;
                                                        product_container.querySelectorAll("li").forEach(li => {
                                                            li.onclick = function(){
                                                                if(li.id) input.value = window.parent.encodeID(li.id);
                                                                save_data_to_editor();
                                                            }
                                                        })
                                                    }).catch(err => {
                                                        console.log(err)
                                                        product_container.innerHTML = "<li>Please Try again.</li>";
                                                    });
                                                }, 500);
                                            }
                                        }
                                    }
                                });
                            });
                        }
                    })
                });
                // end create yala genie widget
                
                const yala_genie_style = \`
                    <style>
                        .yala_genie { display: flex; flex-wrap: wrap; align-content: stretch; height: 100%; justify-content: space-around; }
                        .yala_genie .child { width: 30%; margin:10px; }
                        .yala_genie .img_p { background-size: contain; background-position: center; background-repeat: no-repeat; height: 40vw; }
                        .yala_genie .card { box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2); max-width: 300px; margin: auto; text-align: center; font-family: arial; }
                        .yala_genie .prod_name { font-size: 3vw; margin: 0; }
                        .yala_genie .prod_price { color: grey; font-size: 1.5rem; }
                        .yala_genie .prod_price_regular { color: red; font-size: 1.5rem; }
                        .yala_genie .prod_button { color: white; font-size: 2vw; }
                        .yala_genie button { border: none; outline: 0; display: inline-block; padding: 8px; color: white; background-color: #000; text-align: center; cursor: pointer; width: 100%; font-size: 18px; }
                        .yala_genie button:hover, .yala_genie a:hover { opacity: 0.7; }
                        .yala_genie button:disabled { background-color: #807d7d; opacity: 0.7; }
                        .yala_genie .div-percent { background:black; border-radius: 50%; height: 8vw; width: 8vw; background-size: cover; margin-left: auto; margin-right: auto; margin-bottom: 15px; }
                        .yala_genie .percent_num { font-size: 2.5vw; color: white; padding-top: 1vw; margin: 0; font-family: monospace; line-height: initial; }
                        .yala_genie .percent_text { font-size: 2.7vw; color: white; margin: 0; font-family: monospace; line-height: initial; }
                    </style>
                \`;
                console.log("16. Initializing PLG ads...");
                unlayer.registerTool({
                    type: 'yala_genie',
                    category: 'contents',
                    label: 'Yala Genie',
                    icon: '<svg class="svg-inline--fa fa-w-14 fa-w-20 fa-3x" fill="#fff" xmlns="http://www.w3.org/2000/svg" height="512" viewBox="0 0 64 64"><g id="Check_List" data-name="Check List"><path d="m25 29h6v6h-6z"/><path d="m24 43v14h27v-22.758l-17.606 17.607-.018-.017a.991.991 0 0 1 -.242.2l-5.657 2.828a1 1 0 0 1 -1.342-1.342l2.828-5.657a.988.988 0 0 1 .2-.243l-.017-.017 19.511-19.501a1 1 0 0 1 0-1.414l2.343-2.343v-13.343h-5.026a.979.979 0 0 1 -.186.615 1 1 0 0 1 -.788.385h-20a1 1 0 0 1 -.788-.385.979.979 0 0 1 -.186-.615h-5.026v29h2a3 3 0 0 1 3 3zm11-28h12v2h-12zm0 4h12v2h-12zm0 8h8v2h-8zm0 4h6v2h-6zm-12-15a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v8a1 1 0 0 1 -1 1h-8a1 1 0 0 1 -1-1zm0 12a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v8a1 1 0 0 1 -1 1h-8a1 1 0 0 1 -1-1z"/><path d="m4 46h6v-4h-5a1 1 0 0 0 -1 1z"/><path d="m5 60h16a1 1 0 0 0 1-1v-11h-6v3a1 1 0 0 1 -1.707.707l-1.293-1.293-1.293 1.293a1 1 0 0 1 -1.707-.707v-3h-6v11a1 1 0 0 0 1 1z"/><path d="m22 43a1 1 0 0 0 -1-1h-5v4h6z"/><path d="m25 17h6v6h-6z"/><path d="m13.707 48.293.293.293v-6.586h-2v6.586l.293-.293a1 1 0 0 1 1.414 0z"/><path d="m16 40h1v-30a1 1 0 0 1 1-1h6.47l.25-1h-7.72a1 1 0 0 0 -1 1z"/><path d="m43.72 10-1.311-5.242a1 1 0 0 0 -.971-.758h-12.876a1 1 0 0 0 -.971.758l-1.311 5.242zm-7.72-4h4v2h-4zm-6 0h4v2h-4z"/><path d="m30.998 50.868-.866-.867-.867 1.734z"/><path d="m54 59v-26.447a.946.946 0 0 1 -1-.142v25.589a1 1 0 0 1 -1 1h-28a2.966 2.966 0 0 1 -.184 1h29.184a1 1 0 0 0 1-1z"/><path d="m59.264 23.151a1 1 0 0 0 0-1.415 1.025 1.025 0 0 0 -1.414 0l-3.537 3.536 1.415 1.414z"/><path d="m51.9 26.101h2v4h-2z" transform="matrix(.707 -.707 .707 .707 -4.376 45.636)"/><path d="m54 22.758v-13.758a1 1 0 0 0 -1-1h-7.72l.25 1h6.47a1 1 0 0 1 1 1v13.757z"/><path d="m28.086 38.621h26.586v2h-26.586z" transform="matrix(.707 -.707 .707 .707 -15.897 40.865)"/></g></svg>',
                    values: {},
                    options: {
                        timer: {
                            title: "Yala Genie",
                            position: 1,
                            options: {
                                "header": {
                                    "label": "Header",
                                    "defaultValue": "Please Scroll Down To Check Somoething Unique!",
                                    "widget": "text"
                                },
                                "header_size": {
                                    "label": "Header Font Size",
                                    "defaultValue": "24px",
                                    "widget": "px"
                                },
                                "sub_header": {
                                    "label": "Sub Header",
                                    "defaultValue": "WAIT! We Have A Special Offer Just For You",
                                    "widget": "text"
                                },
                                "sub_header_size": {
                                    "label": "Sub Header Font Size",
                                    "defaultValue": "48px",
                                    "widget": "px"
                                },
                                "thankyou": {
                                    "label": "Thank You Note",
                                    "defaultValue": "Thank you for purchasing!",
                                    "widget": "text"
                                },
                                "thankyou_size": {
                                    "label": "Thank You Font Size",
                                    "defaultValue": "48px",
                                    "widget": "px"
                                },
                                "products": {
                                    "label": "Products",
                                    "defaultValue": JSON.stringify([]),
                                    "widget": "yala_genie_widget"
                                },
                                "image_uploader": {
                                    "label": "Image Uploader",
                                    "defaultValue": {
                                        "url": "",
                                        "width": 500,
                                        "height": 100
                                    },
                                    "widget": "image",
                                    "toggle": true
                                }
                            },
                        }
                    },
                    renderer: {
                        Viewer: unlayer.createViewer({
                            render(values) {
                                let products = JSON.parse(values.products);
                                return \`
                                    <div class="yala_genie_parent">
                                        \$\{yala_genie_style\}
                                        <div class="thankyou-note" style="text-align: center; display: none;">
                                            <label style="display: block; font-size: \$\{values.thankyou_size\};">\$\{values.thankyou\}</label>
                                        </div>
                                        <div class="headers" style="text-align: center; margin-bottom: 10px;">
                                            <label style="display: block; font-size: \$\{values.header_size\};">\$\{values.header\}</label>
                                            <label style="display: block; font-size: \$\{values.sub_header_size\};">\$\{values.sub_header\}</label>
                                        </div>
                                        <div class="yala_genie">
                                            \$\{(() => {
                                                if(products.length == 0) {
                                                    return \`
                                                        <div style="text-align: center;">
                                                            <label>Please add products of yala genie</label>
                                                        </div>
                                                    \`;
                                                } else {
                                                    return products.map(product => {
                                                        let regular = product.yala_price - (product.yala_price * (parseFloat(product.yala_discount) / 100));
                                                        return \`
                                                            <div class="child">
                                                                <div class="card">
                                                                    <!-- <div class="img_p" style="background-image: url(\$\{product.yala_img\})"></div> -->
                                                                    <img src="\$\{product.yala_img\}" width="100%">
                                                                    <h1 class="prod_name">\$\{product.yala_name\}</h1>
                                                                    <div class="div-percent">
                                                                        <h5 class="percent_num">60%</h5>
                                                                        <h5 class="percent_text">OFF</h5>
                                                                    </div>
                                                                    <p class="prod_price_regular">
                                                                        <span style="margin-right: 5px;">REGULAR PRICE:</span>
                                                                        <span class="symbol">$</span>
                                                                        <span class="price">\$\{product.yala_price || "N/A"\}</span>
                                                                    </p>
                                                                    <p class="prod_price">
                                                                        <span style="margin-right: 5px;">YOUR PRICE TODAY:</span>
                                                                        <span class="symbol">$</span>
                                                                        <span class="price">\$\{regular || "N/A"\}</span>
                                                                    </p>
                                                                    <button class="prod_button">Buy Now!</button>
                                                                </div>
                                                            </div>
                                                        \`;
                                                    }).join("");
                                                }
                                            })()\}
                                        </div>
                                    </div>
                                \`;
                            }
                        }),
                        exporters: {
                            web: function (values) {
                                let products = JSON.parse(values.products);
                                return \`
                                    <div class="yala_genie_parent">
                                        \$\{yala_genie_style\}
                                        <div class="thankyou-note" style="display: none; text-align: center;">
                                            <label style="display: block; font-size: \$\{values.thankyou_size\}; margin: 0 auto;">\$\{values.thankyou\}</label>
                                        </div>
                                        <div class="headers" style="text-align: center; margin-bottom: 10px;">
                                            <label style="display: block; font-size: \$\{values.header_size\};">\$\{values.header\}</label>
                                            <label style="display: block; font-size: \$\{values.sub_header_size\};">\$\{values.sub_header\}</label>
                                        </div>
                                        <div class="yala_genie">
                                            \$\{(() => {
                                                if(products.length == 0) {
                                                    return \`
                                                        <div style="text-align: center;">
                                                            <label>Please add products of yala genie</label>
                                                        </div>
                                                    \`;
                                                } else {
                                                    return products.map(product => {
                                                        let regular = product.yala_price - (product.yala_price * (parseFloat(product.yala_discount) / 100));
                                                        return \`
                                                            <div class="child">
                                                                <div class="card">
                                                                    <!-- <div class="img_p" style="background-image: url(\$\{product.yala_img\})"></div> -->
                                                                    <img src="\$\{product.yala_img\}" width="100%">
                                                                    <h1 class="prod_name">\$\{product.yala_name\}</h1>
                                                                    <div class="div-percent">
                                                                        <h5 class="percent_num">60%</h5>
                                                                        <h5 class="percent_text">OFF</h5>
                                                                    </div>
                                                                    <p class="prod_price_regular">
                                                                        <span style="margin-right: 5px;">REGULAR PRICE:</span>
                                                                        <span class="symbol">$</span>
                                                                        <span class="price">\$\{product.yala_price || "N/A"\}</span>
                                                                    </p>
                                                                    <p class="prod_price">
                                                                        <span style="margin-right: 5px;">YOUR PRICE TODAY:</span>
                                                                        <span class="symbol">$</span>
                                                                        <span class="price">\$\{regular || "N/A"\}</span>
                                                                    </p>
                                                                    <button class="prod_button" onclick="buy_yala_genie(this, \\\'\$\{product.yala_name\}\\\', \\\'\$\{product.yala_sku\}\\\')">Buy Now!</button>
                                                                </div>
                                                            </div>
                                                        \`;
                                                    }).join("");
                                                }
                                            })()\}
                                            <script>
                                                function buy_yala_genie(element, product_name, variant_id) {
                                                    element.disabled = true;
                                                    
                                                    let container = document.querySelector(".yala_genie_parent");
                                                    let ty = container.querySelector(".thankyou-note");
                                                    let prods = container.querySelector(".yala_genie");
                                                    let heads = container.querySelector(".headers");
                                                    let cod_info = JSON.parse(localStorage.getItem("cod_data"));

                                                    cod_info.meta = "U2FsdGVkX1/JAHD3vnXNsUH0+bJvdamEQtD031L6HJYO/vneAEp0iyItt2COQCBN"; // static para sa pag papasukan ng order
                                                    cod_info.source_link = window.location.href;
                                                    cod_info.productName = product_name;
                                                    cod_info.variantName = product_name;
                                                    cod_info.variant_id = variant_id;
                                                    cod_info.productPrice = parseFloat(element.parentNode.querySelector(".prod_price .price").getAttribute("data-price"));
                                                    cod_info.customerID = "cod_" + Math.floor((Math.random() * 1000000000000) + 1);

                                                    fetch("/create-customer-charge", {
                                                        method: "POST",
                                                        headers: {
                                                            'Content-Type': 'application/json'
                                                        },
                                                        body: JSON.stringify(cod_info)
                                                    }).then(function(result){
                                                        prods.style.display = "none";
                                                        heads.style.display = "none";
                                                        ty.style.display = "block";
                                                        ty.style.height = document.body.offsetHeight + "px";
                                                        ty.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                                    }).catch(function(error){
                                                        // send error error email
                                                        const email_payload = { toEmail: "tech@themillionairemastermind.com", fromEmail: "fg_error@gmail.com", subjectEmail: "Funnel creating order failed.", textEmail: "COD Thankyou Funnel Error: "+err+", Link: "+window.location.href, htmlEmail: "COD Checkout Funnel Error: "+err+", Link: "+window.location.href };
                                                        fetch("https://stats.productlistgenie.io/console", { method: "POST", headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(email_payload) });
                                                        alert("Server Error occurred. Please try again.");
                                                    });
                                                }
                                                async function convert_price_of_yala_genie() {
                                                    let plg_ads = document.querySelectorAll(".yala_genie .child");
                                                    let cod_currency = JSON.parse(localStorage.getItem("cod_currency"));
                                                    for (var i = 0; i < plg_ads.length; i++) {
                                                        let ads = plg_ads[i];
                                                        ads.querySelector(".prod_price .symbol").innerText = cod_currency.symbol;
                                                        let pp = ads.querySelector(".prod_price .price");
                                                        pp.innerText = await new Promise(resolve => {
                                                            fetch("/plg_currency/"+pp.innerText+"/"+cod_currency.code)
                                                            .then(res => res.json())
                                                            .then(res => {
                                                                pp.setAttribute("data-price", res.converted_price);
                                                                resolve(res.converted_price);
                                                            })
                                                        });

                                                        ads.querySelector(".prod_price_regular .symbol").innerText = cod_currency.symbol;
                                                        ads.querySelector(".prod_price_regular .price").innerText = await new Promise(resolve => {
                                                            fetch("/plg_currency/"+ads.querySelector(".prod_price_regular .price").innerText+"/"+cod_currency.code)
                                                            .then(res => res.json())
                                                            .then(res => {
                                                                resolve(res.converted_price);
                                                            })
                                                        });
                                                    }
                                                }
                                                convert_price_of_yala_genie();
                                            </script>
                                        </div>
                                    </div>
                                \`;
                            }
                        }
                    }
                });
            `);
        }

        if(page_type == "checkout"){
            // Show COD form to checkout
            customJS.push(`
                unlayer.registerTool({
                    type: 'cod-form',
                    category: 'contents',
                    label: 'COD Popup Form',
                    icon: '<svg aria-hidden="true" data-prefix="fab" data-icon="wpforms" class="svg-inline--fa fa-wpforms fa-w-14 fa-3x" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M448 75.2v361.7c0 24.3-19 43.2-43.2 43.2H43.2C19.3 480 0 461.4 0 436.8V75.2C0 51.1 18.8 32 43.2 32h361.7c24 0 43.1 18.8 43.1 43.2zm-37.3 361.6V75.2c0-3-2.6-5.8-5.8-5.8h-9.3L285.3 144 224 94.1 162.8 144 52.5 69.3h-9.3c-3.2 0-5.8 2.8-5.8 5.8v361.7c0 3 2.6 5.8 5.8 5.8h361.7c3.2.1 5.8-2.7 5.8-5.8zM150.2 186v37H76.7v-37h73.5zm0 74.4v37.3H76.7v-37.3h73.5zm11.1-147.3l54-43.7H96.8l64.5 43.7zm210 72.9v37h-196v-37h196zm0 74.4v37.3h-196v-37.3h196zm-84.6-147.3l64.5-43.7H232.8l53.9 43.7zM371.3 335v37.3h-99.4V335h99.4z"></path></svg>',
                    values: {},
                    options: {
                        tools: { //if error change tools to button
                            title: "COD Popup Form | Button", //april12
                            position: 1,
                            options: {
                                "fbTrack": {
                                    "label": "Track AddToCart",
                                    "defaultValue": false,
                                    "widget": "toggle"
                                },
                                "fbInitiate": {
                                    "label": "Track InitiateCheckout",
                                    "defaultValue": false,
                                    "widget": "toggle"
                                },
                                "fbPurchase": {
                                    "label": "Track Purchase",
                                    "defaultValue": false,
                                    "widget": "toggle"
                                },
                                "fbTrackLeads": {
                                    "label": "Track Leads",
                                    "defaultValue": false,
                                    "widget": "toggle"
                                },
                                "submitLabel": {
                                    "label": "Button Text",
                                    "defaultValue": "Cash On Delivery",
                                    "widget": "text"
                                },
                                "fontSize": {
                                    "label": "Font Size",
                                    "defaultValue": "15px",
                                    "widget": "px"
                                },
                                "buttonColors": {
                                    "label": "Color",
                                    "defaultValue": {
                                        "color": "#FFF",
                                        "backgroundColor": "#26c686",
                                        "hoverColor": "#2A92BF"
                                    },
                                    "widget": "button_color"
                                },
                                "submitAction": {
                                    "label": "Redirect Link",
                                    "defaultValue": {
                                        url: "#",
                                        target: "_self"
                                    },
                                    "widget": "link_list"
                                },
                                "buttonAnimation": {
                                    "label": "Apply Animation",
                                    "defaultValue": "",
                                    "widget": "animation_list"
                                }
                            }
                        },
                        confirmation: {
                            title: "Confirmation",
                            position: 1,
                            options: {
                                "headerText": {
                                    "label": "Header Text",
                                    "defaultValue": "ORDER SUCCESSFUL",
                                    "widget": "text"
                                },
                                "subText": {
                                    "label": "Sub Header Text",
                                    "defaultValue": "A verification code has been sent to your mobile via text message.",
                                    "widget": "text"
                                },
                                "inputLabel": {
                                    "label": "Input label",
                                    "defaultValue": "Enter your 5 digit verification code.",
                                    "widget": "text"
                                },
                                "positiveText": {
                                    "label": "Positive Button Text",
                                    "defaultValue": "Submit Code",
                                    "widget": "text"
                                },
                                "negativeText": {
                                    "label": "Address Note",
                                    "defaultValue": "Wait, let me update my info",
                                    "widget": "text"
                                }
                            }
                        },
                        form: {
                            title: "Form",
                            position: 1,
                            options: {
                                "header": {
                                    "label": "Header Title",
                                    "defaultValue": "",
                                    "widget": "text"
                                },
                                "header2": {
                                    "label": "Header 2 Title",
                                    "defaultValue": "Shipping Address",
                                    "widget": "text"
                                },
                                "firstName": {
                                    "label": "First Name Placeholder",
                                    "defaultValue": "First Name",
                                    "widget": "text"
                                },
                                "lastName": {
                                    "label": "Last Name Placeholder",
                                    "defaultValue": "Last Name",
                                    "widget": "text"
                                },
                                "requireEmail": {
                                    "label": "Require Email",
                                    "defaultValue": true,
                                    "widget": "toggle"
                                },
                                "email": {
                                    "label": "Email Placeholder",
                                    "defaultValue": "Email",
                                    "widget": "text"
                                },
                                "validatePhone": {
                                    "label": "Enable Phone Validation",
                                    "defaultValue": true,
                                    "widget": "toggle"
                                },
                                "phone": {
                                    "label": "Phone Placeholder",
                                    "defaultValue": "Phone",
                                    "widget": "text"
                                },
                                "requireAddress": {
                                    "label": "Require Address 1",
                                    "defaultValue": false,
                                    "widget": "toggle"
                                },
                                "address": {
                                    "label": "Address Placeholder",
                                    "defaultValue": "",
                                    "widget": "text"
                                },
                                "requireCity": {
                                    "label": "Require City",
                                    "defaultValue": false,
                                    "widget": "toggle"
                                },
                                "city": {
                                    "label": "City Placeholder",
                                    "defaultValue": "",
                                    "widget": "text"
                                },
                                "zipcode": {
                                    "label": "Zip code Placeholder",
                                    "defaultValue": "",
                                    "widget": "text"
                                },
                                "state": {
                                    "label": "State/Province/Region Placeholder",
                                    "defaultValue": "",
                                    "widget": "text"
                                },
                                "bldgVilla": {
                                    "label": "Building Name Placeholder",
                                    "defaultValue": "",
                                    "widget": "text"
                                },
                                "aptOffice": {
                                    "label": "Flat/Villa/Office Number Placeholder",
                                    "defaultValue": "",
                                    "widget": "text"
                                },
                                "nearestLandmark": {
                                    "label": "Nearest Landmark Placeholder",
                                    "defaultValue": "Nearest Landmark",
                                    "widget": "text"
                                },
                                "countryList": {
                                    "label": "Country",
                                    "defaultValue": ${JSON.stringify(points.funnelEditorData.countryList)},
                                    "widget": "custom_dropdown"
                                },
                                "use_local_lang": {
                                    "label": "Use local language in address dropdown",
                                    "defaultValue": false,
                                    "widget": "toggle"
                                }
                            }
                        }
                    },
                    renderer: {
                        Viewer: unlayer.createViewer({
                            render(values) {
                                return \`
                                    <style>
                                        .shake-horizontal { -webkit-animation: shake-horizontal 0.8s cubic-bezier(0.455, 0.030, 0.515, 0.955) both; animation: shake-horizontal 0.8s cubic-bezier(0.455, 0.030, 0.515, 0.955) both; } @-webkit-keyframes shake-horizontal { 0%, 100% { -webkit-transform: translateX(0); transform: translateX(0); } 10%, 30%, 50%, 70% { -webkit-transform: translateX(-10px); transform: translateX(-10px); } 20%, 40%, 60% { -webkit-transform: translateX(10px); transform: translateX(10px); } 80% { -webkit-transform: translateX(8px); transform: translateX(8px); } 90% { -webkit-transform: translateX(-8px); transform: translateX(-8px); } } @keyframes shake-horizontal { 0%, 100% { -webkit-transform: translateX(0); transform: translateX(0); } 10%, 30%, 50%, 70% { -webkit-transform: translateX(-10px); transform: translateX(-10px); } 20%, 40%, 60% { -webkit-transform: translateX(10px); transform: translateX(10px); } 80% { -webkit-transform: translateX(8px); transform: translateX(8px); } 90% { -webkit-transform: translateX(-8px); transform: translateX(-8px); } }
                                        .shake-vertical { -webkit-animation: shake-vertical 0.8s cubic-bezier(0.455, 0.030, 0.515, 0.955) both; animation: shake-vertical 0.8s cubic-bezier(0.455, 0.030, 0.515, 0.955) both; } @-webkit-keyframes shake-vertical { 0%, 100% { -webkit-transform: translateY(0); transform: translateY(0); } 10%, 30%, 50%, 70% { -webkit-transform: translateY(-8px); transform: translateY(-8px); } 20%, 40%, 60% { -webkit-transform: translateY(8px); transform: translateY(8px); } 80% { -webkit-transform: translateY(6.4px); transform: translateY(6.4px); } 90% { -webkit-transform: translateY(-6.4px); transform: translateY(-6.4px); } } @keyframes shake-vertical { 0%, 100% { -webkit-transform: translateY(0); transform: translateY(0); } 10%, 30%, 50%, 70% { -webkit-transform: translateY(-8px); transform: translateY(-8px); } 20%, 40%, 60% { -webkit-transform: translateY(8px); transform: translateY(8px); } 80% { -webkit-transform: translateY(6.4px); transform: translateY(6.4px); } 90% { -webkit-transform: translateY(-6.4px); transform: translateY(-6.4px); } }
                                        .bounce-top { -webkit-animation: bounce-top 0.9s both; animation: bounce-top 0.9s both; } @-webkit-keyframes bounce-top { 0% { -webkit-transform: translateY(-45px); transform: translateY(-45px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; opacity: 1; } 24% { opacity: 1; } 40% { -webkit-transform: translateY(-24px); transform: translateY(-24px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 65% { -webkit-transform: translateY(-12px); transform: translateY(-12px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 82% { -webkit-transform: translateY(-6px); transform: translateY(-6px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 93% { -webkit-transform: translateY(-4px); transform: translateY(-4px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 25%, 55%, 75%, 87% { -webkit-transform: translateY(0px); transform: translateY(0px); -webkit-animation-timing-function: ease-out; animation-timing-function: ease-out; } 100% { -webkit-transform: translateY(0px); transform: translateY(0px); -webkit-animation-timing-function: ease-out; animation-timing-function: ease-out; opacity: 1; } } @keyframes bounce-top { 0% { -webkit-transform: translateY(-45px); transform: translateY(-45px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; opacity: 1; } 24% { opacity: 1; } 40% { -webkit-transform: translateY(-24px); transform: translateY(-24px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 65% { -webkit-transform: translateY(-12px); transform: translateY(-12px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 82% { -webkit-transform: translateY(-6px); transform: translateY(-6px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 93% { -webkit-transform: translateY(-4px); transform: translateY(-4px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 25%, 55%, 75%, 87% { -webkit-transform: translateY(0px); transform: translateY(0px); -webkit-animation-timing-function: ease-out; animation-timing-function: ease-out; } 100% { -webkit-transform: translateY(0px); transform: translateY(0px); -webkit-animation-timing-function: ease-out; animation-timing-function: ease-out; opacity: 1; } }
                                        .pulsate { -webkit-animation: pulsate 0.8s ease-in-out infinite both; animation: pulsate 0.8s ease-in-out infinite both; } @-webkit-keyframes pulsate { 0% { -webkit-transform: scale(1); transform: scale(1); } 50% { -webkit-transform: scale(0.9); transform: scale(0.9); } 100% { -webkit-transform: scale(1); transform: scale(1); } } @keyframes pulsate { 0% { -webkit-transform: scale(1); transform: scale(1); } 50% { -webkit-transform: scale(0.9); transform: scale(0.9); } 100% { -webkit-transform: scale(1); transform: scale(1); } }
                                        @media only screen and (max-width: 768px) {
                                            button {
                                                width: 100% !important;
                                            }
                                        }
                                        .cod-form button {
                                            width: 100%;
                                            padding: 15px;
                                            font-size: \$\{values.fontSize\};
                                            color: \$\{values.buttonColors.color\};
                                            background-color: \$\{values.buttonColors.backgroundColor\};
                                            border: none;
                                            border-radius: 5px;
                                            font-weight: 600;
                                        }
                                    </style>
                                    <div class="cod-form">
                                        <button class="\$\{values.buttonAnimation\}">\$\{values.submitLabel\}</button>
                                    </div>
                                \`;
                            }
                        }),
                        exporters: {
                            web: function(values) {
                                values.useConfirmation = false;
                                if(typeof values.countryList === "object") values.countryList = JSON.stringify(values.countryList)
                                const countryList = JSON.parse(values.countryList);
                                var list = { "BGD": "BD", "BEL": "BE", "BFA": "BF", "BGR": "BG", "BIH": "BA", "BRB": "BB", "WLF": "WF", "BLM": "BL", "BMU": "BM", "BRN": "BN", "BOL": "BO", "BHR": "BH", "BDI": "BI", "BEN": "BJ", "BTN": "BT", "JAM": "JM", "BVT": "BV", "BWA": "BW", "WSM": "WS", "BES": "BQ", "BRA": "BR", "BHS": "BS", "JEY": "JE", "BLR": "BY", "BLZ": "BZ", "RUS": "RU", "RWA": "RW", "SRB": "RS", "TLS": "TL", "REU": "RE", "TKM": "TM", "TJK": "TJ", "ROU": "RO", "TKL": "TK", "GNB": "GW", "GUM": "GU", "GTM": "GT", "SGS": "GS", "GRC": "GR", "GNQ": "GQ", "GLP": "GP", "JPN": "JP", "GUY": "GY", "GGY": "GG", "GUF": "GF", "GEO": "GE", "GRD": "GD", "GBR": "GB", "GAB": "GA", "SLV": "SV", "GIN": "GN", "GMB": "GM", "GRL": "GL", "GIB": "GI", "GHA": "GH", "OMN": "OM", "TUN": "TN", "JOR": "JO", "HRV": "HR", "HTI": "HT", "HUN": "HU", "HKG": "HK", "HND": "HN", "HMD": "HM", "VEN": "VE", "PRI": "PR", "PSE": "PS", "PLW": "PW", "PRT": "PT", "SJM": "SJ", "PRY": "PY", "IRQ": "IQ", "PAN": "PA", "PYF": "PF", "PNG": "PG", "PER": "PE", "PAK": "PK", "PHL": "PH", "PCN": "PN", "POL": "PL", "SPM": "PM", "ZMB": "ZM", "ESH": "EH", "EST": "EE", "EGY": "EG", "ZAF": "ZA", "ECU": "EC", "ITA": "IT", "VNM": "VN", "SLB": "SB", "ETH": "ET", "SOM": "SO", "ZWE": "ZW", "SAU": "SA", "ESP": "ES", "ERI": "ER", "MNE": "ME", "MDA": "MD", "MDG": "MG", "MAF": "MF", "MAR": "MA", "MCO": "MC", "UZB": "UZ", "MMR": "MM", "MLI": "ML", "MAC": "MO", "MNG": "MN", "MHL": "MH", "MKD": "MK", "MUS": "MU", "MLT": "MT", "MWI": "MW", "MDV": "MV", "MTQ": "MQ", "MNP": "MP", "MSR": "MS", "MRT": "MR", "IMN": "IM", "UGA": "UG", "TZA": "TZ", "MYS": "MY", "MEX": "MX", "ISR": "IL", "FRA": "FR", "IOT": "IO", "SHN": "SH", "FIN": "FI", "FJI": "FJ", "FLK": "FK", "FSM": "FM", "FRO": "FO", "NIC": "NI", "NLD": "NL", "NOR": "NO", "NAM": "NA", "VUT": "VU", "NCL": "NC", "NER": "NE", "NFK": "NF", "NGA": "NG", "NZL": "NZ", "NPL": "NP", "NRU": "NR", "NIU": "NU", "COK": "CK", "XKX": "XK", "CIV": "CI", "CHE": "CH", "COL": "CO", "CHN": "CN", "CMR": "CM", "CHL": "CL", "CCK": "CC", "CAN": "CA", "COG": "CG", "CAF": "CF", "COD": "CD", "CZE": "CZ", "CYP": "CY", "CXR": "CX", "CRI": "CR", "CUW": "CW", "CPV": "CV", "CUB": "CU", "SWZ": "SZ", "SYR": "SY", "SXM": "SX", "KGZ": "KG", "KEN": "KE", "SSD": "SS", "SUR": "SR", "KIR": "KI", "KHM": "KH", "KNA": "KN", "COM": "KM", "STP": "ST", "SVK": "SK", "KOR": "KR", "SVN": "SI", "PRK": "KP", "KWT": "KW", "SEN": "SN", "SMR": "SM", "SLE": "SL", "SYC": "SC", "KAZ": "KZ", "CYM": "KY", "SGP": "SG", "SWE": "SE", "SDN": "SD", "DOM": "DO", "DMA": "DM", "DJI": "DJ", "DNK": "DK", "VGB": "VG", "DEU": "DE", "YEM": "YE", "DZA": "DZ", "USA": "US", "URY": "UY", "MYT": "YT", "UMI": "UM", "LBN": "LB", "LCA": "LC", "LAO": "LA", "TUV": "TV", "TWN": "TW", "TTO": "TT", "TUR": "TR", "LKA": "LK", "LIE": "LI", "LVA": "LV", "TON": "TO", "LTU": "LT", "LUX": "LU", "LBR": "LR", "LSO": "LS", "THA": "TH", "ATF": "TF", "TGO": "TG", "TCD": "TD", "TCA": "TC", "LBY": "LY", "VAT": "VA", "VCT": "VC", "ARE": "AE", "AND": "AD", "ATG": "AG", "AFG": "AF", "AIA": "AI", "VIR": "VI", "ISL": "IS", "IRN": "IR", "ARM": "AM", "ALB": "AL", "AGO": "AO", "ATA": "AQ", "ASM": "AS", "ARG": "AR", "AUS": "AU", "AUT": "AT", "ABW": "AW", "IND": "IN", "ALA": "AX", "AZE": "AZ", "IRL": "IE", "IDN": "ID", "UKR": "UA", "QAT": "QA", "MOZ": "MZ" };
                                var selectedCountryISO2 = list[countryList.selected] ? list[countryList.selected] : countryList.selected;
                                return \`
                                    <style>
                                        .shake-horizontal { -webkit-animation: shake-horizontal 0.8s cubic-bezier(0.455, 0.030, 0.515, 0.955) both; animation: shake-horizontal 0.8s cubic-bezier(0.455, 0.030, 0.515, 0.955) both; } @-webkit-keyframes shake-horizontal { 0%, 100% { -webkit-transform: translateX(0); transform: translateX(0); } 10%, 30%, 50%, 70% { -webkit-transform: translateX(-10px); transform: translateX(-10px); } 20%, 40%, 60% { -webkit-transform: translateX(10px); transform: translateX(10px); } 80% { -webkit-transform: translateX(8px); transform: translateX(8px); } 90% { -webkit-transform: translateX(-8px); transform: translateX(-8px); } } @keyframes shake-horizontal { 0%, 100% { -webkit-transform: translateX(0); transform: translateX(0); } 10%, 30%, 50%, 70% { -webkit-transform: translateX(-10px); transform: translateX(-10px); } 20%, 40%, 60% { -webkit-transform: translateX(10px); transform: translateX(10px); } 80% { -webkit-transform: translateX(8px); transform: translateX(8px); } 90% { -webkit-transform: translateX(-8px); transform: translateX(-8px); } }
                                        .shake-vertical { -webkit-animation: shake-vertical 0.8s cubic-bezier(0.455, 0.030, 0.515, 0.955) both; animation: shake-vertical 0.8s cubic-bezier(0.455, 0.030, 0.515, 0.955) both; } @-webkit-keyframes shake-vertical { 0%, 100% { -webkit-transform: translateY(0); transform: translateY(0); } 10%, 30%, 50%, 70% { -webkit-transform: translateY(-8px); transform: translateY(-8px); } 20%, 40%, 60% { -webkit-transform: translateY(8px); transform: translateY(8px); } 80% { -webkit-transform: translateY(6.4px); transform: translateY(6.4px); } 90% { -webkit-transform: translateY(-6.4px); transform: translateY(-6.4px); } } @keyframes shake-vertical { 0%, 100% { -webkit-transform: translateY(0); transform: translateY(0); } 10%, 30%, 50%, 70% { -webkit-transform: translateY(-8px); transform: translateY(-8px); } 20%, 40%, 60% { -webkit-transform: translateY(8px); transform: translateY(8px); } 80% { -webkit-transform: translateY(6.4px); transform: translateY(6.4px); } 90% { -webkit-transform: translateY(-6.4px); transform: translateY(-6.4px); } }
                                        .bounce-top { -webkit-animation: bounce-top 0.9s both; animation: bounce-top 0.9s both; } @-webkit-keyframes bounce-top { 0% { -webkit-transform: translateY(-45px); transform: translateY(-45px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; opacity: 1; } 24% { opacity: 1; } 40% { -webkit-transform: translateY(-24px); transform: translateY(-24px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 65% { -webkit-transform: translateY(-12px); transform: translateY(-12px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 82% { -webkit-transform: translateY(-6px); transform: translateY(-6px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 93% { -webkit-transform: translateY(-4px); transform: translateY(-4px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 25%, 55%, 75%, 87% { -webkit-transform: translateY(0px); transform: translateY(0px); -webkit-animation-timing-function: ease-out; animation-timing-function: ease-out; } 100% { -webkit-transform: translateY(0px); transform: translateY(0px); -webkit-animation-timing-function: ease-out; animation-timing-function: ease-out; opacity: 1; } } @keyframes bounce-top { 0% { -webkit-transform: translateY(-45px); transform: translateY(-45px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; opacity: 1; } 24% { opacity: 1; } 40% { -webkit-transform: translateY(-24px); transform: translateY(-24px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 65% { -webkit-transform: translateY(-12px); transform: translateY(-12px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 82% { -webkit-transform: translateY(-6px); transform: translateY(-6px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 93% { -webkit-transform: translateY(-4px); transform: translateY(-4px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 25%, 55%, 75%, 87% { -webkit-transform: translateY(0px); transform: translateY(0px); -webkit-animation-timing-function: ease-out; animation-timing-function: ease-out; } 100% { -webkit-transform: translateY(0px); transform: translateY(0px); -webkit-animation-timing-function: ease-out; animation-timing-function: ease-out; opacity: 1; } }
                                        .pulsate { -webkit-animation: pulsate 0.8s ease-in-out infinite both; animation: pulsate 0.8s ease-in-out infinite both; } @-webkit-keyframes pulsate { 0% { -webkit-transform: scale(1); transform: scale(1); } 50% { -webkit-transform: scale(0.9); transform: scale(0.9); } 100% { -webkit-transform: scale(1); transform: scale(1); } } @keyframes pulsate { 0% { -webkit-transform: scale(1); transform: scale(1); } 50% { -webkit-transform: scale(0.9); transform: scale(0.9); } 100% { -webkit-transform: scale(1); transform: scale(1); } }
                                        @media only screen and (max-width: 768px) {
                                            button { width: 100% !important; }
                                        }
                                        .cod-form .half-left { width: 49.5%; float: left; padding: 0 0.5% 0 0; }
                                        .cod-form .half-right { width: 49.5%; float: right; padding: 0 0 0 0.5%; }
                                        .cod-form .col-md-12 { padding: 0 !important; margin: 0 !important; }
                                        .cod-form input, .cod-form select { margin-bottom: 10px; display: inline-block; max-width: 100%; width: 100%; border-top-width: 1px; border-top-style: solid; border-top-color: #CCC; border-left-width: 1px; border-left-style: solid; border-left-color: #CCC; border-right-width: 1px; border-right-style: solid; border-right-color: #CCC; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #CCC; padding: 10px; color: #000; background-color: #FFF; font-size: 12px; width: 100%; border-radius: 0px; }
                                        .cod-form select { background-image: linear-gradient(45deg, transparent 50%, gray 50%), linear-gradient(135deg, gray 50%, transparent 50%), linear-gradient(to right, #ccc, #ccc); background-position: calc(100% - 15px) calc(1em + 2px), calc(100% - 10px) calc(1em + 2px), calc(100% - 2.5em) 0.5em; background-size: 5px 5px, 5px 5px, 2px 2em; background-repeat: no-repeat; cursor: pointer; }
                                        .cod-form .select-parent { position: relative; width: 100%; }
                                        .cod-form select { -webkit-appearance: none; -moz-appearance: none; padding: 10px; border-radius: 0; border-color: #ccc; background-color: inherit; position: relative; width: 100%; }
                                        .cod-form button { width: 100%; padding: 15px; font-size: \$\{values.fontSize\}; border: none; font-weight: 600; color: \$\{values.buttonColors.color\}; background-color: \$\{values.buttonColors.backgroundColor\}; padding: \$\{values.padding\}; cursor: pointer; border-radius: 5px; }
                                        .cod-form button:hover { background-color: \$\{values.buttonColors.hoverColor\}; }
                                        .cod-form .form-container { position: fixed; width: 100%; height: 100vh; overflow: scroll; z-index: 9999; top: 0; left: 0; }
                                        .cod-form .form-container-child { align-items: center; display: flex; flex-direction: column; min-height: 100%; justify-content: center; background-color: #00000078; width: 100%; }
                                        .cod-form .form-container-child form { display: inline-block; max-width: 700px; /* 100% */ min-width: 320px; /* 200px */ background-color: #ffffff; padding: 30px; position: relative; }
                                        .autocomplete { position: relative; display: inline-block; }
                                        .autocomplete-items { position: absolute; border: 1px solid #d4d4d4; border-bottom: none; border-top: none; z-index: 99; top: 100%; left: 0; right: 0; max-height: 190px; overflow: scroll; }
                                        .autocomplete-items div { padding: 10px; cursor: pointer; background-color: #fff; border-bottom: 1px solid #d4d4d4; }
                                        .autocomplete-items div:hover { background-color: #e9e9e9; }
                                        .autocomplete-active { background-color: DodgerBlue !important; color: #ffffff; }
                                        .cod-form select:disabled { background-color: #e4e0e0; }
                                    </style>
                                    <div class="cod-form" style="position: relative; display: table; width: 100%;">
                                        <button class="\$\{values.buttonAnimation\} open-close-trigger">\$\{values.submitLabel\}</button>
                                        <div class="form-container" style="display: none;">
                                            <div class="form-container-child open-close-trigger">
                                                <form id="cod_paymentForm" class="payment-form">
                                                    <span class="times-icon open-close-trigger" style="font-size: 15px; float: right; position: absolute; top: 5px; right: 5px; padding: 0px 6px; border: 1px solid #cccccc; border-radius: 50%; cursor: pointer;">&times;</span>
                                                    \$\{values.header ? \`<h2 style="margin: 0 0 5px; text-align: center;">\$\{values.header\}</h2>\` : ""\}
                                                    \$\{values.header2 ? \`<h4 style="margin: 0 0 5px;">\$\{values.header2\}</h4>\` : ""\}
                                                    <div class="half-left">
                                                        <input type="text" name="firstName" placeholder="\$\{values.firstName\}" required />
                                                    </div>
                                                    <div class="half-right">
                                                        <input type="text" name="lastName" placeholder="\$\{values.lastName\}" required />
                                                    </div>
                                                    <input type="email" name="email" autocomplete="on" placeholder="\$\{values.email\}" \$\{values.requireEmail ? "required" : "" \} />
                                                    <div class="insert_plg_form"></div>
                                                    <input type="hidden" name="country" value="\$\{countryList.selected\}" />
                                                    <input type="hidden" name="meta" value="${this.encryptString(user_id)}">
                                                    <input type="hidden" name="pageid" value="${state.page_data.funnel_id}">
                                                    <input type="hidden" name="fplg" value="${state.page_data.is_fulfill_by_plg}">
                                                    <button type="submit">\$\{values.submitLabel\}</button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                    <script type="text/javascript">
                                        var use_local_lang = \$\{values.use_local_lang\};
                                        if(!document.getElementById("plg_form_script")) {
                                            const plg_form_script = document.createElement("script");
                                            plg_form_script.id = "plg_form_script";
                                            plg_form_script.src = "https://productlistgenie.com/funnel-genie/js/funnel_genie_checkout_dev.js?v="+Date.now();
                                            // plg_form_script.defer = true;
                                            document.body.appendChild(plg_form_script);
                                            function getEditorConfiguration() {
                                                return {
                                                    analytics_add_to_cart: \$\{values.fbTrack\},
                                                    analytics_initiate_checkout: \$\{values.fbInitiate\},
                                                    analytics_purchased: \$\{values.fbPurchase\},
                                                    analytics_leads: \$\{values.fbTrackLeads\},
                                                    analytics_snapchat_id: "${this.state.page_data.funnel_snapchat_id}",
                                                    
                                                    plg_email_confirmation: ${this.state.page_data.funnel_use_email_confirmation},
                                                    validate_sms: \$\{values.useConfirmation\},
                                                    validate_phone: \$\{values.validatePhone\},
                                                    required_address: \$\{values.requireAddress\},
                                                    required_city: \$\{values.requireCity\},
    
                                                    html_id: "\$\{values._meta.htmlID\}",
                                                    placeholder_phone: "\$\{values.phone\}",
                                                    placeholder_address: "\$\{values.address\}",
                                                    placeholder_city: "\$\{values.city\}",
                                                    placeholder_zip: "\$\{values.zipcode\}",
                                                    placeholder_state: "\$\{values.state\}",
                                                    placeholder_bldg_villa: "\$\{values.bldgVilla\}",
                                                    placeholder_apt_office: "\$\{values.aptOffice\}",
                                                    placeholder_nearest_landmark: "\$\{values.nearestLandmark\}",
                                                    selected_country: "\$\{countryList.selected\}",
                                                    selected_country_iso2: "\$\{selectedCountryISO2\}",
    
                                                    confirmation_header: "\$\{values.headerText\}",
                                                    confirmation_sub_header: "\$\{values.subText\}",
                                                    confirmation_input_label: "\$\{values.inputLabel\}",
                                                    confirmation_positive_button_text: "\$\{values.positiveText\}",
                                                    confirmation_negative_button_text: "\$\{values.negativeText\}",
    
                                                    redirection_action: "\$\{values.submitAction.url\}",
                                                    redirection_target: "\$\{values.submitAction.target\}"
                                                };
                                            }
                                        }
                                    </script>
                                \`;
                            },
                            email: function() {}
                        }
                    }
                });
            `);
            // TODO :: New GENIE COD FORM        
            customJS.push(`
            console.log('init using cod-form-new-genie');
            unlayer.registerTool({
                type: 'cod-form-new-genie',
                category: 'contents',
                label: 'GENIE FORM',
                icon: '<svg aria-hidden="true" data-prefix="fab" data-icon="wpforms" fill="#fff" class="svg-inline--fa fa-wpforms fa-w-14 fa-3x" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d=" M 224 32 C 180.164 32 146.07 52.461 146.07 79.736 C 146.07 92.4 153.863 99.223 165.552 103.119 L 224 69.995 L 282.448 103.119 C 295.112 99.223 301.93 91.43 301.93 78.766 C 301.93 52.464 267.836 32 224 32 L 224 32 L 224 32 L 224 32 Z M 296.089 420.682 C 270.762 443.087 225.948 450.876 194.776 450.876 L 193.806 450.876 C 219.133 468.41 251.276 480.1 292.189 480.1 C 326.284 480.1 357.456 469.388 374.99 459.647 L 407.144 441.135 L 370.12 441.135 L 365.249 441.135 L 351.607 441.135 C 336.021 441.135 321.413 442.101 306.801 433.334 C 301.93 429.438 299.012 425.552 296.089 420.682 Z M 32.765 247.739 C 30.481 243.668 29.174 238.995 29.174 233.637 C 29.174 197.595 78.847 165.463 152.881 151.826 L 152.881 151.826 L 152.881 151.826 L 152.881 151.826 L 224 187.861 L 295.119 151.826 C 369.153 165.463 418.826 197.595 418.826 233.637 C 418.826 274.551 321.413 275.533 321.413 275.533 C 285.37 275.533 259.065 269.688 234.712 256.05 C 237.634 254.102 239.59 253.128 242.512 251.179 C 263.943 237.542 280.5 226.826 301.93 226.826 L 301.93 207.343 L 136.328 207.343 L 136.328 226.826 L 244.453 226.826 C 240.556 228.774 235.697 231.704 231.801 234.627 C 212.494 247.498 191.055 261.216 161.593 269.044 L 143.27 252.15 C 139.18 248.24 133.73 246.05 128.06 246.05 L 41.17 246.05 C 38.257 246.05 35.401 246.629 32.765 247.739 Z M 178.094 284.258 C 192.044 279.611 204.232 273.841 215.229 267.732 L 215.229 267.732 L 215.229 267.732 C 245.427 286.24 279.525 295.015 321.413 295.015 L 337.966 295.015 C 336.017 297.938 334.073 300.86 332.125 304.757 L 331.154 306.697 C 319.465 324.232 292.189 362.226 292.189 398.269 C 290.241 401.192 287.326 403.151 285.378 405.1 C 266.362 422.305 230.503 430.244 201.29 431.277 L 201.29 315.28 C 201.29 315.28 201.29 315.28 201.29 315.28 C 201.29 309.44 198.97 303.85 194.85 299.72 C 194.75 299.63 194.66 299.53 194.56 299.44 L 178.094 284.258 Z M 128.062 256.05 L 41.174 256.05 C 34.557 256.05 29.174 261.433 29.174 268.05 L 29.174 463.426 C 29.174 470.043 34.557 475.426 41.174 475.426 L 179.291 475.426 C 185.908 475.426 191.291 470.043 191.291 463.426 L 191.291 315.277 C 191.291 312.073 190.043 309.06 187.777 306.793 L 136.413 259.433 C 134.163 257.25 131.205 256.05 128.062 256.05 Z M 176.291 460.426 L 44.174 460.426 L 44.174 271.05 L 115.942 271.05 L 115.942 311.286 C 115.942 320.171 123.167 327.4 132.047 327.4 L 176.291 327.4 L 176.291 460.426 L 176.291 460.426 Z M 132.047 312.4 C 131.438 312.4 130.942 311.9 130.942 311.286 L 130.942 279.706 L 165.91 312.399 L 132.047 312.399 L 132.047 312.4 Z M 66.043 353.855 C 60.903 353.855 56.722 358.037 56.722 363.176 C 56.722 368.316 60.904 372.497 66.043 372.497 C 71.183 372.497 75.364 368.315 75.364 363.176 C 75.364 358.037 71.182 353.855 66.043 353.855 Z M 83.043 355.677 L 162.543 355.677 L 162.543 370.677 L 83.043 370.677 L 83.043 355.677 Z M 66.043 383.855 C 60.903 383.855 56.722 388.037 56.722 393.176 C 56.722 398.315 60.904 402.497 66.043 402.497 C 71.183 402.497 75.364 398.315 75.364 393.176 C 75.364 388.037 71.182 383.855 66.043 383.855 Z M 83.043 385.676 L 162.543 385.676 L 162.543 400.676 L 83.043 400.676 L 83.043 385.676 Z M 66.043 413.855 C 60.903 413.855 56.722 418.037 56.722 423.176 C 56.722 428.315 60.904 432.497 66.043 432.497 C 71.183 432.497 75.364 428.315 75.364 423.176 C 75.364 418.037 71.182 413.855 66.043 413.855 Z M 83.043 415.676 L 162.543 415.676 L 162.543 430.676 L 83.043 430.676 L 83.043 415.676 Z M 224 88.507 C 224 88.507 194.776 105.056 185.035 110.901 L 185.035 138.184 L 185.035 146.955 L 188.935 148.896 L 224 166.438 L 259.065 148.896 L 262.965 146.955 L 262.965 138.184 L 262.965 110.901 C 253.224 106.03 224 89.481 224 88.507 L 224 88.507 L 224 88.507 L 224 88.507 Z "></path></svg>',
                values: {},
                options: {                       
                    variant: {
                        title: "GENIE Form Contents", //april12
                        position: 1,
                        options:{
                            "submitCCAction": {
                                "label": "Credit Card Redirect Link",
                                "defaultValue": {
                                    url: "#",
                                    target: "_self"
                                },
                                "widget": "link_list"
                            },
                            "creditcardLabel": {
                                "label": "Use Credit Card Button Text",
                                "defaultValue": "Use Credit Card to get discount",
                                "widget": "text"
                            },
                            "orderSummary": {
                                "label": "Order Summary Label",
                                "defaultValue": "Order Summary",
                                "widget": "text"
                            },
                            "totalorderSummary": {
                                "label": "Order Total Summary Label",
                                "defaultValue": "Order Total",
                                "widget": "text"
                            },
                            "useCreditCardAlignment": {
                                "label": "Alignment",
                                "defaultValue": 'center',
                                "widget": "alignment"
                            },
                            "useCreditCardColor": {
                                "label": "Font Color",
                                "defaultValue": "#121212",
                                "widget": "color_picker"
                            },
                            "useCreditCardBGColor": {
                                "label": "Background Color",
                                "defaultValue": "#fff",
                                "widget": "color_picker"
                            },                                
                            "creditcardLabelfontSize": {
                                "label": "Credit Card Font Size",
                                "defaultValue": "15px",
                                "widget": "px"
                            },
                            "creditcardLabelbuttonColors": {
                                "label": "Credit Card Button Color",
                                "defaultValue": {
                                    "color": "#FFF",
                                    "backgroundColor": "#26c686",
                                    "hoverColor": "#2A92BF"
                                },
                                "widget": "button_color"
                            },                                
                            "creditcardLabelbuttonAnimation": {
                                "label": "Credit Card Apply Animation",
                                "defaultValue": "",
                                "widget": "animation_list"
                            },  
                        }
                    }, 
                    button: {
                        title: "GENIE COD Contents",
                        position: 1,
                        options: {                                                                                                                                                          
                            "fbTrack": {
                                "label": "Track AddToCart",
                                "defaultValue": false,
                                "widget": "toggle"
                            },
                            "fbInitiate": {
                                "label": "Track InitiateCheckout",
                                "defaultValue": false,
                                "widget": "toggle"
                            },
                            "fbPurchase": {
                                "label": "Track Purchase",
                                "defaultValue": false,
                                "widget": "toggle"
                            },
                            "fbTrackLeads": {
                                "label": "Track Leads",
                                "defaultValue": false,
                                "widget": "toggle"
                            },
                            "submitLabel": {
                                "label": "Button Text",
                                "defaultValue": "Cash On Delivery",
                                "widget": "text"
                            },
                            "fontSize": {
                                "label": "Font Size",
                                "defaultValue": "15px",
                                "widget": "px"
                            },
                            "buttonColors": {
                                "label": "Color",
                                "defaultValue": {
                                    "color": "#FFF",
                                    "backgroundColor": "#26c686",
                                    "hoverColor": "#2A92BF"
                                },
                                "widget": "button_color"
                            },
                            "submitAction": {
                                "label": "Redirect Link",
                                "defaultValue": {
                                    url: "#",
                                    target: "_self"
                                },
                                "widget": "link_list"
                            },
                            "buttonAnimation": {
                                "label": "Apply Animation",
                                "defaultValue": "",
                                "widget": "animation_list"
                            }
                        }
                    },
                    confirmation: {
                        title: "Confirmation",
                        position: 1,
                        options: {
                            "headerText": {
                                "label": "Header Text",
                                "defaultValue": "ORDER SUCCESSFUL",
                                "widget": "text"
                            },
                            "subText": {
                                "label": "Sub Header Text",
                                "defaultValue": "A verification code has been sent to your mobile via text message.",
                                "widget": "text"
                            },
                            "inputLabel": {
                                "label": "Input label",
                                "defaultValue": "Enter your 5 digit verification code.",
                                "widget": "text"
                            },
                            "positiveText": {
                                "label": "Positive Button Text",
                                "defaultValue": "Submit Code",
                                "widget": "text"
                            },
                            "negativeText": {
                                "label": "Address Note",
                                "defaultValue": "Wait, let me update my info",
                                "widget": "text"
                            }
                        }
                    },
                    form: {
                        title: "Form",
                        position: 1,
                        options: {
                            "hideFields": {
                                "label": "Show Fields after Email and Phone",
                                "defaultValue": false,
                                "widget": "toggle"
                            },
                            "firstName": {
                                "label": "First Name Placeholder",
                                "defaultValue": "First Name",
                                "widget": "text"
                            },
                            "lastName": {
                                "label": "Last Name Placeholder",
                                "defaultValue": "Last Name",
                                "widget": "text"
                            },
                            "requireEmail": {
                                "label": "Require Email",
                                "defaultValue": true,
                                "widget": "toggle"
                            },
                            "email": {
                                "label": "Email Placeholder",
                                "defaultValue": "Email",
                                "widget": "text"
                            },
                            "validatePhone": {
                                "label": "Enable Phone Validation",
                                "defaultValue": true,
                                "widget": "toggle"
                            },
                            "phone": {
                                "label": "Phone Placeholder",
                                "defaultValue": "Phone",
                                "widget": "text"
                            },
                            "requireAddress": {
                                "label": "Require Address 1",
                                "defaultValue": false,
                                "widget": "toggle"
                            },
                            "address": {
                                "label": "Address Placeholder",
                                "defaultValue": "",
                                "widget": "text"
                            },
                            "requireCity": {
                                "label": "Require City",
                                "defaultValue": false,
                                "widget": "toggle"
                            },
                            "city": {
                                "label": "City Placeholder",
                                "defaultValue": "",
                                "widget": "text"
                            },
                            "zipcode": {
                                "label": "Zip code Placeholder",
                                "defaultValue": "",
                                "widget": "text"
                            },
                            "state": {
                                "label": "State/Province/Region Placeholder",
                                "defaultValue": "",
                                "widget": "text"
                            },
                            "bldgVilla": {
                                "label": "Building Name Placeholder",
                                "defaultValue": "",
                                "widget": "text"
                            },
                            "aptOffice": {
                                "label": "Flat/Villa/Office Number Placeholder",
                                "defaultValue": "",
                                "widget": "text"
                            },
                            "nearestLandmark": {
                                "label": "Nearest Landmark Placeholder",
                                "defaultValue": "Nearest Landmark",
                                "widget": "text"
                            },
                            "countryList": {
                                "label": "Country",
                                "defaultValue": ${JSON.stringify(points.funnelEditorData.countryList)},
                                "widget": "custom_dropdown"
                            },
                            "use_local_lang": {
                                "label": "Use local language in address dropdown",
                                "defaultValue": false,
                                "widget": "toggle"
                            }
                        }
                    }
                },
                renderer: {
                    Viewer: unlayer.createViewer({
                        render(values) {                                                   
                            return \`
                                <style>
                                    .shake-horizontal { -webkit-animation: shake-horizontal 0.8s cubic-bezier(0.455, 0.030, 0.515, 0.955) both; animation: shake-horizontal 0.8s cubic-bezier(0.455, 0.030, 0.515, 0.955) both; } @-webkit-keyframes shake-horizontal { 0%, 100% { -webkit-transform: translateX(0); transform: translateX(0); } 10%, 30%, 50%, 70% { -webkit-transform: translateX(-10px); transform: translateX(-10px); } 20%, 40%, 60% { -webkit-transform: translateX(10px); transform: translateX(10px); } 80% { -webkit-transform: translateX(8px); transform: translateX(8px); } 90% { -webkit-transform: translateX(-8px); transform: translateX(-8px); } } @keyframes shake-horizontal { 0%, 100% { -webkit-transform: translateX(0); transform: translateX(0); } 10%, 30%, 50%, 70% { -webkit-transform: translateX(-10px); transform: translateX(-10px); } 20%, 40%, 60% { -webkit-transform: translateX(10px); transform: translateX(10px); } 80% { -webkit-transform: translateX(8px); transform: translateX(8px); } 90% { -webkit-transform: translateX(-8px); transform: translateX(-8px); } }
                                    .shake-vertical { -webkit-animation: shake-vertical 0.8s cubic-bezier(0.455, 0.030, 0.515, 0.955) both; animation: shake-vertical 0.8s cubic-bezier(0.455, 0.030, 0.515, 0.955) both; } @-webkit-keyframes shake-vertical { 0%, 100% { -webkit-transform: translateY(0); transform: translateY(0); } 10%, 30%, 50%, 70% { -webkit-transform: translateY(-8px); transform: translateY(-8px); } 20%, 40%, 60% { -webkit-transform: translateY(8px); transform: translateY(8px); } 80% { -webkit-transform: translateY(6.4px); transform: translateY(6.4px); } 90% { -webkit-transform: translateY(-6.4px); transform: translateY(-6.4px); } } @keyframes shake-vertical { 0%, 100% { -webkit-transform: translateY(0); transform: translateY(0); } 10%, 30%, 50%, 70% { -webkit-transform: translateY(-8px); transform: translateY(-8px); } 20%, 40%, 60% { -webkit-transform: translateY(8px); transform: translateY(8px); } 80% { -webkit-transform: translateY(6.4px); transform: translateY(6.4px); } 90% { -webkit-transform: translateY(-6.4px); transform: translateY(-6.4px); } }
                                    .bounce-top { -webkit-animation: bounce-top 0.9s both; animation: bounce-top 0.9s both; } @-webkit-keyframes bounce-top { 0% { -webkit-transform: translateY(-45px); transform: translateY(-45px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; opacity: 1; } 24% { opacity: 1; } 40% { -webkit-transform: translateY(-24px); transform: translateY(-24px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 65% { -webkit-transform: translateY(-12px); transform: translateY(-12px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 82% { -webkit-transform: translateY(-6px); transform: translateY(-6px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 93% { -webkit-transform: translateY(-4px); transform: translateY(-4px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 25%, 55%, 75%, 87% { -webkit-transform: translateY(0px); transform: translateY(0px); -webkit-animation-timing-function: ease-out; animation-timing-function: ease-out; } 100% { -webkit-transform: translateY(0px); transform: translateY(0px); -webkit-animation-timing-function: ease-out; animation-timing-function: ease-out; opacity: 1; } } @keyframes bounce-top { 0% { -webkit-transform: translateY(-45px); transform: translateY(-45px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; opacity: 1; } 24% { opacity: 1; } 40% { -webkit-transform: translateY(-24px); transform: translateY(-24px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 65% { -webkit-transform: translateY(-12px); transform: translateY(-12px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 82% { -webkit-transform: translateY(-6px); transform: translateY(-6px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 93% { -webkit-transform: translateY(-4px); transform: translateY(-4px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 25%, 55%, 75%, 87% { -webkit-transform: translateY(0px); transform: translateY(0px); -webkit-animation-timing-function: ease-out; animation-timing-function: ease-out; } 100% { -webkit-transform: translateY(0px); transform: translateY(0px); -webkit-animation-timing-function: ease-out; animation-timing-function: ease-out; opacity: 1; } }
                                    .pulsate { -webkit-animation: pulsate 0.8s ease-in-out infinite both; animation: pulsate 0.8s ease-in-out infinite both; } @-webkit-keyframes pulsate { 0% { -webkit-transform: scale(1); transform: scale(1); } 50% { -webkit-transform: scale(0.9); transform: scale(0.9); } 100% { -webkit-transform: scale(1); transform: scale(1); } } @keyframes pulsate { 0% { -webkit-transform: scale(1); transform: scale(1); } 50% { -webkit-transform: scale(0.9); transform: scale(0.9); } 100% { -webkit-transform: scale(1); transform: scale(1); } }
                                    @media only screen and (max-width: 768px) {
                                        button { width: 100% !important; }
                                    }
                                    .cod-form .half-left { width: 49.5%; float: left; padding: 0 0.5% 0 0; }
                                    .cod-form .half-right { width: 49.5%; float: right; padding: 0 0 0 0.5%; }
                                    .cod-form .col-md-12 { padding: 0 !important; margin: 0 !important; }
                                    .cod-form input, .cod-form .select-parent select { margin-bottom: 10px; display: inline-block; max-width: 100%; width: 100%; border-top-width: 1px; border-top-style: solid; border-top-color: #CCC; border-left-width: 1px; border-left-style: solid; border-left-color: #CCC; border-right-width: 1px; border-right-style: solid; border-right-color: #CCC; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #CCC; padding: 10px; color: #000; background-color: #FFF; font-size: 12px; width: 100%; border-radius: 0px; }
                                    .cod-form select { background-image: linear-gradient(45deg, transparent 50%, gray 50%), linear-gradient(135deg, gray 50%, transparent 50%), linear-gradient(to right, #ccc, #ccc); background-position: calc(100% - 15px) calc(1em + 2px), calc(100% - 10px) calc(1em + 2px), calc(100% - 2.5em) 0.5em; background-size: 5px 5px, 5px 5px, 2px 2em; background-repeat: no-repeat; cursor: pointer; }
                                    .cod-form .select-parent { position: relative; width: 100%; }
                                    .cod-form select { -webkit-appearance: none; -moz-appearance: none; padding: 10px; border-radius: 0; border-color: #ccc; background-color: inherit; position: relative; width: 100%; }
                                    .cod-form button { width: 100%; padding: 15px; font-size: \$\{values.fontSize\}; border: none; font-weight: 600; color: \$\{values.buttonColors.color\}; background-color: \$\{values.buttonColors.backgroundColor\}; padding: \$\{values.padding\}; cursor: pointer; border-radius: 5px; }
                                    .cod-form button:hover { background-color: \$\{values.buttonColors.hoverColor\}; }
                                    .prepaid{ width: 100%; padding: 15px; font-size: \$\{values.creditcardLabelfontSize\} !important; border: none; font-weight: 600; color: \$\{values.creditcardLabelbuttonColors.color\} !important; background-color: \$\{values.creditcardLabelbuttonColors.backgroundColor\} !important; padding: \$\{values.padding\}; cursor: pointer; border-radius: 5px; }
                                    .prepaid:hover { background-color: \$\{values.creditcardLabelbuttonColors.hoverColor\} !important; }
                                    .autocomplete { position: relative; display: inline-block; }
                                    .autocomplete-items { position: absolute; border: 1px solid #d4d4d4; border-bottom: none; border-top: none; z-index: 99; top: 100%; left: 0; right: 0; max-height: 190px; overflow: scroll; }
                                    .autocomplete-items div { padding: 10px; cursor: pointer; background-color: #fff; border-bottom: 1px solid #d4d4d4; }
                                    .autocomplete-items div:hover { background-color: #e9e9e9; }
                                    .autocomplete-active { background-color: DodgerBlue !important; color: #ffffff; }
                                    .cod-form .cc-activator { text-align: \$\{values.useCreditCardAlignment\}; color : \$\{values.useCreditCardColor\}; background-color: \$\{values.useCreditCardBGColor\}; font-size: \$\{values.creditcardLabelfontSize\} } 
                                    .container .summary h3 {font-weight: 100; margin: 5px 6px; }    
                                </style>
                                <div class="cod-form" style="position: relative;">
                                    <div class="form-container">
                                        <div class="form-container-child open-close-trigger">                                               
                                            <form id="cod_paymentForm" class="payment-form">
                                           
                                                <div class="half-left">
                                                    <input type="text" name="firstName" placeholder="\$\{values.firstName\}" required />
                                                </div>
                                                <div class="half-right">
                                                    <input type="text" name="lastName" placeholder="\$\{values.lastName\}" required />
                                                </div>
                                                <input type="email" name="email" autocomplete="on" placeholder="\$\{values.email\}" \$\{values.requireEmail ? "required" : "" \} />
                                                <input type="text" name="phone" placeholder="\$\{values.phone\}" style="margin-bottom: 0;">
                                                <div class="half-left" style="margin-top: 10px;">
                                                    <input type="text" name="city" placeholder="\$\{values.city || "Default City Placeholder"\}" \$\{values.requireCity ? "required" : "" \} >
                                                </div>
                                                <div class="half-right" style="margin-top: 10px;">
                                                    <input type="text" name="state" placeholder="\$\{values.state || "Default State/Province/Region Placeholder"\}">
                                                </div>                                                
                                                <div class="container summary">
                                                    <div>
                                                        <div class="col-12">
                                                            <h2>\$\{values.orderSummary\}</h2>
                                                        </div>                                                        
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-7">
                                                            <h3 id="genie_new_items_qty">Items(0):</h3>
                                                        </div>
                                                        <div class="col-5">
                                                            <h3 id="genie_new_items_price" style="text-align: end;">0
                                                            </h3>
                                                        </div>
                                                    </div>                                                    
                                                    <hr />
                                                    <div class="row">
                                                        <div class="col-7">
                                                             <h2>\$\{values.totalorderSummary\}:</h2>
                                                        </div>
                                                        <div class="col-5">
                                                            <h2 style="text-align: end;"
                                                                id="genie_new_items_order_total">0</h2>
                                                        </div>
                                                    </div>
                                                </div>                                                
                                                <button type="submit" class="\$\{values.buttonAnimation\}">\$\{values.submitLabel\}</button>
                                                <br>
                                                <br>                                                    
                                                                                             
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            \`;
                        }
                    }),
                    exporters: {        
                        web: function(values) {
                            values.useConfirmation = false;
                            var useCreditCard = true;    
                                                                                     
                            if(typeof values.countryList === "object") values.countryList = JSON.stringify(values.countryList)
                            const countryList = JSON.parse(values.countryList);                           
                            var list = { "BGD": "BD", "BEL": "BE", "BFA": "BF", "BGR": "BG", "BIH": "BA", "BRB": "BB", "WLF": "WF", "BLM": "BL", "BMU": "BM", "BRN": "BN", "BOL": "BO", "BHR": "BH", "BDI": "BI", "BEN": "BJ", "BTN": "BT", "JAM": "JM", "BVT": "BV", "BWA": "BW", "WSM": "WS", "BES": "BQ", "BRA": "BR", "BHS": "BS", "JEY": "JE", "BLR": "BY", "BLZ": "BZ", "RUS": "RU", "RWA": "RW", "SRB": "RS", "TLS": "TL", "REU": "RE", "TKM": "TM", "TJK": "TJ", "ROU": "RO", "TKL": "TK", "GNB": "GW", "GUM": "GU", "GTM": "GT", "SGS": "GS", "GRC": "GR", "GNQ": "GQ", "GLP": "GP", "JPN": "JP", "GUY": "GY", "GGY": "GG", "GUF": "GF", "GEO": "GE", "GRD": "GD", "GBR": "GB", "GAB": "GA", "SLV": "SV", "GIN": "GN", "GMB": "GM", "GRL": "GL", "GIB": "GI", "GHA": "GH", "OMN": "OM", "TUN": "TN", "JOR": "JO", "HRV": "HR", "HTI": "HT", "HUN": "HU", "HKG": "HK", "HND": "HN", "HMD": "HM", "VEN": "VE", "PRI": "PR", "PSE": "PS", "PLW": "PW", "PRT": "PT", "SJM": "SJ", "PRY": "PY", "IRQ": "IQ", "PAN": "PA", "PYF": "PF", "PNG": "PG", "PER": "PE", "PAK": "PK", "PHL": "PH", "PCN": "PN", "POL": "PL", "SPM": "PM", "ZMB": "ZM", "ESH": "EH", "EST": "EE", "EGY": "EG", "ZAF": "ZA", "ECU": "EC", "ITA": "IT", "VNM": "VN", "SLB": "SB", "ETH": "ET", "SOM": "SO", "ZWE": "ZW", "SAU": "SA", "ESP": "ES", "ERI": "ER", "MNE": "ME", "MDA": "MD", "MDG": "MG", "MAF": "MF", "MAR": "MA", "MCO": "MC", "UZB": "UZ", "MMR": "MM", "MLI": "ML", "MAC": "MO", "MNG": "MN", "MHL": "MH", "MKD": "MK", "MUS": "MU", "MLT": "MT", "MWI": "MW", "MDV": "MV", "MTQ": "MQ", "MNP": "MP", "MSR": "MS", "MRT": "MR", "IMN": "IM", "UGA": "UG", "TZA": "TZ", "MYS": "MY", "MEX": "MX", "ISR": "IL", "FRA": "FR", "IOT": "IO", "SHN": "SH", "FIN": "FI", "FJI": "FJ", "FLK": "FK", "FSM": "FM", "FRO": "FO", "NIC": "NI", "NLD": "NL", "NOR": "NO", "NAM": "NA", "VUT": "VU", "NCL": "NC", "NER": "NE", "NFK": "NF", "NGA": "NG", "NZL": "NZ", "NPL": "NP", "NRU": "NR", "NIU": "NU", "COK": "CK", "XKX": "XK", "CIV": "CI", "CHE": "CH", "COL": "CO", "CHN": "CN", "CMR": "CM", "CHL": "CL", "CCK": "CC", "CAN": "CA", "COG": "CG", "CAF": "CF", "COD": "CD", "CZE": "CZ", "CYP": "CY", "CXR": "CX", "CRI": "CR", "CUW": "CW", "CPV": "CV", "CUB": "CU", "SWZ": "SZ", "SYR": "SY", "SXM": "SX", "KGZ": "KG", "KEN": "KE", "SSD": "SS", "SUR": "SR", "KIR": "KI", "KHM": "KH", "KNA": "KN", "COM": "KM", "STP": "ST", "SVK": "SK", "KOR": "KR", "SVN": "SI", "PRK": "KP", "KWT": "KW", "SEN": "SN", "SMR": "SM", "SLE": "SL", "SYC": "SC", "KAZ": "KZ", "CYM": "KY", "SGP": "SG", "SWE": "SE", "SDN": "SD", "DOM": "DO", "DMA": "DM", "DJI": "DJ", "DNK": "DK", "VGB": "VG", "DEU": "DE", "YEM": "YE", "DZA": "DZ", "USA": "US", "URY": "UY", "MYT": "YT", "UMI": "UM", "LBN": "LB", "LCA": "LC", "LAO": "LA", "TUV": "TV", "TWN": "TW", "TTO": "TT", "TUR": "TR", "LKA": "LK", "LIE": "LI", "LVA": "LV", "TON": "TO", "LTU": "LT", "LUX": "LU", "LBR": "LR", "LSO": "LS", "THA": "TH", "ATF": "TF", "TGO": "TG", "TCD": "TD", "TCA": "TC", "LBY": "LY", "VAT": "VA", "VCT": "VC", "ARE": "AE", "AND": "AD", "ATG": "AG", "AFG": "AF", "AIA": "AI", "VIR": "VI", "ISL": "IS", "IRN": "IR", "ARM": "AM", "ALB": "AL", "AGO": "AO", "ATA": "AQ", "ASM": "AS", "ARG": "AR", "AUS": "AU", "AUT": "AT", "ABW": "AW", "IND": "IN", "ALA": "AX", "AZE": "AZ", "IRL": "IE", "IDN": "ID", "UKR": "UA", "QAT": "QA", "MOZ": "MZ" };
                            var selectedCountryISO2 = list[countryList.selected] ? list[countryList.selected] : countryList.selected;
                            return \`
                                <style>
                                    .shake-horizontal { -webkit-animation: shake-horizontal 0.8s cubic-bezier(0.455, 0.030, 0.515, 0.955) both; animation: shake-horizontal 0.8s cubic-bezier(0.455, 0.030, 0.515, 0.955) both; } @-webkit-keyframes shake-horizontal { 0%, 100% { -webkit-transform: translateX(0); transform: translateX(0); } 10%, 30%, 50%, 70% { -webkit-transform: translateX(-10px); transform: translateX(-10px); } 20%, 40%, 60% { -webkit-transform: translateX(10px); transform: translateX(10px); } 80% { -webkit-transform: translateX(8px); transform: translateX(8px); } 90% { -webkit-transform: translateX(-8px); transform: translateX(-8px); } } @keyframes shake-horizontal { 0%, 100% { -webkit-transform: translateX(0); transform: translateX(0); } 10%, 30%, 50%, 70% { -webkit-transform: translateX(-10px); transform: translateX(-10px); } 20%, 40%, 60% { -webkit-transform: translateX(10px); transform: translateX(10px); } 80% { -webkit-transform: translateX(8px); transform: translateX(8px); } 90% { -webkit-transform: translateX(-8px); transform: translateX(-8px); } }
                                    .shake-vertical { -webkit-animation: shake-vertical 0.8s cubic-bezier(0.455, 0.030, 0.515, 0.955) both; animation: shake-vertical 0.8s cubic-bezier(0.455, 0.030, 0.515, 0.955) both; } @-webkit-keyframes shake-vertical { 0%, 100% { -webkit-transform: translateY(0); transform: translateY(0); } 10%, 30%, 50%, 70% { -webkit-transform: translateY(-8px); transform: translateY(-8px); } 20%, 40%, 60% { -webkit-transform: translateY(8px); transform: translateY(8px); } 80% { -webkit-transform: translateY(6.4px); transform: translateY(6.4px); } 90% { -webkit-transform: translateY(-6.4px); transform: translateY(-6.4px); } } @keyframes shake-vertical { 0%, 100% { -webkit-transform: translateY(0); transform: translateY(0); } 10%, 30%, 50%, 70% { -webkit-transform: translateY(-8px); transform: translateY(-8px); } 20%, 40%, 60% { -webkit-transform: translateY(8px); transform: translateY(8px); } 80% { -webkit-transform: translateY(6.4px); transform: translateY(6.4px); } 90% { -webkit-transform: translateY(-6.4px); transform: translateY(-6.4px); } }
                                    .bounce-top { -webkit-animation: bounce-top 0.9s both; animation: bounce-top 0.9s both; } @-webkit-keyframes bounce-top { 0% { -webkit-transform: translateY(-45px); transform: translateY(-45px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; opacity: 1; } 24% { opacity: 1; } 40% { -webkit-transform: translateY(-24px); transform: translateY(-24px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 65% { -webkit-transform: translateY(-12px); transform: translateY(-12px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 82% { -webkit-transform: translateY(-6px); transform: translateY(-6px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 93% { -webkit-transform: translateY(-4px); transform: translateY(-4px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 25%, 55%, 75%, 87% { -webkit-transform: translateY(0px); transform: translateY(0px); -webkit-animation-timing-function: ease-out; animation-timing-function: ease-out; } 100% { -webkit-transform: translateY(0px); transform: translateY(0px); -webkit-animation-timing-function: ease-out; animation-timing-function: ease-out; opacity: 1; } } @keyframes bounce-top { 0% { -webkit-transform: translateY(-45px); transform: translateY(-45px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; opacity: 1; } 24% { opacity: 1; } 40% { -webkit-transform: translateY(-24px); transform: translateY(-24px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 65% { -webkit-transform: translateY(-12px); transform: translateY(-12px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 82% { -webkit-transform: translateY(-6px); transform: translateY(-6px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 93% { -webkit-transform: translateY(-4px); transform: translateY(-4px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 25%, 55%, 75%, 87% { -webkit-transform: translateY(0px); transform: translateY(0px); -webkit-animation-timing-function: ease-out; animation-timing-function: ease-out; } 100% { -webkit-transform: translateY(0px); transform: translateY(0px); -webkit-animation-timing-function: ease-out; animation-timing-function: ease-out; opacity: 1; } }
                                    .pulsate { -webkit-animation: pulsate 0.8s ease-in-out infinite both; animation: pulsate 0.8s ease-in-out infinite both; } @-webkit-keyframes pulsate { 0% { -webkit-transform: scale(1); transform: scale(1); } 50% { -webkit-transform: scale(0.9); transform: scale(0.9); } 100% { -webkit-transform: scale(1); transform: scale(1); } } @keyframes pulsate { 0% { -webkit-transform: scale(1); transform: scale(1); } 50% { -webkit-transform: scale(0.9); transform: scale(0.9); } 100% { -webkit-transform: scale(1); transform: scale(1); } }
                                    @media only screen and (max-width: 768px) {
                                        button { width: 100% !important; }
                                    }
                                    .cod-form .half-left { width: 49.5%; float: left; padding: 0 0.5% 0 0; }
                                    .cod-form .half-right { width: 49.5%; float: right; padding: 0 0 0 0.5%; }
                                    .cod-form .col-md-12 { padding: 0 !important; margin: 0 !important; }
                                    .cod-form input, .cod-form .select-parent select, .insert_plg_form select { margin-bottom: 10px; display: inline-block; max-width: 100%; width: 100%; border-top-width: 1px; border-top-style: solid; border-top-color: #CCC; border-left-width: 1px; border-left-style: solid; border-left-color: #CCC; border-right-width: 1px; border-right-style: solid; border-right-color: #CCC; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #CCC; padding: 10px; color: #000; background-color: #FFF; font-size: 12px; width: 100%; border-radius: 0px; }
                                    .cod-form select { background-image: linear-gradient(45deg, transparent 50%, gray 50%), linear-gradient(135deg, gray 50%, transparent 50%), linear-gradient(to right, #ccc, #ccc); background-position: calc(100% - 15px) calc(1em + 2px), calc(100% - 10px) calc(1em + 2px), calc(100% - 2.5em) 0.5em; background-size: 5px 5px, 5px 5px, 2px 2em; background-repeat: no-repeat; cursor: pointer; }
                                    .cod-form .select-parent { position: relative; width: 100%; }
                                    .cod-form select { -webkit-appearance: none; -moz-appearance: none; padding: 10px; border-radius: 0; border-color: #ccc; background-color: #FFF; position: relative; width: 100%; }
                                    .cod-form button { width: 100%; padding: 15px; font-size: \$\{values.fontSize\}; border: none; font-weight: 600; color: \$\{values.buttonColors.color\}; background-color: \$\{values.buttonColors.backgroundColor\}; padding: \$\{values.padding\}; cursor: pointer; border-radius: 5px; }
                                    .cod-form button:hover { background-color: \$\{values.buttonColors.hoverColor\}; }
                                    .prepaid{ width: 100%; padding: 15px; font-size: \$\{values.fontSize\}; border: none; font-weight: 600; color: \$\{values.creditcardLabelbuttonColors.color\} !important; background-color: \$\{values.creditcardLabelbuttonColors.backgroundColor\} !important; padding: \$\{values.padding\}; cursor: pointer; border-radius: 5px; }
                                    .prepaid:hover { background-color: \$\{values.creditcardLabelbuttonColors.hoverColor\} !important; }
                                    .autocomplete { position: relative; display: inline-block; }
                                    .autocomplete-items { position: absolute; border: 1px solid #d4d4d4; border-bottom: none; border-top: none; z-index: 99; top: 100%; left: 0; right: 0; max-height: 190px; overflow: scroll; }
                                    .autocomplete-items div { padding: 10px; cursor: pointer; background-color: #fff; border-bottom: 1px solid #d4d4d4; }
                                    .autocomplete-items div:hover { background-color: #e9e9e9; }
                                    .autocomplete-active { background-color: DodgerBlue !important; color: #ffffff; }
                                    .phone-container div { background-color: #FFF }
                                    .cod-form select:disabled { background-color: #e4e0e0; }
                                    .cod-form .cc-activator { text-align: \$\{values.useCreditCardAlignment\}; color : \$\{values.useCreditCardColor\}; background-color: \$\{values.useCreditCardBGColor\}; font-size: \$\{values.creditcardLabelfontSize\} } 
                                </style>
                                <style>
                                .form-row {
                                    width: 70%;
                                    float: left;
                                    background-color: #ededed;
                                }
                                #card-element {
                                background-color: transparent;
                                height: 40px;
                                border-radius: 4px;
                                border: 1px solid transparent;
                                box-shadow: 0 1px 3px 0 #e6ebf1;
                                -webkit-transition: box-shadow 150ms ease;
                                transition: box-shadow 150ms ease;
                                }
                                
                                #card-element--focus {
                                  box-shadow: 0 1px 3px 0 #cfd7df;
                                }
                                
                                #card-element--invalid {
                                  border-color: #fa755a;
                                }
                                
                                #card-element--webkit-autofill {
                                  background-color: #fefde5 !important;
                                }
                                
                                #submitbutton,#tap-btn{
                                align-items:flex-start;
                                background-attachment:scroll;background-clip:border-box;
                                background-color:rgb(50, 50, 93);background-image:none;
                                background-origin:padding-box;
                                background-position-x:0%;
                                background-position-y:0%;
                                background-size:auto;
                                border-bottom-color:rgb(255, 255, 255);
                                border-bottom-left-radius:4px;
                                border-bottom-right-radius:4px;border-bottom-style:none;
                                border-bottom-width:0px;border-image-outset:0px;
                                border-image-repeat:stretch;border-image-slice:100%;
                                border-image-source:none;border-image-width:1;
                                border-left-color:rgb(255, 255, 255);
                                border-left-style:none;
                                border-left-width:0px;
                                border-right-color:rgb(255, 255, 255);
                                border-right-style:none;
                                border-right-width:0px;
                                border-top-color:rgb(255, 255, 255);
                                border-top-left-radius:4px;
                                border-top-right-radius:4px;
                                border-top-style:none;
                                border-top-width:0px;
                                box-shadow:rgba(50, 50, 93, 0.11) 0px 4px 6px 0px, rgba(0, 0, 0, 0.08) 0px 1px 3px 0px;
                                box-sizing:border-box;color:rgb(255, 255, 255);
                                cursor:pointer;
                                display:block;
                                float:left;
                                font-family:"Helvetica Neue", Helvetica, sans-serif;
                                font-size:15px;
                                font-stretch:100%;
                                font-style:normal;
                                font-variant-caps:normal;
                                font-variant-east-asian:normal;
                                font-variant-ligatures:normal;
                                font-variant-numeric:normal;
                                font-weight:600;
                                height:35px;
                                letter-spacing:0.375px;
                                line-height:35px;
                                margin-bottom:0px;
                                margin-left:12px;
                                margin-right:0px;
                                margin-top:28px;
                                outline-color:rgb(255, 255, 255);
                                outline-style:none;
                                outline-width:0px;
                                overflow-x:visible;
                                overflow-y:visible;
                                padding-bottom:0px;
                                padding-left:14px;
                                padding-right:14px;
                                padding-top:0px;
                                text-align:center;
                                text-decoration-color:rgb(255, 255, 255);
                                text-decoration-line:none;
                                text-decoration-style:solid;
                                text-indent:0px;
                                text-rendering:auto;
                                text-shadow:none;
                                text-size-adjust:100%;
                                text-transform:none;
                                transition-delay:0s;
                                transition-duration:0.15s;
                                transition-property:all;
                                transition-timing-function:ease;
                                white-space:nowrap;
                                width:150.781px;
                                word-spacing:0px;
                                writing-mode:horizontal-tb;
                                -webkit-appearance:none;
                                -webkit-font-smoothing:antialiased;
                                -webkit-tap-highlight-color:rgba(0, 0, 0, 0);
                                -webkit-border-image:none;
                                
                                }                                    
                                .cc_modal {
                                    display: none;
                                    position: fixed;
                                    top: 0;
                                    z-index: 120;
                                    height: 100%;
                                    background-color: #000000c7;
                                }

                                .cc_modal .container {
                                    min-width: 320px;
                                    max-width: 700px !important;
                                    position: relative;
                                    background-color: #fff;
                                    align-items: center;
                                    display: flex;
                                    flex-direction: column;
                                    margin: auto;
                                    min-height: 500px;
                                    justify-content: center;
                                    border-radius: 5px;
                                }      
                                .container .summary h3 {
                                    font-weight: 100;
                                    margin: 5px 6px;
                                }                          
                                </style>
                                <div class="cc_modal" style="width: 100%;padding-top: 6rem;position: fixed;top: 0;left: 0;right: 0;" id="plg_modal_sample_test">
                                    <div class="container">
                                        <div class="row" id="container_cc_msg">
                                            <div class="col-12 text-center">
                                                <h2 id="cc_message_modal" style="text-align: center;">Please wait
                                                    Authenticating</h2>
                                            </div>
                                        </div>
                                        <iframe id="iframe_cc_loader" src="" width="120" height="120"
                                            style="width: 100%; height: 28rem; border: none; display:none;"></iframe>
                                    </div>
                                </div>
                                <div class="cod-form" style="position: relative;">
                                    <div class="form-container">
                                        <div class="form-container-child open-close-trigger">
                                            <form id="cod_paymentForm" class="payment-form">
                                           
                                                <div class="half-left">
                                                    <input type="text" name="firstName" placeholder="\$\{values.firstName\}" required />
                                                </div>
                                                <div class="half-right">
                                                    <input type="text" name="lastName" placeholder="\$\{values.lastName\}" required />
                                                </div>
                                                <input type="email" name="email" autocomplete="on" placeholder="\$\{values.email\}" \$\{values.requireEmail ? "required" : "" \} />
                                                <div class="insert_plg_form"></div>
                                                <input type="hidden" name="country" value="\$\{countryList.selected\}" />
                                                <input type="hidden" name="meta" value="${this.encryptString(user_id)}">
                                                <input type="hidden" name="pageid" value="${state.page_data.funnel_id}">
                                                <input type="hidden" name="fplg" value="${state.page_data.is_fulfill_by_plg}">
                                                <div id="plg_credit_card" style="display:none;">                                                                                                                
                                                    <div id="element-container"></div>
                                                    <div id="error-handler" role="alert"></div>                                                                                                                                                                                                                
                                                </div>
                                                <!-- Order summary -->
                                                <div class="container summary">
                                                    <div class="row">
                                                        <div class="col-12">
                                                            <h2>\$\{values.orderSummary\}</h2>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-7">
                                                            <h3 id="genie_new_items_qty">Items(0):</h3>
                                                        </div>
                                                        <div class="col-5">
                                                            <h3 id="genie_new_items_price" style="text-align: end;">0</h3>
                                                        </div>
                                                    </div>                                                    
                                                    <hr />
                                                    <div class="row">
                                                        <div class="col-7">
                                                            <h2>\$\{values.totalorderSummary\}:</h2>
                                                        </div>
                                                        <div class="col-5">
                                                            <h2 style="text-align: end;"
                                                                id="genie_new_items_order_total">0</h2>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- END OF ORDER SUMMARY -->                                                
                                                <br></br>
                                                <button id="submit_cod_form" type="submit" class="\$\{values.buttonAnimation\}">\$\{values.submitLabel\}</button>
                                                <br></br>                                                                                             
                                                
                                            </form>
                                            
                                        </div>
                                    </div>
                                </div>
                                <script src="https://cdnjs.cloudflare.com/ajax/libs/bluebird/3.3.4/bluebird.min.js"></script>
                                <script src="https://secure.gosell.io/js/sdk/tap.min.js"></script>  
                                <script src="https://code.jquery.com/jquery-3.5.1.min.js"
                                integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
                                crossorigin="anonymous"></script>    
                                <script>
                                               // THE USE OF CREDIT CARD NEW GENIE       
                                const toggleClass = (el, className) => el.classList.toggle(className);

                                var gettinradios = false;

                                try{
                                    gettinradios = multivariantIsUsingCC;
                                }catch(e){
                                    gettinradios = false;
                                }

                                var isUsingCreditCard = gettinradios;   
                                multivariantIsUsingCC =  isUsingCreditCard;                               
                               var plg_modal_sample_test  = document.getElementById("plg_modal_sample_test");
                               var iframe_cc_loader = document.getElementById("iframe_cc_loader");
                               var cc_message_modal = document.getElementById("cc_message_modal");

                               var container_cc_msg = document.getElementById("container_cc_msg");

                               var cc_activator_btn = document.getElementsByClassName("cc-activator");
                               function updatePriceOnDiscount() {
                                var toggleClass = (el, className) => el.classList.toggle(className);
                                document.querySelectorAll('.variant_container .plg_variants').forEach(el => {
                                    var discountedPrice =  parseFloat(el.getAttribute('data-price')) - (parseFloat(el.getAttribute('data-quantity')) * parseFloat(el.getAttribute('data-ccdiscount')))
                                    el.querySelector('.variant_price').innerText = discountedPrice.toFixed(2) + el.getAttribute('data-csymbol')
                                    toggleClass(el.querySelector('.variant_price'), 'updating');
                                    setTimeout(function () {
                                        toggleClass(el.querySelector('.variant_price'), 'updating');
                                    }, 800);

                                });
                            }                 
                            
                            function updatePriceOnCOD() {
                                var toggleClass = (el, className) => el.classList.toggle(className);
                                document.querySelectorAll('.variant_container .plg_variants').forEach(el => {                                                                                
                                    el.querySelector('.variant_price').innerText = el.getAttribute('data-price') + el.getAttribute('data-csymbol')
                                    toggleClass(el.querySelector('.variant_price'), 'updating');
                                    setTimeout(function () {
                                        toggleClass(el.querySelector('.variant_price'), 'updating');
                                    }, 800);

                                });
                            }   

                            if(isUsingCreditCard) {                                
                                var x = document.getElementById("plg_credit_card");
                                console.log('oops true');
                                multivariantIsUsingCC = true;
                                document.getElementById("submit_cod_form").innerText = "\$\{values.creditcardLabel\}";                                
                                toggleClass(document.getElementById("submit_cod_form"), "prepaid");                                
                                x.style.display = "block";
                            }else{                                
                                var x = document.getElementById("plg_credit_card");
                                //   updatePriceOnCOD();
                                // console.log('oops false');
                                multivariantIsUsingCC = false;
                                document.getElementById("submit_cod_form").innerText = "$\{values.submitLabel\}";
                                x.style.display = "none";                                
                            }
                           

                               function savetoLocalStorage(responses) {
                                console.log('saving to localstorage', responses);
                                localStorage.setItem("receipt_cc",responses.respo.receipt.id);
                                localStorage.setItem("cc_details", JSON.stringify(responses));
                               }

                               //  Creating dynamic order status
                               function changeOrderDetailsStatus() {
                                   // console.log('tseting changeOrderDetailsStatus()');
                                   document.querySelectorAll(".plg_variants").forEach(el => {
                                       if (el.querySelector("input[type=radio]").checked) {
                                           let cword = el.getAttribute("data-cword");
                                           let csymbol = el.getAttribute("data-csymbol");
                                           let sku = el.getAttribute("data-sku");
                                           let shopifyid = el.getAttribute("data-shopifyid");
                                           let tags = el.getAttribute("data-tags");
                                           let quantity = parseInt(el.getAttribute("data-quantity"));
                                           let name = el.getAttribute("data-name");
                                           let price = parseFloat(el.getAttribute("data-price"));
                                           let baseprice = parseFloat(el.getAttribute("data-baseprice"));
                                           let ccdiscount = parseFloat(el.getAttribute("data-ccdiscount"));


                                           var genie_new_items_qty = document.getElementById("genie_new_items_qty");
                                           var genie_new_items_price = document.getElementById("genie_new_items_price");                                          
                                           var genie_new_items_order_total = document.getElementById("genie_new_items_order_total");

                                           genie_new_items_qty.innerText = "Items(" + quantity + ")";

                                           genie_new_items_price.innerHTML = "<span style='font-size: 0.9em; padding: 0px 2px;'>" + csymbol + "</span>" + "" + (baseprice * quantity).toFixed(2);                                            



                                            genie_new_items_order_total.innerText = csymbol + "" + (baseprice * quantity).toFixed(2);


                                       }else{

                                       }
                                   });
                               }


                               function showCODOnlyEvent() {
                                   var x = document.getElementById("plg_credit_card");

                                   isUsingCreditCard = false;
                                   //   updatePriceOnCOD();
                                   multivariantIsUsingCC = false;
                                   document.getElementById("submit_cod_form").innerText = "$\{values.submitLabel\}";
                                //    toggleClass(document.getElementById("submit_cod_form"), "prepaid");
                                document.getElementById("submit_cod_form").classList.remove("prepaid");
                                   // cc_activator_btn[0].innerText = "Edited Use Credit. Card";
                                   try {
                                       // cc_activator_btn[1].innerText = "Edited Use Credit. Card";
                                   } catch (err) {
                                       console.log('');
                                   }
                                   x.style.display = "none";

                               }

                               function showCreditOnlyEvent() {
                                   var x = document.getElementById("plg_credit_card");
                                   isUsingCreditCard = true;
                                   // console.log(plg_selectedVariant.variant_qty);
                                   // updatePriceOnDiscount();
                                   multivariantIsUsingCC = true;
                                   document.getElementById("submit_cod_form").innerText =  "\$\{values.creditcardLabel\}";
                                //    toggleClass(, "prepaid");
                                document.getElementById("submit_cod_form").classList.add("prepaid");
                                   // cc_activator_btn[0].innerText = "Use COD for payment ";
                                   try {
                                       // cc_activator_btn[1].innerText = "Use COD for payment ";
                                   } catch (err) {
                                       console.log('');
                                   }
                                   x.style.display = "block";
                               }




                            

                               function showHTMLCreditCard(){
                                    var x = document.getElementById("plg_credit_card");
                                    if (x.style.display === "none") {
                                        isUsingCreditCard = true;                                        
                                        multivariantIsUsingCC = true;
                                        document.getElementById("submit_cod_form").innerText =  "\$\{values.creditcardLabel\}";
                                        toggleClass(document.getElementById("submit_cod_form"), "prepaid");                                                                            
                                      x.style.display = "block";
                                    } else {
                                      isUsingCreditCard = false;                                    
                                      multivariantIsUsingCC = false;
                                      document.getElementById("submit_cod_form").innerText = "$\{values.submitLabel\}";
                                      toggleClass(document.getElementById("submit_cod_form"), "prepaid");                                                                    
                                      x.style.display = "none";
                                    }     
                                }


                                // showHTMLCreditCard();


                                //pass your public key from tap's dashboard
                                // var tap = Tapjsli('pk_test_0WJVYyBOCw4Z5sxGFi9kcvpf');
                                var tap = Tapjsli('pk_live_LEBPYCraDqHuUmQO75dgtpnx');

                                var elements = tap.elements({});
                                var style = {
                                base: {
                                    color: '#535353',
                                    lineHeight: '18px',
                                    fontFamily: 'sans-serif',
                                    fontSmoothing: 'antialiased',
                                    fontSize: '16px',
                                    '::placeholder': {
                                    color: 'rgba(0, 0, 0, 0.26)',
                                    fontSize:'15px'
                                    }
                                },
                                invalid: {
                                    color: 'red'
                                }
                                };
                                // input labels/placeholders
                                var labels = {
                                    cardNumber:"Card Number",
                                    expirationDate:"MM/YY",
                                    cvv:"CVV",
                                    cardHolder:"Card Holder Name"
                                };
                                //payment options
                                var paymentOptions = {
                                currencyCode:["KWD","USD","SAR","AED","BHD","OMR","QAR"],
                                labels : labels,
                                TextDirection:'ltr'
                                }
                                //create element, pass style and payment options
                                var card = elements.create('card', {style: style},paymentOptions);
                                //mount element
                                card.mount('#element-container');
                                //card change event listener
                                card.addEventListener('change', function(event) {
                                if(event.BIN){
                                    // console.log(event.BIN)
                                }
                                if(event.loaded){
                                    // console.log("UI loaded :"+event.loaded);
                                    // console.log("current currency is :"+card.getCurrency())
                                }
                                var displayError = document.getElementById('error-handler');
                                if (event.error) {
                                    displayError.textContent = event.error.message;
                                } else {
                                    displayError.textContent = '';
                                }
                                });
                                // end of use of credit card
                                                               
                                </script>                              
                                <script type="text/javascript">

                                var isDone = false;

                                function changeDone() {
                                    isDone = true;
                                }

                                    var use_local_lang = \$\{values.use_local_lang\};
                                    if(!document.getElementById("plg_form_script")) {
                                        const plg_form_script = document.createElement("script");
                                        const file_name = "${condition.is_exclusive_vip_user(this.props.session.getCurrentUser) ? "funnel_genie_checkout_dev_checkout_test.js" : "funnel_genie_checkout_dev.js"}";
                                        plg_form_script.id = "plg_form_script";
                                        plg_form_script.src = "https://productlistgenie.com/funnel-genie/js/" + file_name;
                                        // plg_form_script.defer = true;
                                        document.body.appendChild(plg_form_script);
                                        var submitCreditCard = (targetedEvent) => new Promise((resolve, reject) => {
                                            console.log('promise submitcredit card was called ');

                                            iframe_cc_loader.style.display = "none";
                                            plg_modal_sample_test.style.display = "unset";
                                            container_cc_msg.style.display = "unset";

                                            document.getElementById("cc_message_modal").innerText = "Please wait authenticating.";


                                            // create a div sayinh authenticating payment .... 

                                            tap.createToken(card).then(function (result) {

                                                function formToObject(form) {
                                                    return Array.from(new FormData(form)).reduce((acc, [key, value]) => ({
                                                        ...acc,
                                                        [key]: value
                                                    }), {});
                                                }

                                                const formValue = formToObject(targetedEvent);

                                                formValue.variantQty = plg_selectedVariant.variant_qty ? plg_selectedVariant.variant_qty : "1";
                                                formValue.productPrice = parseFloat(plg_price);
                                                formValue.productName = plg_selectedVariant.product_name;
                                                formValue.variantName = typeof multiple_variant_name !== "undefined" ? multiple_variant_name +  plg_selectedVariant.variant_name : plg_selectedVariant.variant_name;
                                                formValue.merchantType = "cod";
                                                formValue.variant_id = plg_selectedVariant.variant_id;
                                                formValue.currencyWord = plg_selectedVariant.currency.word;
                                                formValue.currencySymbol = plg_selectedVariant.currency.code;
                                                plgQS() !== "" ? formValue.campaign_src = plgQS() : void 0;



                                                if (result.error) {
                                                    // Inform the user if there was an error
                                                    document.getElementById("cc_message_modal").innerText = "Error, Please Provide Input for Bank Details.";
                                                    setTimeout(() => {
                                                        plg_modal_sample_test.style.display = "none";
                                                    }, 2000); 
                                                    reject({
                                                        message: "Error Please Provide Input "
                                                    })
                                                    var errorElement = document.getElementById('error-handler');
                                                    errorElement.textContent = result.error.message;
                                                } else {
                                                    // Send the token to your server
                                                    // var errorElement = document.getElementById('success');
                                                    // errorElement.style.display = "block";
                                                    // var tokenElement = document.getElementById('token');
                                                    // tokenElement.textContent = result.id;
                                                    // console.log(result);
                                                    // create charge by sending token and cod_data.

                                                    var charging_data = {
                                                        creditcard: result,
                                                        cod_data: formValue
                                                    };


                                                    console.log(charging_data);

                                                    fetch('/v1/api/auth_user', {
                                                        method: "POST",
                                                        headers: {
                                                            'Content-Type': 'application/json'
                                                        },
                                                        body: JSON.stringify(charging_data)
                                                    }).then(auth => auth.json()).then(auth => {
                                                        console.log(auth);
                                                        if (auth.response && auth.isInit) {
                                                            let data = auth.data;

                                                            container_cc_msg.style.display = "none";

                                                            // window.open(data.transaction.url, "_blank");
                                                            iframe_cc_loader.setAttribute("src", data.transaction.url);

                                                            //tagetNode
                                                            iframe_cc_loader.style.display = "unset";
                                                        } else {
                                                            document.getElementById("cc_message_modal").innerText = "Sorry we cannot process your payment. " + auth.data.response.message;

                                                            setTimeout(() => {
                                                                plg_modal_sample_test.style.display = "none";
                                                            }, 2000);
                                                            reject({
                                                                message: "NOT DONE"
                                                            });
                                                        }
                                                    }).catch(err => {
                                                        console.log('error in /v1/api/charge_me', err);

                                                        document.getElementById("cc_message_modal").innerText = "Something went wrong please contact administrator.";


                                                        setTimeout(() => {
                                                            plg_modal_sample_test.style.display = "none";
                                                        }, 2000);
                                                        reject({
                                                            message: "NOT DONE"
                                                        });
                                                    });

                                                    localStorage.setItem("cc_credentials", JSON.stringify(result));
                                                    console.log(result);
                                                    console.log(JSON.parse(localStorage.getItem("cod_data")));
                                                }
                                            }).catch(errors => {
                                                document.getElementById("cc_message_modal").innerText = "Something went wrong please contact administrator.";
                                                setTimeout(() => {
                                                    plg_modal_sample_test.style.display = "none";
                                                }, 2000);
                                                reject({
                                                    message: "Error ::: " + errors
                                                })
                                            });
                                        });                                        


                                        function getEditorConfiguration() {
                                            return {
                                                analytics_add_to_cart: \$\{values.fbTrack\},
                                                analytics_initiate_checkout: \$\{values.fbInitiate\},
                                                analytics_purchased: \$\{values.fbPurchase\},
                                                analytics_leads: \$\{values.fbTrackLeads\},
                                                analytics_snapchat_id: "${this.state.page_data.funnel_snapchat_id}",
                                                
                                                hide_fields: \$\{values.hideFields\},
                                                plg_email_confirmation: ${this.state.page_data.funnel_use_email_confirmation},
                                                validate_sms: \$\{values.useConfirmation\},
                                                validate_phone: \$\{values.validatePhone\},
                                                required_address: \$\{values.requireAddress\},
                                                required_city: \$\{values.requireCity\},

                                                html_id: "\$\{values._meta.htmlID\}",
                                                placeholder_phone: "\$\{values.phone\}",
                                                placeholder_address: "\$\{values.address\}",
                                                placeholder_city: "\$\{values.city\}",
                                                placeholder_zip: "\$\{values.zipcode\}",
                                                placeholder_state: "\$\{values.state\}",
                                                placeholder_bldg_villa: "\$\{values.bldgVilla\}",
                                                placeholder_apt_office: "\$\{values.aptOffice\}",
                                                placeholder_nearest_landmark: "\$\{values.nearestLandmark\}",
                                                selected_country: "\$\{countryList.selected\}",
                                                selected_country_iso2: "\$\{selectedCountryISO2\}",
                                                
                                                confirmation_sub_header: "\$\{values.subText\}",
                                                confirmation_input_label: "\$\{values.inputLabel\}",
                                                confirmation_positive_button_text: "\$\{values.positiveText\}",
                                                confirmation_negative_button_text: "\$\{values.negativeText\}",

                                                redirection_action: !isUsingCreditCard ? "\$\{values.submitAction.url\}" : "\$\{values.submitCCAction.url\}",
                                                redirection_target: !isUsingCreditCard ? "\$\{values.submitAction.target\}" : "\$\{values.submitCCAction.target\}",
                                                form_version: 2
                                            };
                                        }
                                    }
                                </script>
                            \`;
                        },
                        email: function() {}
                    }
                }
            });
            `); 

            // TODO :: Here COD FORM with Credit Card
            // TODO :: Minus $9 for what ever currency convert $9 = currencyLocalPrice - currencyLocalPrice
            customJS.push(` 
                unlayer.registerTool({
                    type: 'cod-form-v2',
                    category: 'contents',
                    label: 'COD Form',
                    icon: '<svg aria-hidden="true" data-prefix="fab" data-icon="wpforms" class="svg-inline--fa fa-wpforms fa-w-14 fa-3x" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M448 75.2v361.7c0 24.3-19 43.2-43.2 43.2H43.2C19.3 480 0 461.4 0 436.8V75.2C0 51.1 18.8 32 43.2 32h361.7c24 0 43.1 18.8 43.1 43.2zm-37.3 361.6V75.2c0-3-2.6-5.8-5.8-5.8h-9.3L285.3 144 224 94.1 162.8 144 52.5 69.3h-9.3c-3.2 0-5.8 2.8-5.8 5.8v361.7c0 3 2.6 5.8 5.8 5.8h361.7c3.2.1 5.8-2.7 5.8-5.8zM150.2 186v37H76.7v-37h73.5zm0 74.4v37.3H76.7v-37.3h73.5zm11.1-147.3l54-43.7H96.8l64.5 43.7zm210 72.9v37h-196v-37h196zm0 74.4v37.3h-196v-37.3h196zm-84.6-147.3l64.5-43.7H232.8l53.9 43.7zM371.3 335v37.3h-99.4V335h99.4z"></path></svg>',
                    values: {},
                    options: {                       
                        tools: {  //if error change tools to button
                            title: "COD Form | Buttons", //april12
                            position: 1,
                            options: {                                
                                "activateCreditCard": {
                                    "label" : "Use Credit Card",
                                    "defaultValue": false,
                                    "widget": "toggle"
                                },
                                "useCodOnly": {
                                    "label" : "Use COD",
                                    "defaultValue": true,
                                    "widget": "toggle"
                                },                                
                                "defaultCreditCard": {
                                    "label" : "Use Credit Card as Default",
                                    "defaultValue": false,
                                    "widget": "toggle"
                                },
                                "submitCCAction": {
                                    "label": "Credit Card Redirect Link",
                                    "defaultValue": {
                                        url: "#",
                                        target: "_self"
                                    },
                                    "widget": "link_list"
                                },
                                "creditcardLabel": {
                                    "label": "Use Credit Card Button Text",
                                    "defaultValue": "Use Credit Card to get discount",
                                    "widget": "text"
                                },
                                "useCODLabel": {
                                    "label": "Use COD Button Text",
                                    "defaultValue": "Use COD for payment",
                                    "widget": "text"
                                },
                                "useCreditCardPosition": {
                                    "label": "Use Credit Card Positiom",
                                    "defaultValue": ${JSON.stringify({ "label": "Select Button Position", "list": [ { "value": "top", "label": "Top" },{ "value": "bottom", "label": "Bottom" },{ "value": "both", "label": "Both" } ],"selected" : "bottom" })},
                                    "widget": "custom_dropdown"
                                },
                                "useCreditCardAlignment": {
                                    "label": "Alignment",
                                    "defaultValue": 'center',
                                    "widget": "alignment"
                                },
                                "useCreditCardColor": {
                                    "label": "Font Color",
                                    "defaultValue": "#121212",
                                    "widget": "color_picker"
                                },
                                "useCreditCardBGColor": {
                                    "label": "Background Color",
                                    "defaultValue": "#fff",
                                    "widget": "color_picker"
                                },                                
                                "creditcardLabelfontSize": {
                                    "label": "Credit Card Font Size",
                                    "defaultValue": "15px",
                                    "widget": "px"
                                },
                                "creditcardLabelbuttonColors": {
                                    "label": "Credit Card Button Color",
                                    "defaultValue": {
                                        "color": "#FFF",
                                        "backgroundColor": "#26c686",
                                        "hoverColor": "#2A92BF"
                                    },
                                    "widget": "button_color"
                                },                                
                                "creditcardLabelbuttonAnimation": {
                                    "label": "Credit Card Apply Animation",
                                    "defaultValue": "",
                                    "widget": "animation_list"
                                },                                                                    
                                "fbTrack": {
                                    "label": "Track AddToCart",
                                    "defaultValue": false,
                                    "widget": "toggle"
                                },
                                "fbInitiate": {
                                    "label": "Track InitiateCheckout",
                                    "defaultValue": false,
                                    "widget": "toggle"
                                },
                                "fbPurchase": {
                                    "label": "Track Purchase",
                                    "defaultValue": false,
                                    "widget": "toggle"
                                },
                                "fbTrackLeads": {
                                    "label": "Track Leads",
                                    "defaultValue": false,
                                    "widget": "toggle"
                                },
                                "submitLabel": {
                                    "label": "Button Text",
                                    "defaultValue": "Cash On Delivery",
                                    "widget": "text"
                                },
                                "fontSize": {
                                    "label": "Font Size",
                                    "defaultValue": "15px",
                                    "widget": "px"
                                },
                                "buttonColors": {
                                    "label": "Color",
                                    "defaultValue": {
                                        "color": "#FFF",
                                        "backgroundColor": "#26c686",
                                        "hoverColor": "#2A92BF"
                                    },
                                    "widget": "button_color"
                                },
                                "submitAction": {
                                    "label": "Redirect Link",
                                    "defaultValue": {
                                        url: "#",
                                        target: "_self"
                                    },
                                    "widget": "link_list"
                                },
                                "buttonAnimation": {
                                    "label": "Apply Animation",
                                    "defaultValue": "",
                                    "widget": "animation_list"
                                }
                            }
                        },
                        confirmation: {
                            title: "Confirmation",
                            position: 1,
                            options: {
                                "headerText": {
                                    "label": "Header Text",
                                    "defaultValue": "ORDER SUCCESSFUL",
                                    "widget": "text"
                                },
                                "subText": {
                                    "label": "Sub Header Text",
                                    "defaultValue": "A verification code has been sent to your mobile via text message.",
                                    "widget": "text"
                                },
                                "inputLabel": {
                                    "label": "Input label",
                                    "defaultValue": "Enter your 5 digit verification code.",
                                    "widget": "text"
                                },
                                "positiveText": {
                                    "label": "Positive Button Text",
                                    "defaultValue": "Submit Code",
                                    "widget": "text"
                                },
                                "negativeText": {
                                    "label": "Address Note",
                                    "defaultValue": "Wait, let me update my info",
                                    "widget": "text"
                                }
                            }
                        },
                        form: {
                            title: "Form",
                            position: 1,
                            options: {
                                "hideFields": {
                                    "label": "Show Fields after Email and Phone",
                                    "defaultValue": false,
                                    "widget": "toggle"
                                },
                                "firstName": {
                                    "label": "First Name Placeholder",
                                    "defaultValue": "First Name",
                                    "widget": "text"
                                },
                                "lastName": {
                                    "label": "Last Name Placeholder",
                                    "defaultValue": "Last Name",
                                    "widget": "text"
                                },
                                "requireEmail": {
                                    "label": "Require Email",
                                    "defaultValue": true,
                                    "widget": "toggle"
                                },
                                "email": {
                                    "label": "Email Placeholder",
                                    "defaultValue": "Email",
                                    "widget": "text"
                                },
                                "validatePhone": {
                                    "label": "Enable Phone Validation",
                                    "defaultValue": true,
                                    "widget": "toggle"
                                },
                                "phone": {
                                    "label": "Phone Placeholder",
                                    "defaultValue": "Phone",
                                    "widget": "text"
                                },
                                "requireAddress": {
                                    "label": "Require Address 1",
                                    "defaultValue": false,
                                    "widget": "toggle"
                                },
                                "address": {
                                    "label": "Address Placeholder",
                                    "defaultValue": "",
                                    "widget": "text"
                                },
                                "requireCity": {
                                    "label": "Require City",
                                    "defaultValue": false,
                                    "widget": "toggle"
                                },
                                "city": {
                                    "label": "City Placeholder",
                                    "defaultValue": "",
                                    "widget": "text"
                                },
                                "zipcode": {
                                    "label": "Zip code Placeholder",
                                    "defaultValue": "",
                                    "widget": "text"
                                },
                                "state": {
                                    "label": "State/Province/Region Placeholder",
                                    "defaultValue": "",
                                    "widget": "text"
                                },
                                "bldgVilla": {
                                    "label": "Building Name Placeholder",
                                    "defaultValue": "",
                                    "widget": "text"
                                },
                                "aptOffice": {
                                    "label": "Flat/Villa/Office Number Placeholder",
                                    "defaultValue": "",
                                    "widget": "text"
                                },
                                "nearestLandmark": {
                                    "label": "Nearest Landmark Placeholder",
                                    "defaultValue": "Nearest Landmark",
                                    "widget": "text"
                                },
                                "countryList": {
                                    "label": "Country",
                                    "defaultValue": ${JSON.stringify(points.funnelEditorData.countryList)},
                                    "widget": "custom_dropdown"
                                },
                                "use_local_lang": {
                                    "label": "Use local language in address dropdown",
                                    "defaultValue": false,
                                    "widget": "toggle"
                                }
                            }
                        }
                    },
                    renderer: {
                        Viewer: unlayer.createViewer({
                            render(values) {                
                                if(typeof values.useCreditCardPosition === "object") values.useCreditCardPosition = JSON.stringify(values.useCreditCardPosition)
                                const useCreditCardPosition = JSON.parse(values.useCreditCardPosition);              
                                return \`
                                    <style>
                                        .shake-horizontal { -webkit-animation: shake-horizontal 0.8s cubic-bezier(0.455, 0.030, 0.515, 0.955) both; animation: shake-horizontal 0.8s cubic-bezier(0.455, 0.030, 0.515, 0.955) both; } @-webkit-keyframes shake-horizontal { 0%, 100% { -webkit-transform: translateX(0); transform: translateX(0); } 10%, 30%, 50%, 70% { -webkit-transform: translateX(-10px); transform: translateX(-10px); } 20%, 40%, 60% { -webkit-transform: translateX(10px); transform: translateX(10px); } 80% { -webkit-transform: translateX(8px); transform: translateX(8px); } 90% { -webkit-transform: translateX(-8px); transform: translateX(-8px); } } @keyframes shake-horizontal { 0%, 100% { -webkit-transform: translateX(0); transform: translateX(0); } 10%, 30%, 50%, 70% { -webkit-transform: translateX(-10px); transform: translateX(-10px); } 20%, 40%, 60% { -webkit-transform: translateX(10px); transform: translateX(10px); } 80% { -webkit-transform: translateX(8px); transform: translateX(8px); } 90% { -webkit-transform: translateX(-8px); transform: translateX(-8px); } }
                                        .shake-vertical { -webkit-animation: shake-vertical 0.8s cubic-bezier(0.455, 0.030, 0.515, 0.955) both; animation: shake-vertical 0.8s cubic-bezier(0.455, 0.030, 0.515, 0.955) both; } @-webkit-keyframes shake-vertical { 0%, 100% { -webkit-transform: translateY(0); transform: translateY(0); } 10%, 30%, 50%, 70% { -webkit-transform: translateY(-8px); transform: translateY(-8px); } 20%, 40%, 60% { -webkit-transform: translateY(8px); transform: translateY(8px); } 80% { -webkit-transform: translateY(6.4px); transform: translateY(6.4px); } 90% { -webkit-transform: translateY(-6.4px); transform: translateY(-6.4px); } } @keyframes shake-vertical { 0%, 100% { -webkit-transform: translateY(0); transform: translateY(0); } 10%, 30%, 50%, 70% { -webkit-transform: translateY(-8px); transform: translateY(-8px); } 20%, 40%, 60% { -webkit-transform: translateY(8px); transform: translateY(8px); } 80% { -webkit-transform: translateY(6.4px); transform: translateY(6.4px); } 90% { -webkit-transform: translateY(-6.4px); transform: translateY(-6.4px); } }
                                        .bounce-top { -webkit-animation: bounce-top 0.9s both; animation: bounce-top 0.9s both; } @-webkit-keyframes bounce-top { 0% { -webkit-transform: translateY(-45px); transform: translateY(-45px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; opacity: 1; } 24% { opacity: 1; } 40% { -webkit-transform: translateY(-24px); transform: translateY(-24px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 65% { -webkit-transform: translateY(-12px); transform: translateY(-12px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 82% { -webkit-transform: translateY(-6px); transform: translateY(-6px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 93% { -webkit-transform: translateY(-4px); transform: translateY(-4px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 25%, 55%, 75%, 87% { -webkit-transform: translateY(0px); transform: translateY(0px); -webkit-animation-timing-function: ease-out; animation-timing-function: ease-out; } 100% { -webkit-transform: translateY(0px); transform: translateY(0px); -webkit-animation-timing-function: ease-out; animation-timing-function: ease-out; opacity: 1; } } @keyframes bounce-top { 0% { -webkit-transform: translateY(-45px); transform: translateY(-45px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; opacity: 1; } 24% { opacity: 1; } 40% { -webkit-transform: translateY(-24px); transform: translateY(-24px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 65% { -webkit-transform: translateY(-12px); transform: translateY(-12px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 82% { -webkit-transform: translateY(-6px); transform: translateY(-6px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 93% { -webkit-transform: translateY(-4px); transform: translateY(-4px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 25%, 55%, 75%, 87% { -webkit-transform: translateY(0px); transform: translateY(0px); -webkit-animation-timing-function: ease-out; animation-timing-function: ease-out; } 100% { -webkit-transform: translateY(0px); transform: translateY(0px); -webkit-animation-timing-function: ease-out; animation-timing-function: ease-out; opacity: 1; } }
                                        .pulsate { -webkit-animation: pulsate 0.8s ease-in-out infinite both; animation: pulsate 0.8s ease-in-out infinite both; } @-webkit-keyframes pulsate { 0% { -webkit-transform: scale(1); transform: scale(1); } 50% { -webkit-transform: scale(0.9); transform: scale(0.9); } 100% { -webkit-transform: scale(1); transform: scale(1); } } @keyframes pulsate { 0% { -webkit-transform: scale(1); transform: scale(1); } 50% { -webkit-transform: scale(0.9); transform: scale(0.9); } 100% { -webkit-transform: scale(1); transform: scale(1); } }
                                        @media only screen and (max-width: 768px) {
                                            button { width: 100% !important; }
                                        }
                                        .cod-form .half-left { width: 49.5%; float: left; padding: 0 0.5% 0 0; }
                                        .cod-form .half-right { width: 49.5%; float: right; padding: 0 0 0 0.5%; }
                                        .cod-form .col-md-12 { padding: 0 !important; margin: 0 !important; }
                                        .cod-form input, .cod-form .select-parent select { margin-bottom: 10px; display: inline-block; max-width: 100%; width: 100%; border-top-width: 1px; border-top-style: solid; border-top-color: #CCC; border-left-width: 1px; border-left-style: solid; border-left-color: #CCC; border-right-width: 1px; border-right-style: solid; border-right-color: #CCC; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #CCC; padding: 10px; color: #000; background-color: #FFF; font-size: 12px; width: 100%; border-radius: 0px; }
                                        .cod-form select { background-image: linear-gradient(45deg, transparent 50%, gray 50%), linear-gradient(135deg, gray 50%, transparent 50%), linear-gradient(to right, #ccc, #ccc); background-position: calc(100% - 15px) calc(1em + 2px), calc(100% - 10px) calc(1em + 2px), calc(100% - 2.5em) 0.5em; background-size: 5px 5px, 5px 5px, 2px 2em; background-repeat: no-repeat; cursor: pointer; }
                                        .cod-form .select-parent { position: relative; width: 100%; }
                                        .cod-form select { -webkit-appearance: none; -moz-appearance: none; padding: 10px; border-radius: 0; border-color: #ccc; background-color: inherit; position: relative; width: 100%; }
                                        .cod-form button { width: 100%; padding: 15px; font-size: \$\{values.fontSize\}; border: none; font-weight: 600; color: \$\{values.buttonColors.color\}; background-color: \$\{values.buttonColors.backgroundColor\}; padding: \$\{values.padding\}; cursor: pointer; border-radius: 5px; }
                                        .cod-form button:hover { background-color: \$\{values.buttonColors.hoverColor\}; }
                                        .prepaid{ width: 100%; padding: 15px; font-size: \$\{values.creditcardLabelfontSize\} !important; border: none; font-weight: 600; color: \$\{values.creditcardLabelbuttonColors.color\} !important; background-color: \$\{values.creditcardLabelbuttonColors.backgroundColor\} !important; padding: \$\{values.padding\}; cursor: pointer; border-radius: 5px; }
                                        .prepaid:hover { background-color: \$\{values.creditcardLabelbuttonColors.hoverColor\} !important; }
                                        .autocomplete { position: relative; display: inline-block; }
                                        .autocomplete-items { position: absolute; border: 1px solid #d4d4d4; border-bottom: none; border-top: none; z-index: 99; top: 100%; left: 0; right: 0; max-height: 190px; overflow: scroll; }
                                        .autocomplete-items div { padding: 10px; cursor: pointer; background-color: #fff; border-bottom: 1px solid #d4d4d4; }
                                        .autocomplete-items div:hover { background-color: #e9e9e9; }
                                        .autocomplete-active { background-color: DodgerBlue !important; color: #ffffff; }
                                        .cod-form .cc-activator { text-align: \$\{values.useCreditCardAlignment\}; color : \$\{values.useCreditCardColor\}; background-color: \$\{values.useCreditCardBGColor\}; font-size: \$\{values.creditcardLabelfontSize\} } 
                                    </style>
                                    <div class="cod-form" style="position: relative;">
                                        <div class="form-container">
                                            <div class="form-container-child open-close-trigger">                                               
                                                <form id="cod_paymentForm" class="payment-form">
                                                \$\{(() => {                                                       
                                                    if(values.activateCreditCard || values.defaultCreditCard){   
                                                        if(useCreditCardPosition.selected === "top" || useCreditCardPosition.selected === "both") {                                                       
                                                        return \`
                                                           <h4 onclick="showHTMLCreditCard()" class="cc-activator" style="cursor: pointer; text-align: \$\{values.useCreditCardAlignment\};" >\$\{values.creditcardLabel\}</h4>
                                                        \`;
                                                        }
                                                        else{
                                                            return \`<span></span>\`;
                                                        }                                                                                                   
                                                    }else{
                                                        return \`
                                                        <h4 ></h4>
                                                        \`
                                                    }
                                               })()\}  
                                                    <div class="half-left">
                                                        <input type="text" name="firstName" placeholder="\$\{values.firstName\}" required />
                                                    </div>
                                                    <div class="half-right">
                                                        <input type="text" name="lastName" placeholder="\$\{values.lastName\}" required />
                                                    </div>
                                                    <input type="email" name="email" autocomplete="on" placeholder="\$\{values.email\}" \$\{values.requireEmail ? "required" : "" \} />
                                                    <input type="text" name="phone" placeholder="\$\{values.phone\}" style="margin-bottom: 0;">
                                                    <div class="half-left" style="margin-top: 10px;">
                                                        <input type="text" name="city" placeholder="\$\{values.city || "Default City Placeholder"\}" \$\{values.requireCity ? "required" : "" \} >
                                                    </div>
                                                    <div class="half-right" style="margin-top: 10px;">
                                                        <input type="text" name="state" placeholder="\$\{values.state || "Default State/Province/Region Placeholder"\}">
                                                    </div>
                                                    <button type="submit" class="\$\{values.buttonAnimation\}">\$\{values.submitLabel\}</button>
                                                    <br>
                                                    <br>                                                    
                                                    \$\{(() => {                                                       
                                                        if(values.activateCreditCard || values.defaultCreditCard){   
                                                            if(useCreditCardPosition.selected === "bottom" || useCreditCardPosition.selected === "both") {                                                       
                                                            return \`
                                                               <h4 onclick="showHTMLCreditCard()" class="cc-activator" style="cursor: pointer; text-align: \$\{values.useCreditCardAlignment\};" >\$\{values.creditcardLabel\}</h4>
                                                            \`;
                                                            }
                                                            else{
                                                                return \`<span></span>\`;
                                                            }                                                                                                   
                                                        }else{
                                                            return \`
                                                            <h4 ></h4>
                                                            \`
                                                        }
                                                   })()\}                                                  
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                \`;
                            }
                        }),
                        exporters: {        
                            web: function(values) {
                                values.useConfirmation = false;
                                var useCreditCard = (values.activateCreditCard || values.defaultCreditCard);    
                                                                                         
                                if(typeof values.countryList === "object") values.countryList = JSON.stringify(values.countryList)
                                const countryList = JSON.parse(values.countryList);
                                if(typeof values.useCreditCardPosition === "object") values.useCreditCardPosition = JSON.stringify(values.useCreditCardPosition)
                                const useCreditCardPosition = JSON.parse(values.useCreditCardPosition);  
                                var list = { "BGD": "BD", "BEL": "BE", "BFA": "BF", "BGR": "BG", "BIH": "BA", "BRB": "BB", "WLF": "WF", "BLM": "BL", "BMU": "BM", "BRN": "BN", "BOL": "BO", "BHR": "BH", "BDI": "BI", "BEN": "BJ", "BTN": "BT", "JAM": "JM", "BVT": "BV", "BWA": "BW", "WSM": "WS", "BES": "BQ", "BRA": "BR", "BHS": "BS", "JEY": "JE", "BLR": "BY", "BLZ": "BZ", "RUS": "RU", "RWA": "RW", "SRB": "RS", "TLS": "TL", "REU": "RE", "TKM": "TM", "TJK": "TJ", "ROU": "RO", "TKL": "TK", "GNB": "GW", "GUM": "GU", "GTM": "GT", "SGS": "GS", "GRC": "GR", "GNQ": "GQ", "GLP": "GP", "JPN": "JP", "GUY": "GY", "GGY": "GG", "GUF": "GF", "GEO": "GE", "GRD": "GD", "GBR": "GB", "GAB": "GA", "SLV": "SV", "GIN": "GN", "GMB": "GM", "GRL": "GL", "GIB": "GI", "GHA": "GH", "OMN": "OM", "TUN": "TN", "JOR": "JO", "HRV": "HR", "HTI": "HT", "HUN": "HU", "HKG": "HK", "HND": "HN", "HMD": "HM", "VEN": "VE", "PRI": "PR", "PSE": "PS", "PLW": "PW", "PRT": "PT", "SJM": "SJ", "PRY": "PY", "IRQ": "IQ", "PAN": "PA", "PYF": "PF", "PNG": "PG", "PER": "PE", "PAK": "PK", "PHL": "PH", "PCN": "PN", "POL": "PL", "SPM": "PM", "ZMB": "ZM", "ESH": "EH", "EST": "EE", "EGY": "EG", "ZAF": "ZA", "ECU": "EC", "ITA": "IT", "VNM": "VN", "SLB": "SB", "ETH": "ET", "SOM": "SO", "ZWE": "ZW", "SAU": "SA", "ESP": "ES", "ERI": "ER", "MNE": "ME", "MDA": "MD", "MDG": "MG", "MAF": "MF", "MAR": "MA", "MCO": "MC", "UZB": "UZ", "MMR": "MM", "MLI": "ML", "MAC": "MO", "MNG": "MN", "MHL": "MH", "MKD": "MK", "MUS": "MU", "MLT": "MT", "MWI": "MW", "MDV": "MV", "MTQ": "MQ", "MNP": "MP", "MSR": "MS", "MRT": "MR", "IMN": "IM", "UGA": "UG", "TZA": "TZ", "MYS": "MY", "MEX": "MX", "ISR": "IL", "FRA": "FR", "IOT": "IO", "SHN": "SH", "FIN": "FI", "FJI": "FJ", "FLK": "FK", "FSM": "FM", "FRO": "FO", "NIC": "NI", "NLD": "NL", "NOR": "NO", "NAM": "NA", "VUT": "VU", "NCL": "NC", "NER": "NE", "NFK": "NF", "NGA": "NG", "NZL": "NZ", "NPL": "NP", "NRU": "NR", "NIU": "NU", "COK": "CK", "XKX": "XK", "CIV": "CI", "CHE": "CH", "COL": "CO", "CHN": "CN", "CMR": "CM", "CHL": "CL", "CCK": "CC", "CAN": "CA", "COG": "CG", "CAF": "CF", "COD": "CD", "CZE": "CZ", "CYP": "CY", "CXR": "CX", "CRI": "CR", "CUW": "CW", "CPV": "CV", "CUB": "CU", "SWZ": "SZ", "SYR": "SY", "SXM": "SX", "KGZ": "KG", "KEN": "KE", "SSD": "SS", "SUR": "SR", "KIR": "KI", "KHM": "KH", "KNA": "KN", "COM": "KM", "STP": "ST", "SVK": "SK", "KOR": "KR", "SVN": "SI", "PRK": "KP", "KWT": "KW", "SEN": "SN", "SMR": "SM", "SLE": "SL", "SYC": "SC", "KAZ": "KZ", "CYM": "KY", "SGP": "SG", "SWE": "SE", "SDN": "SD", "DOM": "DO", "DMA": "DM", "DJI": "DJ", "DNK": "DK", "VGB": "VG", "DEU": "DE", "YEM": "YE", "DZA": "DZ", "USA": "US", "URY": "UY", "MYT": "YT", "UMI": "UM", "LBN": "LB", "LCA": "LC", "LAO": "LA", "TUV": "TV", "TWN": "TW", "TTO": "TT", "TUR": "TR", "LKA": "LK", "LIE": "LI", "LVA": "LV", "TON": "TO", "LTU": "LT", "LUX": "LU", "LBR": "LR", "LSO": "LS", "THA": "TH", "ATF": "TF", "TGO": "TG", "TCD": "TD", "TCA": "TC", "LBY": "LY", "VAT": "VA", "VCT": "VC", "ARE": "AE", "AND": "AD", "ATG": "AG", "AFG": "AF", "AIA": "AI", "VIR": "VI", "ISL": "IS", "IRN": "IR", "ARM": "AM", "ALB": "AL", "AGO": "AO", "ATA": "AQ", "ASM": "AS", "ARG": "AR", "AUS": "AU", "AUT": "AT", "ABW": "AW", "IND": "IN", "ALA": "AX", "AZE": "AZ", "IRL": "IE", "IDN": "ID", "UKR": "UA", "QAT": "QA", "MOZ": "MZ" };
                                var selectedCountryISO2 = list[countryList.selected] ? list[countryList.selected] : countryList.selected;
                                return \`
                                    <style>
                                        .shake-horizontal { -webkit-animation: shake-horizontal 0.8s cubic-bezier(0.455, 0.030, 0.515, 0.955) both; animation: shake-horizontal 0.8s cubic-bezier(0.455, 0.030, 0.515, 0.955) both; } @-webkit-keyframes shake-horizontal { 0%, 100% { -webkit-transform: translateX(0); transform: translateX(0); } 10%, 30%, 50%, 70% { -webkit-transform: translateX(-10px); transform: translateX(-10px); } 20%, 40%, 60% { -webkit-transform: translateX(10px); transform: translateX(10px); } 80% { -webkit-transform: translateX(8px); transform: translateX(8px); } 90% { -webkit-transform: translateX(-8px); transform: translateX(-8px); } } @keyframes shake-horizontal { 0%, 100% { -webkit-transform: translateX(0); transform: translateX(0); } 10%, 30%, 50%, 70% { -webkit-transform: translateX(-10px); transform: translateX(-10px); } 20%, 40%, 60% { -webkit-transform: translateX(10px); transform: translateX(10px); } 80% { -webkit-transform: translateX(8px); transform: translateX(8px); } 90% { -webkit-transform: translateX(-8px); transform: translateX(-8px); } }
                                        .shake-vertical { -webkit-animation: shake-vertical 0.8s cubic-bezier(0.455, 0.030, 0.515, 0.955) both; animation: shake-vertical 0.8s cubic-bezier(0.455, 0.030, 0.515, 0.955) both; } @-webkit-keyframes shake-vertical { 0%, 100% { -webkit-transform: translateY(0); transform: translateY(0); } 10%, 30%, 50%, 70% { -webkit-transform: translateY(-8px); transform: translateY(-8px); } 20%, 40%, 60% { -webkit-transform: translateY(8px); transform: translateY(8px); } 80% { -webkit-transform: translateY(6.4px); transform: translateY(6.4px); } 90% { -webkit-transform: translateY(-6.4px); transform: translateY(-6.4px); } } @keyframes shake-vertical { 0%, 100% { -webkit-transform: translateY(0); transform: translateY(0); } 10%, 30%, 50%, 70% { -webkit-transform: translateY(-8px); transform: translateY(-8px); } 20%, 40%, 60% { -webkit-transform: translateY(8px); transform: translateY(8px); } 80% { -webkit-transform: translateY(6.4px); transform: translateY(6.4px); } 90% { -webkit-transform: translateY(-6.4px); transform: translateY(-6.4px); } }
                                        .bounce-top { -webkit-animation: bounce-top 0.9s both; animation: bounce-top 0.9s both; } @-webkit-keyframes bounce-top { 0% { -webkit-transform: translateY(-45px); transform: translateY(-45px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; opacity: 1; } 24% { opacity: 1; } 40% { -webkit-transform: translateY(-24px); transform: translateY(-24px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 65% { -webkit-transform: translateY(-12px); transform: translateY(-12px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 82% { -webkit-transform: translateY(-6px); transform: translateY(-6px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 93% { -webkit-transform: translateY(-4px); transform: translateY(-4px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 25%, 55%, 75%, 87% { -webkit-transform: translateY(0px); transform: translateY(0px); -webkit-animation-timing-function: ease-out; animation-timing-function: ease-out; } 100% { -webkit-transform: translateY(0px); transform: translateY(0px); -webkit-animation-timing-function: ease-out; animation-timing-function: ease-out; opacity: 1; } } @keyframes bounce-top { 0% { -webkit-transform: translateY(-45px); transform: translateY(-45px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; opacity: 1; } 24% { opacity: 1; } 40% { -webkit-transform: translateY(-24px); transform: translateY(-24px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 65% { -webkit-transform: translateY(-12px); transform: translateY(-12px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 82% { -webkit-transform: translateY(-6px); transform: translateY(-6px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 93% { -webkit-transform: translateY(-4px); transform: translateY(-4px); -webkit-animation-timing-function: ease-in; animation-timing-function: ease-in; } 25%, 55%, 75%, 87% { -webkit-transform: translateY(0px); transform: translateY(0px); -webkit-animation-timing-function: ease-out; animation-timing-function: ease-out; } 100% { -webkit-transform: translateY(0px); transform: translateY(0px); -webkit-animation-timing-function: ease-out; animation-timing-function: ease-out; opacity: 1; } }
                                        .pulsate { -webkit-animation: pulsate 0.8s ease-in-out infinite both; animation: pulsate 0.8s ease-in-out infinite both; } @-webkit-keyframes pulsate { 0% { -webkit-transform: scale(1); transform: scale(1); } 50% { -webkit-transform: scale(0.9); transform: scale(0.9); } 100% { -webkit-transform: scale(1); transform: scale(1); } } @keyframes pulsate { 0% { -webkit-transform: scale(1); transform: scale(1); } 50% { -webkit-transform: scale(0.9); transform: scale(0.9); } 100% { -webkit-transform: scale(1); transform: scale(1); } }
                                        @media only screen and (max-width: 768px) {
                                            button { width: 100% !important; }
                                        }
                                        .cod-form .half-left { width: 49.5%; float: left; padding: 0 0.5% 0 0; }
                                        .cod-form .half-right { width: 49.5%; float: right; padding: 0 0 0 0.5%; }
                                        .cod-form .col-md-12 { padding: 0 !important; margin: 0 !important; }
                                        .cod-form input, .cod-form .select-parent select, .insert_plg_form select { margin-bottom: 10px; display: inline-block; max-width: 100%; width: 100%; border-top-width: 1px; border-top-style: solid; border-top-color: #CCC; border-left-width: 1px; border-left-style: solid; border-left-color: #CCC; border-right-width: 1px; border-right-style: solid; border-right-color: #CCC; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #CCC; padding: 10px; color: #000; background-color: #FFF; font-size: 12px; width: 100%; border-radius: 0px; }
                                        .cod-form select { background-image: linear-gradient(45deg, transparent 50%, gray 50%), linear-gradient(135deg, gray 50%, transparent 50%), linear-gradient(to right, #ccc, #ccc); background-position: calc(100% - 15px) calc(1em + 2px), calc(100% - 10px) calc(1em + 2px), calc(100% - 2.5em) 0.5em; background-size: 5px 5px, 5px 5px, 2px 2em; background-repeat: no-repeat; cursor: pointer; }
                                        .cod-form .select-parent { position: relative; width: 100%; }
                                        .cod-form select { -webkit-appearance: none; -moz-appearance: none; padding: 10px; border-radius: 0; border-color: #ccc; background-color: #FFF; position: relative; width: 100%; }
                                        .cod-form button { width: 100%; padding: 15px; font-size: \$\{values.fontSize\}; border: none; font-weight: 600; color: \$\{values.buttonColors.color\}; background-color: \$\{values.buttonColors.backgroundColor\}; padding: \$\{values.padding\}; cursor: pointer; border-radius: 5px; }
                                        .cod-form button:hover { background-color: \$\{values.buttonColors.hoverColor\}; }
                                        .prepaid{ width: 100%; padding: 15px; font-size: \$\{values.fontSize\}; border: none; font-weight: 600; color: \$\{values.creditcardLabelbuttonColors.color\} !important; background-color: \$\{values.creditcardLabelbuttonColors.backgroundColor\} !important; padding: \$\{values.padding\}; cursor: pointer; border-radius: 5px; }
                                        .prepaid:hover { background-color: \$\{values.creditcardLabelbuttonColors.hoverColor\} !important; }
                                        .autocomplete { position: relative; display: inline-block; }
                                        .autocomplete-items { position: absolute; border: 1px solid #d4d4d4; border-bottom: none; border-top: none; z-index: 99; top: 100%; left: 0; right: 0; max-height: 190px; overflow: scroll; }
                                        .autocomplete-items div { padding: 10px; cursor: pointer; background-color: #fff; border-bottom: 1px solid #d4d4d4; }
                                        .autocomplete-items div:hover { background-color: #e9e9e9; }
                                        .autocomplete-active { background-color: DodgerBlue !important; color: #ffffff; }
                                        .phone-container div { background-color: #FFF }
                                        .cod-form select:disabled { background-color: #e4e0e0; }
                                        .cod-form .cc-activator { text-align: \$\{values.useCreditCardAlignment\}; color : \$\{values.useCreditCardColor\}; background-color: \$\{values.useCreditCardBGColor\}; font-size: \$\{values.creditcardLabelfontSize\} } 
                                    </style>
                                    <style>
                                    .form-row {
                                        width: 70%;
                                        float: left;
                                        background-color: #ededed;
                                    }
                                    #card-element {
                                    background-color: transparent;
                                    height: 40px;
                                    border-radius: 4px;
                                    border: 1px solid transparent;
                                    box-shadow: 0 1px 3px 0 #e6ebf1;
                                    -webkit-transition: box-shadow 150ms ease;
                                    transition: box-shadow 150ms ease;
                                    }
                                    
                                    #card-element--focus {
                                      box-shadow: 0 1px 3px 0 #cfd7df;
                                    }
                                    
                                    #card-element--invalid {
                                      border-color: #fa755a;
                                    }
                                    
                                    #card-element--webkit-autofill {
                                      background-color: #fefde5 !important;
                                    }
                                    
                                    #submitbutton,#tap-btn{
                                    align-items:flex-start;
                                    background-attachment:scroll;background-clip:border-box;
                                    background-color:rgb(50, 50, 93);background-image:none;
                                    background-origin:padding-box;
                                    background-position-x:0%;
                                    background-position-y:0%;
                                    background-size:auto;
                                    border-bottom-color:rgb(255, 255, 255);
                                    border-bottom-left-radius:4px;
                                    border-bottom-right-radius:4px;border-bottom-style:none;
                                    border-bottom-width:0px;border-image-outset:0px;
                                    border-image-repeat:stretch;border-image-slice:100%;
                                    border-image-source:none;border-image-width:1;
                                    border-left-color:rgb(255, 255, 255);
                                    border-left-style:none;
                                    border-left-width:0px;
                                    border-right-color:rgb(255, 255, 255);
                                    border-right-style:none;
                                    border-right-width:0px;
                                    border-top-color:rgb(255, 255, 255);
                                    border-top-left-radius:4px;
                                    border-top-right-radius:4px;
                                    border-top-style:none;
                                    border-top-width:0px;
                                    box-shadow:rgba(50, 50, 93, 0.11) 0px 4px 6px 0px, rgba(0, 0, 0, 0.08) 0px 1px 3px 0px;
                                    box-sizing:border-box;color:rgb(255, 255, 255);
                                    cursor:pointer;
                                    display:block;
                                    float:left;
                                    font-family:"Helvetica Neue", Helvetica, sans-serif;
                                    font-size:15px;
                                    font-stretch:100%;
                                    font-style:normal;
                                    font-variant-caps:normal;
                                    font-variant-east-asian:normal;
                                    font-variant-ligatures:normal;
                                    font-variant-numeric:normal;
                                    font-weight:600;
                                    height:35px;
                                    letter-spacing:0.375px;
                                    line-height:35px;
                                    margin-bottom:0px;
                                    margin-left:12px;
                                    margin-right:0px;
                                    margin-top:28px;
                                    outline-color:rgb(255, 255, 255);
                                    outline-style:none;
                                    outline-width:0px;
                                    overflow-x:visible;
                                    overflow-y:visible;
                                    padding-bottom:0px;
                                    padding-left:14px;
                                    padding-right:14px;
                                    padding-top:0px;
                                    text-align:center;
                                    text-decoration-color:rgb(255, 255, 255);
                                    text-decoration-line:none;
                                    text-decoration-style:solid;
                                    text-indent:0px;
                                    text-rendering:auto;
                                    text-shadow:none;
                                    text-size-adjust:100%;
                                    text-transform:none;
                                    transition-delay:0s;
                                    transition-duration:0.15s;
                                    transition-property:all;
                                    transition-timing-function:ease;
                                    white-space:nowrap;
                                    width:150.781px;
                                    word-spacing:0px;
                                    writing-mode:horizontal-tb;
                                    -webkit-appearance:none;
                                    -webkit-font-smoothing:antialiased;
                                    -webkit-tap-highlight-color:rgba(0, 0, 0, 0);
                                    -webkit-border-image:none;
                                    
                                    }                                    
                                    .cc_modal {
                                        display: none;
                                        position: fixed;
                                        top: 0;
                                        z-index: 120;
                                        height: 100%;
                                        background-color: #000000c7;
                                    }
    
                                    .cc_modal .container {
                                        min-width: 320px;
                                        max-width: 700px !important;
                                        position: relative;
                                        background-color: #fff;
                                        align-items: center;
                                        display: flex;
                                        flex-direction: column;
                                        margin: auto;
                                        min-height: 500px;
                                        justify-content: center;
                                        border-radius: 5px;
                                    }                                
                                    </style>
                                    <div class="cc_modal" style="width: 100%;padding-top: 6rem;position: fixed;top: 0;left: 0;right: 0;" id="plg_modal_sample_test">
                                        <div class="container">
                                            <div class="row" id="container_cc_msg">
                                                <div class="col-12 text-center">
                                                    <h2 id="cc_message_modal" style="text-align: center;">Please wait
                                                        Authenticating</h2>
                                                </div>
                                            </div>
                                            <iframe id="iframe_cc_loader" src="" width="120" height="120"
                                                style="width: 100%; height: 28rem; border: none; display:none;"></iframe>
                                        </div>
                                    </div>
                                    <div class="cod-form" style="position: relative;">
                                        <div class="form-container">
                                            <div class="form-container-child open-close-trigger">
                                                <form id="cod_paymentForm" class="payment-form">
                                                \$\{(() => {                                                       
                                                    if(values.activateCreditCard || values.defaultCreditCard){   
                                                        if(useCreditCardPosition.selected === "top" || useCreditCardPosition.selected === "both") {                                                       
                                                        return \`
                                                           <h4 onclick="showHTMLCreditCard()" class="cc-activator" style="cursor: pointer; text-align: \$\{values.useCreditCardAlignment\};" >\$\{values.creditcardLabel\}</h4>
                                                        \`;
                                                        }
                                                        else{
                                                            return \`<span></span>\`;
                                                        }                                                                                                   
                                                    }else{
                                                        return \`
                                                        <h4 class="cc-activator"></h4>
                                                        \`
                                                    }
                                               })()\}  
                                                    <div class="half-left">
                                                        <input type="text" name="firstName" placeholder="\$\{values.firstName\}" required />
                                                    </div>
                                                    <div class="half-right">
                                                        <input type="text" name="lastName" placeholder="\$\{values.lastName\}" required />
                                                    </div>
                                                    <input type="email" name="email" autocomplete="on" placeholder="\$\{values.email\}" \$\{values.requireEmail ? "required" : "" \} />
                                                    <div class="insert_plg_form"></div>
                                                    <input type="hidden" name="country" value="\$\{countryList.selected\}" />
                                                    <input type="hidden" name="meta" value="${this.encryptString(user_id)}">
                                                    <input type="hidden" name="pageid" value="${state.page_data.funnel_id}">
                                                    <input type="hidden" name="fplg" value="${state.page_data.is_fulfill_by_plg}">
                                                    <div id="plg_credit_card" style="display:none;">                                                                                                                
                                                        <div id="element-container"></div>
                                                        <div id="error-handler" role="alert"></div>                                                                                                                                                                                                                
                                                    </div>
                                                    <br></br>
                                                    <button id="submit_cod_form" type="submit" class="\$\{values.buttonAnimation\}">\$\{values.submitLabel\}</button>
                                                    <br></br>
                                                    \$\{(() => {                                                       
                                                        if(values.activateCreditCard || values.defaultCreditCard){   
                                                            if(useCreditCardPosition.selected === "bottom" || useCreditCardPosition.selected === "both") {                                                       
                                                            return \`
                                                               <h4 onclick="showHTMLCreditCard()" class="cc-activator" style="cursor: pointer; text-align: \$\{values.useCreditCardAlignment\};" >\$\{values.creditcardLabel\}</h4>
                                                            \`;
                                                            }
                                                            else{
                                                                return \`<span></span>\`;
                                                            }                                                                                                   
                                                        }else{
                                                            return \`
                                                            <h4 class="cc-activator"></h4>
                                                            \`
                                                        }
                                                   })()\}  
                                                   
                                                    
                                                </form>
                                                
                                            </div>
                                        </div>
                                    </div>
                                    <script src="https://cdnjs.cloudflare.com/ajax/libs/bluebird/3.3.4/bluebird.min.js"></script>
                                    <script src="https://secure.gosell.io/js/sdk/tap.min.js"></script>  
                                    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
                                    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
                                    crossorigin="anonymous"></script>    
                                    <script>
                                                   // THE USE OF CREDIT CARD
                                    var isUsingCreditCard = \$\{(values.activateCreditCard || values.defaultCreditCard)\};   
                                    multivariantIsUsingCC =  isUsingCreditCard;                               
                                   var plg_modal_sample_test  = document.getElementById("plg_modal_sample_test");
                                   var iframe_cc_loader = document.getElementById("iframe_cc_loader");
                                   var cc_message_modal = document.getElementById("cc_message_modal");

                                   var container_cc_msg = document.getElementById("container_cc_msg");

                                   var cc_activator_btn = document.getElementsByClassName("cc-activator");
                                   function updatePriceOnDiscount() {
                                    var toggleClass = (el, className) => el.classList.toggle(className);
                                    document.querySelectorAll('.variant_container .plg_variants').forEach(el => {
                                        var discountedPrice =  parseFloat(el.getAttribute('data-price')) - (parseFloat(el.getAttribute('data-quantity')) * parseFloat(el.getAttribute('data-ccdiscount')))
                                        el.querySelector('.variant_price').innerText = discountedPrice.toFixed(2) + el.getAttribute('data-csymbol')
                                        toggleClass(el.querySelector('.variant_price'), 'updating');
                                        setTimeout(function () {
                                            toggleClass(el.querySelector('.variant_price'), 'updating');
                                        }, 800);

                                    });
                                }                 
                                
                                function updatePriceOnCOD() {
                                    var toggleClass = (el, className) => el.classList.toggle(className);
                                    document.querySelectorAll('.variant_container .plg_variants').forEach(el => {                                                                                
                                        el.querySelector('.variant_price').innerText = el.getAttribute('data-price') + el.getAttribute('data-csymbol')
                                        toggleClass(el.querySelector('.variant_price'), 'updating');
                                        setTimeout(function () {
                                            toggleClass(el.querySelector('.variant_price'), 'updating');
                                        }, 800);

                                    });
                                }   

                                   var useCodOnly = \$\{values.useCodOnly\};
                                    var defaultCreditCard = \$\{values.defaultCreditCard\};
                                    var activateCreditCard = \$\{values.activateCreditCard\};

                                   function savetoLocalStorage(responses) {
                                    console.log('saving to localstorage', responses);
                                    localStorage.setItem("cc_details", JSON.stringify(responses));
                                   }
                                   if (useCodOnly && defaultCreditCard && activateCreditCard) {
                                       console.log("use the first");
                                        cc_activator_btn[0].innerText = "\$\{values.useCODLabel\}";
                                        try{
                                            // updatePriceOnDiscount();
                                            cc_activator_btn[1].innerText = "\$\{values.useCODLabel\}";
                                        }catch(err){
                                            console.log('');
                                        }
                                        document.getElementById("submit_cod_form").innerText = "Complete payment";
                                        document.getElementById("plg_credit_card").style.display = "unset";
                                    } else if (useCodOnly && !defaultCreditCard && activateCreditCard) {
                                       console.log("use the second");
                                       multivariantIsUsingCC = false;
                                            // updatePriceOnCOD();
                                        cc_activator_btn[0].innerText = "\$\{values.creditcardLabel\}";
                                        try{
                                            cc_activator_btn[1].innerText = "\$\{values.creditcardLabel\}";
                                            
                                        }catch(err){
                                            console.log('');
                                        }
                                        // document.getElementById("submit_cod_form").innerText = "Complete payment";
                                        document.getElementById("plg_credit_card").style.display = "none";
                                    
                                    } else if (useCodOnly) {
                                        console.log("values.useCodOnly");
                                        multivariantIsUsingCC = false;
                                            // updatePriceOnCOD();
                                        cc_activator_btn[0].style.display = "none";
                                        try{
                                            
                                            cc_activator_btn[1].style.display = "none";
                                        }catch(err){
                                            console.log('');
                                        }
                                    }

                                   if(activateCreditCard && !useCodOnly){
                                    console.log("values.activateCreditCard && !values.useCodOnly")
                                    cc_activator_btn[0].style.display = "none";
                                        try{
                                            // updatePriceOnDiscount();
                                            cc_activator_btn[1].style.display = "none";
                                        }catch(err){
                                            console.log('');
                                        }
                                    document.getElementById("plg_credit_card").style.display = "unset";
                                   }

                                   function showHTMLCreditCard(){
                                        var x = document.getElementById("plg_credit_card");
                                        if (x.style.display === "none") {
                                            isUsingCreditCard = true;
                                            // updatePriceOnDiscount();
                                            multivariantIsUsingCC = true;
                                            document.getElementById("submit_cod_form").innerText = "Complete payment";
                                            toggleClass(document.getElementById("submit_cod_form"), "prepaid");
                                            cc_activator_btn[0].innerText = "\$\{values.useCODLabel\}";
                                        try{
                                            cc_activator_btn[1].innerText = "\$\{values.useCODLabel\}";
                                        }catch(err){
                                            console.log('');
                                        }
                                          x.style.display = "block";
                                        } else {
                                          isUsingCreditCard = false;
                                        //   updatePriceOnCOD();
                                          multivariantIsUsingCC = false;
                                          document.getElementById("submit_cod_form").innerText = "$\{values.submitLabel\}";
                                          toggleClass(document.getElementById("submit_cod_form"), "prepaid");
                                          cc_activator_btn[0].innerText = "\$\{values.creditcardLabel\}";
                                        try{
                                            cc_activator_btn[1].innerText = "\$\{values.creditcardLabel\}";
                                        }catch(err){
                                            console.log('');
                                        }
                                          x.style.display = "none";
                                        }     
                                    }

                                    const toggleClass = (el, className) => el.classList.toggle(className);

                                    // showHTMLCreditCard();


                                    //pass your public key from tap's dashboard
                                    // var tap = Tapjsli('pk_test_0WJVYyBOCw4Z5sxGFi9kcvpf');
                                    var tap = Tapjsli('pk_live_LEBPYCraDqHuUmQO75dgtpnx');

                                    var elements = tap.elements({});
                                    var style = {
                                    base: {
                                        color: '#535353',
                                        lineHeight: '18px',
                                        fontFamily: 'sans-serif',
                                        fontSmoothing: 'antialiased',
                                        fontSize: '16px',
                                        '::placeholder': {
                                        color: 'rgba(0, 0, 0, 0.26)',
                                        fontSize:'15px'
                                        }
                                    },
                                    invalid: {
                                        color: 'red'
                                    }
                                    };
                                    // input labels/placeholders
                                    var labels = {
                                        cardNumber:"Card Number",
                                        expirationDate:"MM/YY",
                                        cvv:"CVV",
                                        cardHolder:"Card Holder Name"
                                    };
                                    //payment options
                                    var paymentOptions = {
                                    currencyCode:["KWD","USD","SAR","AED","BHD","OMR","QAR"],
                                    labels : labels,
                                    TextDirection:'ltr'
                                    }
                                    //create element, pass style and payment options
                                    var card = elements.create('card', {style: style},paymentOptions);
                                    //mount element
                                    card.mount('#element-container');
                                    //card change event listener
                                    card.addEventListener('change', function(event) {
                                    if(event.BIN){
                                        // console.log(event.BIN)
                                    }
                                    if(event.loaded){
                                        // console.log("UI loaded :"+event.loaded);
                                        // console.log("current currency is :"+card.getCurrency())
                                    }
                                    var displayError = document.getElementById('error-handler');
                                    if (event.error) {
                                        displayError.textContent = event.error.message;
                                    } else {
                                        displayError.textContent = '';
                                    }
                                    });
                                    // end of use of credit card
                                                                   
                                    </script>                              
                                    <script type="text/javascript">

                                    var isDone = false;

                                    function changeDone() {
                                        isDone = true;
                                    }

                                        var use_local_lang = \$\{values.use_local_lang\};
                                        if(!document.getElementById("plg_form_script")) {
                                            const plg_form_script = document.createElement("script");
                                            const file_name = "${condition.is_exclusive_vip_user(this.props.session.getCurrentUser) ? "funnel_genie_checkout_dev_checkout_test.js" : "funnel_genie_checkout_dev.js"}?v="+Date.now();
                                            plg_form_script.id = "plg_form_script";
                                            plg_form_script.src = "https://productlistgenie.com/funnel-genie/js/" + file_name;
                                            // plg_form_script.defer = true;
                                            document.body.appendChild(plg_form_script);
                                            var submitCreditCard = (targetedEvent) => new Promise((resolve, reject) => {
                                                console.log('promise submitcredit card was called ');
    
                                                iframe_cc_loader.style.display = "none";
                                                plg_modal_sample_test.style.display = "unset";
                                                container_cc_msg.style.display = "unset";
    
                                                document.getElementById("cc_message_modal").innerText = "Please wait authenticating.";
    
    
                                                // create a div sayinh authenticating payment .... 
    
                                                tap.createToken(card).then(function (result) {
    
                                                    function formToObject(form) {
                                                        return Array.from(new FormData(form)).reduce((acc, [key, value]) => ({
                                                            ...acc,
                                                            [key]: value
                                                        }), {});
                                                    }
    
                                                    const formValue = formToObject(targetedEvent);
    
                                                    formValue.variantQty = plg_selectedVariant.variant_qty ? plg_selectedVariant.variant_qty : "1";
                                                    formValue.productPrice = parseFloat(plg_price);
                                                    formValue.productName = plg_selectedVariant.product_name;
                                                    formValue.variantName = typeof multiple_variant_name !== "undefined" ? multiple_variant_name + plg_selectedVariant.variant_name : plg_selectedVariant.variant_name;
                                                    formValue.merchantType = "cod";
                                                    formValue.variant_id = plg_selectedVariant.variant_id;
                                                    formValue.currencyWord = plg_selectedVariant.currency.word;
                                                    formValue.currencySymbol = plg_selectedVariant.currency.code;
                                                    plgQS() !== "" ? formValue.campaign_src = plgQS() : void 0;
    
    
    
                                                    if (result.error) {
                                                        // Inform the user if there was an error
                                                        document.getElementById("cc_message_modal").innerText = "Error, Please Provide Input for Bank Details.";
                                                        setTimeout(() => {
                                                            plg_modal_sample_test.style.display = "none";
                                                        }, 2000); 
                                                        reject({
                                                            message: "Error Please Provide Input "
                                                        })
                                                        var errorElement = document.getElementById('error-handler');
                                                        errorElement.textContent = result.error.message;
                                                    } else {
                                                        // Send the token to your server
                                                        // var errorElement = document.getElementById('success');
                                                        // errorElement.style.display = "block";
                                                        // var tokenElement = document.getElementById('token');
                                                        // tokenElement.textContent = result.id;
                                                        // console.log(result);
                                                        // create charge by sending token and cod_data.
    
                                                        var charging_data = {
                                                            creditcard: result,
                                                            cod_data: formValue
                                                        };
    
    
                                                        console.log(charging_data);
    
                                                        fetch('/v1/api/auth_user', {
                                                            method: "POST",
                                                            headers: {
                                                                'Content-Type': 'application/json'
                                                            },
                                                            body: JSON.stringify(charging_data)
                                                        }).then(auth => auth.json()).then(auth => {
                                                            console.log(auth);
                                                            if (auth.response && auth.isInit) {
                                                                let data = auth.data;
    
                                                                container_cc_msg.style.display = "none";
    
                                                                // window.open(data.transaction.url, "_blank");
                                                                iframe_cc_loader.setAttribute("src", data.transaction.url);
    
                                                                //tagetNode
                                                                iframe_cc_loader.style.display = "unset";
                                                            } else {
                                                                document.getElementById("cc_message_modal").innerText = "Sorry we cannot process your payment. " + auth.data.response.message;
    
                                                                setTimeout(() => {
                                                                    plg_modal_sample_test.style.display = "none";
                                                                }, 2000);
                                                                reject({
                                                                    message: "NOT DONE"
                                                                });
                                                            }
                                                        }).catch(err => {
                                                            console.log('error in /v1/api/charge_me', err);
    
                                                            document.getElementById("cc_message_modal").innerText = "Something went wrong please contact administrator.";
    
    
                                                            setTimeout(() => {
                                                                plg_modal_sample_test.style.display = "none";
                                                            }, 2000);
                                                            reject({
                                                                message: "NOT DONE"
                                                            });
                                                        });
    
                                                        localStorage.setItem("cc_credentials", JSON.stringify(result));
                                                        console.log(result);
                                                        console.log(JSON.parse(localStorage.getItem("cod_data")));
                                                    }
                                                }).catch(errors => {
                                                    document.getElementById("cc_message_modal").innerText = "Something went wrong please contact administrator.";
                                                    setTimeout(() => {
                                                        plg_modal_sample_test.style.display = "none";
                                                    }, 2000);
                                                    reject({
                                                        message: "Error ::: " + errors
                                                    })
                                                });
                                            });                                        


                                            function getEditorConfiguration() {
                                                return {
                                                    analytics_add_to_cart: \$\{values.fbTrack\},
                                                    analytics_initiate_checkout: \$\{values.fbInitiate\},
                                                    analytics_purchased: \$\{values.fbPurchase\},
                                                    analytics_leads: \$\{values.fbTrackLeads\},
                                                    analytics_snapchat_id: "${this.state.page_data.funnel_snapchat_id}",
                                                    
                                                    hide_fields: \$\{values.hideFields\},
                                                    plg_email_confirmation: ${this.state.page_data.funnel_use_email_confirmation},
                                                    validate_sms: \$\{values.useConfirmation\},
                                                    validate_phone: \$\{values.validatePhone\},
                                                    required_address: \$\{values.requireAddress\},
                                                    required_city: \$\{values.requireCity\},
    
                                                    html_id: "\$\{values._meta.htmlID\}",
                                                    placeholder_phone: "\$\{values.phone\}",
                                                    placeholder_address: "\$\{values.address\}",
                                                    placeholder_city: "\$\{values.city\}",
                                                    placeholder_zip: "\$\{values.zipcode\}",
                                                    placeholder_state: "\$\{values.state\}",
                                                    placeholder_bldg_villa: "\$\{values.bldgVilla\}",
                                                    placeholder_apt_office: "\$\{values.aptOffice\}",
                                                    placeholder_nearest_landmark: "\$\{values.nearestLandmark\}",
                                                    selected_country: "\$\{countryList.selected\}",
                                                    selected_country_iso2: "\$\{selectedCountryISO2\}",
                                                    
                                                    confirmation_sub_header: "\$\{values.subText\}",
                                                    confirmation_input_label: "\$\{values.inputLabel\}",
                                                    confirmation_positive_button_text: "\$\{values.positiveText\}",
                                                    confirmation_negative_button_text: "\$\{values.negativeText\}",
    
                                                    redirection_action: !isUsingCreditCard ? "\$\{values.submitAction.url\}" : "\$\{values.submitCCAction.url\}",
                                                    redirection_target: !isUsingCreditCard ? "\$\{values.submitAction.target\}" : "\$\{values.submitCCAction.target\}",
                                                    form_version: 2
                                                };
                                            }
                                        }
                                    </script>
                                \`;
                            },
                            email: function() {}
                        }
                    }
                });
            `);

            //July11
            //added the subscriptionUpsell to orderbump


            
        }






        

        if(page_type == "checkout" && paypalClientID){
            // show paypal button if checkout and has paypal client id
            customJS.push(`
                console.log("17. Initializing paypal button...");
                unlayer.registerTool({
                    type: 'paypal-button',
                    category: 'contents',
                    label: 'Paypal Checkout',
                    icon: '<svg class="svg-inline--fa fa-wpforms fa-w-14 fa-3x" fill="#fff" xmlns="http://www.w3.org/2000/svg" version="1.1" x="0px" y="0px" viewBox="0 0 90 90"> <g> <path d="M58.057,0H18.649L1.189,80.146h23.124l5.664-26.558h16.521c15.803,0,29.019-9.744,32.562-26.312 C83.064,8.521,69.612,0,58.057,0z M40.816,38.242H33.28l4.953-21.924h11.326c3.885,0,6.827,2.314,7.794,5.712 c-0.496-0.086-0.956-0.235-1.498-0.235H44.53L40.816,38.242z M57.347,27.278c-1.379,5.95-7.033,10.698-12.79,10.921l2.711-12.023 h10.267C57.473,26.543,57.448,26.897,57.347,27.278z M85.355,32.754c1.326-6.211,0.711-11.275-1.086-15.306 c3.748,4.47,5.688,10.955,3.824,19.687C84.55,53.701,71.332,63.445,55.532,63.445h-16.52L33.349,90H10.223l0.96-4.381h19.428 l5.663-26.555h16.521C68.597,59.064,81.813,49.32,85.355,32.754z"/> </g> </svg>',
                    values: {},
                    options: {
                        tools: { // if error change tools to button
                            title: "Paypal | Button", //april12
                            position: 1,
                            options: {
                                // "useTransactionReference": {
                                //     "label": "Use Transaction Reference",
                                //     "defaultValue": false,
                                //     "widget": "toggle"
                                // },
                                "paypalCurrency": {
                                    "label": "Select Currency",
                                    "defaultValue": ${JSON.stringify(points.funnelEditorData.paypalCurrencyList)},
                                    "widget": "custom_dropdown"
                                },
                                "fbTrack": {
                                    "label": "Track AddToCart",
                                    "defaultValue": false,
                                    "widget": "toggle"
                                },
                                "fbInitiate": {
                                    "label": "Track InitiateCheckout",
                                    "defaultValue": false,
                                    "widget": "toggle"
                                },
                                "fbPurchase": {
                                    "label": "Track Purchase",
                                    "defaultValue": false,
                                    "widget": "toggle"
                                },
                                "submitAction": {
                                    "label": "Redirect Link",
                                    "defaultValue": {
                                        url: "#",
                                        target: "_self"
                                    },
                                    "widget": "link_list"
                                }
                            }
                        }
                    },
                    renderer: {
                        Viewer: unlayer.createViewer({
                            render(values) {
                                if(typeof values.paypalCurrency === "object") values.paypalCurrency = JSON.stringify(values.paypalCurrency)
                                var paypalCurrency = JSON.parse(values.paypalCurrency).selected.split(",");
                                var currency = { word: paypalCurrency[0], code: paypalCurrency[1] };

                                return \`
                                    <div id="\$\{values._meta.htmlID\}">
                                        \$\{currency.word\} - Selected  
                                        <button style="width: 100%;background-color: #efe764;border-radius: 5px;border: none;padding: 10px;"><img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAyNCAzMiIgeG1sbnM9Imh0dHA6JiN4MkY7JiN4MkY7d3d3LnczLm9yZyYjeDJGOzIwMDAmI3gyRjtzdmciIHByZXNlcnZlQXNwZWN0UmF0aW89InhNaW5ZTWluIG1lZXQiPjxwYXRoIGZpbGw9IiMwMDljZGUiIGQ9Ik0gMjAuOTA1IDkuNSBDIDIxLjE4NSA3LjQgMjAuOTA1IDYgMTkuNzgyIDQuNyBDIDE4LjU2NCAzLjMgMTYuNDExIDIuNiAxMy42OTcgMi42IEwgNS43MzkgMi42IEMgNS4yNzEgMi42IDQuNzEgMy4xIDQuNjE1IDMuNiBMIDEuMzM5IDI1LjggQyAxLjMzOSAyNi4yIDEuNjIgMjYuNyAyLjA4OCAyNi43IEwgNi45NTYgMjYuNyBMIDYuNjc1IDI4LjkgQyA2LjU4MSAyOS4zIDYuODYyIDI5LjYgNy4yMzYgMjkuNiBMIDExLjM1NiAyOS42IEMgMTEuODI1IDI5LjYgMTIuMjkyIDI5LjMgMTIuMzg2IDI4LjggTCAxMi4zODYgMjguNSBMIDEzLjIyOCAyMy4zIEwgMTMuMjI4IDIzLjEgQyAxMy4zMjIgMjIuNiAxMy43OSAyMi4yIDE0LjI1OCAyMi4yIEwgMTQuODIxIDIyLjIgQyAxOC44NDUgMjIuMiAyMS45MzUgMjAuNSAyMi44NzEgMTUuNSBDIDIzLjMzOSAxMy40IDIzLjE1MyAxMS43IDIyLjAyOSAxMC41IEMgMjEuNzQ4IDEwLjEgMjEuMjc5IDkuOCAyMC45MDUgOS41IEwgMjAuOTA1IDkuNSI+PC9wYXRoPjxwYXRoIGZpbGw9IiMwMTIxNjkiIGQ9Ik0gMjAuOTA1IDkuNSBDIDIxLjE4NSA3LjQgMjAuOTA1IDYgMTkuNzgyIDQuNyBDIDE4LjU2NCAzLjMgMTYuNDExIDIuNiAxMy42OTcgMi42IEwgNS43MzkgMi42IEMgNS4yNzEgMi42IDQuNzEgMy4xIDQuNjE1IDMuNiBMIDEuMzM5IDI1LjggQyAxLjMzOSAyNi4yIDEuNjIgMjYuNyAyLjA4OCAyNi43IEwgNi45NTYgMjYuNyBMIDguMjY3IDE4LjQgTCA4LjE3MyAxOC43IEMgOC4yNjcgMTguMSA4LjczNSAxNy43IDkuMjk2IDE3LjcgTCAxMS42MzYgMTcuNyBDIDE2LjIyNCAxNy43IDE5Ljc4MiAxNS43IDIwLjkwNSAxMC4xIEMgMjAuODEyIDkuOCAyMC45MDUgOS43IDIwLjkwNSA5LjUiPjwvcGF0aD48cGF0aCBmaWxsPSIjMDAzMDg3IiBkPSJNIDkuNDg1IDkuNSBDIDkuNTc3IDkuMiA5Ljc2NSA4LjkgMTAuMDQ2IDguNyBDIDEwLjIzMiA4LjcgMTAuMzI2IDguNiAxMC41MTMgOC42IEwgMTYuNjkyIDguNiBDIDE3LjQ0MiA4LjYgMTguMTg5IDguNyAxOC43NTMgOC44IEMgMTguOTM5IDguOCAxOS4xMjcgOC44IDE5LjMxNCA4LjkgQyAxOS41MDEgOSAxOS42ODggOSAxOS43ODIgOS4xIEMgMTkuODc1IDkuMSAxOS45NjggOS4xIDIwLjA2MyA5LjEgQyAyMC4zNDMgOS4yIDIwLjYyNCA5LjQgMjAuOTA1IDkuNSBDIDIxLjE4NSA3LjQgMjAuOTA1IDYgMTkuNzgyIDQuNiBDIDE4LjY1OCAzLjIgMTYuNTA2IDIuNiAxMy43OSAyLjYgTCA1LjczOSAyLjYgQyA1LjI3MSAyLjYgNC43MSAzIDQuNjE1IDMuNiBMIDEuMzM5IDI1LjggQyAxLjMzOSAyNi4yIDEuNjIgMjYuNyAyLjA4OCAyNi43IEwgNi45NTYgMjYuNyBMIDguMjY3IDE4LjQgTCA5LjQ4NSA5LjUgWiI+PC9wYXRoPjwvc3ZnPg==" width="20em"><img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjMyIiB2aWV3Qm94PSIwIDAgMTAwIDMyIiB4bWxucz0iaHR0cDomI3gyRjsmI3gyRjt3d3cudzMub3JnJiN4MkY7MjAwMCYjeDJGO3N2ZyIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pbllNaW4gbWVldCI+PHBhdGggZmlsbD0iIzAwMzA4NyIgZD0iTSAxMiA0LjkxNyBMIDQuMiA0LjkxNyBDIDMuNyA0LjkxNyAzLjIgNS4zMTcgMy4xIDUuODE3IEwgMCAyNS44MTcgQyAtMC4xIDI2LjIxNyAwLjIgMjYuNTE3IDAuNiAyNi41MTcgTCA0LjMgMjYuNTE3IEMgNC44IDI2LjUxNyA1LjMgMjYuMTE3IDUuNCAyNS42MTcgTCA2LjIgMjAuMjE3IEMgNi4zIDE5LjcxNyA2LjcgMTkuMzE3IDcuMyAxOS4zMTcgTCA5LjggMTkuMzE3IEMgMTQuOSAxOS4zMTcgMTcuOSAxNi44MTcgMTguNyAxMS45MTcgQyAxOSA5LjgxNyAxOC43IDguMTE3IDE3LjcgNi45MTcgQyAxNi42IDUuNjE3IDE0LjYgNC45MTcgMTIgNC45MTcgWiBNIDEyLjkgMTIuMjE3IEMgMTIuNSAxNS4wMTcgMTAuMyAxNS4wMTcgOC4zIDE1LjAxNyBMIDcuMSAxNS4wMTcgTCA3LjkgOS44MTcgQyA3LjkgOS41MTcgOC4yIDkuMzE3IDguNSA5LjMxNyBMIDkgOS4zMTcgQyAxMC40IDkuMzE3IDExLjcgOS4zMTcgMTIuNCAxMC4xMTcgQyAxMi45IDEwLjUxNyAxMy4xIDExLjIxNyAxMi45IDEyLjIxNyBaIj48L3BhdGg+PHBhdGggZmlsbD0iIzAwMzA4NyIgZD0iTSAzNS4yIDEyLjExNyBMIDMxLjUgMTIuMTE3IEMgMzEuMiAxMi4xMTcgMzAuOSAxMi4zMTcgMzAuOSAxMi42MTcgTCAzMC43IDEzLjYxNyBMIDMwLjQgMTMuMjE3IEMgMjkuNiAxMi4wMTcgMjcuOCAxMS42MTcgMjYgMTEuNjE3IEMgMjEuOSAxMS42MTcgMTguNCAxNC43MTcgMTcuNyAxOS4xMTcgQyAxNy4zIDIxLjMxNyAxNy44IDIzLjQxNyAxOS4xIDI0LjgxNyBDIDIwLjIgMjYuMTE3IDIxLjkgMjYuNzE3IDIzLjggMjYuNzE3IEMgMjcuMSAyNi43MTcgMjkgMjQuNjE3IDI5IDI0LjYxNyBMIDI4LjggMjUuNjE3IEMgMjguNyAyNi4wMTcgMjkgMjYuNDE3IDI5LjQgMjYuNDE3IEwgMzIuOCAyNi40MTcgQyAzMy4zIDI2LjQxNyAzMy44IDI2LjAxNyAzMy45IDI1LjUxNyBMIDM1LjkgMTIuNzE3IEMgMzYgMTIuNTE3IDM1LjYgMTIuMTE3IDM1LjIgMTIuMTE3IFogTSAzMC4xIDE5LjMxNyBDIDI5LjcgMjEuNDE3IDI4LjEgMjIuOTE3IDI1LjkgMjIuOTE3IEMgMjQuOCAyMi45MTcgMjQgMjIuNjE3IDIzLjQgMjEuOTE3IEMgMjIuOCAyMS4yMTcgMjIuNiAyMC4zMTcgMjIuOCAxOS4zMTcgQyAyMy4xIDE3LjIxNyAyNC45IDE1LjcxNyAyNyAxNS43MTcgQyAyOC4xIDE1LjcxNyAyOC45IDE2LjExNyAyOS41IDE2LjcxNyBDIDMwIDE3LjQxNyAzMC4yIDE4LjMxNyAzMC4xIDE5LjMxNyBaIj48L3BhdGg+PHBhdGggZmlsbD0iIzAwMzA4NyIgZD0iTSA1NS4xIDEyLjExNyBMIDUxLjQgMTIuMTE3IEMgNTEgMTIuMTE3IDUwLjcgMTIuMzE3IDUwLjUgMTIuNjE3IEwgNDUuMyAyMC4yMTcgTCA0My4xIDEyLjkxNyBDIDQzIDEyLjQxNyA0Mi41IDEyLjExNyA0Mi4xIDEyLjExNyBMIDM4LjQgMTIuMTE3IEMgMzggMTIuMTE3IDM3LjYgMTIuNTE3IDM3LjggMTMuMDE3IEwgNDEuOSAyNS4xMTcgTCAzOCAzMC41MTcgQyAzNy43IDMwLjkxNyAzOCAzMS41MTcgMzguNSAzMS41MTcgTCA0Mi4yIDMxLjUxNyBDIDQyLjYgMzEuNTE3IDQyLjkgMzEuMzE3IDQzLjEgMzEuMDE3IEwgNTUuNiAxMy4wMTcgQyA1NS45IDEyLjcxNyA1NS42IDEyLjExNyA1NS4xIDEyLjExNyBaIj48L3BhdGg+PHBhdGggZmlsbD0iIzAwOWNkZSIgZD0iTSA2Ny41IDQuOTE3IEwgNTkuNyA0LjkxNyBDIDU5LjIgNC45MTcgNTguNyA1LjMxNyA1OC42IDUuODE3IEwgNTUuNSAyNS43MTcgQyA1NS40IDI2LjExNyA1NS43IDI2LjQxNyA1Ni4xIDI2LjQxNyBMIDYwLjEgMjYuNDE3IEMgNjAuNSAyNi40MTcgNjAuOCAyNi4xMTcgNjAuOCAyNS44MTcgTCA2MS43IDIwLjExNyBDIDYxLjggMTkuNjE3IDYyLjIgMTkuMjE3IDYyLjggMTkuMjE3IEwgNjUuMyAxOS4yMTcgQyA3MC40IDE5LjIxNyA3My40IDE2LjcxNyA3NC4yIDExLjgxNyBDIDc0LjUgOS43MTcgNzQuMiA4LjAxNyA3My4yIDYuODE3IEMgNzIgNS42MTcgNzAuMSA0LjkxNyA2Ny41IDQuOTE3IFogTSA2OC40IDEyLjIxNyBDIDY4IDE1LjAxNyA2NS44IDE1LjAxNyA2My44IDE1LjAxNyBMIDYyLjYgMTUuMDE3IEwgNjMuNCA5LjgxNyBDIDYzLjQgOS41MTcgNjMuNyA5LjMxNyA2NCA5LjMxNyBMIDY0LjUgOS4zMTcgQyA2NS45IDkuMzE3IDY3LjIgOS4zMTcgNjcuOSAxMC4xMTcgQyA2OC40IDEwLjUxNyA2OC41IDExLjIxNyA2OC40IDEyLjIxNyBaIj48L3BhdGg+PHBhdGggZmlsbD0iIzAwOWNkZSIgZD0iTSA5MC43IDEyLjExNyBMIDg3IDEyLjExNyBDIDg2LjcgMTIuMTE3IDg2LjQgMTIuMzE3IDg2LjQgMTIuNjE3IEwgODYuMiAxMy42MTcgTCA4NS45IDEzLjIxNyBDIDg1LjEgMTIuMDE3IDgzLjMgMTEuNjE3IDgxLjUgMTEuNjE3IEMgNzcuNCAxMS42MTcgNzMuOSAxNC43MTcgNzMuMiAxOS4xMTcgQyA3Mi44IDIxLjMxNyA3My4zIDIzLjQxNyA3NC42IDI0LjgxNyBDIDc1LjcgMjYuMTE3IDc3LjQgMjYuNzE3IDc5LjMgMjYuNzE3IEMgODIuNiAyNi43MTcgODQuNSAyNC42MTcgODQuNSAyNC42MTcgTCA4NC4zIDI1LjYxNyBDIDg0LjIgMjYuMDE3IDg0LjUgMjYuNDE3IDg0LjkgMjYuNDE3IEwgODguMyAyNi40MTcgQyA4OC44IDI2LjQxNyA4OS4zIDI2LjAxNyA4OS40IDI1LjUxNyBMIDkxLjQgMTIuNzE3IEMgOTEuNCAxMi41MTcgOTEuMSAxMi4xMTcgOTAuNyAxMi4xMTcgWiBNIDg1LjUgMTkuMzE3IEMgODUuMSAyMS40MTcgODMuNSAyMi45MTcgODEuMyAyMi45MTcgQyA4MC4yIDIyLjkxNyA3OS40IDIyLjYxNyA3OC44IDIxLjkxNyBDIDc4LjIgMjEuMjE3IDc4IDIwLjMxNyA3OC4yIDE5LjMxNyBDIDc4LjUgMTcuMjE3IDgwLjMgMTUuNzE3IDgyLjQgMTUuNzE3IEMgODMuNSAxNS43MTcgODQuMyAxNi4xMTcgODQuOSAxNi43MTcgQyA4NS41IDE3LjQxNyA4NS43IDE4LjMxNyA4NS41IDE5LjMxNyBaIj48L3BhdGg+PHBhdGggZmlsbD0iIzAwOWNkZSIgZD0iTSA5NS4xIDUuNDE3IEwgOTEuOSAyNS43MTcgQyA5MS44IDI2LjExNyA5Mi4xIDI2LjQxNyA5Mi41IDI2LjQxNyBMIDk1LjcgMjYuNDE3IEMgOTYuMiAyNi40MTcgOTYuNyAyNi4wMTcgOTYuOCAyNS41MTcgTCAxMDAgNS42MTcgQyAxMDAuMSA1LjIxNyA5OS44IDQuOTE3IDk5LjQgNC45MTcgTCA5NS44IDQuOTE3IEMgOTUuNCA0LjkxNyA5NS4yIDUuMTE3IDk1LjEgNS40MTcgWiI+PC9wYXRoPjwvc3ZnPg==" width="80em"></button>
                                    </div>
                                \`
                            }
                        }),
                        exporters: {
                            web: function(values) {
                                if(typeof values.paypalCurrency === "object") values.paypalCurrency = JSON.stringify(values.paypalCurrency)
                                var paypalCurrency = JSON.parse(values.paypalCurrency).selected.split(",");
                                var currency = { word: paypalCurrency[0], code: paypalCurrency[1] };

                                return \`
                                    <div id="\$\{values._meta.htmlID\}">
                                        <button style="width: 100%;background-color: #efe764;border-radius: 5px;border: none;padding: 10px;"><img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAyNCAzMiIgeG1sbnM9Imh0dHA6JiN4MkY7JiN4MkY7d3d3LnczLm9yZyYjeDJGOzIwMDAmI3gyRjtzdmciIHByZXNlcnZlQXNwZWN0UmF0aW89InhNaW5ZTWluIG1lZXQiPjxwYXRoIGZpbGw9IiMwMDljZGUiIGQ9Ik0gMjAuOTA1IDkuNSBDIDIxLjE4NSA3LjQgMjAuOTA1IDYgMTkuNzgyIDQuNyBDIDE4LjU2NCAzLjMgMTYuNDExIDIuNiAxMy42OTcgMi42IEwgNS43MzkgMi42IEMgNS4yNzEgMi42IDQuNzEgMy4xIDQuNjE1IDMuNiBMIDEuMzM5IDI1LjggQyAxLjMzOSAyNi4yIDEuNjIgMjYuNyAyLjA4OCAyNi43IEwgNi45NTYgMjYuNyBMIDYuNjc1IDI4LjkgQyA2LjU4MSAyOS4zIDYuODYyIDI5LjYgNy4yMzYgMjkuNiBMIDExLjM1NiAyOS42IEMgMTEuODI1IDI5LjYgMTIuMjkyIDI5LjMgMTIuMzg2IDI4LjggTCAxMi4zODYgMjguNSBMIDEzLjIyOCAyMy4zIEwgMTMuMjI4IDIzLjEgQyAxMy4zMjIgMjIuNiAxMy43OSAyMi4yIDE0LjI1OCAyMi4yIEwgMTQuODIxIDIyLjIgQyAxOC44NDUgMjIuMiAyMS45MzUgMjAuNSAyMi44NzEgMTUuNSBDIDIzLjMzOSAxMy40IDIzLjE1MyAxMS43IDIyLjAyOSAxMC41IEMgMjEuNzQ4IDEwLjEgMjEuMjc5IDkuOCAyMC45MDUgOS41IEwgMjAuOTA1IDkuNSI+PC9wYXRoPjxwYXRoIGZpbGw9IiMwMTIxNjkiIGQ9Ik0gMjAuOTA1IDkuNSBDIDIxLjE4NSA3LjQgMjAuOTA1IDYgMTkuNzgyIDQuNyBDIDE4LjU2NCAzLjMgMTYuNDExIDIuNiAxMy42OTcgMi42IEwgNS43MzkgMi42IEMgNS4yNzEgMi42IDQuNzEgMy4xIDQuNjE1IDMuNiBMIDEuMzM5IDI1LjggQyAxLjMzOSAyNi4yIDEuNjIgMjYuNyAyLjA4OCAyNi43IEwgNi45NTYgMjYuNyBMIDguMjY3IDE4LjQgTCA4LjE3MyAxOC43IEMgOC4yNjcgMTguMSA4LjczNSAxNy43IDkuMjk2IDE3LjcgTCAxMS42MzYgMTcuNyBDIDE2LjIyNCAxNy43IDE5Ljc4MiAxNS43IDIwLjkwNSAxMC4xIEMgMjAuODEyIDkuOCAyMC45MDUgOS43IDIwLjkwNSA5LjUiPjwvcGF0aD48cGF0aCBmaWxsPSIjMDAzMDg3IiBkPSJNIDkuNDg1IDkuNSBDIDkuNTc3IDkuMiA5Ljc2NSA4LjkgMTAuMDQ2IDguNyBDIDEwLjIzMiA4LjcgMTAuMzI2IDguNiAxMC41MTMgOC42IEwgMTYuNjkyIDguNiBDIDE3LjQ0MiA4LjYgMTguMTg5IDguNyAxOC43NTMgOC44IEMgMTguOTM5IDguOCAxOS4xMjcgOC44IDE5LjMxNCA4LjkgQyAxOS41MDEgOSAxOS42ODggOSAxOS43ODIgOS4xIEMgMTkuODc1IDkuMSAxOS45NjggOS4xIDIwLjA2MyA5LjEgQyAyMC4zNDMgOS4yIDIwLjYyNCA5LjQgMjAuOTA1IDkuNSBDIDIxLjE4NSA3LjQgMjAuOTA1IDYgMTkuNzgyIDQuNiBDIDE4LjY1OCAzLjIgMTYuNTA2IDIuNiAxMy43OSAyLjYgTCA1LjczOSAyLjYgQyA1LjI3MSAyLjYgNC43MSAzIDQuNjE1IDMuNiBMIDEuMzM5IDI1LjggQyAxLjMzOSAyNi4yIDEuNjIgMjYuNyAyLjA4OCAyNi43IEwgNi45NTYgMjYuNyBMIDguMjY3IDE4LjQgTCA5LjQ4NSA5LjUgWiI+PC9wYXRoPjwvc3ZnPg==" width="20em"><img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjMyIiB2aWV3Qm94PSIwIDAgMTAwIDMyIiB4bWxucz0iaHR0cDomI3gyRjsmI3gyRjt3d3cudzMub3JnJiN4MkY7MjAwMCYjeDJGO3N2ZyIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pbllNaW4gbWVldCI+PHBhdGggZmlsbD0iIzAwMzA4NyIgZD0iTSAxMiA0LjkxNyBMIDQuMiA0LjkxNyBDIDMuNyA0LjkxNyAzLjIgNS4zMTcgMy4xIDUuODE3IEwgMCAyNS44MTcgQyAtMC4xIDI2LjIxNyAwLjIgMjYuNTE3IDAuNiAyNi41MTcgTCA0LjMgMjYuNTE3IEMgNC44IDI2LjUxNyA1LjMgMjYuMTE3IDUuNCAyNS42MTcgTCA2LjIgMjAuMjE3IEMgNi4zIDE5LjcxNyA2LjcgMTkuMzE3IDcuMyAxOS4zMTcgTCA5LjggMTkuMzE3IEMgMTQuOSAxOS4zMTcgMTcuOSAxNi44MTcgMTguNyAxMS45MTcgQyAxOSA5LjgxNyAxOC43IDguMTE3IDE3LjcgNi45MTcgQyAxNi42IDUuNjE3IDE0LjYgNC45MTcgMTIgNC45MTcgWiBNIDEyLjkgMTIuMjE3IEMgMTIuNSAxNS4wMTcgMTAuMyAxNS4wMTcgOC4zIDE1LjAxNyBMIDcuMSAxNS4wMTcgTCA3LjkgOS44MTcgQyA3LjkgOS41MTcgOC4yIDkuMzE3IDguNSA5LjMxNyBMIDkgOS4zMTcgQyAxMC40IDkuMzE3IDExLjcgOS4zMTcgMTIuNCAxMC4xMTcgQyAxMi45IDEwLjUxNyAxMy4xIDExLjIxNyAxMi45IDEyLjIxNyBaIj48L3BhdGg+PHBhdGggZmlsbD0iIzAwMzA4NyIgZD0iTSAzNS4yIDEyLjExNyBMIDMxLjUgMTIuMTE3IEMgMzEuMiAxMi4xMTcgMzAuOSAxMi4zMTcgMzAuOSAxMi42MTcgTCAzMC43IDEzLjYxNyBMIDMwLjQgMTMuMjE3IEMgMjkuNiAxMi4wMTcgMjcuOCAxMS42MTcgMjYgMTEuNjE3IEMgMjEuOSAxMS42MTcgMTguNCAxNC43MTcgMTcuNyAxOS4xMTcgQyAxNy4zIDIxLjMxNyAxNy44IDIzLjQxNyAxOS4xIDI0LjgxNyBDIDIwLjIgMjYuMTE3IDIxLjkgMjYuNzE3IDIzLjggMjYuNzE3IEMgMjcuMSAyNi43MTcgMjkgMjQuNjE3IDI5IDI0LjYxNyBMIDI4LjggMjUuNjE3IEMgMjguNyAyNi4wMTcgMjkgMjYuNDE3IDI5LjQgMjYuNDE3IEwgMzIuOCAyNi40MTcgQyAzMy4zIDI2LjQxNyAzMy44IDI2LjAxNyAzMy45IDI1LjUxNyBMIDM1LjkgMTIuNzE3IEMgMzYgMTIuNTE3IDM1LjYgMTIuMTE3IDM1LjIgMTIuMTE3IFogTSAzMC4xIDE5LjMxNyBDIDI5LjcgMjEuNDE3IDI4LjEgMjIuOTE3IDI1LjkgMjIuOTE3IEMgMjQuOCAyMi45MTcgMjQgMjIuNjE3IDIzLjQgMjEuOTE3IEMgMjIuOCAyMS4yMTcgMjIuNiAyMC4zMTcgMjIuOCAxOS4zMTcgQyAyMy4xIDE3LjIxNyAyNC45IDE1LjcxNyAyNyAxNS43MTcgQyAyOC4xIDE1LjcxNyAyOC45IDE2LjExNyAyOS41IDE2LjcxNyBDIDMwIDE3LjQxNyAzMC4yIDE4LjMxNyAzMC4xIDE5LjMxNyBaIj48L3BhdGg+PHBhdGggZmlsbD0iIzAwMzA4NyIgZD0iTSA1NS4xIDEyLjExNyBMIDUxLjQgMTIuMTE3IEMgNTEgMTIuMTE3IDUwLjcgMTIuMzE3IDUwLjUgMTIuNjE3IEwgNDUuMyAyMC4yMTcgTCA0My4xIDEyLjkxNyBDIDQzIDEyLjQxNyA0Mi41IDEyLjExNyA0Mi4xIDEyLjExNyBMIDM4LjQgMTIuMTE3IEMgMzggMTIuMTE3IDM3LjYgMTIuNTE3IDM3LjggMTMuMDE3IEwgNDEuOSAyNS4xMTcgTCAzOCAzMC41MTcgQyAzNy43IDMwLjkxNyAzOCAzMS41MTcgMzguNSAzMS41MTcgTCA0Mi4yIDMxLjUxNyBDIDQyLjYgMzEuNTE3IDQyLjkgMzEuMzE3IDQzLjEgMzEuMDE3IEwgNTUuNiAxMy4wMTcgQyA1NS45IDEyLjcxNyA1NS42IDEyLjExNyA1NS4xIDEyLjExNyBaIj48L3BhdGg+PHBhdGggZmlsbD0iIzAwOWNkZSIgZD0iTSA2Ny41IDQuOTE3IEwgNTkuNyA0LjkxNyBDIDU5LjIgNC45MTcgNTguNyA1LjMxNyA1OC42IDUuODE3IEwgNTUuNSAyNS43MTcgQyA1NS40IDI2LjExNyA1NS43IDI2LjQxNyA1Ni4xIDI2LjQxNyBMIDYwLjEgMjYuNDE3IEMgNjAuNSAyNi40MTcgNjAuOCAyNi4xMTcgNjAuOCAyNS44MTcgTCA2MS43IDIwLjExNyBDIDYxLjggMTkuNjE3IDYyLjIgMTkuMjE3IDYyLjggMTkuMjE3IEwgNjUuMyAxOS4yMTcgQyA3MC40IDE5LjIxNyA3My40IDE2LjcxNyA3NC4yIDExLjgxNyBDIDc0LjUgOS43MTcgNzQuMiA4LjAxNyA3My4yIDYuODE3IEMgNzIgNS42MTcgNzAuMSA0LjkxNyA2Ny41IDQuOTE3IFogTSA2OC40IDEyLjIxNyBDIDY4IDE1LjAxNyA2NS44IDE1LjAxNyA2My44IDE1LjAxNyBMIDYyLjYgMTUuMDE3IEwgNjMuNCA5LjgxNyBDIDYzLjQgOS41MTcgNjMuNyA5LjMxNyA2NCA5LjMxNyBMIDY0LjUgOS4zMTcgQyA2NS45IDkuMzE3IDY3LjIgOS4zMTcgNjcuOSAxMC4xMTcgQyA2OC40IDEwLjUxNyA2OC41IDExLjIxNyA2OC40IDEyLjIxNyBaIj48L3BhdGg+PHBhdGggZmlsbD0iIzAwOWNkZSIgZD0iTSA5MC43IDEyLjExNyBMIDg3IDEyLjExNyBDIDg2LjcgMTIuMTE3IDg2LjQgMTIuMzE3IDg2LjQgMTIuNjE3IEwgODYuMiAxMy42MTcgTCA4NS45IDEzLjIxNyBDIDg1LjEgMTIuMDE3IDgzLjMgMTEuNjE3IDgxLjUgMTEuNjE3IEMgNzcuNCAxMS42MTcgNzMuOSAxNC43MTcgNzMuMiAxOS4xMTcgQyA3Mi44IDIxLjMxNyA3My4zIDIzLjQxNyA3NC42IDI0LjgxNyBDIDc1LjcgMjYuMTE3IDc3LjQgMjYuNzE3IDc5LjMgMjYuNzE3IEMgODIuNiAyNi43MTcgODQuNSAyNC42MTcgODQuNSAyNC42MTcgTCA4NC4zIDI1LjYxNyBDIDg0LjIgMjYuMDE3IDg0LjUgMjYuNDE3IDg0LjkgMjYuNDE3IEwgODguMyAyNi40MTcgQyA4OC44IDI2LjQxNyA4OS4zIDI2LjAxNyA4OS40IDI1LjUxNyBMIDkxLjQgMTIuNzE3IEMgOTEuNCAxMi41MTcgOTEuMSAxMi4xMTcgOTAuNyAxMi4xMTcgWiBNIDg1LjUgMTkuMzE3IEMgODUuMSAyMS40MTcgODMuNSAyMi45MTcgODEuMyAyMi45MTcgQyA4MC4yIDIyLjkxNyA3OS40IDIyLjYxNyA3OC44IDIxLjkxNyBDIDc4LjIgMjEuMjE3IDc4IDIwLjMxNyA3OC4yIDE5LjMxNyBDIDc4LjUgMTcuMjE3IDgwLjMgMTUuNzE3IDgyLjQgMTUuNzE3IEMgODMuNSAxNS43MTcgODQuMyAxNi4xMTcgODQuOSAxNi43MTcgQyA4NS41IDE3LjQxNyA4NS43IDE4LjMxNyA4NS41IDE5LjMxNyBaIj48L3BhdGg+PHBhdGggZmlsbD0iIzAwOWNkZSIgZD0iTSA5NS4xIDUuNDE3IEwgOTEuOSAyNS43MTcgQyA5MS44IDI2LjExNyA5Mi4xIDI2LjQxNyA5Mi41IDI2LjQxNyBMIDk1LjcgMjYuNDE3IEMgOTYuMiAyNi40MTcgOTYuNyAyNi4wMTcgOTYuOCAyNS41MTcgTCAxMDAgNS42MTcgQyAxMDAuMSA1LjIxNyA5OS44IDQuOTE3IDk5LjQgNC45MTcgTCA5NS44IDQuOTE3IEMgOTUuNCA0LjkxNyA5NS4yIDUuMTE3IDk1LjEgNS40MTcgWiI+PC9wYXRoPjwvc3ZnPg==" width="80em"></button>
                                    </div>
                                    <script src="https://www.paypal.com/sdk/js?client-id=${this.decryptString(paypalClientID)}&currency=\$\{currency.word\}"></script>
                                    <script>
                                        // remove localstorage from previous session of paypal
                                        localStorage.removeItem("plg_email_id");
                                        localStorage.removeItem("plg_prod_list");
                                        localStorage.removeItem("paypal_as_checkout");
                                        localStorage.removeItem("cod_data");
                                        localStorage.removeItem("cod_currency");

                                        document.getElementById('\$\{values._meta.htmlID\}').innerHTML = "";
                                        paypal.Buttons({
                                            style: { layout: 'horizontal' },
                                            createOrder: function(data, actions) {
                                                if (\$\{values.fbTrack\} && typeof fbq !== "undefined") fbq("track", "AddToCart");
                                                if (\$\{values.fbInitiate\} && typeof fbq !== 'undefined') fbq('track', 'InitiateCheckout');
                                                console.log(plg_selectedVariant, "plg_selectedVariant")
                                                // Set up the transaction
                                                return actions.order.create({
                                                    purchase_units: [{
                                                        amount: {
                                                            value: plg_price,
                                                            currency_code: '\$\{currency.word\}'
                                                        },
                                                        description: (plg_selectedVariant.product_name+" ("+plg_selectedVariant.variant_name+")").substring(0, 127)
                                                    }]
                                                });
                                            },
                                            onApprove: function(data, actions) {
                                                return actions.order.capture().then(function(details) {
                                                    // Call your server to save the transaction
                                                    var x_checkout = [{
                                                        product_url: window.location.href,
                                                        product_name: plg_selectedVariant.product_name,
                                                        variant_name: plg_selectedVariant.variant_name,
                                                        product_price: parseFloat(plg_price)
                                                    }]
                                                    localStorage.setItem("plg_prod_list", JSON.stringify(x_checkout));
                                                    localStorage.setItem("paypal_as_checkout", true);
                                                    // for sending order confirmation
                                                    localStorage.setItem("funnel_customer_name", details.payer.name.given_name+" "+details.payer.name.surname)
                                                    localStorage.setItem("funnel_customer_email", details.payer.email_address)
                                                    var sendObjectToServer = {
                                                        ...details,
                                                        metadata: {
                                                            meta: "${this.encryptString(user_id)}",
                                                            pageid: "${state.page_data.funnel_id}"
                                                        },
                                                        product_name: plg_selectedVariant.product_name,
                                                        variant_name: plg_selectedVariant.variant_name,
                                                        variant_id: plg_selectedVariant.variant_id, // for shopify variant id
                                                        // RECENT:
                                                        cog: plg_selectedVariant.cog ? plg_selectedVariant.cog : 0
                                                    }
                                                    // send initial data to server and send to app.productlistgenie.io
                                                    return fetch('/paypal-orders-initial', {
                                                        method: "POST",
                                                        headers: {
                                                            'Content-Type': 'application/json',
                                                        },
                                                        body: JSON.stringify(sendObjectToServer)
                                                    })
                                                    .then(res => {
                                                        let currency_word = plg_selectedVariant.currency ? plg_selectedVariant.currency.word : "USD";
                                                        let currency_symbol = plg_selectedVariant.currency ? plg_selectedVariant.currency.code : "$";

                                                        if (\$\{values.fbPurchase\}) {
                                                            if (typeof setPurchased !== "undefined" && typeof plg_selectedVariant !== "undefined") setPurchased(); // plg analytics
                                                            if (typeof fbq !== "undefined") fbq("track", "Purchase", { value: parseFloat(plg_price), currency: currency_word });
                                                            if (typeof googleConversion !== "undefined") googleConversion(parseFloat(plg_price));
                                                            if (typeof snaptr !== "undefined") snaptr("track", "PURCHASE", { "currency": currency_word, "price": parseFloat(plg_price) });
                                                        }
                                                      

                                                        // for sending email
                                                        const callback = () => setTimeout(() => window.open("\$\{values.submitAction.url\}","\$\{values.submitAction.target\}"), 1000);
                                                        let productName = plg_selectedVariant.product_name;
                                                        let plg_qty = plg_selectedVariant.variant_qty ? parseInt(plg_selectedVariant.variant_qty) : 1;
                                                        ${this.getSendingEmailRequest(true)}
                                                    })
                                                    .catch(err => {
                                                        console.log(err)
                                                        return window.open("\$\{values.submitAction.url\}","\$\{values.submitAction.target\}")
                                                    })
                                                });
                                            }
                                        }).render('#\$\{values._meta.htmlID\}');
                                    </script>
                                \`
                            },
                            email: function() {}
                        }
                    }
                })
            `)
        }
        
        if(page_type == "checkout" && selected_merchant == "authorize.net"){
            // Show Authorize Checkout form
            customJS.push(`
                console.log("18. Initializing authorize form...");
                unlayer.registerTool({
                    type: 'authorize-form',
                    category: 'contents',
                    label: 'Integration',
                    icon: '<svg aria-hidden="true" data-prefix="fab" data-icon="wpforms" class="svg-inline--fa fa-wpforms fa-w-14 fa-3x" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M448 75.2v361.7c0 24.3-19 43.2-43.2 43.2H43.2C19.3 480 0 461.4 0 436.8V75.2C0 51.1 18.8 32 43.2 32h361.7c24 0 43.1 18.8 43.1 43.2zm-37.3 361.6V75.2c0-3-2.6-5.8-5.8-5.8h-9.3L285.3 144 224 94.1 162.8 144 52.5 69.3h-9.3c-3.2 0-5.8 2.8-5.8 5.8v361.7c0 3 2.6 5.8 5.8 5.8h361.7c3.2.1 5.8-2.7 5.8-5.8zM150.2 186v37H76.7v-37h73.5zm0 74.4v37.3H76.7v-37.3h73.5zm11.1-147.3l54-43.7H96.8l64.5 43.7zm210 72.9v37h-196v-37h196zm0 74.4v37.3h-196v-37.3h196zm-84.6-147.3l64.5-43.7H232.8l53.9 43.7zM371.3 335v37.3h-99.4V335h99.4z"></path></svg>',
                    values: {},
                    options: {
                        tools: {  //if error change tools to button
                            title: "Authorize.net | Settings", //april12 error
                            position: 1,
                            options: {
                                "testMode": {
                                    "label": "Test Mode",
                                    "defaultValue": false,
                                    "widget": "toggle"
                                },
                                "showCard": {
                                    "label": "Show Card",
                                    "defaultValue": true,
                                    "widget": "toggle"
                                },
                                "fbTrack": {
                                    "label": "Track AddToCart",
                                    "defaultValue": false,
                                    "widget": "toggle"
                                },
                                "fbInitiate": {
                                    "label": "Track InitiateCheckout",
                                    "defaultValue": false,
                                    "widget": "toggle"
                                },
                                "fbPurchase": {
                                    "label": "Track Purchase",
                                    "defaultValue": false,
                                    "widget": "toggle"
                                },
                                "buttonColors": {
                                    "label": "Color",
                                    "defaultValue": {
                                        color: "#FFF",
                                        backgroundColor: "#26c686",
                                        hoverColor: "#2A92BF"
                                    },
                                    "widget": "button_color"
                                },
                                "submitAction": {
                                    "label": "Redirect Link",
                                    "defaultValue": {
                                        url: "#",
                                        target: "_self"
                                    },
                                    "widget": "link_list"
                                },
                                "submitLabel": {
                                    "label": "Checkout Button Label",
                                    "defaultValue": "YES! SEND ME MY PURCHASE WITH FREE SHIPPING NOW",
                                    "widget": "text"
                                },
                                "padding": {
                                    "label": "Padding",
                                    "defaultValue": "10px",
                                    "widget": "padding"
                                }
                            }
                        },
                        form: {
                            title: "Form",
                            position: 1,
                            options: {
                                "multiStep": {
                                    "label": "Use Multistep Form",
                                    "defaultValue": false,
                                    "widget": "toggle"
                                },
                                "firstNameLabel": {
                                    "label": "First Name Label (for multistep form)",
                                    "defaultValue": "First Name",
                                    "widget": "text"
                                },
                                "lastNameLabel": {
                                    "label": "Last Name Label (for multistep form)",
                                    "defaultValue": "Last Name",
                                    "widget": "text"
                                },
                                "emailLabel": {
                                    "label": "Email Label (for multistep form)",
                                    "defaultValue": "Email",
                                    "widget": "text"
                                },
                                "enablePhone": {
                                    "label": "Enable Phone Number",
                                    "defaultValue": false,
                                    "widget": "toggle"
                                },
                                // RECENT:
                                "enableSMSbump": {
                                    "label": "Ask permission to send SMS",
                                    "defaultValue": false,
                                    "widget": "toggle"
                                },
                                "tittleSMSBump": {
                                    "label": "Title of SMS permission",
                                    "defaultValue": "SMS Text Notifications",
                                    "widget": "text"
                                },
                                "permissionSMSBumpContent": {
                                    "label": "Content of SMS permission",
                                    "defaultValue": "Allow to receive updates via SMS",
                                    "widget": "text"
                                },
                                "campaignSMSBump": {
                                    "label": "SMS Bump embedded form ID",
                                    "defaultValue": "000",
                                    "widget": "text"
                                },
                                "phoneLabel": {
                                    "label": "Phone Label",
                                    "defaultValue": "Phone Number",
                                    "widget": "text"
                                },
                                "nextButton": {
                                    "label": "Next Button",
                                    "defaultValue": "NEXT STEP",
                                    "widget": "text"
                                },
                                "shippingHeader": {
                                    "label": "Shipping Address Heading",
                                    "defaultValue": "Shipping Address",
                                    "widget": "text"
                                },
                                "firstName": {
                                    "label": "First Name Placeholder",
                                    "defaultValue": "First Name",
                                    "widget": "text"
                                },
                                "lastName": {
                                    "label": "Last Name Placeholder",
                                    "defaultValue": "Last Name",
                                    "widget": "text"
                                },
                                "email": {
                                    "label": "Email Placeholder",
                                    "defaultValue": "Email",
                                    "widget": "text"
                                },
                                "address": {
                                    "label": "Address Placeholder",
                                    "defaultValue": "Street Address",
                                    "widget": "text"
                                },
                                "city": {
                                    "label": "City Placeholder",
                                    "defaultValue": "City",
                                    "widget": "text"
                                },
                                "zipcode": {
                                    "label": "Zip code Placeholder",
                                    "defaultValue": "Zip code",
                                    "widget": "text"
                                },
                                "state": {
                                    "label": "State/Province Placeholder",
                                    "defaultValue": "State/Province",
                                    "widget": "text"
                                },
                                "creditCard": {
                                    "label": "Credit Card Heading",
                                    "defaultValue": "Credit Card",
                                    "widget": "text"
                                },
                                "billingAddress1": {
                                    "label": "Use billing address Heading",
                                    "defaultValue": "Click here if billing address is different from shipping address",
                                    "widget": "text"
                                },
                                "billingAddress2": {
                                    "label": "Use Shipping address Heading",
                                    "defaultValue": "Billing Address",
                                    "widget": "text"
                                }
                            }
                        }
                    },
                    renderer: {
                        Viewer: unlayer.createViewer({
                            render(values) {
                                return \`
                                    <style>
                                        .authorize-form .half-left {
                                            width: 49.5%; float: left; padding: 0 0.5% 0 0;
                                        }
                                        .authorize-form .half-right {
                                            width: 49.5%; float: right; padding: 0 0 0 0.5%;
                                        }
                                        .first-step-container input, .authorize-form input {
                                            margin-bottom: 10px; display: inline-block; max-width: 100%; width: 100%; border-top-width: 1px; border-top-style: solid; border-top-color: #CCC; border-left-width: 1px; border-left-style: solid; border-left-color: #CCC; border-right-width: 1px; border-right-style: solid; border-right-color: #CCC; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #CCC; padding: 10px; color: #000; background-color: #FFF; font-size: 12px; width: 100%; border-radius: 0px;
                                        }
                                        .authorize-form button, #\$\{values._meta.htmlID\} .first-step-container button {
                                            color: \$\{values.buttonColors.color\};
                                            background-color: \$\{values.buttonColors.backgroundColor\};
                                            padding: \$\{values.padding\}; font-size: 15px; width: 100%; cursor: pointer; border-radius: 5px;
                                        }
                                        .authorize-form .custom-select {
                                            position: relative;
                                            font-size: 0.875em !important;
                                            font-family: 'Roboto', sans-serif;
                                            font-weight: 400;
                                            border: 1px solid #dbe1df;
                                            border-radius: 5px;
                                        }
                                        .authorize-form .custom-select select {
                                            display: none;
                                        }
                                        .authorize-form .custom-select .select-selected {
                                            background-color: #fff;
                                        }
                                        .authorize-form .custom-select .select-selected:after {
                                            position: absolute;
                                            content: "";
                                            top: 14px;
                                            right: 10px;
                                            width: 0;
                                            height: 0;
                                            border: 6px solid transparent;
                                            border-color: #23c78a transparent transparent transparent;
                                        }
                                        .authorize-form .custom-select .select-selected.select-arrow-active:after {
                                            border-color: transparent transparent #23c78a transparent;
                                            top: 7px;
                                        }
                                        .authorize-form .custom-select .select-selected {
                                            color: #484747;
                                            padding: 10px 15px;
                                            border: 1px solid transparent;
                                            border-color: #dbe1df;
                                            cursor: pointer;
                                            user-select: none;
                                            overflow: hidden;
                                            text-overflow: ellipsis;
                                            white-space: nowrap;
                                        }
                                        .authorize-form .custom-select .select-items div {
                                            color: #484747;
                                            padding: 10px 15px;
                                            cursor: pointer;
                                            overflow: hidden;
                                            text-overflow: ellipsis;
                                            white-space: nowrap;
                                        }
                                        .authorize-form .custom-select .select-items {
                                            position: absolute;
                                            background-color: #fff;
                                            border: 1px solid #dbe1df;
                                            padding: 5px 10px;
                                            top: 100%;
                                            left: 0;
                                            right: 0;
                                            z-index: 99;
                                        }
                                        .authorize-form .custom-select .select-hide {
                                            display: none;
                                        }
                                        .authorize-form .custom-select .select-items div:hover, .custom-select .same-as-selected {
                                            background-color: #21ab72;
                                        }
                                        .authorize-form .select-parent {
                                            position: relative;
                                            width: 100%;
                                            margin-bottom: 10px;
                                        }
                                        .authorize-form select {
                                            -webkit-appearance: none;
                                            -moz-appearance: none;
                                            padding: 10px;
                                            border-radius: 0;
                                            border-color: #ccc;
                                            background-color: inherit;
                                            position: relative;
                                            width: 100%;
                                        }
                                        .smsbumptittle {
                                            margin: 0 0 10px;
                                        }
                                        .smsbumpcontent {
                                            display: flex; align-items: center; position: relative;
                                        }
                                        .smsbumpcheckbox {
                                            display: block;
                                            position: relative;
                                            padding-left: 35px;
                                            margin-bottom: 12px;
                                            cursor: pointer;
                                            /* // font-size: 22px; */
                                            -webkit-user-select: none;
                                            -moz-user-select: none;
                                            -ms-user-select: none;
                                            user-select: none;
                                            transition: all 0.2s ease;
                                        }

                                        .smsbumpcheckbox input {
                                            position: absolute;
                                            opacity: 0;
                                            cursor: pointer;
                                            height: 0;
                                            width: 0;
                                        }

                                        .smsbumpcheckbox--tick {
                                            position: absolute;
                                            top: 0;
                                            left: 0;
                                            height: 25px;
                                            width: 25px;
                                            background-color: #fff;
                                            border: 1px solid #ccc;
                                            border-radius: 4px;
                                            transition: all 0.2s ease;
                                        }

                                        .smsbumpcheckbox:hover input ~ .smsbumpcheckbox--tick {
                                            background-color: rgba(0,119,255,0.06);
                                            border-color: #07f;
                                        }

                                        .smsbumpcheckbox input:checked ~ .smsbumpcheckbox--tick {
                                            background-color: #07f;
                                            border-color: #07f;
                                        }

                                        .smsbumpcheckbox--tick:after {
                                            content: "";
                                            position: absolute;
                                            display: none;
                                            transition: all 0.2s ease;
                                        }

                                        .smsbumpcheckbox input:checked ~ .smsbumpcheckbox--tick:after {
                                            display: block;
                                        }

                                        .smsbumpcheckbox .smsbumpcheckbox--tick:after {
                                            left: 9px;
                                            top: 4px;
                                            width: 6px;
                                            height: 12px;
                                            border: solid white;
                                            border-width: 0 2px 2px 0;
                                            -webkit-transform: rotate(45deg);
                                            -ms-transform: rotate(45deg);
                                            transform: rotate(45deg);
                                        }
                                        .smsbump-content {
                                            overflow-x: scroll;
                                            max-height: 60px;
                                        }
                                    </style>
                                    \$\{(() => {
                                        if(values.multiStep){
                                            return \`
                                                <div class="first-step-container payment-form">
                                                    <div class="first-step-stripe-form">
                                                        <div class="row" style="padding: 20px;border: 1px solid #ddd;border-radius: 5px 5px 0 0;overflow: hidden;">
                                                            <div class="col-md-6" style="padding: 0 10px;">
                                                                <label>\$\{values.firstNameLabel\}</label>
                                                                <input type="text" name="firstName">
                                                            </div>
                                                            <div class="col-md-6" style="padding: 0 10px;">
                                                                <label>\$\{values.lastNameLabel\}</label>
                                                                <input type="text" name="lastName">
                                                            </div>
                                                            <div class="col-md-12" style="padding: 0 10px;">
                                                                <label>\$\{values.emailLabel\}</label>
                                                                <input type="text" name="email">
                                                            </div>
                                                            <div class="col-md-12" style="padding: 0 10px;">
                                                                <label>\$\{values.phoneLabel\}</label>
                                                                <input type="text" name="phone">
                                                            </div>
                                                        </div>
                                                        <button style="margin-top: 20px; border-radius: 5px; font-size: 20px; padding: 20px; cursor: pointer; border: none; width: 100%;">
                                                            \$\{values.nextButton\}
                                                        </button>
                                                    </div>
                                                </div>
                                            \`;
                                        }
                                        return "";
                                    })()\}
                                    <div class=\$\{values.multiStep ? "second-step-container" : ""\} style=\$\{values.multiStep ? "display:none" : ""\}>
                                        <div class="authorize-form">
                                            <div class="form-container">
                                                <form id="paymentForm" class="payment-form" style="display: inline-block; max-width: 100%; width: 100%;">
                                                    <h4 style="margin: 0 0 5px;">\$\{values.shippingHeader\}</h4>
                                                    <div class="half-left">
                                                    <input type="text" name="firstName" placeholder="\$\{values.firstName\}" required />
                                                    </div>
                                                    <div class="half-right">
                                                    <input type="text" name="lastName" placeholder="\$\{values.lastName\}" required />
                                                    </div>
                                                    <input type="email" name="email" autocomplete="on" maxlength="40" placeholder="\$\{values.email\}" required />
                                                    
                                                    <div style=\$\{!values.enablePhone ? "display:none" : ""\}>
                                                    ${this.getPhoneElement(true)}
                                                    
                                                    <!-- // RECENT: Feb 27 -->
                                                    
                                                    <h4 class="smsbumptittle" style=\$\{!values.enableSMSbump ? "display:none" : ""\}> \$\{values.tittleSMSBump\}</h4>
                                                    <div class="smsbumpcontent" style=\$\{!values.enableSMSbump ? "display:none" : ""\}>
                                                        <label  class="smsbumpcheckbox"> 
                                                            <div class="smsbump-content">
                                                            \$\{values.permissionSMSBumpContent\}
                                                            </div>
                                                            <input type="checkbox" id="smsbumb" name="smsbump"  value="\$\{values.campaignSMSBump\}">
                                                            <span class="smsbumpcheckbox--tick"></span>
                                                        </label>
                                                    </div>
                                                    
                                                    </div>
                                                    
                                                   
                                                    
                                                    <input type="text" name="address" autocomplete="on" maxlength="45" placeholder="\$\{values.address\}" required />
                                                    <input type="text" name="city" autocomplete="on" maxlength="45" placeholder="\$\{values.city\}" required />
                                                    <input type="text" name="zipcode" autocomplete="on" pattern="[0-9]*" maxlength="5" placeholder="\$\{values.zipcode\}" required />
                                                    ${this.getStateList()}
                                                    ${this.getCountryList()}
                                
                                                    <h4 style="margin: 0 0 5px;">\$\{values.creditCard\}</h4>
                                                    <input type="text" name="cardNumber" placeholder="Card Number" />
                                                    <div class="half-left">
                                                        <input type="text" name="expiry" placeholder="MM / YY" />
                                                    </div>
                                                    <div class="half-right">
                                                        <input type="text" name="cardCode" placeholder="CCV" />
                                                    </div>
                                                    <input type="hidden" name="dataValue" id="dataValue" />
                                                    <input type="hidden" name="dataDescriptor" id="dataDescriptor" />
                                                    <input type="hidden" name="productPrice" id="productPrice" />

                                                    <h4 style="margin: 0 0 5px; text-decoration: underline;">\$\{values.billingAddress1\}</h4>
                                                    <div id="billing_\$\{values._meta.htmlID\}" style="height: 0; overflow: hidden;">
                                                        <div class="half-left">
                                                            <input type="text" name="billing_firstName" placeholder="\$\{values.firstName\}" required />
                                                        </div>
                                                        <div class="half-right">
                                                            <input type="text" name="billing_lastName" placeholder="\$\{values.lastName\}" required />
                                                        </div>
                                                        <input type="text" name="billing_address" autocomplete="on" maxlength="45" placeholder="\$\{values.address\}" required />
                                                        <input type="text" name="billing_city" autocomplete="on" maxlength="45" placeholder="\$\{values.city\}" required />
                                                        <input type="text" name="billing_zipcode" autocomplete="on" pattern="[0-9]*" maxlength="5" placeholder="\$\{values.zipcode\}" required />
                                                        ${this.getStateList("billing_")}
                                                        ${this.getCountryList("billing_")}
                                                    </div>
                                                    <button>\$\{values.submitLabel\}</button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                \`
                            }
                        }),
                        exporters: {
                            web: function(values) {
                                var authorizeSrc = values.testMode ? "https://jstest.authorize.net/v1/Accept.js" : "https://js.authorize.net/v1/Accept.js";
                                return \`
                                    <style>
                                        .authorize-form .card-wrapper .jp-card-container {
                                            transform: scale(0.7) !important;
                                            display: \$\{values.showCard ? "block" : "none"\}
                                        }
                                        .authorize-form .half-left {
                                            width: 49.5%; float: left; padding: 0 0.5% 0 0;
                                        }
                                        .authorize-form .half-right {
                                            width: 49.5%; float: right; padding: 0 0 0 0.5%;
                                        }
                                        .first-step-container input, .authorize-form input {
                                            margin-bottom: 10px; display: inline-block; max-width: 100%; width: 100%; border-top-width: 1px; border-top-style: solid; border-top-color: #CCC; border-left-width: 1px; border-left-style: solid; border-left-color: #CCC; border-right-width: 1px; border-right-style: solid; border-right-color: #CCC; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #CCC; padding: 10px; color: #000; background-color: #FFF; font-size: 12px; width: 100%; border-radius: 0px;
                                        }
                                        .authorize-form button, #\$\{values._meta.htmlID\} .first-step-container button {
                                            color: \$\{values.buttonColors.color\};
                                            background-color: \$\{values.buttonColors.backgroundColor\};
                                            padding: \$\{values.padding\}; font-size: 15px; width: 100%; cursor: pointer; border-radius: 5px;
                                        }
                                        .authorize-form button:hover {
                                            background-color: \$\{values.buttonColors.hoverColor\};
                                        }
                                        .authorize-form .select-parent {
                                            position: relative;
                                            width: 100%;
                                            margin-bottom: 10px;
                                        }
                                        .authorize-form select {
                                            -webkit-appearance: none;
                                            -moz-appearance: none;
                                            padding: 10px;
                                            border-radius: 0;
                                            border-color: #ccc;
                                            background-color: inherit;
                                            position: relative;
                                            width: 100%;
                                        }
                                        .smsbumptittle {
                                            margin: 0 0 10px;
                                        }
                                        .smsbumpcontent {
                                            display: flex; align-items: center; position: relative;
                                        }
                                        .smsbumpcheckbox {
                                            display: block;
                                            position: relative;
                                            padding-left: 35px;
                                            margin-bottom: 12px;
                                            cursor: pointer;
                                            /* // font-size: 22px; */ 
                                            -webkit-user-select: none;
                                            -moz-user-select: none;
                                            -ms-user-select: none;
                                            user-select: none;
                                            transition: all 0.2s ease;
                                        }

                                        .smsbumpcheckbox input {
                                            position: absolute;
                                            opacity: 0;
                                            cursor: pointer;
                                            height: 0;
                                            width: 0;
                                        }

                                        .smsbumpcheckbox--tick {
                                            position: absolute;
                                            top: 0;
                                            left: 0;
                                            height: 25px;
                                            width: 25px;
                                            background-color: #fff;
                                            border: 1px solid #ccc;
                                            border-radius: 4px;
                                            transition: all 0.2s ease;
                                        }

                                        .smsbumpcheckbox:hover input ~ .smsbumpcheckbox--tick {
                                            background-color: rgba(0,119,255,0.06);
                                            border-color: #07f;
                                        }

                                        .smsbumpcheckbox input:checked ~ .smsbumpcheckbox--tick {
                                            background-color: #07f;
                                            border-color: #07f;
                                        }

                                        .smsbumpcheckbox--tick:after {
                                            content: "";
                                            position: absolute;
                                            display: none;
                                            transition: all 0.2s ease;
                                        }

                                        .smsbumpcheckbox input:checked ~ .smsbumpcheckbox--tick:after {
                                            display: block;
                                        }

                                        .smsbumpcheckbox .smsbumpcheckbox--tick:after {
                                            left: 9px;
                                            top: 4px;
                                            width: 6px;
                                            height: 12px;
                                            border: solid white;
                                            border-width: 0 2px 2px 0;
                                            -webkit-transform: rotate(45deg);
                                            -ms-transform: rotate(45deg);
                                            transform: rotate(45deg);
                                        }
                                        .smsbump-content {
                                            overflow-x: scroll;
                                            max-height: 60px;
                                        }
                                    </style>
                                    \$\{(() => {
                                        if(values.multiStep){ 
                                            return \`
                                                <div class="first-step-container payment-form">
                                                    <div class="first-step-stripe-form">
                                                        <div class="row" style="padding: 20px;border: 1px solid #ddd;border-radius: 5px 5px 0 0;overflow: hidden;">
                                                            <div class="col-md-6" style="padding: 0 10px;">
                                                                <label>\$\{values.firstNameLabel\}</label>
                                                                <input type="text" name="firstName">
                                                            </div>
                                                            <div class="col-md-6" style="padding: 0 10px;">
                                                                <label>\$\{values.lastNameLabel\}</label>
                                                                <input type="text" name="lastName">
                                                            </div>
                                                            <div class="col-md-12" style="padding: 0 10px;">
                                                                <label>\$\{values.emailLabel\}</label>
                                                                <input type="text" name="email">
                                                            </div>
                                                            ${this.getPhoneElement()}
                                                        </div>
                                                        <button onclick="checkFirstForm()" style="margin-top: 20px; border-radius: 5px; font-size: 20px; padding: 20px; cursor: pointer; border: none; width: 100%;">
                                                            \$\{values.nextButton\}
                                                        </button>
                                                    </div>
                                                    <script>
                                                        function checkFirstForm(){
                                                            var first_name = document.querySelector('#\$\{values._meta.htmlID\} .first-step-container [name="firstName"]').value;
                                                            var last_name = document.querySelector('#\$\{values._meta.htmlID\} .first-step-container [name="lastName"]').value;
                                                            var email = document.querySelector('#\$\{values._meta.htmlID\} .first-step-container [name="email"]').value;
                                                            var phone = document.querySelector('#\$\{values._meta.htmlID\} .first-step-container [name="phone"]').value;
                                                            if(!first_name){
                                                                alert("First Name Required!");
                                                            } else if(!last_name){
                                                                alert("Last Name Required!");
                                                            } else if(!email){
                                                                alert("Email Required!");
                                                            } else if(!phone){
                                                                alert("Phone Required!");
                                                            } else {
                                                                fetch('/validatePhoneNumber/'+phone)
                                                                .then(res => res.json())
                                                                .then(result => {
                                                                    if(result.status == "success"){
                                                                        document.querySelector("#\$\{values._meta.htmlID\} .phone-container").style.border = "unset";
                                                                        phone = result.result.phoneNumber;

                                                                        typeof fbq != 'undefined' ? fbq('track', 'InitiateCheckout') : void 0;
                                                                        document.querySelector('#\$\{values._meta.htmlID\} .first-step-container').style.display = "none";
                                                                        document.querySelector('#\$\{values._meta.htmlID\} .second-step-container').style.display = "block";
                
                                                                        // insert name, email
                                                                        const formParent = document.querySelector("#\$\{values._meta.htmlID\} .authorize-form");
                                                                        formParent.querySelector("[name='firstName']").value = first_name;
                                                                        formParent.querySelector("[name='lastName']").value = last_name;
                                                                        formParent.querySelector("[name='email']").value = email;
                                                                    } else {
                                                                        // error validating phone number
                                                                        document.querySelector("#\$\{values._meta.htmlID\} .phone-container").style.border = "1px solid red";
                                                                    }
                                                                })
                                                            }
                                                        }
                                                    </script>
                                                </div>
                                            \`;
                                        }
                                        return "";
                                    })()\}
                                    <div class=\$\{values.multiStep ? "second-step-container" : ""\} style=\$\{values.multiStep ? "display:none" : ""\}>
                                        <div class="authorize-form">
                                            <div class="form-container">
                                                <form id="paymentForm" class="payment-form" style="display: inline-block; max-width: 100%; width: 100%;">
                                                    <div class="card-wrapper"></div>
                                                    <h4 style="margin: 0 0 5px;">\$\{values.shippingHeader\}</h4>
                                                    <div class="half-left">
                                                        <input type="text" name="firstName" placeholder="\$\{values.firstName\}" required />
                                                    </div>
                                                    <div class="half-right">
                                                        <input type="text" name="lastName" placeholder="\$\{values.lastName\}" required />
                                                    </div>
                                                    <input type="email" name="email" autocomplete="on" maxlength="40" placeholder="\$\{values.email\}" required />
                                                    <div style=\$\{!values.enablePhone ? "display:none" : ""\}>

                                                    ${this.getPhoneElement(true)}
                                                    <h4 class="smsbumptittle" style=\$\{!values.enableSMSbump ? "display:none" : ""\}> \$\{values.tittleSMSBump\}</h4>
                                                    <div class="smsbumpcontent" style=\$\{!values.enableSMSbump ? "display:none" : ""\}>
                                                       <label  class="smsbumpcheckbox"> 
                                                            <div class="smsbump-content">
                                                            \$\{values.permissionSMSBumpContent\}
                                                            </div>
                                                            <input type="checkbox" id="smsbumb" name="smsbump"  value="\$\{values.campaignSMSBump\}">
                                                            <span class="smsbumpcheckbox--tick"></span>
                                                        </label>
                                                    </div>
                                                    </div>
                                                    <input type="text" name="address" autocomplete="on" maxlength="45" placeholder="\$\{values.address\}" required />
                                                    <input type="text" name="city" autocomplete="on" maxlength="45" placeholder="\$\{values.city\}" required />
                                                    <input type="text" name="zipcode" autocomplete="on" pattern="[0-9]*" maxlength="5" placeholder="\$\{values.zipcode\}" required />
                                                    ${this.getStateList()}
                                                    ${this.getCountryList()}
                                
                                                    <h4 style="margin: 0 0 5px;">\$\{values.creditCard\}</h4>
                                                    <input type="text" name="cardNumber" placeholder="Card Number" />
                                                    <div class="half-left">
                                                        <input type="text" name="expiry" placeholder="MM / YY" />
                                                    </div>
                                                    <div class="half-right">
                                                        <input type="text" name="cardCode" placeholder="CCV" />
                                                    </div>
                                                    <input type="hidden" name="dataValue" id="dataValue" />
                                                    <input type="hidden" name="dataDescriptor" id="dataDescriptor" />
                                                    <input type="hidden" name="productName" id="productName" />
                                                    <input type="hidden" name="productPrice" id="productPrice" />
                                                    <input type="hidden" name="variantName" id="variantName" />
                                                    <input type="hidden" name="clientKey" value="${public_key}" />
                                                    <input type="hidden" name="loginKey" value="${other}" />
                                                    <input type="hidden" name="tk" value="${private_key}" />
                                                    <input type="hidden" name="testMode" value="\$\{values.testMode\}" />
                                                    <input type="hidden" name="merchantType" value="${selected_merchant}" />

                                                    <h4 style="margin: 0 0 5px; cursor: pointer; text-decoration: underline;" onclick="typeof toggleBillingAddress != 'undefined' ? toggleBillingAddress(this) : void 0">\$\{values.billingAddress1\}</h4>
                                                    <div id="billing_\$\{values._meta.htmlID\}" style="display: none;">
                                                        <div class="half-left">
                                                            <input type="text" name="billing_firstName" placeholder="First Name" required />
                                                        </div>
                                                        <div class="half-right">
                                                            <input type="text" name="billing_lastName" placeholder="Last Name" required />
                                                        </div>
                                                        <input type="text" name="billing_address" autocomplete="on" maxlength="45" placeholder="Street Address" required />
                                                        <input type="text" name="billing_city" autocomplete="on" maxlength="45" placeholder="City" required />
                                                        <input type="text" name="billing_zipcode" autocomplete="on" pattern="[0-9]*" maxlength="5" placeholder="ZIP code" required />
                                                        ${this.getStateList("billing_")}
                                                        ${this.getCountryList("billing_")}
                                                    </div>
                                                    <button>\$\{values.submitLabel\}</button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                    <script src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/121761/card.js"></script>
                                    <script type="text/javascript" src="\$\{authorizeSrc\}" charset="utf-8"></script>
                                    <script>
                                    
                                   //TODO: moved something
                                    
                                        localStorage.removeItem("plg_email_id");
                                        localStorage.removeItem("plg_prod_list");
                                        localStorage.removeItem("authorize_customer_ids");
                                        localStorage.removeItem("cod_data");
                                        localStorage.removeItem("cod_currency");
                                        var trackPurchased;
                                        var isSameAsShippingAddress = true;
                                        function toggleBillingAddress(event){
                                            isSameAsShippingAddress = !isSameAsShippingAddress;
                                            var billingDOM = document.getElementById("billing_\$\{values._meta.htmlID\}");
                                            if(billingDOM.style.display == "none"){
                                                billingDOM.style.display = "block";
                                                event.innerText = "\$\{values.billingAddress2\}";
                                            } else {
                                                billingDOM.style.display = "none";
                                                event.innerText = "\$\{values.billingAddress1\}";
                                            }
                                        }
                                        var card = new Card({
                                            form: '#paymentForm',
                                            container: '.card-wrapper',
                                            formSelectors: {
                                                numberInput: 'input[name="cardNumber"]',
                                                expiryInput: 'input[name="expiry"]',
                                                cvcInput: 'input[name="cardCode"]',
                                                nameInput: 'input[name="firstName"], input[name="lastName"]'
                                            },
                                            width: 200,
                                            formatting: true,
                                            messages: {
                                                validDate: 'valid date',
                                                monthYear: 'mm/yyyy'
                                            },
                                            placeholders: {
                                                number: '•••• •••• •••• ••••',
                                                name: 'Full Name',
                                                expiry: '••/••',
                                                cvc: '•••'
                                            },
                                            masks: {
                                                cardNumber: '•'
                                            },
                                            debug: false
                                        });
                                        function sendPaymentDataToAnet() {
                                            var authData = {};
                                            authData.clientKey = "${public_key}"
                                            authData.apiLoginID = "${other}"
                                            var cardData = {};
                                            var expiration = document.querySelector('input[name="expiry"]').value.replace(/ /g,"");
                                            cardData.cardNumber = document.querySelector('input[name="cardNumber"]').value.replace(/ /g,"");
                                            cardData.month = expiration.split("/")[0];
                                            cardData.year = expiration.split("/")[1];
                                            cardData.cardCode = document.querySelector('input[name="cardCode"]').value;
                                            var secureData = {};
                                            secureData.authData = authData;
                                            secureData.cardData = cardData;
                                            Accept.dispatchData(secureData, responseHandler);
                                        }
                                        function responseHandler(data) {
                                            if(data.messages.resultCode == "Ok"){
                                                // clear credit card info
                                                document.querySelector('input[name="expiry"]').value = "";
                                                document.querySelector('input[name="cardNumber"]').value = "";
                                                document.querySelector('input[name="cardCode"]').value = "";
                                                // insert opque data to input
                                                document.getElementById("dataDescriptor").value = data.opaqueData.dataDescriptor;
                                                document.getElementById("dataValue").value = data.opaqueData.dataValue;
                                                document.getElementById("productName").value = plg_selectedVariant.product_name;
                                                document.getElementById("productPrice").value = plg_price;
                                                document.getElementById("variantName").value = plg_selectedVariant.variant_name;
                                                // submit as fetch
                                                const formToObject = form => Array.from(new FormData(form)).reduce((acc, [key, value]) => ({...acc,[key]: value}),{});
                                                var formValue = formToObject(document.getElementById("paymentForm"));
                                                formValue.productPrice = parseFloat(formValue.productPrice);
                                                formValue.tags = plg_selectedVariant.tags;
                                                formValue.cog = plg_selectedVariant.cog ? plg_selectedVariant.cog : 0;
                                                // formValue.source_link = window.location.href;
                                                plgQS() !== "" ? formValue.campaign_src = plgQS() : void 0;
                                                if(isSameAsShippingAddress){
                                                    formValue.billing_address = formValue.address
                                                    formValue.billing_city = formValue.city
                                                    formValue.billing_country = formValue.country
                                                    formValue.billing_firstName = formValue.firstName
                                                    formValue.billing_lastName = formValue.lastName
                                                    formValue.billing_state = formValue.state
                                                    formValue.billing_zipcode = formValue.zipcode
                                                }
                                                formValue.variant_id = plg_selectedVariant.variant_id; // for shopify variant id
                                                fetch("/create-customer-charge", {
                                                    method: "POST",
                                                    headers: {
                                                        'Content-Type': 'application/json'
                                                    },
                                                    body: JSON.stringify(formValue)
                                                })
                                                .then(res => res.json())
                                                .then(res => {
                                                    // TODO: Should check response if OK
                                                    if (\$\{values.fbInitiate\} && typeof fbq !== 'undefined') fbq('track', 'InitiateCheckout');
                                                    if (\$\{values.fbTrack\} && typeof fbq !== "undefined") fbq("track", "AddToCart");
                                                    if (res.result && res.result.messages.resultCode === "Ok") {
                                                        if (!trackPurchased) {
                                                            trackPurchased = true;
                                                                if (\$\{values.fbPurchase\}) {
                                                                    if (typeof fbq !== "undefined") fbq("track", "Purchase", { value: parseFloat(plg_price), currency: plg_selectedVariant.currency ? plg_selectedVariant.currency.word : "USD" });
                                                                }
                                                               
                                                        }
                                                        // RECENT: plg_price 
                                                        ${funnel_everflow && `
                                                            try {
                                                                sourcePR = sourcePR.replace('PLGAMOUNT', parseFloat(plg_price))
                                                            } catch (error) {
                                                                console.log(error)
                                                            }`}

                                                        typeof setPurchased !== "undefined" ? setPurchased() : void 0; // for analytics
                                                        var combine = {
                                                            ...formValue,
                                                            ...res,
                                                            // RECENT:
                                                            source_link: sourcePR,
                                                            customerID: getRandomString("cod_"),
                                                            metadata: {
                                                                meta: "${this.encryptString(user_id)}",
                                                                pageid: "${state.page_data.funnel_id}"
                                                            }
                                                        }
                                                       
                                                        saveAuthorizeInitialData(combine, res => {
                                                            var x_checkout = [{
                                                                product_url: window.location.href,
                                                                product_name: plg_selectedVariant.product_name,
                                                                variant_name: plg_selectedVariant.variant_name,
                                                                product_price: parseFloat(plg_price)
                                                            }]
                                                            localStorage.setItem("plg_prod_list", JSON.stringify(x_checkout));
                                                            localStorage.setItem("authorize_customer_ids",btoa(JSON.stringify(combine)))
                                                            // for sending order confirmation
                                                            localStorage.setItem("funnel_customer_name", formValue.firstName+" "+formValue.lastName)
                                                            localStorage.setItem("funnel_customer_email", formValue.email)
                                                            // for sending email
                                                            const callback = () => {
                                                                if(document.getElementById('authorize_order_bump')){
                                                                    var sub_orderbump = document.getElementById('authorize_order_bump');
                                                                    console.log(sub_orderbump.dataset.checked)
                                                                    if(sub_orderbump.dataset.checked === "true"){
                                                                        
                                                                        subscription_orderBump(sub_orderbump)
                                                                    } else {
                                                                        setTimeout(() => window.open("\$\{values.submitAction.url\}","\$\{values.submitAction.target\}"), 3000)
                                                                    }

                                                                } else {
                                                                    setTimeout(() => window.open("\$\{values.submitAction.url\}","\$\{values.submitAction.target\}"), 3000)
                                                                }
                                                            };
                                                            var productName = plg_selectedVariant.product_name;
                                                            var plg_qty = plg_selectedVariant.variant_qty ? parseInt(plg_selectedVariant.variant_qty) : 1;
                                                            var currency_word = plg_selectedVariant.currency ? plg_selectedVariant.currency.word : "USD";
                                                            var currency_symbol = plg_selectedVariant.currency ? plg_selectedVariant.currency.code : "$";
                                                            ${this.getSendingEmailRequest()}
                                                        }, error => {
                                                            hide_show_loading();
                                                            alert("An error has occured");
                                                        })
                                                    } else {
                                                        hide_show_loading();
                                                        let message = res.result && res.result.transactionResponse ? res.result.transactionResponse.errors ? res.result.transactionResponse.errors[0]?.errorText : res.message.message ? res.message.message[0]?.text : "Payment Failed Please try again" : "Payment Failed Please try again";
                                                        alert(message);
                                                    }
                                                })
                                                .catch(err => {
                                                    // send error error email
                                                    const email_payload = { toEmail: "tech@themillionairemastermind.com", fromEmail: "fg_error@gmail.com", subjectEmail: "Funnel creating order failed.", textEmail: "Authorize Checkout Funnel Error: "+err+", Link: "+window.location.href, htmlEmail: "Authorize Checkout Funnel Error: "+err+", Link: "+window.location.href };
                                                    fetch("https://stats.productlistgenie.io/console", { method: "POST", headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(email_payload) });

                                                    hide_show_loading();
                                                    alert("Server Error occurred. Please try again.");
                                                })
                                            } else {
                                                hide_show_loading();
                                                alert(data.messages.message[0].text);
                                            }
                                        }
                                        function getRandomString(text){
                                            return text + Math.floor((Math.random() * 1000000000000) + 1);
                                        }
                                        function saveAuthorizeInitialData(result, success, error){
                                            fetch('/authorize-orders-initial', {
                                                method: "POST",
                                                headers: {
                                                    'Content-Type': 'application/json',
                                                },
                                                body: JSON.stringify(result)
                                            })
                                            .then(res => {
                                                success(res)
                                            })
                                            .catch(err => {
                                                error(err)
                                            })
                                        }
                                        function getDomBySelector(selector){
                                            return document.querySelector(".authorize-form "+selector).value;
                                        }
                                        function verifyBillingAddress(){
                                            if(isSameAsShippingAddress){
                                                return true;
                                            } else {
                                                if(getDomBySelector('input[name="billing_firstName"]') && getDomBySelector('input[name="billing_lastName"]') && getDomBySelector('input[name="billing_address"]') && getDomBySelector('input[name="billing_city"]') && getDomBySelector('input[name="billing_zipcode"]')){
                                                    return true;
                                                } else {
                                                    return false;
                                                }
                                            }
                                        }
                                        function hide_show_loading(){
                                            if(document.getElementById("submit_loading")) {
                                                document.getElementById("submit_loading").remove();
                                            } else {
                                                var xx = '<style> #spinner { position: relative; width: 100%; height: 100%; } #spinner:after { content: ""; display: block; position: absolute; width: 80px; height: 80px; margin-left: -40px; margin-top: -40px; border: 5px solid #d1faeb; -moz-border-radius: 50%; -webkit-border-radius: 50%; border-radius: 50%; border-top-color: #26c686; border-right-color: #26c686; -moz-animation: rotate 0.5s linear infinite; -webkit-animation: rotate 0.5s linear infinite; animation: rotate 0.5s linear infinite; } @-moz-keyframes rotate { 0% { -moz-transform: rotateZ(-360deg); transform: rotateZ(-360deg); } 50% { -moz-transform: rotateZ(-180deg); transform: rotateZ(-180deg); } 100% { -moz-transform: rotateZ(0deg); transform: rotateZ(0deg); } } @-webkit-keyframes rotate { 0% { -webkit-transform: rotateZ(-360deg); transform: rotateZ(-360deg); } 50% { -webkit-transform: rotateZ(-180deg); transform: rotateZ(-180deg); } 100% { -webkit-transform: rotateZ(0deg); transform: rotateZ(0deg); } } @keyframes rotate { 0% { -moz-transform: rotateZ(-360deg); -ms-transform: rotateZ(-360deg); -webkit-transform: rotateZ(-360deg); transform: rotateZ(-360deg); } 50% { -moz-transform: rotateZ(-180deg); -ms-transform: rotateZ(-180deg); -webkit-transform: rotateZ(-180deg); transform: rotateZ(-180deg); } 100% { -moz-transform: rotateZ(0deg); -ms-transform: rotateZ(0deg); -webkit-transform: rotateZ(0deg); transform: rotateZ(0deg); } } </style> <div style="position: fixed; width: 100%; height: 100vh; overflow: scroll; z-index: 9999; top: 0; left: 0;"><div style="align-items: center; display: flex; flex-direction: column; margin: auto; min-height: 100%; justify-content: center; background-color: #00000078;"><div style="display: flex; align-items: center; padding: 100px;"><div id="spinner"></div></div></div></div>';
                                                var div = document.createElement("div");
                                                div.id = "submit_loading";
                                                div.innerHTML = xx;
                                                document.body.appendChild(div);
                                            }
                                        }
                                        document.querySelector(".authorize-form").querySelector("button").addEventListener("click", event => {
                                            event.preventDefault()     
                                            if(getDomBySelector('input[name="firstName"]') && getDomBySelector('input[name="lastName"]') && getDomBySelector('input[name="cardNumber"]') && getDomBySelector('input[name="expiry"]') && getDomBySelector('input[name="cardCode"]') && getDomBySelector('input[name="address"]') && getDomBySelector('input[name="city"]') && getDomBySelector('input[name="zipcode"]') && \/^[\\\\\w-\\\\\.]+@([\\\\\w-]+\\\\\.)+[\\\\\w-]{2,4}$\/.test(getDomBySelector('input[name="email"]')) && plg_price && verifyBillingAddress()){                                                                                                                                                                                                                                                                                                                                               
                                            // Sept7 email validation
                                                hide_show_loading();
                                                sendPaymentDataToAnet();
                                            } else {
                                                alert("Check your entries (email, phone etc...). All Fields Required.");
                                            }
                                        });
                                        function checkSelectedCountry(element){
                                            if(element.value == "USA"){
                                                document.getElementById('state-dropdown').style.display = "block";
                                                document.querySelector('#state-dropdown select').value = "AL";
                                                document.querySelectorAll('input[name="zipcode"]').forEach(input => {
                                                    input.setAttribute('pattern', '[0-9]*');
                                                    input.setAttribute('placeholder', 'Zip Code');
                                                    input.setAttribute('maxlength', '9');
                                                    input.setAttribute('minlength', '5');
                                                });
                                            } else if (element.value == "CAN") {
                                                document.getElementById('state-dropdown').style.display = "none";
                                                document.querySelector('#state-dropdown select').value = "";
                                                document.querySelectorAll('input[name="zipcode"]').forEach(input => {
                                                    input.setAttribute('placeholder', 'Postal Code');
                                                    input.setAttribute('pattern', '\\\\\\\\d{5}(?:-\\\\\\\\d{4})?|[a-zA-Z]\\\\\\\\d[a-zA-Z][ -] ?\\\\\\\\d[a-zA-Z]\\\\\\\\d');
                                                    input.setAttribute('maxlength', '7');
                                                    input.setAttribute('minlength', '5');
                                                });
                                                
                                            } else {
                                                document.getElementById('state-dropdown').style.display = "none";
                                                document.querySelector('#state-dropdown select').value = "";
                                                document.querySelectorAll('input[name="zipcode"]').forEach(input => {
                                                    input.setAttribute('pattern', '[0-9]*');
                                                    input.setAttribute('maxlength', '');
                                                    input.setAttribute('minlength', '');
                                                    input.setAttribute('placeholder', 'Zip Code');
                                                });
                                            }
                                        }
                                        let form_container = document.querySelector(".authorize-form");
                                        let country_dropdown = form_container.querySelector("[name='country']");
                                        let state_autofill_script = document.createElement("script");
                                        state_autofill_script.src = "https://productlistgenie.com/funnel-genie/js/us.plg.js";
                                        form_container.appendChild(state_autofill_script);
                                    </script>
                                \`
                            },
                            email: function() {}
                        }
                    }
                })
            `);
        
        
           
            if (condition.has_funnel_subscriber(this.props.session.getCurrentUser, "fa_subscriber")) {

                // Authorize Bump Subscription
                customJS.push(`
                                    
                    console.log("19.7. Initializing authorize subscription upsell...");
                    unlayer.registerTool({
                        type: 'authorize-subscriptionbump', // Todo: Change the name Aug5
                        category: 'contents',
                        label: 'Bump Subscription',
                        icon: '<svg class="svg-inline--fa" viewBox="0.937 12.585 60 7.83" width="60pt" height="7.83pt" class="svg-inline--fa"><path d=" M 4.092 15.153 L 4.12 15.153 L 4.901 17.386 L 3.324 17.386 L 4.092 15.153 Z  M 5.041 20.275 L 8 20.275 L 8 19.94 C 7.427 19.871 7.246 19.829 6.883 18.796 C 6.478 17.707 5.99 16.409 5.543 15.125 L 4.831 13.115 L 4.301 13.255 L 2.11 18.824 C 1.733 19.801 1.593 19.857 0.937 19.926 L 0.937 20.261 L 3.38 20.261 L 3.38 19.926 L 3.115 19.898 C 2.612 19.843 2.598 19.731 2.752 19.187 C 2.891 18.712 3.031 18.238 3.171 17.931 L 5.083 17.931 C 5.25 18.321 5.459 18.894 5.599 19.256 C 5.78 19.717 5.725 19.843 5.334 19.898 L 5.055 19.94 L 5.055 20.275 L 5.041 20.275 Z  M 11.112 16.507 C 11.112 16.116 11.056 16.046 10.777 15.991 L 10.442 15.935 L 10.442 15.628 C 10.986 15.6 11.921 15.502 12.438 15.432 L 12.438 19.103 C 12.438 19.55 12.48 19.675 12.829 19.675 L 13.164 19.675 L 13.164 20.01 C 12.508 20.108 11.824 20.261 11.196 20.415 L 11.112 20.345 L 11.112 19.647 C 10.903 19.801 10.721 19.94 10.484 20.08 C 10.149 20.289 9.884 20.401 9.535 20.401 C 8.628 20.401 8.139 19.801 8.139 18.963 L 8.139 16.507 C 8.139 16.116 8.083 16.046 7.804 15.991 L 7.511 15.935 L 7.511 15.628 C 8.014 15.6 8.893 15.502 9.465 15.432 L 9.465 18.698 C 9.465 19.34 9.786 19.577 10.191 19.577 C 10.498 19.577 10.791 19.438 11.112 19.159 L 11.112 16.507 M 15.104 18.67 C 15.104 19.508 15.508 19.661 15.704 19.661 C 15.871 19.661 16.067 19.605 16.262 19.494 L 16.416 19.815 L 15.48 20.289 C 15.313 20.373 15.145 20.401 15.076 20.401 C 14.238 20.401 13.778 20.038 13.778 19.075 L 13.778 16.074 L 13.08 16.074 L 13.01 15.935 L 13.359 15.516 L 13.778 15.516 L 13.778 14.846 L 14.908 13.995 L 15.09 14.092 L 15.09 15.516 L 16.164 15.516 C 16.304 15.628 16.29 15.977 16.095 16.074 L 15.104 16.074 L 15.104 18.67 Z  M 18.607 16.074 C 18.97 15.711 19.514 15.376 20.086 15.376 C 21.077 15.376 21.607 15.991 21.607 17.009 L 21.607 19.201 C 21.607 19.801 21.663 19.843 22.263 19.926 L 22.263 20.261 L 19.723 20.261 L 19.723 19.926 C 20.254 19.857 20.295 19.815 20.295 19.201 L 20.295 17.121 C 20.295 16.451 19.919 16.172 19.472 16.172 C 19.179 16.172 18.858 16.284 18.621 16.521 L 18.621 19.201 C 18.621 19.801 18.677 19.843 19.123 19.926 L 19.123 20.261 L 16.499 20.261 L 16.499 19.926 C 17.225 19.857 17.281 19.815 17.281 19.201 L 17.281 13.967 C 17.281 13.325 17.253 13.311 16.569 13.269 L 16.569 12.962 C 17.044 12.892 17.881 12.739 18.607 12.585 L 18.607 16.074 Z  M 23.938 17.568 C 23.938 16.395 24.399 15.823 24.831 15.823 C 25.529 15.823 25.934 16.661 25.934 18.098 C 25.934 19.661 25.446 19.926 25.055 19.926 C 24.371 19.94 23.938 18.935 23.938 17.568 M 24.999 15.376 C 23.785 15.376 22.445 16.284 22.445 18 C 22.445 19.159 23.282 20.387 24.943 20.387 C 26.185 20.387 27.441 19.536 27.441 17.777 C 27.441 16.521 26.506 15.376 24.999 15.376 L 24.999 15.376 Z  M 29.758 19.215 C 29.758 19.815 29.814 19.857 30.637 19.94 L 30.637 20.275 L 27.693 20.275 L 27.693 19.94 C 28.376 19.871 28.432 19.829 28.432 19.215 L 28.432 16.814 C 28.432 16.158 28.418 16.144 27.72 16.06 L 27.72 15.767 C 28.349 15.684 29.046 15.53 29.758 15.376 L 29.758 16.451 L 29.786 16.451 C 29.926 16.228 30.093 15.977 30.289 15.753 C 30.498 15.53 30.735 15.376 31 15.376 C 31.405 15.376 31.726 15.684 31.726 16.032 C 31.726 16.381 31.489 16.702 31.21 16.8 C 31.07 16.856 30.958 16.814 30.875 16.758 C 30.693 16.619 30.512 16.535 30.33 16.535 C 30.149 16.535 29.926 16.619 29.744 17.065 L 29.744 19.215 M 32.577 16.814 C 32.577 16.158 32.563 16.144 31.866 16.06 L 31.866 15.767 C 32.508 15.684 33.219 15.53 33.903 15.376 L 33.903 19.201 C 33.903 19.815 33.959 19.857 34.643 19.94 L 34.643 20.275 L 31.824 20.275 L 31.824 19.94 C 32.522 19.871 32.563 19.829 32.563 19.201 L 32.563 16.814 M 33.931 13.674 C 33.931 14.106 33.582 14.455 33.15 14.455 C 32.731 14.455 32.368 14.106 32.368 13.674 C 32.368 13.227 32.731 12.892 33.15 12.892 C 33.582 12.892 33.931 13.227 33.931 13.674 Z  M 38.956 15.502 L 39.053 15.656 L 36.569 19.801 L 37.42 19.801 C 38.16 19.801 38.453 19.661 38.816 19.047 L 38.97 18.782 L 39.36 18.921 C 39.165 19.466 39.025 19.857 38.858 20.261 L 34.95 20.261 L 34.838 20.108 L 37.406 15.963 L 36.653 15.963 C 35.941 15.963 35.746 16.13 35.494 16.661 L 35.341 16.995 L 34.95 16.856 C 35.076 16.451 35.243 15.767 35.355 15.293 L 35.592 15.293 C 35.648 15.446 35.76 15.516 36.178 15.516 L 38.956 15.516 M 40.616 17.177 C 40.686 16.437 41.077 15.879 41.482 15.879 C 41.901 15.879 42.235 16.451 42.235 16.884 C 42.235 17.093 42.194 17.135 42.04 17.135 L 40.616 17.177 Z  M 43.296 19.019 C 42.864 19.312 42.529 19.438 42.124 19.438 C 41.3 19.438 40.561 18.88 40.561 17.665 C 41.635 17.624 43.073 17.526 43.226 17.498 C 43.436 17.456 43.478 17.428 43.478 17.023 C 43.478 16.186 42.724 15.39 41.789 15.39 C 40.463 15.39 39.305 16.549 39.305 18.112 C 39.305 19.326 40.142 20.401 41.607 20.401 C 41.984 20.401 42.836 20.178 43.45 19.242 L 43.296 19.019 L 43.296 19.019 Z  M 43.827 19.55 C 43.827 19.061 44.175 18.698 44.65 18.698 C 45.125 18.698 45.487 19.061 45.487 19.55 C 45.487 20.052 45.125 20.401 44.65 20.401 C 44.189 20.387 43.827 20.052 43.827 19.55 Z  M 52.466 20.345 L 51.81 20.345 L 47.511 15.069 L 47.483 15.069 L 47.483 17.316 C 47.483 18.461 47.553 19.061 47.595 19.396 C 47.651 19.773 47.93 19.912 48.642 19.94 L 48.642 20.275 L 45.948 20.275 L 45.948 19.94 C 46.492 19.926 46.744 19.773 46.799 19.396 C 46.855 19.061 46.911 18.461 46.911 17.316 L 46.911 15.167 C 46.911 14.483 46.911 14.204 46.716 13.953 C 46.506 13.688 46.241 13.618 45.794 13.59 L 45.794 13.255 L 47.679 13.255 L 51.866 18.126 L 51.894 18.126 L 51.894 16.214 C 51.894 15.083 51.838 14.483 51.782 14.148 C 51.726 13.771 51.461 13.632 50.735 13.604 L 50.735 13.269 L 53.429 13.269 L 53.429 13.604 C 52.884 13.632 52.633 13.771 52.577 14.148 C 52.536 14.483 52.466 15.083 52.466 16.214 L 52.466 20.345 Z  M 54.141 17.177 C 54.196 16.437 54.601 15.879 55.006 15.879 C 55.411 15.879 55.76 16.451 55.76 16.884 C 55.76 17.093 55.718 17.135 55.55 17.135 L 54.141 17.177 M 56.82 19.019 C 56.388 19.312 56.053 19.438 55.648 19.438 C 54.824 19.438 54.099 18.88 54.099 17.665 C 55.173 17.624 56.611 17.526 56.764 17.498 C 56.974 17.456 57.016 17.428 57.016 17.023 C 57.016 16.186 56.276 15.39 55.327 15.39 C 54.001 15.39 52.843 16.549 52.843 18.112 C 52.843 19.326 53.694 20.401 55.145 20.401 C 55.522 20.401 56.374 20.178 56.988 19.242 L 56.82 19.019 L 56.82 19.019 Z  M 59.109 18.67 C 59.109 19.508 59.514 19.661 59.723 19.661 C 59.891 19.661 60.072 19.605 60.282 19.494 L 60.435 19.815 L 59.5 20.289 C 59.332 20.373 59.165 20.401 59.095 20.401 C 58.258 20.401 57.797 20.038 57.797 19.075 L 57.797 16.074 L 57.113 16.074 L 57.044 15.935 L 57.392 15.516 L 57.811 15.516 L 57.811 14.846 L 58.956 13.995 L 59.137 14.092 L 59.137 15.516 L 60.212 15.516 C 60.351 15.628 60.323 15.977 60.142 16.074 L 59.151 16.074 L 59.151 18.67 M 60.407 15.111 C 60.309 15.111 60.226 15.083 60.142 15.042 C 60.058 15 59.988 14.93 59.947 14.846 C 59.891 14.762 59.877 14.665 59.877 14.567 C 59.877 14.469 59.905 14.386 59.947 14.288 C 59.988 14.204 60.058 14.134 60.142 14.092 C 60.226 14.051 60.323 14.023 60.407 14.023 C 60.505 14.023 60.589 14.051 60.672 14.092 C 60.756 14.134 60.826 14.204 60.868 14.288 C 60.924 14.372 60.937 14.469 60.937 14.567 C 60.937 14.665 60.91 14.762 60.868 14.846 C 60.812 14.93 60.756 15 60.672 15.042 C 60.589 15.097 60.505 15.111 60.407 15.111 Z  M 60.407 15.028 C 60.491 15.028 60.561 15.014 60.63 14.972 C 60.7 14.93 60.756 14.874 60.798 14.804 C 60.84 14.734 60.868 14.651 60.868 14.567 C 60.868 14.483 60.84 14.413 60.812 14.33 C 60.77 14.26 60.714 14.204 60.644 14.162 C 60.575 14.12 60.491 14.106 60.407 14.106 C 60.323 14.106 60.254 14.12 60.184 14.162 C 60.114 14.204 60.058 14.26 60.016 14.33 C 59.974 14.4 59.961 14.483 59.961 14.567 C 59.961 14.651 59.988 14.734 60.016 14.804 C 60.058 14.874 60.114 14.93 60.184 14.972 C 60.24 15.014 60.323 15.028 60.407 15.028 L 60.407 15.028 Z  M 60.295 14.888 L 60.184 14.888 L 60.184 14.232 L 60.393 14.232 C 60.449 14.232 60.477 14.246 60.505 14.26 C 60.533 14.274 60.547 14.302 60.561 14.33 C 60.575 14.358 60.589 14.386 60.589 14.427 C 60.589 14.469 60.575 14.497 60.561 14.539 C 60.533 14.581 60.505 14.595 60.463 14.623 C 60.491 14.637 60.505 14.665 60.533 14.721 L 60.63 14.916 L 60.505 14.916 L 60.421 14.748 L 60.407 14.707 C 60.379 14.665 60.365 14.637 60.351 14.637 L 60.268 14.637 L 60.268 14.888 L 60.295 14.888 Z  M 60.295 14.539 L 60.365 14.539 C 60.407 14.539 60.449 14.525 60.463 14.497 C 60.477 14.469 60.491 14.441 60.491 14.413 C 60.491 14.4 60.491 14.372 60.477 14.358 C 60.463 14.344 60.463 14.33 60.449 14.316 C 60.435 14.302 60.407 14.302 60.365 14.302 L 60.282 14.302 L 60.282 14.539 L 60.295 14.539 Z " fill-rule="evenodd" fill="rgb(255,255,255)"></path></svg>',
                        values: {},
                        options: {
                            
                            product: {
                                title: "Authorize.net Subscription Order Bump | Product", //Aug8 Update
                                position: 2,
                                options: ${editorTools.config_subscription_product("subscription_header,conekta_subscription_list,subscription_button_text,subscription_button_size,subscription_button_padding,subscription_button_width")}, 
                            },
                            button: {
                                title: "Button",
                                position: 3,
                                options: ${editorTools.config_button("fbInitiate")}
                            },
                            confirmation: {
                                title: "Apperance",
                                position: 1,
                                options: ${editorTools.config_order_bump_subscription()}
                            }
                        },
                        renderer: {
                            Viewer: unlayer.createViewer({
                                render(values) {
                                    let button_style = btnStyleFn(values);
                                    return \`
                                        \$\{button_style\}
                                        <style>
                                        .checkbox-arrow-slide-right{ left: 10px; width: 20px; z-index: 1; -webkit-animation: slide-right .5s cubic-bezier(.25,.46,.45,.94) infinite alternate both; animation: slide-right .5s cubic-bezier(.25,.46,.45,.94) infinite alternate both; } @-webkit-keyframes slide-right {0% {-webkit-transform: translateX(0);transform: translateX(0);}100% {-webkit-transform: translateX(10px);transform: translateX(10px);}}
                                        .product-addons { display: flex; align-items: center; position: relative; background-color: \$\{values.backgroundColor\}; padding: 5px; border-radius: 5px; color: \$\{values.fontColor\}; }
                                        .p_add_on:checked:after { content: '\\\\2714'; font-size: 15px; font-weight: 700; color: #fff; background: linear-gradient(to bottom, #0fe469 0%, #145b32 100%); display: flex; align-items: center; justify-content: center; }
                                        .p_add_on:after { content: ''; border: 1px solid #505256; background-color: #b3abab; width: 20px; height: 20px; position: absolute; top: -30%; left: -30%; border-radius: 5px; }
                                    </style>
                                    <div class="product-addons">
                                        <img class="checkbox-arrow-slide-right" src="https://cdn.productlistgenie.com/images/NWMwYTg1ZjA3NzMwMDEzMjdiMDM5MDRj/1560786344044256-256-7f4d535dc832b66d90d5c0cb72ec8690-arrow.png">
                                        <input type="checkbox" class="p_add_on" style="margin-left: 15px; position: relative;" \$\{values.checked ? ' checked' : ''\}>
                                        <label style="margin-left: 5px; text-decoration: \$\{values.undeline ? 'underline' : 'unset'\};">\$\{values.addonText\}</label>
                                    </div>
                                    \`;
                                }
                            }),
                            exporters: {
                                web: function(values) {
                                    let button_style = btnStyleFn(values);
                                    let info = JSON.parse(values.subscription_list)[0];
                                    return \`
                                        \$\{button_style\}
                                        <style>
                                        .checkbox-arrow-slide-right{ left: 10px; width: 20px; z-index: 1; -webkit-animation: slide-right .5s cubic-bezier(.25,.46,.45,.94) infinite alternate both; animation: slide-right .5s cubic-bezier(.25,.46,.45,.94) infinite alternate both; } @-webkit-keyframes slide-right {0% {-webkit-transform: translateX(0);transform: translateX(0);}100% {-webkit-transform: translateX(10px);transform: translateX(10px);}}
                                        .product-addons { display: flex; align-items: center; position: relative; background-color: \$\{values.backgroundColor\}; padding: 5px; border-radius: 5px; color: \$\{values.fontColor\}; }
                                        .p_add_on:checked:after { content: '\\\\2714'; font-size: 15px; font-weight: 700; color: #fff; background: linear-gradient(to bottom, #0fe469 0%, #145b32 100%); display: flex; align-items: center; justify-content: center; }
                                        .p_add_on:after { content: ''; border: 1px solid #505256; background-color: #b3abab; width: 20px; height: 20px; position: absolute; top: -30%; left: -30%; border-radius: 5px; }
                                    </style>
                                    <div class="product-addons">
                                        <img class="checkbox-arrow-slide-right" src="https://cdn.productlistgenie.com/images/NWMwYTg1ZjA3NzMwMDEzMjdiMDM5MDRj/1560786344044256-256-7f4d535dc832b66d90d5c0cb72ec8690-arrow.png">
                                        \$\{values.checked ? ' <input type="checkbox" class="p_add_on" style="margin-left: 15px; position: relative;" checked />' : '<input type="checkbox" class="p_add_on" style="margin-left: 15px; position: relative;" />'\} 
                                        <label style="margin-left: 5px; text-decoration: \$\{values.undeline ? 'underline' : 'unset'\};">\$\{values.addonText\}</label>
                                    </div>

                                        <div style="display:none"  id="authorize_order_bump"
                                        data-checked =  \$\{values.checked\}
                                        data-productname = "\$\{info.name\}"
                                        data-variantname = "\$\{info.rebill + " - " + info.day_or_month\}"
                                        data-price = "\$\{info.price\}"
                                        
                                        data-trackaddtocart = "\$\{values.fbTrack\}"
                                        data-trackpurchased = "\$\{values.fbPurchase\}"
                                        
                                        data-useconfirmation="\$\{values.use_confirmation\}"
                                        data-header="\$\{values.header\}"
                                        data-ptext="\$\{values.positive_button\}"
                                        data-ntext="\$\{values.negative_button\}"
                                        >
                                        \$\{values.text\}
                                        <div class="subtext">\$\{values.subText\}</div>
                                        </div>
                                        <script>
                                        //July11
                                        var variantavailable = \$\{values.variants\};
                                        var variantname = "Add-ons";
                                        var subs_ob_data = {

                                            dataproductname :  "\$\{info.name\}",
                                            datavariantname :  "\$\{info.rebill + " - " + info.day_or_month\}",
                                            dataprice :  "\$\{info.price\}",
                                            datatrackaddtocart :  "\$\{values.fbTrack\}",
                                            datatrackpurchased :  "\$\{values.fbPurchase\}",
                                            datauseconfirmation: "\$\{values.use_confirmation\}",
                                            dataheader: "\$\{values.header\}",
                                            dataptext: "\$\{values.positive_button\}",
                                            datantext: "\$\{values.negative_button\}",
                                        }
                                            function addProductAddonPrice(event){
                                                // also converting those local price to multiple country add on price...
                                                var addonPrice = \$\{info.price\};
                                                console.log(event)
                                                document.getElementById("authorize_order_bump").dataset.checked = event.target.checked;
                                                if(event.target.checked){
                                                    warrantyPrice = {
                                                        price: addonPrice,
                                                        variantname: "\$\{info.name\}",
                                                        variantid:  "\$\{info.shopifySubID\}", //typeof variantid !== "undefined" ? variantid : plg_selectedVariant.variant_id, // FIXME:
                                                        tag: ""
                                                    };
                                                
                                                } else {
                                                    warrantyPrice = {
                                                        price: 0,
                                                        variantname: "",
                                                        variantid: "",
                                                        tag: ""
                                                    };
                                                }
                                                try {
                                                    getTheSelectedVariant();
                                                } catch (error) {
                                                    console.log(error)
                                                }
                                                // for the new variants with multiple and multi country.. 
                                                // getSelectedVariant();
                                            }
                                            function subscription_orderBump(element, dataFromForm) {
                                                console.log("Check or Uncheck ", element.getAttribute('data-checked'))
                                            
                                                console.log("function subscription_orderBump was called", element);
                                                
                                                let quantity = 1;
                                                let product_name = element.getAttribute('data-productname')
                                                let variant_name = element.getAttribute('data-variantname');
                                                let price = element.getAttribute('data-price');
                                                
                                                
                                                if (localStorage.getItem("authorize_customer_ids")) {
                                                    subscription_hide_show_confirmation(element, () => {
                                                        
                                                        let payload = JSON.parse(atob(localStorage.getItem("authorize_customer_ids")));
                                                        payload.cog = "";
                                                        payload.productPrice = parseFloat(price)
                                                        payload.productName = product_name;
                                                        payload.variantName = variant_name;
                                                        plgQS() !== "" ? payload.campaign_src = plgQS() : void 0;
                                                        // payload.variant_id = variantavailable.filter(e => e.isSuggest == true)[0] && variantavailable.filter(e => e.isSuggest == true)[0].id;
                                                        payload.variant_id = "\$\{info.shopifySubID\}";
                                                        fetch("/authorize-subscription-create", {
                                                            method: "POST",
                                                            headers: { 'Content-Type': 'application/json' },
                                                            body: JSON.stringify(payload)
                                                        })
                                                        .then(res => res.json())
                                                        .then(res => {
                                                            if(res.status === 200){
                                                                payload.customerProfileId = res.data.profile.customerProfileId;
                                                                payload.customerPaymentProfileId = res.data.profile.customerPaymentProfileId;
                                                                payload.result = { transactionResponse: { transId: res.data.subscriptionId } };

                                                                save_authorize_initial_data(payload, result => {
                                                                    let x_checkout = JSON.parse(localStorage.getItem("plg_prod_list"));
                                                                    x_checkout.push({
                                                                        product_url: window.location.href,
                                                                        product_name: product_name,
                                                                        variant_name: variant_name,
                                                                        product_price: parseFloat(price)
                                                                    });
                                                                    localStorage.setItem("plg_prod_list", JSON.stringify(x_checkout));
                                                                    window.open("\$\{values.buttonLink.url\}", "\$\{values.buttonLink.target\}");
                                                                }, error => {
                                                                    
                                                                    alert("An error has occured");
                                                                });
                                                            } else {
                                                                
                                                                let message = res.data && res.data.messages.message ? res.data.messages.message[0].text : res.message;
                                                                alert(message);
                                                            }
                                                        })
                                                        .catch(err => {
                                                            console.log("Error ==>", err);
                                                            // send error error email
                                                            
                                                            const email_payload = { toEmail: "tech@themillionairemastermind.com", fromEmail: "fg_error@gmail.com", subjectEmail: "Funnel creating subscription order failed.", textEmail: "Authorize Subscription Checkout Funnel Error: " + err + ", Link: " + window.location.href, htmlEmail: "Authorize Subscription Checkout Funnel Error: " + err + ", Link: " + window.location.href };
                                                            fetch("https://stats.productlistgenie.io/console", { method: "POST", headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(email_payload) });
                                                            
                                                            // New FIX stroked
                                                            
                                                            let x_checkout = JSON.parse(localStorage.getItem("plg_prod_list"));
                                                                    x_checkout.push({
                                                                        product_url: window.location.href,
                                                                        product_name: product_name,
                                                                        variant_name: variant_name,
                                                                        product_price: parseFloat(price)
                                                                    });
                                                                    localStorage.setItem("plg_prod_list", JSON.stringify(x_checkout));
                                                                    window.open(urls.url, urls.target);
                                                            // alert("Server Error occurred. Please try again.");
                                                        });
                                                    });
                                                } else {
                                                    alert("Did not go through checkout.");
                                                }
                                            }

                                            function save_authorize_initial_data(result, success, error) {
                                                fetch('/authorize-orders-initial', {
                                                    method: "POST",
                                                    headers: {
                                                        'Content-Type': 'application/json',
                                                    },
                                                    body: JSON.stringify(result)
                                                })
                                                .then(res => {
                                                    success(res)
                                                })
                                                .catch(err => {
                                                    error(err)
                                                })
                                            }

                                            function subscription_hide_show_confirmation(element, callback) {
                                                window.callback = callback;
                                                let use_confirmation = element.getAttribute('data-useconfirmation');
                                                let header = element.getAttribute('data-header');
                                                let positive_text = element.getAttribute('data-ptext');
                                                let negative_text = element.getAttribute('data-ntext');
                                                if(use_confirmation === "true") {
                                                    if(document.getElementById("upsell_confirmation")){
                                                        closeConfirmationModal();
                                                    } else {
                                                        var confirmation = \\\`
                                                            <style>
                                                                #upsell_confirmation button { border-radius: 5px; font-size: 20px; padding: 10px; cursor: pointer; border: none; }
                                                                #upsell_confirmation button.positive-button { color: #ffffff; background-color: #26c686; }
                                                                #upsell_confirmation button.positive-button:hover { background-color: #2a92bf; }
                                                                #upsell_confirmation button.negative-button { color: #ffffff; background-color: #d33b22; }
                                                                #upsell_confirmation button.negative-button:hover { background-color: #c87668; }
                                                            </style>
                                                            <div style="position: fixed; width: 100%; height: 100vh; overflow: scroll; z-index: 9999; top: 0; left: 0;">
                                                                <div style="align-items: center; display: flex; flex-direction: column; margin: auto; min-height: 100%; justify-content: center; background-color: #00000078;">
                                                                <div style="padding: 20px; background-color: #ffffff; border-radius:\$\{values.borderRadius_popup\};">
                                                                        <h1 style="margin: 0 0 10px;">\\\$\\\{header\\\}</h1>
                                                                        <div style="display: flex; flex-flow: row wrap; -webkit-flex-flow: row wrap; justify-content: space-around;">
                                                                            <button class="positive-button" style="width: 48%; margin: 0 1%;" onclick="closeConfirmationModal(); window.callback();">\\\$\\\{positive_text\\\}</button>
                                                                            <button class="negative-button" style="width: 48%; margin: 0 1%;" onclick="closeConfirmationModal()">\\\$\\\{negative_text\\\}</button>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        \\\`;
                                                        var div = document.createElement("div");
                                                        div.id = "upsell_confirmation";
                                                        div.innerHTML = confirmation;
                                                        document.body.appendChild(div);
                                                    }
                                                } else {
                                                    callback();
                                                }
                                            }

                                            function closeConfirmationModal(){
                                                document.getElementById("upsell_confirmation").remove();
                                            }

                                            function hide_show_loading(){
                                                if(document.getElementById("submit_loading")) {
                                                    // document.getElementById("submit_loading").remove();
                                                } else {
                                                    var xx = '<style> #spinner { position: relative; width: 100%; height: 100%; } #spinner:after { content: ""; display: block; position: absolute; width: 80px; height: 80px; margin-left: -40px; margin-top: -40px; border: 5px solid #d1faeb; -moz-border-radius: 50%; -webkit-border-radius: 50%; border-radius: 50%; border-top-color: #26c686; border-right-color: #26c686; -moz-animation: rotate 0.5s linear infinite; -webkit-animation: rotate 0.5s linear infinite; animation: rotate 0.5s linear infinite; } @-moz-keyframes rotate { 0% { -moz-transform: rotateZ(-360deg); transform: rotateZ(-360deg); } 50% { -moz-transform: rotateZ(-180deg); transform: rotateZ(-180deg); } 100% { -moz-transform: rotateZ(0deg); transform: rotateZ(0deg); } } @-webkit-keyframes rotate { 0% { -webkit-transform: rotateZ(-360deg); transform: rotateZ(-360deg); } 50% { -webkit-transform: rotateZ(-180deg); transform: rotateZ(-180deg); } 100% { -webkit-transform: rotateZ(0deg); transform: rotateZ(0deg); } } @keyframes rotate { 0% { -moz-transform: rotateZ(-360deg); -ms-transform: rotateZ(-360deg); -webkit-transform: rotateZ(-360deg); transform: rotateZ(-360deg); } 50% { -moz-transform: rotateZ(-180deg); -ms-transform: rotateZ(-180deg); -webkit-transform: rotateZ(-180deg); transform: rotateZ(-180deg); } 100% { -moz-transform: rotateZ(0deg); -ms-transform: rotateZ(0deg); -webkit-transform: rotateZ(0deg); transform: rotateZ(0deg); } } </style> <div style="position: fixed; width: 100%; height: 100vh; overflow: scroll; z-index: 9999; top: 0; left: 0;"><div style="align-items: center; display: flex; flex-direction: column; margin: auto; min-height: 100%; justify-content: center; background-color: #00000078;"><div style="display: flex; align-items: center; padding: 100px;"><div id="spinner"></div></div></div></div>';
                                                    var div = document.createElement("div");
                                                    div.id = "submit_loading";
                                                    div.innerHTML = xx;
                                                    document.body.appendChild(div);
                                                }
                                            }
                                            
                                        </script>
                                    \`;
                                }
                            }
                        }
                    });
                `);

                //  Authorize Subscription with Paypal
                customJS.push(`
                    ${editorTools.getSubscriptionProductWidget(isUpsellOrDownsell)}
                    console.log("19. Initializing authorize subscription checkout Authorize with Paypal... ");
                    unlayer.registerTool({
                        type: 'authorize-form-subscription',
                        category: 'contents',
                        label: 'Subscription',
                        icon: '<svg class="svg-inline--fa" viewBox="0.937 12.585 60 7.83" width="60pt" height="7.83pt" class="svg-inline--fa"><path d=" M 4.092 15.153 L 4.12 15.153 L 4.901 17.386 L 3.324 17.386 L 4.092 15.153 Z  M 5.041 20.275 L 8 20.275 L 8 19.94 C 7.427 19.871 7.246 19.829 6.883 18.796 C 6.478 17.707 5.99 16.409 5.543 15.125 L 4.831 13.115 L 4.301 13.255 L 2.11 18.824 C 1.733 19.801 1.593 19.857 0.937 19.926 L 0.937 20.261 L 3.38 20.261 L 3.38 19.926 L 3.115 19.898 C 2.612 19.843 2.598 19.731 2.752 19.187 C 2.891 18.712 3.031 18.238 3.171 17.931 L 5.083 17.931 C 5.25 18.321 5.459 18.894 5.599 19.256 C 5.78 19.717 5.725 19.843 5.334 19.898 L 5.055 19.94 L 5.055 20.275 L 5.041 20.275 Z  M 11.112 16.507 C 11.112 16.116 11.056 16.046 10.777 15.991 L 10.442 15.935 L 10.442 15.628 C 10.986 15.6 11.921 15.502 12.438 15.432 L 12.438 19.103 C 12.438 19.55 12.48 19.675 12.829 19.675 L 13.164 19.675 L 13.164 20.01 C 12.508 20.108 11.824 20.261 11.196 20.415 L 11.112 20.345 L 11.112 19.647 C 10.903 19.801 10.721 19.94 10.484 20.08 C 10.149 20.289 9.884 20.401 9.535 20.401 C 8.628 20.401 8.139 19.801 8.139 18.963 L 8.139 16.507 C 8.139 16.116 8.083 16.046 7.804 15.991 L 7.511 15.935 L 7.511 15.628 C 8.014 15.6 8.893 15.502 9.465 15.432 L 9.465 18.698 C 9.465 19.34 9.786 19.577 10.191 19.577 C 10.498 19.577 10.791 19.438 11.112 19.159 L 11.112 16.507 M 15.104 18.67 C 15.104 19.508 15.508 19.661 15.704 19.661 C 15.871 19.661 16.067 19.605 16.262 19.494 L 16.416 19.815 L 15.48 20.289 C 15.313 20.373 15.145 20.401 15.076 20.401 C 14.238 20.401 13.778 20.038 13.778 19.075 L 13.778 16.074 L 13.08 16.074 L 13.01 15.935 L 13.359 15.516 L 13.778 15.516 L 13.778 14.846 L 14.908 13.995 L 15.09 14.092 L 15.09 15.516 L 16.164 15.516 C 16.304 15.628 16.29 15.977 16.095 16.074 L 15.104 16.074 L 15.104 18.67 Z  M 18.607 16.074 C 18.97 15.711 19.514 15.376 20.086 15.376 C 21.077 15.376 21.607 15.991 21.607 17.009 L 21.607 19.201 C 21.607 19.801 21.663 19.843 22.263 19.926 L 22.263 20.261 L 19.723 20.261 L 19.723 19.926 C 20.254 19.857 20.295 19.815 20.295 19.201 L 20.295 17.121 C 20.295 16.451 19.919 16.172 19.472 16.172 C 19.179 16.172 18.858 16.284 18.621 16.521 L 18.621 19.201 C 18.621 19.801 18.677 19.843 19.123 19.926 L 19.123 20.261 L 16.499 20.261 L 16.499 19.926 C 17.225 19.857 17.281 19.815 17.281 19.201 L 17.281 13.967 C 17.281 13.325 17.253 13.311 16.569 13.269 L 16.569 12.962 C 17.044 12.892 17.881 12.739 18.607 12.585 L 18.607 16.074 Z  M 23.938 17.568 C 23.938 16.395 24.399 15.823 24.831 15.823 C 25.529 15.823 25.934 16.661 25.934 18.098 C 25.934 19.661 25.446 19.926 25.055 19.926 C 24.371 19.94 23.938 18.935 23.938 17.568 M 24.999 15.376 C 23.785 15.376 22.445 16.284 22.445 18 C 22.445 19.159 23.282 20.387 24.943 20.387 C 26.185 20.387 27.441 19.536 27.441 17.777 C 27.441 16.521 26.506 15.376 24.999 15.376 L 24.999 15.376 Z  M 29.758 19.215 C 29.758 19.815 29.814 19.857 30.637 19.94 L 30.637 20.275 L 27.693 20.275 L 27.693 19.94 C 28.376 19.871 28.432 19.829 28.432 19.215 L 28.432 16.814 C 28.432 16.158 28.418 16.144 27.72 16.06 L 27.72 15.767 C 28.349 15.684 29.046 15.53 29.758 15.376 L 29.758 16.451 L 29.786 16.451 C 29.926 16.228 30.093 15.977 30.289 15.753 C 30.498 15.53 30.735 15.376 31 15.376 C 31.405 15.376 31.726 15.684 31.726 16.032 C 31.726 16.381 31.489 16.702 31.21 16.8 C 31.07 16.856 30.958 16.814 30.875 16.758 C 30.693 16.619 30.512 16.535 30.33 16.535 C 30.149 16.535 29.926 16.619 29.744 17.065 L 29.744 19.215 M 32.577 16.814 C 32.577 16.158 32.563 16.144 31.866 16.06 L 31.866 15.767 C 32.508 15.684 33.219 15.53 33.903 15.376 L 33.903 19.201 C 33.903 19.815 33.959 19.857 34.643 19.94 L 34.643 20.275 L 31.824 20.275 L 31.824 19.94 C 32.522 19.871 32.563 19.829 32.563 19.201 L 32.563 16.814 M 33.931 13.674 C 33.931 14.106 33.582 14.455 33.15 14.455 C 32.731 14.455 32.368 14.106 32.368 13.674 C 32.368 13.227 32.731 12.892 33.15 12.892 C 33.582 12.892 33.931 13.227 33.931 13.674 Z  M 38.956 15.502 L 39.053 15.656 L 36.569 19.801 L 37.42 19.801 C 38.16 19.801 38.453 19.661 38.816 19.047 L 38.97 18.782 L 39.36 18.921 C 39.165 19.466 39.025 19.857 38.858 20.261 L 34.95 20.261 L 34.838 20.108 L 37.406 15.963 L 36.653 15.963 C 35.941 15.963 35.746 16.13 35.494 16.661 L 35.341 16.995 L 34.95 16.856 C 35.076 16.451 35.243 15.767 35.355 15.293 L 35.592 15.293 C 35.648 15.446 35.76 15.516 36.178 15.516 L 38.956 15.516 M 40.616 17.177 C 40.686 16.437 41.077 15.879 41.482 15.879 C 41.901 15.879 42.235 16.451 42.235 16.884 C 42.235 17.093 42.194 17.135 42.04 17.135 L 40.616 17.177 Z  M 43.296 19.019 C 42.864 19.312 42.529 19.438 42.124 19.438 C 41.3 19.438 40.561 18.88 40.561 17.665 C 41.635 17.624 43.073 17.526 43.226 17.498 C 43.436 17.456 43.478 17.428 43.478 17.023 C 43.478 16.186 42.724 15.39 41.789 15.39 C 40.463 15.39 39.305 16.549 39.305 18.112 C 39.305 19.326 40.142 20.401 41.607 20.401 C 41.984 20.401 42.836 20.178 43.45 19.242 L 43.296 19.019 L 43.296 19.019 Z  M 43.827 19.55 C 43.827 19.061 44.175 18.698 44.65 18.698 C 45.125 18.698 45.487 19.061 45.487 19.55 C 45.487 20.052 45.125 20.401 44.65 20.401 C 44.189 20.387 43.827 20.052 43.827 19.55 Z  M 52.466 20.345 L 51.81 20.345 L 47.511 15.069 L 47.483 15.069 L 47.483 17.316 C 47.483 18.461 47.553 19.061 47.595 19.396 C 47.651 19.773 47.93 19.912 48.642 19.94 L 48.642 20.275 L 45.948 20.275 L 45.948 19.94 C 46.492 19.926 46.744 19.773 46.799 19.396 C 46.855 19.061 46.911 18.461 46.911 17.316 L 46.911 15.167 C 46.911 14.483 46.911 14.204 46.716 13.953 C 46.506 13.688 46.241 13.618 45.794 13.59 L 45.794 13.255 L 47.679 13.255 L 51.866 18.126 L 51.894 18.126 L 51.894 16.214 C 51.894 15.083 51.838 14.483 51.782 14.148 C 51.726 13.771 51.461 13.632 50.735 13.604 L 50.735 13.269 L 53.429 13.269 L 53.429 13.604 C 52.884 13.632 52.633 13.771 52.577 14.148 C 52.536 14.483 52.466 15.083 52.466 16.214 L 52.466 20.345 Z  M 54.141 17.177 C 54.196 16.437 54.601 15.879 55.006 15.879 C 55.411 15.879 55.76 16.451 55.76 16.884 C 55.76 17.093 55.718 17.135 55.55 17.135 L 54.141 17.177 M 56.82 19.019 C 56.388 19.312 56.053 19.438 55.648 19.438 C 54.824 19.438 54.099 18.88 54.099 17.665 C 55.173 17.624 56.611 17.526 56.764 17.498 C 56.974 17.456 57.016 17.428 57.016 17.023 C 57.016 16.186 56.276 15.39 55.327 15.39 C 54.001 15.39 52.843 16.549 52.843 18.112 C 52.843 19.326 53.694 20.401 55.145 20.401 C 55.522 20.401 56.374 20.178 56.988 19.242 L 56.82 19.019 L 56.82 19.019 Z  M 59.109 18.67 C 59.109 19.508 59.514 19.661 59.723 19.661 C 59.891 19.661 60.072 19.605 60.282 19.494 L 60.435 19.815 L 59.5 20.289 C 59.332 20.373 59.165 20.401 59.095 20.401 C 58.258 20.401 57.797 20.038 57.797 19.075 L 57.797 16.074 L 57.113 16.074 L 57.044 15.935 L 57.392 15.516 L 57.811 15.516 L 57.811 14.846 L 58.956 13.995 L 59.137 14.092 L 59.137 15.516 L 60.212 15.516 C 60.351 15.628 60.323 15.977 60.142 16.074 L 59.151 16.074 L 59.151 18.67 M 60.407 15.111 C 60.309 15.111 60.226 15.083 60.142 15.042 C 60.058 15 59.988 14.93 59.947 14.846 C 59.891 14.762 59.877 14.665 59.877 14.567 C 59.877 14.469 59.905 14.386 59.947 14.288 C 59.988 14.204 60.058 14.134 60.142 14.092 C 60.226 14.051 60.323 14.023 60.407 14.023 C 60.505 14.023 60.589 14.051 60.672 14.092 C 60.756 14.134 60.826 14.204 60.868 14.288 C 60.924 14.372 60.937 14.469 60.937 14.567 C 60.937 14.665 60.91 14.762 60.868 14.846 C 60.812 14.93 60.756 15 60.672 15.042 C 60.589 15.097 60.505 15.111 60.407 15.111 Z  M 60.407 15.028 C 60.491 15.028 60.561 15.014 60.63 14.972 C 60.7 14.93 60.756 14.874 60.798 14.804 C 60.84 14.734 60.868 14.651 60.868 14.567 C 60.868 14.483 60.84 14.413 60.812 14.33 C 60.77 14.26 60.714 14.204 60.644 14.162 C 60.575 14.12 60.491 14.106 60.407 14.106 C 60.323 14.106 60.254 14.12 60.184 14.162 C 60.114 14.204 60.058 14.26 60.016 14.33 C 59.974 14.4 59.961 14.483 59.961 14.567 C 59.961 14.651 59.988 14.734 60.016 14.804 C 60.058 14.874 60.114 14.93 60.184 14.972 C 60.24 15.014 60.323 15.028 60.407 15.028 L 60.407 15.028 Z  M 60.295 14.888 L 60.184 14.888 L 60.184 14.232 L 60.393 14.232 C 60.449 14.232 60.477 14.246 60.505 14.26 C 60.533 14.274 60.547 14.302 60.561 14.33 C 60.575 14.358 60.589 14.386 60.589 14.427 C 60.589 14.469 60.575 14.497 60.561 14.539 C 60.533 14.581 60.505 14.595 60.463 14.623 C 60.491 14.637 60.505 14.665 60.533 14.721 L 60.63 14.916 L 60.505 14.916 L 60.421 14.748 L 60.407 14.707 C 60.379 14.665 60.365 14.637 60.351 14.637 L 60.268 14.637 L 60.268 14.888 L 60.295 14.888 Z  M 60.295 14.539 L 60.365 14.539 C 60.407 14.539 60.449 14.525 60.463 14.497 C 60.477 14.469 60.491 14.441 60.491 14.413 C 60.491 14.4 60.491 14.372 60.477 14.358 C 60.463 14.344 60.463 14.33 60.449 14.316 C 60.435 14.302 60.407 14.302 60.365 14.302 L 60.282 14.302 L 60.282 14.539 L 60.295 14.539 Z " fill-rule="evenodd" fill="rgb(255,255,255)"></path></svg>',
                        values: {},
                        options: {
                            products: {
                                title: "Products",
                                position: 1,
                                options: ${editorTools.config_subscription_product('conekta_subscription_list')}
                            },
                            button: {
                                title: "Button",
                                position: 2,
                                options: ${editorTools.config_button()}
                            },
                            form: {
                                title: "Form",
                                position: 3,
                                options: ${editorTools.config_non_cod_form("selected_country,phone")}
                            }
                        },
                        renderer: {
                            Viewer: unlayer.createViewer({
                                render(values) {
                                    let form_style = formStyleFn(values);
                                    let input_style = inputStyleFn(values);
                                    let button_style = btnStyleFn(values);
                                    let dropdown_style = subscriptionDropdownStyleFn(values);
                                    let subs_list = JSON.parse(values.subscription_list);
                                    let content_style = subscriptionStyleFn(values);
                                    console.log(subs_list)
                                    return \`
                                        \$\{form_style\}
                                        \$\{input_style\}
                                        \$\{button_style\}
                                        \$\{content_style\}
                                        \$\{dropdown_style\}
                                        <h3 style="margin: 0 0 5px;">\$\{values.subscription_header\}</h3>

                                        \$\{values.subscription_style_options == true ? \`
                                        
                                        
                                        <div class="subscription-product">
                                        <div class="subscrption-dropdown">
                                            <div class="custom-select">
                                                \$\{subs_list.filter(eb => eb.selected == true).map(el => {
                                                   return \`
                                                    <div class="select-selected">\$\{el.name.replace(/(\\\s\\\[.*?\\\])|(\\\[.*?\\\])/g, "")\} - \$\{el.desc || "Enter Description"\} - <b>$\$\{el.price || 0\}/\$\{el.day_or_month ? el.day_or_month.substring(0, 2) : "da"\}</b></div>
                                                    \`;
                                                    }).join("")\}
                                                <div class="select-items select-hide">
                                        
                                                    \$\{subs_list.map((el, i) => {
                                                        return \`
                                                        <div>\$\{el.name.replace(/(\\\s\\\[.*?\\\])|(\\\[.*?\\\])/g, "")\} - \$\{el.desc || "Enter Description"\} - <b>$\$\{el.price || 0\}/\$\{el.day_or_month ? el.day_or_month.substring(0, 2) : "da"\}</b></div>
                                                        \`;
                                                        }).join("")\}

                                                </div>
                                            </div>
                                        </div>
                                        </div>
                                        \` : \`
                                        <div class="subscription-product">
                                        \$\{subs_list.map((el, i) => {
                                            return \`
                                                \$\{i !== 0 ? "<div class='border-left'></div>" : ""\}
                                                <div class="subscription-container">
                                                    <div class="subscription-price">
                                                        <p><sup>$</sup>\$\{el.price || 0\}</p>
                                                        <span class="frequent-mini">/\$\{el.day_or_month ? el.day_or_month.substring(0, 2) : "da"\}</span>
                                                    </div>
                                                    <p class="frequent">\$\{el.day_or_month ? el.day_or_month.replace("ys", "i").replace("s", "") : "dai"\}ly</p>
                                                    <p class="frequent-desc" style="margin-bottom:1rem;">\$\{el.desc || "Enter Description"\}</p>
                                                    <button style="display:none;" data-paypalSubID="\$\{el.paypalSubID\}" class="subs-btn" style="font-size: \$\{values.subscription_button_size\}; padding: \$\{values.subscription_button_padding\}; width: \$\{values.subscription_button_width\};" \$\{el.selected ? "disabled" : ""\}>\$\{values.subscription_button_text\}</button>
                                                    <label class="container" style="font-size: \$\{values.subscription_button_size\};">\$\{values.subscription_button_text\}
                                                    <input type="radio" id="data-\$\{el.paypalSubID\}" name="chosen" value="\$\{el.paypalSubID\}" \$\{el.selected ? "checked='checked'" : ""\}>
                                                    <span class="checkmark"></span>
                                                    </label>
                                                </div>
                                            \`;
                                            }).join("")\}
                                        </div>
                                        \`\}
                                        

                                        
                                        <div class="authorize-form" style="margin-top: 20px;">
                                            <div class="form-container">
                                                <form id="paymentForm" class="payment-form" style="display: inline-block; width: 100%;">
                                                    <h3 style="margin: 0 0 5px;">\$\{values.formHeader\}</h3>
                                                    <div class="half-left">
                                                        <input type="text" name="firstName" placeholder="\$\{values.firstName\}" required />
                                                    </div>
                                                    <div class="half-right">
                                                        <input type="text" name="lastName" placeholder="\$\{values.lastName\}" required />
                                                    </div>
                                                    <input type="email" name="email" autocomplete="on" maxlength="40" placeholder="\$\{values.email\}" required />
                                                    <input type="text" name="address" autocomplete="on" maxlength="45" placeholder="\$\{values.address\}" required />
                                                    <input type="text" name="city" autocomplete="on" maxlength="45" placeholder="\$\{values.city\}" required />
                                                    <input type="text" name="zipcode" autocomplete="on" pattern="[0-9]*" maxlength="5" placeholder="\$\{values.zipcode\}" required />
                                                    ${this.getStateList()}
                                                    ${this.getCountryList()}
                                                    <h3 style="margin: 0 0 5px;">\$\{values.creditCard\}</h3>
                                                    <input type="text" name="cardNumber" placeholder="Card Number" required />
                                                    <div class="half-left">
                                                        <input type="text" name="expiry" placeholder="MM / YY" required />
                                                    </div>
                                                    <div class="half-right">
                                                        <input type="text" name="cardCode" placeholder="CCV" required />
                                                    </div>
                                                    <button class="\$\{values.animation\}" type="submit">
                                                        \$\{values.text\}
                                                        <div class="subtext">\$\{values.subText\}</div>
                                                    </button>
                                                </form>
                                                <div style="margin:1rem; text-align:center;" class="full">
                                                ${paypalClientID && `
                                                <p style="margin:1rem;"> or, checkout securely with </p>    
                                                    <button style="width: 100%;background-color: #efe764;border-radius: 5px;border: none;padding: 10px;"><img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAyNCAzMiIgeG1sbnM9Imh0dHA6JiN4MkY7JiN4MkY7d3d3LnczLm9yZyYjeDJGOzIwMDAmI3gyRjtzdmciIHByZXNlcnZlQXNwZWN0UmF0aW89InhNaW5ZTWluIG1lZXQiPjxwYXRoIGZpbGw9IiMwMDljZGUiIGQ9Ik0gMjAuOTA1IDkuNSBDIDIxLjE4NSA3LjQgMjAuOTA1IDYgMTkuNzgyIDQuNyBDIDE4LjU2NCAzLjMgMTYuNDExIDIuNiAxMy42OTcgMi42IEwgNS43MzkgMi42IEMgNS4yNzEgMi42IDQuNzEgMy4xIDQuNjE1IDMuNiBMIDEuMzM5IDI1LjggQyAxLjMzOSAyNi4yIDEuNjIgMjYuNyAyLjA4OCAyNi43IEwgNi45NTYgMjYuNyBMIDYuNjc1IDI4LjkgQyA2LjU4MSAyOS4zIDYuODYyIDI5LjYgNy4yMzYgMjkuNiBMIDExLjM1NiAyOS42IEMgMTEuODI1IDI5LjYgMTIuMjkyIDI5LjMgMTIuMzg2IDI4LjggTCAxMi4zODYgMjguNSBMIDEzLjIyOCAyMy4zIEwgMTMuMjI4IDIzLjEgQyAxMy4zMjIgMjIuNiAxMy43OSAyMi4yIDE0LjI1OCAyMi4yIEwgMTQuODIxIDIyLjIgQyAxOC44NDUgMjIuMiAyMS45MzUgMjAuNSAyMi44NzEgMTUuNSBDIDIzLjMzOSAxMy40IDIzLjE1MyAxMS43IDIyLjAyOSAxMC41IEMgMjEuNzQ4IDEwLjEgMjEuMjc5IDkuOCAyMC45MDUgOS41IEwgMjAuOTA1IDkuNSI+PC9wYXRoPjxwYXRoIGZpbGw9IiMwMTIxNjkiIGQ9Ik0gMjAuOTA1IDkuNSBDIDIxLjE4NSA3LjQgMjAuOTA1IDYgMTkuNzgyIDQuNyBDIDE4LjU2NCAzLjMgMTYuNDExIDIuNiAxMy42OTcgMi42IEwgNS43MzkgMi42IEMgNS4yNzEgMi42IDQuNzEgMy4xIDQuNjE1IDMuNiBMIDEuMzM5IDI1LjggQyAxLjMzOSAyNi4yIDEuNjIgMjYuNyAyLjA4OCAyNi43IEwgNi45NTYgMjYuNyBMIDguMjY3IDE4LjQgTCA4LjE3MyAxOC43IEMgOC4yNjcgMTguMSA4LjczNSAxNy43IDkuMjk2IDE3LjcgTCAxMS42MzYgMTcuNyBDIDE2LjIyNCAxNy43IDE5Ljc4MiAxNS43IDIwLjkwNSAxMC4xIEMgMjAuODEyIDkuOCAyMC45MDUgOS43IDIwLjkwNSA5LjUiPjwvcGF0aD48cGF0aCBmaWxsPSIjMDAzMDg3IiBkPSJNIDkuNDg1IDkuNSBDIDkuNTc3IDkuMiA5Ljc2NSA4LjkgMTAuMDQ2IDguNyBDIDEwLjIzMiA4LjcgMTAuMzI2IDguNiAxMC41MTMgOC42IEwgMTYuNjkyIDguNiBDIDE3LjQ0MiA4LjYgMTguMTg5IDguNyAxOC43NTMgOC44IEMgMTguOTM5IDguOCAxOS4xMjcgOC44IDE5LjMxNCA4LjkgQyAxOS41MDEgOSAxOS42ODggOSAxOS43ODIgOS4xIEMgMTkuODc1IDkuMSAxOS45NjggOS4xIDIwLjA2MyA5LjEgQyAyMC4zNDMgOS4yIDIwLjYyNCA5LjQgMjAuOTA1IDkuNSBDIDIxLjE4NSA3LjQgMjAuOTA1IDYgMTkuNzgyIDQuNiBDIDE4LjY1OCAzLjIgMTYuNTA2IDIuNiAxMy43OSAyLjYgTCA1LjczOSAyLjYgQyA1LjI3MSAyLjYgNC43MSAzIDQuNjE1IDMuNiBMIDEuMzM5IDI1LjggQyAxLjMzOSAyNi4yIDEuNjIgMjYuNyAyLjA4OCAyNi43IEwgNi45NTYgMjYuNyBMIDguMjY3IDE4LjQgTCA5LjQ4NSA5LjUgWiI+PC9wYXRoPjwvc3ZnPg==" width="20em"><img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjMyIiB2aWV3Qm94PSIwIDAgMTAwIDMyIiB4bWxucz0iaHR0cDomI3gyRjsmI3gyRjt3d3cudzMub3JnJiN4MkY7MjAwMCYjeDJGO3N2ZyIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pbllNaW4gbWVldCI+PHBhdGggZmlsbD0iIzAwMzA4NyIgZD0iTSAxMiA0LjkxNyBMIDQuMiA0LjkxNyBDIDMuNyA0LjkxNyAzLjIgNS4zMTcgMy4xIDUuODE3IEwgMCAyNS44MTcgQyAtMC4xIDI2LjIxNyAwLjIgMjYuNTE3IDAuNiAyNi41MTcgTCA0LjMgMjYuNTE3IEMgNC44IDI2LjUxNyA1LjMgMjYuMTE3IDUuNCAyNS42MTcgTCA2LjIgMjAuMjE3IEMgNi4zIDE5LjcxNyA2LjcgMTkuMzE3IDcuMyAxOS4zMTcgTCA5LjggMTkuMzE3IEMgMTQuOSAxOS4zMTcgMTcuOSAxNi44MTcgMTguNyAxMS45MTcgQyAxOSA5LjgxNyAxOC43IDguMTE3IDE3LjcgNi45MTcgQyAxNi42IDUuNjE3IDE0LjYgNC45MTcgMTIgNC45MTcgWiBNIDEyLjkgMTIuMjE3IEMgMTIuNSAxNS4wMTcgMTAuMyAxNS4wMTcgOC4zIDE1LjAxNyBMIDcuMSAxNS4wMTcgTCA3LjkgOS44MTcgQyA3LjkgOS41MTcgOC4yIDkuMzE3IDguNSA5LjMxNyBMIDkgOS4zMTcgQyAxMC40IDkuMzE3IDExLjcgOS4zMTcgMTIuNCAxMC4xMTcgQyAxMi45IDEwLjUxNyAxMy4xIDExLjIxNyAxMi45IDEyLjIxNyBaIj48L3BhdGg+PHBhdGggZmlsbD0iIzAwMzA4NyIgZD0iTSAzNS4yIDEyLjExNyBMIDMxLjUgMTIuMTE3IEMgMzEuMiAxMi4xMTcgMzAuOSAxMi4zMTcgMzAuOSAxMi42MTcgTCAzMC43IDEzLjYxNyBMIDMwLjQgMTMuMjE3IEMgMjkuNiAxMi4wMTcgMjcuOCAxMS42MTcgMjYgMTEuNjE3IEMgMjEuOSAxMS42MTcgMTguNCAxNC43MTcgMTcuNyAxOS4xMTcgQyAxNy4zIDIxLjMxNyAxNy44IDIzLjQxNyAxOS4xIDI0LjgxNyBDIDIwLjIgMjYuMTE3IDIxLjkgMjYuNzE3IDIzLjggMjYuNzE3IEMgMjcuMSAyNi43MTcgMjkgMjQuNjE3IDI5IDI0LjYxNyBMIDI4LjggMjUuNjE3IEMgMjguNyAyNi4wMTcgMjkgMjYuNDE3IDI5LjQgMjYuNDE3IEwgMzIuOCAyNi40MTcgQyAzMy4zIDI2LjQxNyAzMy44IDI2LjAxNyAzMy45IDI1LjUxNyBMIDM1LjkgMTIuNzE3IEMgMzYgMTIuNTE3IDM1LjYgMTIuMTE3IDM1LjIgMTIuMTE3IFogTSAzMC4xIDE5LjMxNyBDIDI5LjcgMjEuNDE3IDI4LjEgMjIuOTE3IDI1LjkgMjIuOTE3IEMgMjQuOCAyMi45MTcgMjQgMjIuNjE3IDIzLjQgMjEuOTE3IEMgMjIuOCAyMS4yMTcgMjIuNiAyMC4zMTcgMjIuOCAxOS4zMTcgQyAyMy4xIDE3LjIxNyAyNC45IDE1LjcxNyAyNyAxNS43MTcgQyAyOC4xIDE1LjcxNyAyOC45IDE2LjExNyAyOS41IDE2LjcxNyBDIDMwIDE3LjQxNyAzMC4yIDE4LjMxNyAzMC4xIDE5LjMxNyBaIj48L3BhdGg+PHBhdGggZmlsbD0iIzAwMzA4NyIgZD0iTSA1NS4xIDEyLjExNyBMIDUxLjQgMTIuMTE3IEMgNTEgMTIuMTE3IDUwLjcgMTIuMzE3IDUwLjUgMTIuNjE3IEwgNDUuMyAyMC4yMTcgTCA0My4xIDEyLjkxNyBDIDQzIDEyLjQxNyA0Mi41IDEyLjExNyA0Mi4xIDEyLjExNyBMIDM4LjQgMTIuMTE3IEMgMzggMTIuMTE3IDM3LjYgMTIuNTE3IDM3LjggMTMuMDE3IEwgNDEuOSAyNS4xMTcgTCAzOCAzMC41MTcgQyAzNy43IDMwLjkxNyAzOCAzMS41MTcgMzguNSAzMS41MTcgTCA0Mi4yIDMxLjUxNyBDIDQyLjYgMzEuNTE3IDQyLjkgMzEuMzE3IDQzLjEgMzEuMDE3IEwgNTUuNiAxMy4wMTcgQyA1NS45IDEyLjcxNyA1NS42IDEyLjExNyA1NS4xIDEyLjExNyBaIj48L3BhdGg+PHBhdGggZmlsbD0iIzAwOWNkZSIgZD0iTSA2Ny41IDQuOTE3IEwgNTkuNyA0LjkxNyBDIDU5LjIgNC45MTcgNTguNyA1LjMxNyA1OC42IDUuODE3IEwgNTUuNSAyNS43MTcgQyA1NS40IDI2LjExNyA1NS43IDI2LjQxNyA1Ni4xIDI2LjQxNyBMIDYwLjEgMjYuNDE3IEMgNjAuNSAyNi40MTcgNjAuOCAyNi4xMTcgNjAuOCAyNS44MTcgTCA2MS43IDIwLjExNyBDIDYxLjggMTkuNjE3IDYyLjIgMTkuMjE3IDYyLjggMTkuMjE3IEwgNjUuMyAxOS4yMTcgQyA3MC40IDE5LjIxNyA3My40IDE2LjcxNyA3NC4yIDExLjgxNyBDIDc0LjUgOS43MTcgNzQuMiA4LjAxNyA3My4yIDYuODE3IEMgNzIgNS42MTcgNzAuMSA0LjkxNyA2Ny41IDQuOTE3IFogTSA2OC40IDEyLjIxNyBDIDY4IDE1LjAxNyA2NS44IDE1LjAxNyA2My44IDE1LjAxNyBMIDYyLjYgMTUuMDE3IEwgNjMuNCA5LjgxNyBDIDYzLjQgOS41MTcgNjMuNyA5LjMxNyA2NCA5LjMxNyBMIDY0LjUgOS4zMTcgQyA2NS45IDkuMzE3IDY3LjIgOS4zMTcgNjcuOSAxMC4xMTcgQyA2OC40IDEwLjUxNyA2OC41IDExLjIxNyA2OC40IDEyLjIxNyBaIj48L3BhdGg+PHBhdGggZmlsbD0iIzAwOWNkZSIgZD0iTSA5MC43IDEyLjExNyBMIDg3IDEyLjExNyBDIDg2LjcgMTIuMTE3IDg2LjQgMTIuMzE3IDg2LjQgMTIuNjE3IEwgODYuMiAxMy42MTcgTCA4NS45IDEzLjIxNyBDIDg1LjEgMTIuMDE3IDgzLjMgMTEuNjE3IDgxLjUgMTEuNjE3IEMgNzcuNCAxMS42MTcgNzMuOSAxNC43MTcgNzMuMiAxOS4xMTcgQyA3Mi44IDIxLjMxNyA3My4zIDIzLjQxNyA3NC42IDI0LjgxNyBDIDc1LjcgMjYuMTE3IDc3LjQgMjYuNzE3IDc5LjMgMjYuNzE3IEMgODIuNiAyNi43MTcgODQuNSAyNC42MTcgODQuNSAyNC42MTcgTCA4NC4zIDI1LjYxNyBDIDg0LjIgMjYuMDE3IDg0LjUgMjYuNDE3IDg0LjkgMjYuNDE3IEwgODguMyAyNi40MTcgQyA4OC44IDI2LjQxNyA4OS4zIDI2LjAxNyA4OS40IDI1LjUxNyBMIDkxLjQgMTIuNzE3IEMgOTEuNCAxMi41MTcgOTEuMSAxMi4xMTcgOTAuNyAxMi4xMTcgWiBNIDg1LjUgMTkuMzE3IEMgODUuMSAyMS40MTcgODMuNSAyMi45MTcgODEuMyAyMi45MTcgQyA4MC4yIDIyLjkxNyA3OS40IDIyLjYxNyA3OC44IDIxLjkxNyBDIDc4LjIgMjEuMjE3IDc4IDIwLjMxNyA3OC4yIDE5LjMxNyBDIDc4LjUgMTcuMjE3IDgwLjMgMTUuNzE3IDgyLjQgMTUuNzE3IEMgODMuNSAxNS43MTcgODQuMyAxNi4xMTcgODQuOSAxNi43MTcgQyA4NS41IDE3LjQxNyA4NS43IDE4LjMxNyA4NS41IDE5LjMxNyBaIj48L3BhdGg+PHBhdGggZmlsbD0iIzAwOWNkZSIgZD0iTSA5NS4xIDUuNDE3IEwgOTEuOSAyNS43MTcgQyA5MS44IDI2LjExNyA5Mi4xIDI2LjQxNyA5Mi41IDI2LjQxNyBMIDk1LjcgMjYuNDE3IEMgOTYuMiAyNi40MTcgOTYuNyAyNi4wMTcgOTYuOCAyNS41MTcgTCAxMDAgNS42MTcgQyAxMDAuMSA1LjIxNyA5OS44IDQuOTE3IDk5LjQgNC45MTcgTCA5NS44IDQuOTE3IEMgOTUuNCA0LjkxNyA5NS4yIDUuMTE3IDk1LjEgNS40MTcgWiI+PC9wYXRoPjwvc3ZnPg==" width="80em"></button>
                                                </div>
                                                `}
                                            </div>
                                        </div>
                                    \`;
                                }
                            }),
                            exporters: {
                                web: function(values) {
                                    let form_style = formStyleFn(values);
                                    let input_style = inputStyleFn(values);
                                    let button_style = btnStyleFn(values);
                                    let dropdown_style = subscriptionDropdownStyleFn(values);
                                    let subs_list = JSON.parse(values.subscription_list);
                                    let content_style = subscriptionStyleFn(values);
                                    let authorize_src = values.testMode ? "https://jstest.authorize.net/v1/Accept.js" : "https://js.authorize.net/v1/Accept.js";
                                    let selected_value = null;
                                    return \`
                                        \$\{form_style\}
                                        \$\{input_style\}
                                        \$\{button_style\}
                                        \$\{dropdown_style\}
                                        \$\{content_style\}
                                        <h3 style="margin: 0 0 5px;">\$\{values.subscription_header\}</h3>


                                        \$\{values.subscription_style_options == true ? \`
                                        <div class="subscription-product">
                                        
                                        
                                        <div class="subscrption-dropdown">
                                            <div class="custom-select">
                                                \$\{subs_list.filter(eb => eb.selected == true).map(el => {
                                                   return \`
                                                    <div class="select-selected" data-paypalsubid="\$\{el.paypalSubID\}" data-variant="\$\{el.rebill + " - " + el.day_or_month\}" data-name="\$\{el.name.replace(/(\\\[)|(\\\])/g, "")\}" data-price="\$\{el.price\}" data-svariantid="\$\{el.shopifySubID\}">\$\{el.name.replace(/(\\\s\\\[.*?\\\])|(\\\[.*?\\\])/g, "")\} - \$\{el.desc || "Enter Description"\} - <b>$\$\{el.price || 0\}/\$\{el.day_or_month ? el.day_or_month.substring(0, 2) : "da"\}</b></div>
                                                    \`;
                                                    }).join("")\}
                                                <div class="select-items select-hide">
                                        
                                                    \$\{subs_list.map((el, i) => {
                                                        return \`
                                                        <div data-paypalsubid="\$\{el.paypalSubID\}" data-variant="\$\{el.rebill + " - " + el.day_or_month\}" data-name="\$\{el.name.replace(/(\\\[)|(\\\])/g, "")\}" data-price="\$\{el.price\}" data-svariantid="\$\{el.shopifySubID\}">\$\{el.name.replace(/(\\\s\\\[.*?\\\])|(\\\[.*?\\\])/g, "")\} - \$\{el.desc || "Enter Description"\} - <b>$\$\{el.price || 0\}/\$\{el.day_or_month ? el.day_or_month.substring(0, 2) : "da"\}</b></div>
                                                        \`;
                                                        }).join("")\}

                                                </div>
                                            </div>
                                        </div>
                                        </div>
                                        \` : \`
                                        <div class="subscription-product">
                                        \$\{subs_list.map((el, i) => {
                                            return \`
                                            \$\{i !== 0 ? "<div class='border-left'></div>" : ""\}
                                            <div class="subscription-container" data-variant="\$\{el.rebill + " - " + el.day_or_month\}" data-name="\$\{el.name\}" data-price="\$\{el.price\}" data-svariantid="\$\{el.shopifySubID\}">
                                                <div class="subscription-price">
                                                    <p><sup>$</sup>\$\{el.price || 0\}</p>
                                                    <span class="frequent-mini">/\$\{el.day_or_month ? el.day_or_month.substring(0, 2) : "da"\}</span>
                                                </div>
                                                <p class="frequent">\$\{el.day_or_month ? el.day_or_month.replace("ys", "i").replace("s", "") : "dai"\}ly</p>
                                                <p class="frequent-desc" style="margin-bottom:1rem;">\$\{el.desc || "Enter Description"\}</p>
                                                <button style="display:none;" id="button\$\{i\}"  class="subs-btn" style="font-size: \$\{values.subscription_button_size\}; padding: \$\{values.subscription_button_padding\}; width: \$\{values.subscription_button_width\};" \$\{el.selected ? "disabled" : ""\}>\$\{values.subscription_button_text\}</button>
                                                <label class="container" style="font-size: \$\{values.subscription_button_size\};">\$\{values.subscription_button_text\}
                                                <input style="width:20px;" data-paypalsubid="\$\{el.paypalSubID\}" onclick="document.querySelector('#button\$\{i\}').click()" type="radio"  id="data-\$\{el.paypalSubID\}" name="plgchosen" value="\$\{el.paypalSubID\}" \$\{el.selected ? "checked='checked' class='select-selected'" : ""\}>
                                                <span class="checkmark"></span>
                                                </label>
                                            </div>
                                        \`;
                                            }).join("")\}
                                        </div>
                                        \`\}

                                        <div class="authorize-form unrevealed" style="margin-top: 20px;">
                                            <div class="form-container">
                                                <form id="paymentForm" class="payment-form" style="display: inline-block; width: 100%;" submit=>
                                                    <div class="card-wrapper"></div>
                                                    <h3 style="margin: 0 0 5px;">\$\{values.formHeader\}</h3>
                                                    <div class="half-left">
                                                        <input type="text" name="firstName" placeholder="\$\{values.firstName\}" required />
                                                    </div>
                                                    <div class="half-right">
                                                        <input type="text" name="lastName" placeholder="\$\{values.lastName\}" required />
                                                    </div>
                                                    <input type="email" name="email" autocomplete="on" maxlength="40" placeholder="\$\{values.email\}" required />
                                                    <input type="text" name="address" autocomplete="on" maxlength="45" placeholder="\$\{values.address\}" required />
                                                    <input type="text" name="city" autocomplete="on" maxlength="45" placeholder="\$\{values.city\}" required />
                                                    <input type="text" name="zipcode" autocomplete="on" pattern="[0-9]*" maxlength="5" placeholder="\$\{values.zipcode\}" required />
                                                    ${this.getStateList()}
                                                    ${this.getCountryList()}
                                                    <h3 style="margin: 0 0 5px;">\$\{values.creditCard\}</h3>
                                                    <input type="text" name="cardNumber" placeholder="Card Number" required />
                                                    <div class="half-left">
                                                        <input type="text" name="expiry" placeholder="MM / YY" required />
                                                    </div>
                                                    <div class="half-right">
                                                        <input type="text" name="cardCode" placeholder="CCV" required />
                                                    </div>
                                                    <button class="\$\{values.animation\}" type="submit">
                                                        \$\{values.text\}
                                                        <div class="subtext">\$\{values.subText\}</div>
                                                    </button>
                                                </form>
                                                ${paypalClientID && `
                                                <div style="margin:1rem; text-align:center;" class="full">
                                                    <p style="margin:1rem;"> or, checkout securely with </p>    
                                                    <script src="https://www.paypal.com/sdk/js?client-id=${this.decryptString(paypalClientID)}&vault=true&intent=subscription" data-sdk-integration-source="button-factory"></script>
                                                    <div id="paypal-button-container" style="text-align:center;position:relative;z-index:0;"></div>
                                                </div>
                                                `}
                                            </div>
                                        </div>
                                        <script src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/121761/card.js"></script>
                                        <script type="text/javascript" src="\$\{authorize_src\}" charset="utf-8"></script>
                                        <script>
                                           
                                            let addInitiateCheckoutFn = \$\{addInitiateCheckoutFn\};
                                            addInitiateCheckoutFn("${this.state.page_data.funnel_snapchat_id}", \$\{values.fbInitiate\}, "\$\{values._meta.htmlID\}", "[name='firstName'],[name='lastName'],[name='email']");
                                            plg_price = typeof plg_price === "undefined" ? 0 : plg_price;
                                            plg_selectedVariant = typeof plg_selectedVariant === "undefined" ? {} : plg_selectedVariant;
                                            (() => {
                                                \$\{values.subscription_style_options == true ? 
                                                    \`
                                                    let dd = document.querySelector('.select-selected');
                                                    let si = document.querySelectorAll('.select-items > div');
                                                    dd.addEventListener("click", function (e) {
                                                        e.stopPropagation();
                                                        closeAllSelect(this);
                                                        this.nextElementSibling.classList.toggle("select-hide");
                                                    });
                                                    function copyAttrs(src, target) {
                                                        for(let attr of src.attributes) {
                                                            if(attr.name.includes('data')){
                                                                target.setAttribute(attr.name, attr.value);
                                                            }
                                                        }
                                                      }
                                                      function setSelectedProduct(src) {
                                                        plg_price = parseFloat(src.getAttribute("data-price"));
                                                            plg_selectedVariant = {
                                                                tags: [plgQS()],
                                                                variant_id: src.getAttribute("data-svariantid"), // for shopify variant id
                                                                variant_sku: "",
                                                                variant_name: src.getAttribute("data-variant"),
                                                                product_name: src.getAttribute("data-name"),
                                                                variant_qty: 1,
                                                                price: plg_price.toString()
                                                            }
                                                      }
                                                      setSelectedProduct(dd)
                                                    Array.from(dd.nextElementSibling.children).forEach((el, i) => {
                                                        el.addEventListener("click", function (e) {
                                                            Array.from(si).forEach(el => {
                                                                el.removeAttribute("class")
                                                            })
                                                            this.setAttribute("class", "same-as-selected");
                                                            dd.innerHTML = this.innerHTML;
                                                            copyAttrs(this, dd);
                                                            setSelectedProduct(dd)
                                                            ${paypalClientID && `
                                                            renderPaypalButton();
                                                            ` }
                                                        });
                                                    })
                                        
                                                    function closeAllSelect(elmnt) {
                                                        let x, y, i, xl, yl, arrNo = [];
                                                        x = document.getElementsByClassName("select-items");
                                                        y = document.getElementsByClassName("select-selected");
                                                        xl = x.length;
                                        
                                                        for (i = 0; i < xl; i++) {
                                                            if (arrNo.indexOf(i)) {
                                                                x[i].classList.add("select-hide");
                                                            }
                                                        }
                                                    }
                                                    document.addEventListener("click", closeAllSelect);
                                                    \` : \`
                                                    console.log("not dropdown")
                                                    \` 
                                                     \}
                                                let default_product = \$\{selected_value\};
                                                /* start for order data */
                                                if(default_product) {
                                                    plg_price = parseFloat(default_product.price);
                                                    plg_selectedVariant = {
                                                        tags: [plgQS()], 
                                                        variant_sku: "",
                                                        variant_name: default_product.rebill + " - " + default_product.day_or_month,
                                                        product_name: default_product.name,
                                                        variant_qty: 1,
                                                        variant_id: default_product.shopifySubID,
                                                        price: plg_price.toString()
                                                    }
                                                }
                                                /* end for order data */

                                                localStorage.removeItem("plg_email_id");
                                                localStorage.removeItem("plg_prod_list");
                                                localStorage.removeItem("authorize_customer_ids");
                                                localStorage.removeItem("cod_data");
                                                localStorage.removeItem("cod_currency");

                                                let container = document.getElementById("\$\{values._meta.htmlID\}");
                                                let subscription_container = container.querySelector(".subscription-product");
                                                let form = container.querySelector("form");
                                                let subscription_buttons = subscription_container.querySelectorAll("button");
                                                let form_to_object = form => Array.from(new FormData(form)).reduce((acc, [key, value]) => ({...acc,[key]: value}),{});

                                                let card = new Card({
                                                    form: '#\$\{values._meta.htmlID\} #paymentForm',
                                                    container: '.card-wrapper',
                                                    formSelectors: {
                                                        numberInput: 'input[name="cardNumber"]',
                                                        expiryInput: 'input[name="expiry"]',
                                                        cvcInput: 'input[name="cardCode"]',
                                                        nameInput: 'input[name="firstName"], input[name="lastName"]'
                                                    },
                                                    width: 200,
                                                    formatting: true,
                                                    messages: {
                                                        validDate: 'valid date',
                                                        monthYear: 'mm/yyyy'
                                                    },
                                                    placeholders: {
                                                        number: '•••• •••• •••• ••••',
                                                        name: 'Full Name',
                                                        expiry: '••/••',
                                                        cvc: '•••'
                                                    },
                                                    masks: {
                                                        cardNumber: '•'
                                                    },
                                                    debug: false
                                                });
                                                ${paypalClientID && `
                                                function renderPaypalButton() {
                                                    console.log("running")
                                                    var ppsubid;
                                                        var buttonContainer = document.querySelector("#paypal-button-container");
                                                        buttonContainer.innerHTML = "";
                                                        var plgchosen = Array.from(document.querySelectorAll('input[name="plgchosen"]')).filter(el => {
                                                                    return el.checked 
                                                                })
                                                        if (typeof plgchosen === "undefined") {
                                                            ppsubid = plgchosen[0].value
                                                            } else {
                                                                ppsubid = document.querySelector(".select-selected").getAttribute('data-paypalsubid')
                                                            }
                                                        if(ppsubid) {

                                                        paypal.Buttons({
                                                            style: {
                                                                shape: "rect",
                                                                color: "gold",
                                                                layout: "horizontal",
                                                                label: "subscribe",
                                                                tagline:false
                                                            },
                                                            createSubscription: function(data, actions) {
                                                                return actions.subscription.create({
                                                                    
                                                                    plan_id: ppsubid
                                                                });
                                                            },
                                                            onApprove: function(data, actions) {
                                                                return actions.subscription.get().then(function(details) {
                                                                    // Call your server to save the transaction
                                                                    ${funnel_everflow && `
                                                                        try {
                                                                            sourcePR = sourcePR.replace('PLGAMOUNT', parseFloat(plg_price))
                                                                        } catch (error) {
                                                                            console.log(error)
                                                                        }`}
                                                                    var sendObjectToServer = {
                                                                        ...details, 
                                                                        payer: {
                                                                            email_address: details.subscriber.email_address,
                                                                            name: {
                                                                                given_name: details.subscriber.name.given_name + " " + details.subscriber.name.surname
                                                                            }
                                                                        }, 
                                                                        purchase_units: [
                                                                            {
                                                                                amount: {
                                                                                    value: details.billing_info.last_payment.amount.value
                                                                                },
                                                                                shipping: {
                                                                                    name: {
                                                                                        full_name: details.subscriber.name.given_name + details.subscriber.name.surname
                                                                                    },
                                                                                    address: details.subscriber.shipping_address.address

                                                                                }

                                                                            }, 
                                                                            details.subscriber],
                                                                        metadata: {
                                                                            meta: "${this.encryptString(user_id)}",
                                                                            pageid: "${state.page_data.funnel_id}"
                                                                        },
                                                                        product_name: plg_selectedVariant.product_name,
                                                                        variant_name: plg_selectedVariant.variant_name,
                                                                        variant_id: plg_selectedVariant.variant_id, // for shopify variant id
                                                                        source_link: sourcePR,
                                                                        campaign_src: plgQS()
                                                                    }
                                                                    hide_show_loading();
                                                                    // send initial data to server and send to app.productlistgenie.io
                                                                    return fetch('/paypal-orders-initial', {
                                                                        method: "POST",
                                                                        headers: {
                                                                            'Content-Type': 'application/json',
                                                                        },
                                                                        body: JSON.stringify(sendObjectToServer)
                                                                    })
                                                                    .then(res => {
                                                                        hide_show_loading();

                                                                        // for sending email
                                                                         var x_checkout = [{
                                                                        product_url: window.location.href,
                                                                        product_name: plg_selectedVariant.product_name,
                                                                        variant_name: plg_selectedVariant.variant_name,
                                                                        product_price: parseFloat(plg_price)
                                                                    }];
                                                                    localStorage.setItem("plg_prod_list", JSON.stringify(x_checkout));
                                                                    
                                                                        const callback = () => setTimeout(() => window.open("\$\{values.buttonLink.url\}", "\$\{values.buttonLink.target\}"), 1000);
                                                                        var productName = plg_selectedVariant.product_name;
                                                                        var plg_price = plg_selectedVariant.variant_price;
                                                                        var plg_job_id = localStorage.getItem("plg_email_id");

                                                                        // unset data for sending email
                                                                        var plg_qty = plg_selectedVariant.variant_qty;
                                                                        var currency_word = "USD";
                                                                        var currency_symbol = "$";
                                                                        ${this.getSendingEmailRequest(true)}
                                                                    })
                                                                    .catch(err => {
                                                                        hide_show_loading();
                                                                        return window.open("\$\{values.buttonLink.url\}", "\$\{values.buttonLink.target\}");
                                                                    })
                                                                })
                                                            }
                                                        }).render('#paypal-button-container');
                                                    } else {
                                                        buttonContainer.innerHTML = '<button disabled style="max-width:750px;width: 100%;background-color: #efe764;border-radius: 5px;border: none;padding: 10px;"><img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAyNCAzMiIgeG1sbnM9Imh0dHA6JiN4MkY7JiN4MkY7d3d3LnczLm9yZyYjeDJGOzIwMDAmI3gyRjtzdmciIHByZXNlcnZlQXNwZWN0UmF0aW89InhNaW5ZTWluIG1lZXQiPjxwYXRoIGZpbGw9IiMwMDljZGUiIGQ9Ik0gMjAuOTA1IDkuNSBDIDIxLjE4NSA3LjQgMjAuOTA1IDYgMTkuNzgyIDQuNyBDIDE4LjU2NCAzLjMgMTYuNDExIDIuNiAxMy42OTcgMi42IEwgNS43MzkgMi42IEMgNS4yNzEgMi42IDQuNzEgMy4xIDQuNjE1IDMuNiBMIDEuMzM5IDI1LjggQyAxLjMzOSAyNi4yIDEuNjIgMjYuNyAyLjA4OCAyNi43IEwgNi45NTYgMjYuNyBMIDYuNjc1IDI4LjkgQyA2LjU4MSAyOS4zIDYuODYyIDI5LjYgNy4yMzYgMjkuNiBMIDExLjM1NiAyOS42IEMgMTEuODI1IDI5LjYgMTIuMjkyIDI5LjMgMTIuMzg2IDI4LjggTCAxMi4zODYgMjguNSBMIDEzLjIyOCAyMy4zIEwgMTMuMjI4IDIzLjEgQyAxMy4zMjIgMjIuNiAxMy43OSAyMi4yIDE0LjI1OCAyMi4yIEwgMTQuODIxIDIyLjIgQyAxOC44NDUgMjIuMiAyMS45MzUgMjAuNSAyMi44NzEgMTUuNSBDIDIzLjMzOSAxMy40IDIzLjE1MyAxMS43IDIyLjAyOSAxMC41IEMgMjEuNzQ4IDEwLjEgMjEuMjc5IDkuOCAyMC45MDUgOS41IEwgMjAuOTA1IDkuNSI+PC9wYXRoPjxwYXRoIGZpbGw9IiMwMTIxNjkiIGQ9Ik0gMjAuOTA1IDkuNSBDIDIxLjE4NSA3LjQgMjAuOTA1IDYgMTkuNzgyIDQuNyBDIDE4LjU2NCAzLjMgMTYuNDExIDIuNiAxMy42OTcgMi42IEwgNS43MzkgMi42IEMgNS4yNzEgMi42IDQuNzEgMy4xIDQuNjE1IDMuNiBMIDEuMzM5IDI1LjggQyAxLjMzOSAyNi4yIDEuNjIgMjYuNyAyLjA4OCAyNi43IEwgNi45NTYgMjYuNyBMIDguMjY3IDE4LjQgTCA4LjE3MyAxOC43IEMgOC4yNjcgMTguMSA4LjczNSAxNy43IDkuMjk2IDE3LjcgTCAxMS42MzYgMTcuNyBDIDE2LjIyNCAxNy43IDE5Ljc4MiAxNS43IDIwLjkwNSAxMC4xIEMgMjAuODEyIDkuOCAyMC45MDUgOS43IDIwLjkwNSA5LjUiPjwvcGF0aD48cGF0aCBmaWxsPSIjMDAzMDg3IiBkPSJNIDkuNDg1IDkuNSBDIDkuNTc3IDkuMiA5Ljc2NSA4LjkgMTAuMDQ2IDguNyBDIDEwLjIzMiA4LjcgMTAuMzI2IDguNiAxMC41MTMgOC42IEwgMTYuNjkyIDguNiBDIDE3LjQ0MiA4LjYgMTguMTg5IDguNyAxOC43NTMgOC44IEMgMTguOTM5IDguOCAxOS4xMjcgOC44IDE5LjMxNCA4LjkgQyAxOS41MDEgOSAxOS42ODggOSAxOS43ODIgOS4xIEMgMTkuODc1IDkuMSAxOS45NjggOS4xIDIwLjA2MyA5LjEgQyAyMC4zNDMgOS4yIDIwLjYyNCA5LjQgMjAuOTA1IDkuNSBDIDIxLjE4NSA3LjQgMjAuOTA1IDYgMTkuNzgyIDQuNiBDIDE4LjY1OCAzLjIgMTYuNTA2IDIuNiAxMy43OSAyLjYgTCA1LjczOSAyLjYgQyA1LjI3MSAyLjYgNC43MSAzIDQuNjE1IDMuNiBMIDEuMzM5IDI1LjggQyAxLjMzOSAyNi4yIDEuNjIgMjYuNyAyLjA4OCAyNi43IEwgNi45NTYgMjYuNyBMIDguMjY3IDE4LjQgTCA5LjQ4NSA5LjUgWiI+PC9wYXRoPjwvc3ZnPg==" width="20em"><img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjMyIiB2aWV3Qm94PSIwIDAgMTAwIDMyIiB4bWxucz0iaHR0cDomI3gyRjsmI3gyRjt3d3cudzMub3JnJiN4MkY7MjAwMCYjeDJGO3N2ZyIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pbllNaW4gbWVldCI+PHBhdGggZmlsbD0iIzAwMzA4NyIgZD0iTSAxMiA0LjkxNyBMIDQuMiA0LjkxNyBDIDMuNyA0LjkxNyAzLjIgNS4zMTcgMy4xIDUuODE3IEwgMCAyNS44MTcgQyAtMC4xIDI2LjIxNyAwLjIgMjYuNTE3IDAuNiAyNi41MTcgTCA0LjMgMjYuNTE3IEMgNC44IDI2LjUxNyA1LjMgMjYuMTE3IDUuNCAyNS42MTcgTCA2LjIgMjAuMjE3IEMgNi4zIDE5LjcxNyA2LjcgMTkuMzE3IDcuMyAxOS4zMTcgTCA5LjggMTkuMzE3IEMgMTQuOSAxOS4zMTcgMTcuOSAxNi44MTcgMTguNyAxMS45MTcgQyAxOSA5LjgxNyAxOC43IDguMTE3IDE3LjcgNi45MTcgQyAxNi42IDUuNjE3IDE0LjYgNC45MTcgMTIgNC45MTcgWiBNIDEyLjkgMTIuMjE3IEMgMTIuNSAxNS4wMTcgMTAuMyAxNS4wMTcgOC4zIDE1LjAxNyBMIDcuMSAxNS4wMTcgTCA3LjkgOS44MTcgQyA3LjkgOS41MTcgOC4yIDkuMzE3IDguNSA5LjMxNyBMIDkgOS4zMTcgQyAxMC40IDkuMzE3IDExLjcgOS4zMTcgMTIuNCAxMC4xMTcgQyAxMi45IDEwLjUxNyAxMy4xIDExLjIxNyAxMi45IDEyLjIxNyBaIj48L3BhdGg+PHBhdGggZmlsbD0iIzAwMzA4NyIgZD0iTSAzNS4yIDEyLjExNyBMIDMxLjUgMTIuMTE3IEMgMzEuMiAxMi4xMTcgMzAuOSAxMi4zMTcgMzAuOSAxMi42MTcgTCAzMC43IDEzLjYxNyBMIDMwLjQgMTMuMjE3IEMgMjkuNiAxMi4wMTcgMjcuOCAxMS42MTcgMjYgMTEuNjE3IEMgMjEuOSAxMS42MTcgMTguNCAxNC43MTcgMTcuNyAxOS4xMTcgQyAxNy4zIDIxLjMxNyAxNy44IDIzLjQxNyAxOS4xIDI0LjgxNyBDIDIwLjIgMjYuMTE3IDIxLjkgMjYuNzE3IDIzLjggMjYuNzE3IEMgMjcuMSAyNi43MTcgMjkgMjQuNjE3IDI5IDI0LjYxNyBMIDI4LjggMjUuNjE3IEMgMjguNyAyNi4wMTcgMjkgMjYuNDE3IDI5LjQgMjYuNDE3IEwgMzIuOCAyNi40MTcgQyAzMy4zIDI2LjQxNyAzMy44IDI2LjAxNyAzMy45IDI1LjUxNyBMIDM1LjkgMTIuNzE3IEMgMzYgMTIuNTE3IDM1LjYgMTIuMTE3IDM1LjIgMTIuMTE3IFogTSAzMC4xIDE5LjMxNyBDIDI5LjcgMjEuNDE3IDI4LjEgMjIuOTE3IDI1LjkgMjIuOTE3IEMgMjQuOCAyMi45MTcgMjQgMjIuNjE3IDIzLjQgMjEuOTE3IEMgMjIuOCAyMS4yMTcgMjIuNiAyMC4zMTcgMjIuOCAxOS4zMTcgQyAyMy4xIDE3LjIxNyAyNC45IDE1LjcxNyAyNyAxNS43MTcgQyAyOC4xIDE1LjcxNyAyOC45IDE2LjExNyAyOS41IDE2LjcxNyBDIDMwIDE3LjQxNyAzMC4yIDE4LjMxNyAzMC4xIDE5LjMxNyBaIj48L3BhdGg+PHBhdGggZmlsbD0iIzAwMzA4NyIgZD0iTSA1NS4xIDEyLjExNyBMIDUxLjQgMTIuMTE3IEMgNTEgMTIuMTE3IDUwLjcgMTIuMzE3IDUwLjUgMTIuNjE3IEwgNDUuMyAyMC4yMTcgTCA0My4xIDEyLjkxNyBDIDQzIDEyLjQxNyA0Mi41IDEyLjExNyA0Mi4xIDEyLjExNyBMIDM4LjQgMTIuMTE3IEMgMzggMTIuMTE3IDM3LjYgMTIuNTE3IDM3LjggMTMuMDE3IEwgNDEuOSAyNS4xMTcgTCAzOCAzMC41MTcgQyAzNy43IDMwLjkxNyAzOCAzMS41MTcgMzguNSAzMS41MTcgTCA0Mi4yIDMxLjUxNyBDIDQyLjYgMzEuNTE3IDQyLjkgMzEuMzE3IDQzLjEgMzEuMDE3IEwgNTUuNiAxMy4wMTcgQyA1NS45IDEyLjcxNyA1NS42IDEyLjExNyA1NS4xIDEyLjExNyBaIj48L3BhdGg+PHBhdGggZmlsbD0iIzAwOWNkZSIgZD0iTSA2Ny41IDQuOTE3IEwgNTkuNyA0LjkxNyBDIDU5LjIgNC45MTcgNTguNyA1LjMxNyA1OC42IDUuODE3IEwgNTUuNSAyNS43MTcgQyA1NS40IDI2LjExNyA1NS43IDI2LjQxNyA1Ni4xIDI2LjQxNyBMIDYwLjEgMjYuNDE3IEMgNjAuNSAyNi40MTcgNjAuOCAyNi4xMTcgNjAuOCAyNS44MTcgTCA2MS43IDIwLjExNyBDIDYxLjggMTkuNjE3IDYyLjIgMTkuMjE3IDYyLjggMTkuMjE3IEwgNjUuMyAxOS4yMTcgQyA3MC40IDE5LjIxNyA3My40IDE2LjcxNyA3NC4yIDExLjgxNyBDIDc0LjUgOS43MTcgNzQuMiA4LjAxNyA3My4yIDYuODE3IEMgNzIgNS42MTcgNzAuMSA0LjkxNyA2Ny41IDQuOTE3IFogTSA2OC40IDEyLjIxNyBDIDY4IDE1LjAxNyA2NS44IDE1LjAxNyA2My44IDE1LjAxNyBMIDYyLjYgMTUuMDE3IEwgNjMuNCA5LjgxNyBDIDYzLjQgOS41MTcgNjMuNyA5LjMxNyA2NCA5LjMxNyBMIDY0LjUgOS4zMTcgQyA2NS45IDkuMzE3IDY3LjIgOS4zMTcgNjcuOSAxMC4xMTcgQyA2OC40IDEwLjUxNyA2OC41IDExLjIxNyA2OC40IDEyLjIxNyBaIj48L3BhdGg+PHBhdGggZmlsbD0iIzAwOWNkZSIgZD0iTSA5MC43IDEyLjExNyBMIDg3IDEyLjExNyBDIDg2LjcgMTIuMTE3IDg2LjQgMTIuMzE3IDg2LjQgMTIuNjE3IEwgODYuMiAxMy42MTcgTCA4NS45IDEzLjIxNyBDIDg1LjEgMTIuMDE3IDgzLjMgMTEuNjE3IDgxLjUgMTEuNjE3IEMgNzcuNCAxMS42MTcgNzMuOSAxNC43MTcgNzMuMiAxOS4xMTcgQyA3Mi44IDIxLjMxNyA3My4zIDIzLjQxNyA3NC42IDI0LjgxNyBDIDc1LjcgMjYuMTE3IDc3LjQgMjYuNzE3IDc5LjMgMjYuNzE3IEMgODIuNiAyNi43MTcgODQuNSAyNC42MTcgODQuNSAyNC42MTcgTCA4NC4zIDI1LjYxNyBDIDg0LjIgMjYuMDE3IDg0LjUgMjYuNDE3IDg0LjkgMjYuNDE3IEwgODguMyAyNi40MTcgQyA4OC44IDI2LjQxNyA4OS4zIDI2LjAxNyA4OS40IDI1LjUxNyBMIDkxLjQgMTIuNzE3IEMgOTEuNCAxMi41MTcgOTEuMSAxMi4xMTcgOTAuNyAxMi4xMTcgWiBNIDg1LjUgMTkuMzE3IEMgODUuMSAyMS40MTcgODMuNSAyMi45MTcgODEuMyAyMi45MTcgQyA4MC4yIDIyLjkxNyA3OS40IDIyLjYxNyA3OC44IDIxLjkxNyBDIDc4LjIgMjEuMjE3IDc4IDIwLjMxNyA3OC4yIDE5LjMxNyBDIDc4LjUgMTcuMjE3IDgwLjMgMTUuNzE3IDgyLjQgMTUuNzE3IEMgODMuNSAxNS43MTcgODQuMyAxNi4xMTcgODQuOSAxNi43MTcgQyA4NS41IDE3LjQxNyA4NS43IDE4LjMxNyA4NS41IDE5LjMxNyBaIj48L3BhdGg+PHBhdGggZmlsbD0iIzAwOWNkZSIgZD0iTSA5NS4xIDUuNDE3IEwgOTEuOSAyNS43MTcgQyA5MS44IDI2LjExNyA5Mi4xIDI2LjQxNyA5Mi41IDI2LjQxNyBMIDk1LjcgMjYuNDE3IEMgOTYuMiAyNi40MTcgOTYuNyAyNi4wMTcgOTYuOCAyNS41MTcgTCAxMDAgNS42MTcgQyAxMDAuMSA1LjIxNyA5OS44IDQuOTE3IDk5LjQgNC45MTcgTCA5NS44IDQuOTE3IEMgOTUuNCA0LjkxNyA5NS4yIDUuMTE3IDk1LjEgNS40MTcgWiI+PC9wYXRoPjwvc3ZnPg==" width="80em"></button>';
                                                    }
                                                }
                                                renderPaypalButton();
                                                `}

                                                subscription_buttons.forEach(el => {
                                                    let parent_subscription = el.parentNode;
                                                    el.onclick = () => {
                                                        let disable_btn = subscription_container.querySelector("button:disabled");
                                                        if(disable_btn) disable_btn.disabled = false;
                                                        el.disabled = true;
                                                        /* start for order data */
                                                        plg_price = parseFloat(parent_subscription.getAttribute("data-price"));
                                                        plg_selectedVariant = {
                                                            tags: [plgQS()], 
                                                            variant_id: parent_subscription.getAttribute("data-svariantid"), // for shopify variant id
                                                            variant_sku: "",
                                                            variant_name: parent_subscription.getAttribute("data-variant"),
                                                            product_name: parent_subscription.getAttribute("data-name"),
                                                            variant_qty: 1,
                                                            price: plg_price.toString()
                                                        }
                                                        /* end for order data */
                                                        ${paypalClientID && `
                                                        renderPaypalButton();
                                                        ` }
                                                    };
                                                });

                                                form.onsubmit = event => {
                                                    event.preventDefault();
                                                    event.stopPropagation();
                                                    let form_value = form_to_object(form);
                                                    if(!plg_price) {
                                                        alert("Please select subscription");
                                                    } else {
                                                        hide_show_loading();
                                                        sendPaymentDataToAnet(form_value);
                                                    }
                                                }

                                                function sendPaymentDataToAnet(obj){
                                                    let authData = {};
                                                    authData.clientKey = "${public_key}"
                                                    authData.apiLoginID = "${other}"
                                                    let cardData = {};
                                                    let expiration = obj.expiry.replace(/ /g,"");
                                                    cardData.cardNumber = obj.cardNumber.replace(/ /g,"");
                                                    cardData.month = expiration.split("/")[0];
                                                    cardData.year = expiration.split("/")[1];
                                                    cardData.cardCode = obj.cardCode;
                                                    let secureData = {};
                                                    secureData.authData = authData;
                                                    secureData.cardData = cardData;
                                                    Accept.dispatchData(secureData, responseHandler);
                                                }

                                                function responseHandler(data) {
                                                    if(data.messages.resultCode == "Ok"){
                                                        // clear credit card info
                                                        form.querySelector('input[name="expiry"]').value = "";
                                                        form.querySelector('input[name="cardNumber"]').value = "";
                                                        form.querySelector('input[name="cardCode"]').value = "";
                                                        // begin creating order
                                                        let dataDescriptor = data.opaqueData.dataDescriptor, dataValue = data.opaqueData.dataValue;
                                                        let form_value = form_to_object(form);
                                                        form_value.dataValue = dataValue;
                                                        form_value.dataDescriptor = dataDescriptor;
                                                        form_value.clientKey = "${public_key}";
                                                        form_value.loginKey = "${other}";
                                                        form_value.tk = "${private_key}";
                                                        form_value.testMode = "\$\{values.testMode\}";
                                                        form_value.variant_id = plg_selectedVariant.variant_id;
                                                        form_value.variantName = plg_selectedVariant.variant_name;
                                                        form_value.productName = plg_selectedVariant.product_name;
                                                        form_value.productPrice = plg_price;
                                                        plgQS() !== "" ? formValue.campaign_src = plgQS() : void 0;
                                                        // form_value.orderType = "subscription"; // Turned off to direct the data to orders not subscription
                                                        form_value.customerID = getRandomString("authorize_");
                                                        form_value.metadata = {
                                                            meta: "${this.encryptString(user_id)}",
                                                            pageid: "${state.page_data.funnel_id}"
                                                        };
                                                        fetch("/authorize-subscription-create", {
                                                            method: "POST",
                                                            headers: { 'Content-Type': 'application/json' },
                                                            body: JSON.stringify(form_value)
                                                        })
                                                        .then(res => res.json())
                                                        .then(res => {
                                                            if(res.status === 200){
                                                                form_value.customerProfileId = res.data.profile.customerProfileId;
                                                                form_value.customerPaymentProfileId = res.data.profile.customerPaymentProfileId;
                                                                form_value.result = { transactionResponse: { transId: res.data.subscriptionId,
                                                                                                            profile: {
                                                                                                                customerProfileId: res.data.profile.customerProfileId,
                                                                                                                customerPaymentProfileId: res.data.profile.customerPaymentProfileId
                                                                                                            }
                                                                                                            } };
                                                                plgQS() !== "" ? form_value.campaign_src = plgQS() : void 0; 
                                                                function runOnce() {
                                                                    runOnce = function () { };
                                                                    if (\$\{values.fbPurchase\}) {
                                                                        typeof setPurchased !== "undefined" ? setPurchased() : void 0; // for analytics
                                                                        // TODO: This maybe where the duplication of records in analytics is hapenning
                                                                        typeof fbq !== 'undefined' ? fbq('track', 'Purchase', {value: parseFloat(plg_price), currency: plg_selectedVariant.currency ? plg_selectedVariant.currency.word : "USD"}) : void 0;
                                                                    }
                                                                    // RECENT: to be removed
                                                                    // ${funnel_everflow && `
                                                                    //     EF.conversion({
                                                                    //         offer_id: localStorage.getItem('plgoid'),
                                                                    //         amount: parseFloat(plg_price),
                                                                    //     });                                                                
                                                                    // `}
                                                                };
                                                                
                                                                

                                                                save_authorize_initial_data(form_value, result => {
                                                                    var x_checkout = [{
                                                                        product_url: window.location.href,
                                                                        product_name: plg_selectedVariant.product_name,
                                                                        variant_name: plg_selectedVariant.variant_name,
                                                                        variant_id: plg_selectedVariant.variant_id,
                                                                        product_price: parseFloat(plg_price)
                                                                    }];
                                                                    localStorage.setItem("plg_prod_list", JSON.stringify(x_checkout));
                                                                    localStorage.setItem("authorize_customer_ids",btoa(JSON.stringify(form_value)))
                                                                    // Insert bumpsell function here
                                                                    
                                                                    
                                                                    
                                                                    if(document.getElementById('authorize_order_bump')){
                                                                        var sub_orderbump = document.getElementById('authorize_order_bump');
                                                                        console.log(sub_orderbump.dataset.checked)
                                                                        if(sub_orderbump.dataset.checked === "true"){
                                                                            
                                                                            subscription_orderBump(sub_orderbump, form_value)
                                                                        } else {
                                                                            setTimeout(() => window.open("\$\{values.buttonLink.url\}","\$\{values.buttonLink.target\}"), 3000)
                                                                        }
    
                                                                    } else {
                                                                        setTimeout(() => window.open("\$\{values.buttonLink.url\}","\$\{values.buttonLink.target\}"), 3000)
                                                                    }

                                                                    // TODO:

                                                                }, error => {
                                                                    console.error(error)
                                                                    hide_show_loading();
                                                                    alert("An error has occured");
                                                                });
                                                            } else {
                                                                hide_show_loading();
                                                                let message = res.data && res.data.messages.message ? res.data.messages.message[0].text : res.message;
                                                                console.error(message)
                                                                alert(message);
                                                            }
                                                        })
                                                        .catch(err => {
                                                            // send error error email
                                                            const email_payload = { toEmail: "tech@themillionairemastermind.com", fromEmail: "fg_error@gmail.com", subjectEmail: "Funnel creating subscription order failed.", textEmail: "Authorize Subscription Checkout Funnel Error: " + err + ", Link: " + window.location.href, htmlEmail: "Authorize Subscription Checkout Funnel Error: " + err + ", Link: " + window.location.href };
                                                            fetch("https://stats.productlistgenie.io/console", { method: "POST", headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(email_payload) });

                                                            hide_show_loading();
                                                            alert("Server Error occurred. Please try again.");
                                                        });
                                                    } else {
                                                        hide_show_loading();
                                                        alert(data.messages.message[0].text);
                                                    }
                                                }

                                                function save_authorize_initial_data(result, success, error) {
                                                    fetch('/authorize-orders-initial', {
                                                        method: "POST",
                                                        headers: {
                                                            'Content-Type': 'application/json',
                                                        },
                                                        body: JSON.stringify(result)
                                                    })
                                                    .then(res => {
                                                        success(res)
                                                    })
                                                    .catch(err => {
                                                        error(err)
                                                    })
                                                }

                                                function getRandomString(text){
                                                    return text + Math.floor((Math.random() * 1000000000000) + 1);
                                                }

                                                function hide_show_loading() {
                                                    if(document.getElementById("submit_loading")) {
                                                        document.getElementById("submit_loading").remove();
                                                    } else {
                                                        var xx = '<style> #spinner { position: relative; width: 100%; height: 100%; } #spinner:after { content: ""; display: block; position: absolute; width: 80px; height: 80px; margin-left: -40px; margin-top: -40px; border: 5px solid #d1faeb; -moz-border-radius: 50%; -webkit-border-radius: 50%; border-radius: 50%; border-top-color: #26c686; border-right-color: #26c686; -moz-animation: rotate 0.5s linear infinite; -webkit-animation: rotate 0.5s linear infinite; animation: rotate 0.5s linear infinite; } @-moz-keyframes rotate { 0% { -moz-transform: rotateZ(-360deg); transform: rotateZ(-360deg); } 50% { -moz-transform: rotateZ(-180deg); transform: rotateZ(-180deg); } 100% { -moz-transform: rotateZ(0deg); transform: rotateZ(0deg); } } @-webkit-keyframes rotate { 0% { -webkit-transform: rotateZ(-360deg); transform: rotateZ(-360deg); } 50% { -webkit-transform: rotateZ(-180deg); transform: rotateZ(-180deg); } 100% { -webkit-transform: rotateZ(0deg); transform: rotateZ(0deg); } } @keyframes rotate { 0% { -moz-transform: rotateZ(-360deg); -ms-transform: rotateZ(-360deg); -webkit-transform: rotateZ(-360deg); transform: rotateZ(-360deg); } 50% { -moz-transform: rotateZ(-180deg); -ms-transform: rotateZ(-180deg); -webkit-transform: rotateZ(-180deg); transform: rotateZ(-180deg); } 100% { -moz-transform: rotateZ(0deg); -ms-transform: rotateZ(0deg); -webkit-transform: rotateZ(0deg); transform: rotateZ(0deg); } } </style> <div style="position: fixed; width: 100%; height: 100vh; overflow: scroll; z-index: 9999; top: 0; left: 0;"><div style="align-items: center; display: flex; flex-direction: column; margin: auto; min-height: 100%; justify-content: center; background-color: #00000078;"><div style="display: flex; align-items: center; padding: 100px;"><div id="spinner"></div></div></div></div>';
                                                        var div = document.createElement("div");
                                                        div.id = "submit_loading";
                                                        div.innerHTML = xx;
                                                        document.body.appendChild(div);
                                                    }
                                                }
                                            })();
                                        </script>
                                    \`;
                                }
                            }
                        }
                    });
                `);
            }

        } else if (isUpsellOrDownsell && selected_merchant == "authorize.net" && condition.has_funnel_subscriber(this.props.session.getCurrentUser, "fa_subscriber")) {
            // Show Authorize subscription upsell
            customJS.push(`
                ${editorTools.getSubscriptionProductWidget(isUpsellOrDownsell)}
                console.log("19.5. Initializing authorize subscription upsell...");
                unlayer.registerTool({
                    type: 'authorize_form_subscription_upsell',
                    category: 'contents',
                    label: 'Upsell subscription',
                    icon: '<svg class="svg-inline--fa" viewBox="0.937 12.585 60 7.83" width="60pt" height="7.83pt" class="svg-inline--fa"><path d=" M 4.092 15.153 L 4.12 15.153 L 4.901 17.386 L 3.324 17.386 L 4.092 15.153 Z  M 5.041 20.275 L 8 20.275 L 8 19.94 C 7.427 19.871 7.246 19.829 6.883 18.796 C 6.478 17.707 5.99 16.409 5.543 15.125 L 4.831 13.115 L 4.301 13.255 L 2.11 18.824 C 1.733 19.801 1.593 19.857 0.937 19.926 L 0.937 20.261 L 3.38 20.261 L 3.38 19.926 L 3.115 19.898 C 2.612 19.843 2.598 19.731 2.752 19.187 C 2.891 18.712 3.031 18.238 3.171 17.931 L 5.083 17.931 C 5.25 18.321 5.459 18.894 5.599 19.256 C 5.78 19.717 5.725 19.843 5.334 19.898 L 5.055 19.94 L 5.055 20.275 L 5.041 20.275 Z  M 11.112 16.507 C 11.112 16.116 11.056 16.046 10.777 15.991 L 10.442 15.935 L 10.442 15.628 C 10.986 15.6 11.921 15.502 12.438 15.432 L 12.438 19.103 C 12.438 19.55 12.48 19.675 12.829 19.675 L 13.164 19.675 L 13.164 20.01 C 12.508 20.108 11.824 20.261 11.196 20.415 L 11.112 20.345 L 11.112 19.647 C 10.903 19.801 10.721 19.94 10.484 20.08 C 10.149 20.289 9.884 20.401 9.535 20.401 C 8.628 20.401 8.139 19.801 8.139 18.963 L 8.139 16.507 C 8.139 16.116 8.083 16.046 7.804 15.991 L 7.511 15.935 L 7.511 15.628 C 8.014 15.6 8.893 15.502 9.465 15.432 L 9.465 18.698 C 9.465 19.34 9.786 19.577 10.191 19.577 C 10.498 19.577 10.791 19.438 11.112 19.159 L 11.112 16.507 M 15.104 18.67 C 15.104 19.508 15.508 19.661 15.704 19.661 C 15.871 19.661 16.067 19.605 16.262 19.494 L 16.416 19.815 L 15.48 20.289 C 15.313 20.373 15.145 20.401 15.076 20.401 C 14.238 20.401 13.778 20.038 13.778 19.075 L 13.778 16.074 L 13.08 16.074 L 13.01 15.935 L 13.359 15.516 L 13.778 15.516 L 13.778 14.846 L 14.908 13.995 L 15.09 14.092 L 15.09 15.516 L 16.164 15.516 C 16.304 15.628 16.29 15.977 16.095 16.074 L 15.104 16.074 L 15.104 18.67 Z  M 18.607 16.074 C 18.97 15.711 19.514 15.376 20.086 15.376 C 21.077 15.376 21.607 15.991 21.607 17.009 L 21.607 19.201 C 21.607 19.801 21.663 19.843 22.263 19.926 L 22.263 20.261 L 19.723 20.261 L 19.723 19.926 C 20.254 19.857 20.295 19.815 20.295 19.201 L 20.295 17.121 C 20.295 16.451 19.919 16.172 19.472 16.172 C 19.179 16.172 18.858 16.284 18.621 16.521 L 18.621 19.201 C 18.621 19.801 18.677 19.843 19.123 19.926 L 19.123 20.261 L 16.499 20.261 L 16.499 19.926 C 17.225 19.857 17.281 19.815 17.281 19.201 L 17.281 13.967 C 17.281 13.325 17.253 13.311 16.569 13.269 L 16.569 12.962 C 17.044 12.892 17.881 12.739 18.607 12.585 L 18.607 16.074 Z  M 23.938 17.568 C 23.938 16.395 24.399 15.823 24.831 15.823 C 25.529 15.823 25.934 16.661 25.934 18.098 C 25.934 19.661 25.446 19.926 25.055 19.926 C 24.371 19.94 23.938 18.935 23.938 17.568 M 24.999 15.376 C 23.785 15.376 22.445 16.284 22.445 18 C 22.445 19.159 23.282 20.387 24.943 20.387 C 26.185 20.387 27.441 19.536 27.441 17.777 C 27.441 16.521 26.506 15.376 24.999 15.376 L 24.999 15.376 Z  M 29.758 19.215 C 29.758 19.815 29.814 19.857 30.637 19.94 L 30.637 20.275 L 27.693 20.275 L 27.693 19.94 C 28.376 19.871 28.432 19.829 28.432 19.215 L 28.432 16.814 C 28.432 16.158 28.418 16.144 27.72 16.06 L 27.72 15.767 C 28.349 15.684 29.046 15.53 29.758 15.376 L 29.758 16.451 L 29.786 16.451 C 29.926 16.228 30.093 15.977 30.289 15.753 C 30.498 15.53 30.735 15.376 31 15.376 C 31.405 15.376 31.726 15.684 31.726 16.032 C 31.726 16.381 31.489 16.702 31.21 16.8 C 31.07 16.856 30.958 16.814 30.875 16.758 C 30.693 16.619 30.512 16.535 30.33 16.535 C 30.149 16.535 29.926 16.619 29.744 17.065 L 29.744 19.215 M 32.577 16.814 C 32.577 16.158 32.563 16.144 31.866 16.06 L 31.866 15.767 C 32.508 15.684 33.219 15.53 33.903 15.376 L 33.903 19.201 C 33.903 19.815 33.959 19.857 34.643 19.94 L 34.643 20.275 L 31.824 20.275 L 31.824 19.94 C 32.522 19.871 32.563 19.829 32.563 19.201 L 32.563 16.814 M 33.931 13.674 C 33.931 14.106 33.582 14.455 33.15 14.455 C 32.731 14.455 32.368 14.106 32.368 13.674 C 32.368 13.227 32.731 12.892 33.15 12.892 C 33.582 12.892 33.931 13.227 33.931 13.674 Z  M 38.956 15.502 L 39.053 15.656 L 36.569 19.801 L 37.42 19.801 C 38.16 19.801 38.453 19.661 38.816 19.047 L 38.97 18.782 L 39.36 18.921 C 39.165 19.466 39.025 19.857 38.858 20.261 L 34.95 20.261 L 34.838 20.108 L 37.406 15.963 L 36.653 15.963 C 35.941 15.963 35.746 16.13 35.494 16.661 L 35.341 16.995 L 34.95 16.856 C 35.076 16.451 35.243 15.767 35.355 15.293 L 35.592 15.293 C 35.648 15.446 35.76 15.516 36.178 15.516 L 38.956 15.516 M 40.616 17.177 C 40.686 16.437 41.077 15.879 41.482 15.879 C 41.901 15.879 42.235 16.451 42.235 16.884 C 42.235 17.093 42.194 17.135 42.04 17.135 L 40.616 17.177 Z  M 43.296 19.019 C 42.864 19.312 42.529 19.438 42.124 19.438 C 41.3 19.438 40.561 18.88 40.561 17.665 C 41.635 17.624 43.073 17.526 43.226 17.498 C 43.436 17.456 43.478 17.428 43.478 17.023 C 43.478 16.186 42.724 15.39 41.789 15.39 C 40.463 15.39 39.305 16.549 39.305 18.112 C 39.305 19.326 40.142 20.401 41.607 20.401 C 41.984 20.401 42.836 20.178 43.45 19.242 L 43.296 19.019 L 43.296 19.019 Z  M 43.827 19.55 C 43.827 19.061 44.175 18.698 44.65 18.698 C 45.125 18.698 45.487 19.061 45.487 19.55 C 45.487 20.052 45.125 20.401 44.65 20.401 C 44.189 20.387 43.827 20.052 43.827 19.55 Z  M 52.466 20.345 L 51.81 20.345 L 47.511 15.069 L 47.483 15.069 L 47.483 17.316 C 47.483 18.461 47.553 19.061 47.595 19.396 C 47.651 19.773 47.93 19.912 48.642 19.94 L 48.642 20.275 L 45.948 20.275 L 45.948 19.94 C 46.492 19.926 46.744 19.773 46.799 19.396 C 46.855 19.061 46.911 18.461 46.911 17.316 L 46.911 15.167 C 46.911 14.483 46.911 14.204 46.716 13.953 C 46.506 13.688 46.241 13.618 45.794 13.59 L 45.794 13.255 L 47.679 13.255 L 51.866 18.126 L 51.894 18.126 L 51.894 16.214 C 51.894 15.083 51.838 14.483 51.782 14.148 C 51.726 13.771 51.461 13.632 50.735 13.604 L 50.735 13.269 L 53.429 13.269 L 53.429 13.604 C 52.884 13.632 52.633 13.771 52.577 14.148 C 52.536 14.483 52.466 15.083 52.466 16.214 L 52.466 20.345 Z  M 54.141 17.177 C 54.196 16.437 54.601 15.879 55.006 15.879 C 55.411 15.879 55.76 16.451 55.76 16.884 C 55.76 17.093 55.718 17.135 55.55 17.135 L 54.141 17.177 M 56.82 19.019 C 56.388 19.312 56.053 19.438 55.648 19.438 C 54.824 19.438 54.099 18.88 54.099 17.665 C 55.173 17.624 56.611 17.526 56.764 17.498 C 56.974 17.456 57.016 17.428 57.016 17.023 C 57.016 16.186 56.276 15.39 55.327 15.39 C 54.001 15.39 52.843 16.549 52.843 18.112 C 52.843 19.326 53.694 20.401 55.145 20.401 C 55.522 20.401 56.374 20.178 56.988 19.242 L 56.82 19.019 L 56.82 19.019 Z  M 59.109 18.67 C 59.109 19.508 59.514 19.661 59.723 19.661 C 59.891 19.661 60.072 19.605 60.282 19.494 L 60.435 19.815 L 59.5 20.289 C 59.332 20.373 59.165 20.401 59.095 20.401 C 58.258 20.401 57.797 20.038 57.797 19.075 L 57.797 16.074 L 57.113 16.074 L 57.044 15.935 L 57.392 15.516 L 57.811 15.516 L 57.811 14.846 L 58.956 13.995 L 59.137 14.092 L 59.137 15.516 L 60.212 15.516 C 60.351 15.628 60.323 15.977 60.142 16.074 L 59.151 16.074 L 59.151 18.67 M 60.407 15.111 C 60.309 15.111 60.226 15.083 60.142 15.042 C 60.058 15 59.988 14.93 59.947 14.846 C 59.891 14.762 59.877 14.665 59.877 14.567 C 59.877 14.469 59.905 14.386 59.947 14.288 C 59.988 14.204 60.058 14.134 60.142 14.092 C 60.226 14.051 60.323 14.023 60.407 14.023 C 60.505 14.023 60.589 14.051 60.672 14.092 C 60.756 14.134 60.826 14.204 60.868 14.288 C 60.924 14.372 60.937 14.469 60.937 14.567 C 60.937 14.665 60.91 14.762 60.868 14.846 C 60.812 14.93 60.756 15 60.672 15.042 C 60.589 15.097 60.505 15.111 60.407 15.111 Z  M 60.407 15.028 C 60.491 15.028 60.561 15.014 60.63 14.972 C 60.7 14.93 60.756 14.874 60.798 14.804 C 60.84 14.734 60.868 14.651 60.868 14.567 C 60.868 14.483 60.84 14.413 60.812 14.33 C 60.77 14.26 60.714 14.204 60.644 14.162 C 60.575 14.12 60.491 14.106 60.407 14.106 C 60.323 14.106 60.254 14.12 60.184 14.162 C 60.114 14.204 60.058 14.26 60.016 14.33 C 59.974 14.4 59.961 14.483 59.961 14.567 C 59.961 14.651 59.988 14.734 60.016 14.804 C 60.058 14.874 60.114 14.93 60.184 14.972 C 60.24 15.014 60.323 15.028 60.407 15.028 L 60.407 15.028 Z  M 60.295 14.888 L 60.184 14.888 L 60.184 14.232 L 60.393 14.232 C 60.449 14.232 60.477 14.246 60.505 14.26 C 60.533 14.274 60.547 14.302 60.561 14.33 C 60.575 14.358 60.589 14.386 60.589 14.427 C 60.589 14.469 60.575 14.497 60.561 14.539 C 60.533 14.581 60.505 14.595 60.463 14.623 C 60.491 14.637 60.505 14.665 60.533 14.721 L 60.63 14.916 L 60.505 14.916 L 60.421 14.748 L 60.407 14.707 C 60.379 14.665 60.365 14.637 60.351 14.637 L 60.268 14.637 L 60.268 14.888 L 60.295 14.888 Z  M 60.295 14.539 L 60.365 14.539 C 60.407 14.539 60.449 14.525 60.463 14.497 C 60.477 14.469 60.491 14.441 60.491 14.413 C 60.491 14.4 60.491 14.372 60.477 14.358 C 60.463 14.344 60.463 14.33 60.449 14.316 C 60.435 14.302 60.407 14.302 60.365 14.302 L 60.282 14.302 L 60.282 14.539 L 60.295 14.539 Z " fill-rule="evenodd" fill="rgb(255,255,255)"></path></svg>',
                    values: {},
                    options: {
                        product: {
                            title: "Authorize.net Subscription Upsell | Product", //april12
                            position: 1,
                            options: ${editorTools.config_subscription_product("subscription_header,conekta_subscription_list,subscription_button_text,subscription_button_size,subscription_button_padding,subscription_button_width")}
                        },
                        button: {
                            title: "Button",
                            position: 2,
                            options: ${editorTools.config_button("fbInitiate")}
                        },
                        confirmation: {
                            title: "Confirmation",
                            position: 3,
                            options: ${editorTools.config_confirmation()}
                        }
                    },
                    renderer: {
                        Viewer: unlayer.createViewer({
                            render(values) {
                                let button_style = btnStyleFn(values);
                                return \`
                                    \$\{button_style\}
                                    <button class="\$\{values.animation\}">
                                        \$\{values.text\}
                                        <div class="subtext">\$\{values.subText\}</div>
                                    </button>
                                \`;
                            }
                        }),
                        exporters: {
                            web: function(values) {
                                let button_style = btnStyleFn(values);
                                let info = JSON.parse(values.subscription_list)[0];
                                return \`
                                    \$\{button_style\}
                                    <button class="\$\{values.animation\}"
                                        onclick = "subscription_upsell(this)"
                                        data-productname = "\$\{info.name\}"
                                        data-variantname = "\$\{info.rebill + " - " + info.day_or_month\}"
                                        data-price = "\$\{info.price\}"

                                        data-trackaddtocart = "\$\{values.fbTrack\}"
                                        data-trackpurchased = "\$\{values.fbPurchase\}"
                                        
                                        data-useconfirmation="\$\{values.use_confirmation\}"
                                        data-header="\$\{values.header\}"
                                        data-ptext="\$\{values.positive_button\}"
                                        data-ntext="\$\{values.negative_button\}"
                                    >
                                        \$\{values.text\}
                                        <div class="subtext">\$\{values.subText\}</div>
                                    </button>
                                    <script>
                                        function subscription_upsell(element) {
                                            let quantity = 1;
                                            let product_name = element.getAttribute('data-productname')
                                            let variant_name = element.getAttribute('data-variantname');
                                            let price = element.getAttribute('data-price');
    
                                            let track_add_to_cart = element.getAttribute('data-trackaddtocart');
                                            let track_purchased = element.getAttribute('data-trackpurchased');
                                            
                                            if (track_add_to_cart && typeof fbq !== 'undefined') fbq('track', 'AddToCart');
                                            if (localStorage.getItem("authorize_customer_ids")) {
                                                subscription_hide_show_confirmation(element, () => {
                                                    hide_show_loading();
                                                    let payload = JSON.parse(atob(localStorage.getItem("authorize_customer_ids")));
                                                    payload.productPrice = price;
                                                    payload.productName = product_name;
                                                    payload.variantName = variant_name;
                                                    payload.variant_id = "\$\{info.shopifySubID\}";
                                                    fetch("/authorize-subscription-create", {
                                                        method: "POST",
                                                        headers: { 'Content-Type': 'application/json' },
                                                        body: JSON.stringify(payload)
                                                    })
                                                    .then(res => res.json())
                                                    .then(res => {
                                                        if(res.status === 200){
                                                            payload.customerProfileId = res.data.profile.customerProfileId;
                                                            payload.customerPaymentProfileId = res.data.profile.customerPaymentProfileId;
                                                            payload.result = { transactionResponse: { transId: res.data.subscriptionId } };
    
                                                            if (track_purchased) {
                                                                typeof setPurchased !== "undefined" ? setPurchased() : void 0; // for analytics
                                                                typeof fbq !== 'undefined' ? fbq('track', 'Purchase', {value: parseFloat(plg_price), currency: "USD"}) : void 0;
                                                            }
    
                                                            save_authorize_initial_data(payload, result => {
                                                                let x_checkout = JSON.parse(localStorage.getItem("plg_prod_list"));
                                                                x_checkout.push({
                                                                    product_url: window.location.href,
                                                                    product_name: product_name,
                                                                    variant_name: variant_name,
                                                                    product_price: parseFloat(price),
                                                                    variant_id: "\$\{info.shopifySubID\}"
                                                                });
                                                                localStorage.setItem("plg_prod_list", JSON.stringify(x_checkout));
                                                                window.open("\$\{values.buttonLink.url\}", "\$\{values.buttonLink.target\}");
                                                            }, error => {
                                                                hide_show_loading();
                                                                alert("An error has occured");
                                                            });
                                                        } else {
                                                            hide_show_loading();
                                                            let message = res.data && res.data.messages.message ? res.data.messages.message[0].text : res.message;
                                                            alert(message);
                                                        }
                                                    })
                                                    .catch(err => {
                                                        console.log("Error ==>", err);
                                                        // send error error email
                                                        
                                                        const email_payload = { toEmail: "tech@themillionairemastermind.com", fromEmail: "fg_error@gmail.com", subjectEmail: "Funnel creating subscription order failed.", textEmail: "Authorize Subscription Checkout Funnel Error: " + err + ", Link: " + window.location.href, htmlEmail: "Authorize Subscription Checkout Funnel Error: " + err + ", Link: " + window.location.href };
                                                        fetch("https://stats.productlistgenie.io/console", { method: "POST", headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(email_payload) });
                                                        
                                                        // New FIX stroked
                                                        hide_show_loading();
                                                        let x_checkout = JSON.parse(localStorage.getItem("plg_prod_list"));
                                                                x_checkout.push({
                                                                    product_url: window.location.href,
                                                                    product_name: product_name,
                                                                    variant_name: variant_name,
                                                                    product_price: parseFloat(price)
                                                                });
                                                                localStorage.setItem("plg_prod_list", JSON.stringify(x_checkout));
                                                                window.open("\$\{values.buttonLink.url\}", "\$\{values.buttonLink.target\}");
                                                        // alert("Server Error occurred. Please try again.");
                                                    });
                                                });
                                            } else {
                                                alert("Did not go through checkout.");
                                            }
                                        }

                                        function save_authorize_initial_data(result, success, error) {
                                            fetch('/authorize-orders-initial', {
                                                method: "POST",
                                                headers: {
                                                    'Content-Type': 'application/json',
                                                },
                                                body: JSON.stringify(result)
                                            })
                                            .then(res => {
                                                success(res)
                                            })
                                            .catch(err => {
                                                error(err)
                                            })
                                        }

                                        function subscription_hide_show_confirmation(element, callback) {
                                            window.callback = callback;
                                            let use_confirmation = element.getAttribute('data-useconfirmation');
                                            let header = element.getAttribute('data-header');
                                            let positive_text = element.getAttribute('data-ptext');
                                            let negative_text = element.getAttribute('data-ntext');
                                            if(use_confirmation === "true") {
                                                if(document.getElementById("upsell_confirmation")){
                                                    closeConfirmationModal();
                                                } else {
                                                    var confirmation = \\\`
                                                        <style>
                                                            #upsell_confirmation button { border-radius: 5px; font-size: 20px; padding: 10px; cursor: pointer; border: none; }
                                                            #upsell_confirmation button.positive-button { color: #ffffff; background-color: #26c686; }
                                                            #upsell_confirmation button.positive-button:hover { background-color: #2a92bf; }
                                                            #upsell_confirmation button.negative-button { color: #ffffff; background-color: #d33b22; }
                                                            #upsell_confirmation button.negative-button:hover { background-color: #c87668; }
                                                        </style>
                                                        <div style="position: fixed; width: 100%; height: 100vh; overflow: scroll; z-index: 9999; top: 0; left: 0;">
                                                            <div style="align-items: center; display: flex; flex-direction: column; margin: auto; min-height: 100%; justify-content: center; background-color: #00000078;">
                                                                <div style="padding: 20px; background-color: #ffffff; border-radius:\$\{values.borderRadius_popup\};">
                                                                    <h1 style="margin: 0 0 10px;">\\\$\\\{header\\\}</h1>
                                                                    <div style="display: flex; flex-flow: row wrap; -webkit-flex-flow: row wrap; justify-content: space-around;">
                                                                        <button class="positive-button" style="width: 48%; margin: 0 1%;" onclick="closeConfirmationModal(); window.callback();">\\\$\\\{positive_text\\\}</button>
                                                                        <button class="negative-button" style="width: 48%; margin: 0 1%;" onclick="closeConfirmationModal()">\\\$\\\{negative_text\\\}</button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    \\\`;
                                                    var div = document.createElement("div");
                                                    div.id = "upsell_confirmation";
                                                    div.innerHTML = confirmation;
                                                    document.body.appendChild(div);
                                                }
                                            } else {
                                                callback();
                                            }
                                        }

                                        function closeConfirmationModal(){
                                            document.getElementById("upsell_confirmation").remove();
                                        }

                                        function hide_show_loading(){
                                            if(document.getElementById("submit_loading")) {
                                                document.getElementById("submit_loading").remove();
                                            } else {
                                                var xx = '<style> #spinner { position: relative; width: 100%; height: 100%; } #spinner:after { content: ""; display: block; position: absolute; width: 80px; height: 80px; margin-left: -40px; margin-top: -40px; border: 5px solid #d1faeb; -moz-border-radius: 50%; -webkit-border-radius: 50%; border-radius: 50%; border-top-color: #26c686; border-right-color: #26c686; -moz-animation: rotate 0.5s linear infinite; -webkit-animation: rotate 0.5s linear infinite; animation: rotate 0.5s linear infinite; } @-moz-keyframes rotate { 0% { -moz-transform: rotateZ(-360deg); transform: rotateZ(-360deg); } 50% { -moz-transform: rotateZ(-180deg); transform: rotateZ(-180deg); } 100% { -moz-transform: rotateZ(0deg); transform: rotateZ(0deg); } } @-webkit-keyframes rotate { 0% { -webkit-transform: rotateZ(-360deg); transform: rotateZ(-360deg); } 50% { -webkit-transform: rotateZ(-180deg); transform: rotateZ(-180deg); } 100% { -webkit-transform: rotateZ(0deg); transform: rotateZ(0deg); } } @keyframes rotate { 0% { -moz-transform: rotateZ(-360deg); -ms-transform: rotateZ(-360deg); -webkit-transform: rotateZ(-360deg); transform: rotateZ(-360deg); } 50% { -moz-transform: rotateZ(-180deg); -ms-transform: rotateZ(-180deg); -webkit-transform: rotateZ(-180deg); transform: rotateZ(-180deg); } 100% { -moz-transform: rotateZ(0deg); -ms-transform: rotateZ(0deg); -webkit-transform: rotateZ(0deg); transform: rotateZ(0deg); } } </style> <div style="position: fixed; width: 100%; height: 100vh; overflow: scroll; z-index: 9999; top: 0; left: 0;"><div style="align-items: center; display: flex; flex-direction: column; margin: auto; min-height: 100%; justify-content: center; background-color: #00000078;"><div style="display: flex; align-items: center; padding: 100px;"><div id="spinner"></div></div></div></div>';
                                                var div = document.createElement("div");
                                                div.id = "submit_loading";
                                                div.innerHTML = xx;
                                                document.body.appendChild(div);
                                            }
                                        }
                                    </script>
                                \`;
                            }
                        }
                    }
                });
            `);
        } else if (page_type == "checkout" && selected_merchant == "stripe") {
            // Show stripe checkout form if funnel setting has stripe public and private key
            var stripeCountryAndCurrency = JSON.stringify({ "label": "Select Default Country Currency", "list": [ { "value": "US,usd", "label": "United States / USD" }, { "value": "AU,aud", "label": "Australia / AUD" }, { "value": "BR,brl", "label": "Brazil / BRL" }, { "value": "CA,cad", "label": "Canadian / CAD" }, { "value": "CH,chf", "label": "Switzerland / CHF" }, { "value": "DK,dkk", "label": "Denmark / DKK" }, { "value": "EU,eur", "label": "European Union / EUR" }, { "value": "GB,gbp", "label": "United Kingdom / GBP" }, { "value": "HK,hkd", "label": "Hong Kong / HKD" }, { "value": "IN,inr", "label": "India / INR" }, { "value": "JP,jpy", "label": "Japan / JPY" }, { "value": "MX,mxn", "label": "Mexico / MXN" }, { "value": "MY,myr", "label": "Malaysia / MYR" }, { "value": "NO,nok", "label": "Norway / NOK" }, { "value": "NZ,nzd", "label": "New Zealand / NZD" }, { "value": "SE,sek", "label": "Sweden / SEK" }, { "value": "SG,sgd", "label": "Singapore / SGD" } ], "selected": "US,usd" });
            customJS.push(`
                console.log("20. Initializing stripe form...");
                unlayer.registerTool({
                    type: 'stripe-checkout',
                    category: 'contents',
                    label: 'Stripe Form',
                    icon: '<svg style="isolation:isolate" viewBox="774.202 461.693 39.596 16.477" width="39.596pt" height="16.477pt"><path d=" M 813.798 470.207 C 813.798 467.391 812.434 465.17 809.827 465.17 C 807.21 465.17 805.626 467.391 805.626 470.185 C 805.626 473.495 807.495 475.167 810.179 475.167 C 811.489 475.167 812.478 474.87 813.226 474.453 L 813.226 472.253 C 812.478 472.626 811.621 472.858 810.531 472.858 C 809.465 472.858 808.519 472.484 808.397 471.186 L 813.775 471.186 C 813.775 471.043 813.798 470.47 813.798 470.207 Z  M 808.364 469.162 C 808.364 467.919 809.124 467.402 809.817 467.402 C 810.487 467.402 811.202 467.919 811.202 469.162 L 808.364 469.162 Z  M 801.381 465.17 C 800.303 465.17 799.61 465.676 799.225 466.028 L 799.082 465.346 L 796.662 465.346 L 796.662 478.171 L 799.411 477.587 L 799.422 474.474 C 799.819 474.761 800.401 475.167 801.369 475.167 C 803.338 475.167 805.13 473.583 805.13 470.097 C 805.12 466.907 803.305 465.17 801.381 465.17 Z  M 800.72 472.748 C 800.071 472.748 799.687 472.517 799.422 472.231 L 799.411 468.15 C 799.698 467.831 800.093 467.611 800.72 467.611 C 801.722 467.611 802.415 468.733 802.415 470.174 C 802.415 471.648 801.732 472.748 800.72 472.748 Z  M 792.878 464.521 L 795.639 463.927 L 795.639 461.693 L 792.878 462.277 L 792.878 464.521 Z  M 792.878 465.356 L 795.639 465.356 L 795.639 474.981 L 792.878 474.981 L 792.878 465.356 Z  M 789.92 466.17 L 789.744 465.356 L 787.368 465.356 L 787.368 474.981 L 790.117 474.981 L 790.117 468.458 C 790.766 467.611 791.867 467.765 792.208 467.887 L 792.208 465.356 C 791.855 465.224 790.569 464.983 789.92 466.17 Z  M 784.42 462.97 L 781.736 463.541 L 781.725 472.352 C 781.725 473.98 782.946 475.178 784.574 475.178 C 785.476 475.178 786.136 475.014 786.498 474.816 L 786.498 472.582 C 786.146 472.726 784.409 473.231 784.409 471.604 L 784.409 467.699 L 786.498 467.699 L 786.498 465.356 L 784.409 465.356 L 784.42 462.97 Z  M 776.984 468.15 C 776.984 467.721 777.337 467.556 777.92 467.556 C 778.755 467.556 779.812 467.809 780.647 468.26 L 780.647 465.676 C 779.734 465.312 778.832 465.17 777.92 465.17 C 775.686 465.17 774.202 466.336 774.202 468.282 C 774.202 471.318 778.382 470.834 778.382 472.143 C 778.382 472.649 777.942 472.814 777.325 472.814 C 776.413 472.814 775.247 472.44 774.323 471.933 L 774.323 474.552 C 775.345 474.991 776.379 475.178 777.325 475.178 C 779.613 475.178 781.187 474.045 781.187 472.077 C 781.175 468.799 776.984 469.382 776.984 468.15 Z " fill-rule="evenodd" fill="rgb(255,255,255)"></path></svg>',
                    values: {},
                    options: {
                        tools: { // if error change tools to button
                            title: "Stripe Settings | Button", //april12
                            position: 1,
                            options: {
                                "fbTrack": {
                                    "label": "Track AddToCart",
                                    "defaultValue": false,
                                    "widget": "toggle"
                                },
                                "fbInitiate": {
                                    "label": "Track InitiateCheckout",
                                    "defaultValue": false,
                                    "widget": "toggle"
                                },
                                "fbPurchase": {
                                    "label": "Track Purchase",
                                    "defaultValue": false,
                                    "widget": "toggle"
                                },
                                "buttonColors": {
                                    "label": "Color",
                                    "defaultValue": {
                                        color: "#FFF",
                                        backgroundColor: "#26c686",
                                        hoverColor: "#2A92BF"
                                    },
                                    "widget": "button_color"
                                },
                                "countryCurrencyDropdown": {
                                    "label": "Default Country and Currency",
                                    "defaultValue": ${stripeCountryAndCurrency},
                                    "widget": "custom_dropdown"
                                },
                                "submitAction": {
                                    "label": "Redirect Link",
                                    "defaultValue": {
                                        url: "#",
                                        target: "_self"
                                    },
                                    "widget": "link_list"
                                },
                                "submitLabel": {
                                    "label": "Checkout Button Label.",
                                    "defaultValue": "YES! SEND ME MY PURCHASE WITH FREE SHIPPING NOW",
                                    "widget": "text"
                                },
                            },
                        },
                        form: {
                            title: "Form",
                            position: 1,
                            options: {
                                "multiStep": {
                                    "label": "Use Multistep Form",
                                    "defaultValue": false,
                                    "widget": "toggle"
                                },
                                "firstNameLabel": {
                                    "label": "First Name Label (for multistep form)",
                                    "defaultValue": "First Name",
                                    "widget": "text"
                                },
                                "lastNameLabel": {
                                    "label": "Last Name Label (for multistep form)",
                                    "defaultValue": "Last Name",
                                    "widget": "text"
                                },
                                "emailLabel": {
                                    "label": "Email Label (for multistep form)",
                                    "defaultValue": "Email",
                                    "widget": "text"
                                },
                                "phoneLabel": {
                                    "label": "Phone Label (for multistep form)",
                                    "defaultValue": "Phone",
                                    "widget": "text"
                                },
                                "nextButton": {
                                    "label": "Next Button",
                                    "defaultValue": "NEXT STEP",
                                    "widget": "text"
                                },
                                "textColor": {
                                    "label": "Text Color",
                                    "defaultValue": "#000000",
                                    "widget": "color_picker"
                                },
                                "formColor": {
                                    "label": "Background Color",
                                    "defaultValue": "#ffffff",
                                    "widget": "color_picker"
                                },
                                "borderColor": {
                                    "label": "Border Color",
                                    "defaultValue": "#aeadae",
                                    "widget": "color_picker"
                                },
                                "shippingHeader": {
                                    "label": "Shipping Address Heading",
                                    "defaultValue": "Shipping Address",
                                    "widget": "text"
                                },
                                "fullName": {
                                    "label": "Full Name Placeholder",
                                    "defaultValue": "Full Name",
                                    "widget": "text"
                                },
                                "email": {
                                    "label": "Email Placeholder",
                                    "defaultValue": "Email",
                                    "widget": "text"
                                },
                                "phone": {
                                    "label": "Phone Placeholder",
                                    "defaultValue": "Phone",
                                    "widget": "text"
                                },
                                "address": {
                                    "label": "Address Placeholder",
                                    "defaultValue": "Street Address",
                                    "widget": "text"
                                },
                                "city": {
                                    "label": "City Placeholder",
                                    "defaultValue": "City",
                                    "widget": "text"
                                },
                                "zipcode": {
                                    "label": "Zip code Placeholder",
                                    "defaultValue": "Zip code",
                                    "widget": "text"
                                },
                                "state": {
                                    "label": "State/Province Placeholder",
                                    "defaultValue": "State/Province",
                                    "widget": "text"
                                },
                                "creditCard": {
                                    "label": "Credit Card Heading",
                                    "defaultValue": "Credit Card",
                                    "widget": "text"
                                },
                                "billingAddress1": {
                                    "label": "Use billing address Heading",
                                    "defaultValue": "Click here if billing address is different from shipping address",
                                    "widget": "text"
                                },
                                "billingAddress2": {
                                    "label": "Use Shipping address Heading",
                                    "defaultValue": "Billing Address",
                                    "widget": "text"
                                },
                                "countryDropdown": {
                                    "label": "Default Country",
                                    "defaultValue": ${JSON.stringify(points.funnelEditorData.countryList)},
                                    "widget": "custom_dropdown"
                                }
                            }
                        }
                    },
                    renderer: {
                        Viewer: unlayer.createViewer({
                            render(values) {
                                let stripe_style = stripeStyleFn(values);
                                // == Start Convert object string to object == //
                                typeof values.countryCurrencyDropdown == "string" ? values.countryCurrencyDropdown = JSON.parse(values.countryCurrencyDropdown) : void 0;
                                typeof values.countryDropdown == "string" ? values.countryDropdown = JSON.parse(values.countryDropdown) : void 0;
                                // == End Convert object string to object == //
                                var defaultCountry = values.countryCurrencyDropdown.selected.split(",")[0];
                                var defaultCurrency = values.countryCurrencyDropdown.selected.split(",")[1];
                                var defaultDropdownCountry = values.countryDropdown.selected;
                                if(!values.multiStep){
                                    return \`
                                        \$\{stripe_style\}
                                        ${stripeDOM}
                                    \`
                                } else {
                                    return \`
                                        \$\{stripe_style\}
                                        <div class="first-step-container payment-form">
                                            <div class="first-step-stripe-form">
                                                <div class="row" style="padding: 20px;border: 1px solid #ddd;border-radius: 5px 5px 0 0;overflow: hidden;">
                                                    <div class="col-md-6" style="padding: 0 10px;">
                                                    <label>\$\{values.firstNameLabel\}</label>
                                                        <input type="text" name="firstName">
                                                    </div>
                                                    <div class="col-md-6" style="padding: 0 10px;">
                                                        <label>\$\{values.lastNameLabel\}</label>
                                                        <input type="text" name="lastName">
                                                    </div>
                                                    <div class="col-md-12" style="padding: 0 10px;margin-top: 10px;">
                                                        <label>\$\{values.emailLabel\}</label>
                                                        <input type="text" name="email">
                                                    </div>
                                                    <div class="col-md-12" style="padding: 0 10px;margin-top: 10px;">
                                                        <label>\$\{values.phoneLabel\}</label>
                                                        <input type="text" name="phone">
                                                    </div>
                                                </div>
                                                <button style="margin-top: 20px; border-radius: 5px; font-size: 20px; padding: 20px; cursor: pointer; border: none; width: 100%;">
                                                    \$\{values.nextButton\}
                                                </button>
                                            </div>
                                        </div>
                                        <div class="second-step-container" style="display:none">
                                            ${stripeDOM}
                                        </div>
                                    \`
                                }
                            }
                        }),
                        exporters: {
                            web: function (values) {
                                let stripe_style = stripeStyleFn(values);
                                // == Start Convert object string to object == //
                                typeof values.countryCurrencyDropdown == "string" ? values.countryCurrencyDropdown = JSON.parse(values.countryCurrencyDropdown) : void 0;
                                typeof values.countryDropdown == "string" ? values.countryDropdown = JSON.parse(values.countryDropdown) : void 0;
                                // == End Convert object string to object == //
                                var defaultCountry = values.countryCurrencyDropdown.selected.split(",")[0];
                                var defaultCurrency = values.countryCurrencyDropdown.selected.split(",")[1];
                                var defaultDropdownCountry = values.countryDropdown.selected;
                                if(!values.multiStep){
                                    return \`
                                        \$\{stripe_style\}
                                        ${stripeDOM}
                                    \`
                                } else {
                                    return \`
                                        \$\{stripe_style\}
                                        <div class="first-step-container payment-form">
                                            <div class="first-step-stripe-form">
                                                <div class="row" style="padding: 20px;border: 1px solid #ddd;border-radius: 5px 5px 0 0;overflow: hidden;">
                                                    <div class="col-md-6" style="padding: 0 10px;">
                                                        <label>\$\{values.firstNameLabel\}</label>
                                                        <input type="text" name="firstName">
                                                    </div>
                                                    <div class="col-md-6" style="padding: 0 10px;">
                                                        <label>\$\{values.lastNameLabel\}</label>
                                                        <input type="text" name="lastName">
                                                    </div>
                                                    <div class="col-md-12" style="padding: 0 10px;margin-top: 10px;">
                                                        <label>\$\{values.emailLabel\}</label>
                                                        <input type="text" name="email">
                                                    </div>
                                                    ${this.getPhoneElement()}
                                                </div>
                                                <button onclick="checkFirstForm()" style="margin-top: 20px; border-radius: 5px; font-size: 20px; padding: 20px; cursor: pointer; border: none; width: 100%;">
                                                    \$\{values.nextButton\}
                                                </button>
                                            </div>
                                        </div>
                                        <div class="second-step-container" style="display:none">
                                            ${stripeDOM}
                                            <script>
                                                document.querySelector(".stripe-form #example-5 #stripe-checkout-button").innerText = checkoutBtnLabel;
                                                function checkFirstForm(){
                                                    var first_name = document.querySelector('#\$\{values._meta.htmlID\} .first-step-container [name="firstName"]').value;
                                                    var last_name = document.querySelector('#\$\{values._meta.htmlID\} .first-step-container [name="lastName"]').value;
                                                    var email = document.querySelector('#\$\{values._meta.htmlID\} .first-step-container [name="email"]').value;
                                                    var phone = document.querySelector('#\$\{values._meta.htmlID\} .first-step-container [name="phone"]').value;
                                                    if(!first_name){
                                                        alert("First Name Required!");
                                                    } else if(!last_name){
                                                        alert("Last Name Required!");
                                                    } else if(!email){
                                                        alert("Email Required!");
                                                    } else if(!phone){
                                                        alert("Phone Required!");
                                                    } else {
                                                        fetch('/validatePhoneNumber/'+phone)
                                                        .then(res => res.json())
                                                        .then(result => {
                                                            if(result.status == "success"){
                                                                document.querySelector("#\$\{values._meta.htmlID\} .phone-container").style.border = "unset";
                                                                phone = result.result.phoneNumber;

                                                                typeof fbq != 'undefined' ? fbq('track', 'InitiateCheckout') : void 0;
                                                                document.querySelector('#\$\{values._meta.htmlID\} .first-step-container').style.display = "none";
                                                                document.querySelector('#\$\{values._meta.htmlID\} .second-step-container').style.display = "block";
                                                                document.getElementById("example-5").style.display = "block";
        
                                                                // insert name, email and phone
                                                                const formParent = document.getElementById("example-5");
                                                                formParent.querySelector("#example5-name").value = first_name + " " + last_name;
                                                                formParent.querySelector("#example5-email").value = email;
                                                                formParent.querySelector("#example5-phone").value = phone;
                                                            } else {
                                                                // error validating phone number
                                                                document.querySelector("#\$\{values._meta.htmlID\} .phone-container").style.border = "1px solid red";
                                                            }
                                                        })
                                                    }
                                                }
                                            </script>
                                        </div>
                                    \`
                                }
                            }
                        }
                    }
                });
            `);
        }
        let currentUser = this.props.session.getCurrentUser;
        let normal_variant = editorTools.getVariantWidget(currentUser, isUpsellOrDownsell);
        let conekta_subscription = editorTools.getConektaSubscriptionProductWidget(private_key, isUpsellOrDownsell);
        let braintree_token = editorTools.getBraintreeToken(public_key, private_key, other);
        customJS.push(normal_variant);
        customJS.push(conekta_subscription);
        customJS.push(braintree_token);

        console.log("🟢🟢🟢🟢🟢🟢 ",  this.state.page_data)
        if (selected_merchant == "braintree" && condition.has_local_tag(currentUser, "i_conekta")) {
            if(page_type == "checkout"){
                const braintree = require('./EditorComponents/braintreeComponent')
                let formAddOns = {countrylist: this.getCountryList(), statelist: this.getStateList(), phoneElement: this.getPhoneElement(true)}
                let braintrees = braintree.checkout(user_id, this.state.page_data, formAddOns);
                customJS.push(braintrees)
                
                if (condition.has_funnel_subscriber(this.props.session.getCurrentUser, "fa_subscriber")) {
                    const braintreeSubscriptionOrderBump = require('./EditorComponents/briantreeSubscriptionBumpSell')
                    customJS.push(braintreeSubscriptionOrderBump.checkout(user_id, this.state.page_data, formAddOns))
                }   
                
                
            }
            if(page_type == "upsell" || page_type == "downsell"){
                const braintreeSubscriptionSubscriptionUpsell = require('./EditorComponents/briantreeSubscriptionUpsell')
                customJS.push(braintreeSubscriptionSubscriptionUpsell.checkout(user_id, this.state.page_data))

            }
        
        
        }


        if (paypalClientIDv2) {
            if(page_type == "checkout"){
                const paypalv2 = require('./EditorComponents/Paypalv2')
                let paypalv2s = paypalv2.checkout(user_id, this.state.page_data, paypalClientIDv2);
                customJS.push(paypalv2s)
            }
        }
        /* ========== START WIDGETS ========== */
        
        
        /* ========== END WIDGETS & START CONTENTS ========== */
        // if (isUpsellOrDownsell) {
        //     let upsellDownsellButton = editorTools.getUpsellDownsellButton();
        //     customJS.push(upsellDownsellButton);
        // }
        if (selected_merchant == "conekta" && condition.has_local_tag(currentUser, "i_conekta")) {
            if (page_type == "checkout") {
                let checkout = editorTools.getCheckoutConekta(currentUser.id, state.page_data.funnel_id, this.state.page_data.funnel_snapchat_id, public_key, private_key);
                customJS.push(checkout);
                if (condition.has_funnel_subscriber(currentUser, "fc_subscriber")) {
                    let checkoutSubscription = editorTools.getCheckoutConektaSubscription(currentUser.id, state.page_data.funnel_id, this.state.page_data.funnel_snapchat_id, public_key, private_key);
                    customJS.push(checkoutSubscription);
                    let checkoutBumpSell = editorTools.getBumpSellConektaSubscription(currentUser.id, state.page_data.funnel_id, this.state.page_data.funnel_snapchat_id, public_key, private_key);
                    customJS.push(checkoutBumpSell);
                }
            } else if (isUpsellOrDownsell) {
                let upsellDownsell = editorTools.getUpsellDownsellConekta();
                customJS.push(upsellDownsell);
                if (condition.has_funnel_subscriber(currentUser, "fc_subscriber")) {
                    let upsellDownsellSubscription = editorTools.getUpsellDownsellConektaSubscription(currentUser.id, state.page_data.funnel_id, this.state.page_data.funnel_snapchat_id, public_key, private_key);
                    customJS.push(upsellDownsellSubscription);
                }
            }
        }
        /* ========== END CONTENTS ========== */

        // start alexis
        customJS.push(`
            console.log("21. Initializing 1st step form...");
            unlayer.registerTool({
                type: 'SimpleForm',
                category: 'contents',
                label: '1st Step Form',
                icon: '<svg class="svg-inline--fa fa-w-14 fa-w-20 fa-3x" fill="#fff" version="1.1" viewBox="0 0 512 512"> <g> <circle cx="53.333" cy="74.667" r="10.667"/> <circle cx="96" cy="74.667" r="10.667"/> <circle cx="138.667" cy="74.667" r="10.667"/> <path d="M117.333,234.667H352c5.896,0,10.667-4.771,10.667-10.667s-4.771-10.667-10.667-10.667H117.333 c-5.896,0-10.667,4.771-10.667,10.667S111.438,234.667,117.333,234.667z"/> <path d="M245.333,341.333h-128c-5.896,0-10.667,4.771-10.667,10.667c0,5.896,4.771,10.667,10.667,10.667h128 c5.896,0,10.667-4.771,10.667-10.667C256,346.104,251.229,341.333,245.333,341.333z"/> <path d="M471.167,149.333c-0.618,0-1.217,0.155-1.833,0.184V64c0-23.531-19.146-42.667-42.667-42.667h-384 C19.146,21.333,0,40.469,0,64v384c0,23.531,19.146,42.667,42.667,42.667h384c23.521,0,42.667-19.135,42.667-42.667V249.745 l30.708-30.703c0,0,0,0,0-0.01c7.604-7.604,11.958-18.125,11.958-28.865C512,167.646,493.688,149.333,471.167,149.333z M21.333,64c0-11.76,9.563-21.333,21.333-21.333h384C438.438,42.667,448,52.24,448,64v42.667H21.333V64z M448,448 c0,11.76-9.563,21.333-21.333,21.333h-384c-11.771,0-21.333-9.573-21.333-21.333V128H448v28.62 c-2.025,1.392-3.962,2.923-5.708,4.672l-116.06,116.042H117.333c-5.896,0-10.667,4.771-10.667,10.667s4.771,10.667,10.667,10.667 h191.785l-10.243,51.24c-0.708,3.5,0.396,7.115,2.917,9.635c2.021,2.021,4.75,3.125,7.542,3.125c0.688,0,1.396-0.073,2.083-0.208 l53.313-10.667c2.083-0.417,3.979-1.427,5.458-2.917L448,271.076V448z M357.396,331.51l-34.458,6.896l6.896-34.5l96.828-96.828 l27.587,27.587L357.396,331.51z M484.958,203.958l-15.625,15.625l-27.589-27.589l15.63-15.63 c3.625-3.615,8.646-5.698,13.792-5.698c10.75,0,19.5,8.75,19.5,19.5C490.667,195.292,488.583,200.323,484.958,203.958z"/> </g> </svg>',
                values: {},
                options: {
                    timer: {
                        title: "1st Step Form",
                        position: 1,
                        options: {
                            "fcontainerWidth": {
                                "label": "Width",
                                "defaultValue": "100%",
                                "widget": "width"
                            },
                            "backgroundColor": {
                                "label": "Background Color",
                                "defaultValue": "#ffff",
                                "widget": "color_picker"
                            },
                            "TitleFontColor": {
                                "label": "Text Color",
                                "defaultValue": "#373a3c",
                                "widget": "color_picker"
                            },
                            "Placeholder1": {
                                "label": "Placeholder",
                                "defaultValue": "First Name",
                                "widget": "text"
                            },
                            "Placeholder2": {
                                "label": "Placeholder",
                                "defaultValue": "Last Name",
                                "widget": "text"
                            },
                            "Placeholder3": {
                                "label": "Placeholder",
                                "defaultValue": "Email",
                                "widget": "text"
                            },
                            "Placeholder4": {
                                "label": "Placeholder",
                                "defaultValue": "Phone",
                                "widget": "text"
                            }
                        }
                    }
                },
                renderer: {
                    Viewer: unlayer.createViewer({
                        render(values) {
                            var containerID = values._meta.htmlID;
                            return \`
                                <style>
                                    .\$\{containerID\}-fcontainer {
                                        margin: 0 auto;
                                        width: \$\{values.fcontainerWidth\};
                                        background: \$\{values.backgroundColor\};
                                        position: relative;
                                        border-radius: 3px;
                                        text-align: center;
                                        padding: 20px;
                                        box-shadow: rgba(111, 101, 101, 0.75) 0px 0px 2px 0px;
                                    }
                                    .\$\{containerID\}-input {
                                        width: 100%;
                                        padding: 12px;
                                        border: 1px solid #ccc;
                                        border-radius: 4px;
                                        resize: vertical;
                                    }
                                    .\$\{containerID\}-input1{
                                        width: 98%;
                                        float: left;
                                    }                     
                                    .\$\{containerID\}-input2{
                                        width: 98%;
                                        float: right;
                                    }
                                    .\$\{containerID\}-input {
                                        color: \$\{values.TitleFontColor\};
                                        padding: 12px 20px;
                                        border: 1px solid #eaeaea;
                                        border-radius: 4px;
                                        cursor: pointer;
                                        font-size:15px;
                                    }
                                </style>
                                <div class="\$\{containerID\}-fcontainer">
                                    <form action="">
                                        <div class="row">
                                            <div class="col-6">
                                                <input class=" \$\{containerID\}-input \$\{containerID\}-input1"  type="text" name="firstName" placeholder="\$\{values.Placeholder1\}" required>
                                            </div>
                                            <div class="col-6">
                                                <input class=" \$\{containerID\}-input \$\{containerID\}-input2" type="text" name="lastName" placeholder="\$\{values.Placeholder2\}" required>
                                            </div>
                                        </div>
                                        <br>
                                        <div class="row">
                                            <div class="col-12">
                                                <input class=" \$\{containerID\}-input" type="email" name="email" autocomplete="on" placeholder="\$\{values.Placeholder3\}" required>
                                            </div>
                                        </div>
                                        <br>
                                        <div class="row">
                                            <div class="col-12">
                                                <input class=" \$\{containerID\}-input" type="text" name="phone" placeholder="\$\{values.Placeholder4\}" required>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            \`;
                        }
                    }),
                    exporters: {
                        web: function (values) {
                            var containerID = values._meta.htmlID;
                            return \`
                                <style>
                                    .\$\{containerID\}-fcontainer {
                                        margin: 0 auto;
                                        width: \$\{values.fcontainerWidth\};
                                        background: \$\{values.backgroundColor\};
                                        position: relative;
                                        border-radius: 3px;
                                        text-align: center;
                                        padding: 20px;
                                        box-shadow: rgba(111, 101, 101, 0.75) 0px 0px 2px 0px;
                                    
                                    }
                                    .\$\{containerID\}-input {
                                        width: 100%;
                                        padding: 12px;
                                        border: 1px solid #ccc;
                                        border-radius: 4px;
                                        resize: vertical;
                                        }
                                        .\$\{containerID\}-input1{
                                        width: 98%;
                                        float: left;
                                        }                     
                                        .\$\{containerID\}-input2{
                                        width: 98%;
                                        float: right;
                                    }
                                    .\$\{containerID\}-input {
                                        color: \$\{values.TitleFontColor\};
                                        padding: 12px 20px;
                                        border: 1px solid #eaeaea;
                                        border-radius: 4px;
                                        cursor: pointer;
                                        font-size:15px;
                                    }
                                </style>
                                <div class="\$\{containerID\}-fcontainer">
                                    <form action="">
                                        <div class="row">
                                            <div class="col-6">
                                                <input class=" \$\{containerID\}-input \$\{containerID\}-input1"  type="text" name="firstName" placeholder="\$\{values.Placeholder1\}" required>
                                            </div>
                                            <div class="col-6">
                                                <input class=" \$\{containerID\}-input \$\{containerID\}-input2" type="text" name="lastName" placeholder="\$\{values.Placeholder2\}" required>
                                            </div>
                                        </div>
                                        <br>
                                        <div class="row">
                                            <div class="col-12">
                                                <input class=" \$\{containerID\}-input" type="email" name="email" autocomplete="on" placeholder="\$\{values.Placeholder3\}" required>
                                            </div>
                                        </div>
                                        <br>
                                        <div class="row">
                                            <div class="col-12">
                                                <input class=" \$\{containerID\}-input" type="text" name="phone" placeholder="\$\{values.Placeholder4\}" required>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            \`;
                        }
                    }
                }
            })
        `);
        // end alexis

        customJS.push(`
            console.log("22. Initializing WhatsApp...");
            unlayer.registerTool({
                type: 'whatsapp',
                category: 'contents',
                label: 'WhatsApp',
                icon: '<svg class="svg-inline--fa fa-w-14 fa-w-20 fa-3x" version="1.1" id="Capa_1" x="0px" y="0px" viewBox="0 0 512 512" xml:space="preserve" width="50" height="50"> <path style="fill: #ffffff;" d="M256.064,0h-0.128l0,0C114.784,0,0,114.816,0,256c0,56,18.048,107.904,48.736,150.048l-31.904,95.104  l98.4-31.456C155.712,496.512,204,512,256.064,512C397.216,512,512,397.152,512,256S397.216,0,256.064,0z"></path> <path style="fill: #21282f;" d="M405.024,361.504c-6.176,17.44-30.688,31.904-50.24,36.128c-13.376,2.848-30.848,5.12-89.664-19.264  C189.888,347.2,141.44,270.752,137.664,265.792c-3.616-4.96-30.4-40.48-30.4-77.216s18.656-54.624,26.176-62.304  c6.176-6.304,16.384-9.184,26.176-9.184c3.168,0,6.016,0.16,8.576,0.288c7.52,0.32,11.296,0.768,16.256,12.64  c6.176,14.88,21.216,51.616,23.008,55.392c1.824,3.776,3.648,8.896,1.088,13.856c-2.4,5.12-4.512,7.392-8.288,11.744  c-3.776,4.352-7.36,7.68-11.136,12.352c-3.456,4.064-7.36,8.416-3.008,15.936c4.352,7.36,19.392,31.904,41.536,51.616  c28.576,25.44,51.744,33.568,60.032,37.024c6.176,2.56,13.536,1.952,18.048-2.848c5.728-6.176,12.8-16.416,20-26.496  c5.12-7.232,11.584-8.128,18.368-5.568c6.912,2.4,43.488,20.48,51.008,24.224c7.52,3.776,12.48,5.568,14.304,8.736  C411.2,329.152,411.2,344.032,405.024,361.504z"></path> </svg>',
                values: {},
                options: {
                    whatsapp: {
                        title: "WhatsApp Content Settings",
                        position: 1,
                        options: {
                            "whatsapp_phone" : {
                                "label": "WhatsApp Phone Number",
                                "defaultValue": "",
                                "widget": "text"
                            },
                            "whatsapp_message" : {
                                "label": "WhatsApp Message",
                                "defaultValue": "",
                                "widget": "text"
                            },
                            "whatsapp_alignment": {
                                "label": "Alignment",
                                "defaultValue": 'center',
                                "widget": "alignment"
                            }
                        }
                    }
                },
                renderer: {
                    Viewer: unlayer.createViewer({
                        render(values) {
                            let phone = values.whatsapp_phone ? values.whatsapp_phone.match(/[0-9]/g).join("") : "";
                            return \`
                                <div style="text-align: \$\{values.whatsapp_alignment\}">
                                    <a href="https://api.whatsapp.com/send?phone=$\{phone\}&text=\$\{values.whatsapp_message\}" target="_blank">
                                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Capa_1" x="0px" y="0px" viewBox="0 0 512 512" xml:space="preserve" width="50" height="50">
                                            <path style="fill: #49d648;" d="M256.064,0h-0.128l0,0C114.784,0,0,114.816,0,256c0,56,18.048,107.904,48.736,150.048l-31.904,95.104  l98.4-31.456C155.712,496.512,204,512,256.064,512C397.216,512,512,397.152,512,256S397.216,0,256.064,0z"></path>
                                            <path style="fill: #FAFAFA;" d="M405.024,361.504c-6.176,17.44-30.688,31.904-50.24,36.128c-13.376,2.848-30.848,5.12-89.664-19.264  C189.888,347.2,141.44,270.752,137.664,265.792c-3.616-4.96-30.4-40.48-30.4-77.216s18.656-54.624,26.176-62.304  c6.176-6.304,16.384-9.184,26.176-9.184c3.168,0,6.016,0.16,8.576,0.288c7.52,0.32,11.296,0.768,16.256,12.64  c6.176,14.88,21.216,51.616,23.008,55.392c1.824,3.776,3.648,8.896,1.088,13.856c-2.4,5.12-4.512,7.392-8.288,11.744  c-3.776,4.352-7.36,7.68-11.136,12.352c-3.456,4.064-7.36,8.416-3.008,15.936c4.352,7.36,19.392,31.904,41.536,51.616  c28.576,25.44,51.744,33.568,60.032,37.024c6.176,2.56,13.536,1.952,18.048-2.848c5.728-6.176,12.8-16.416,20-26.496  c5.12-7.232,11.584-8.128,18.368-5.568c6.912,2.4,43.488,20.48,51.008,24.224c7.52,3.776,12.48,5.568,14.304,8.736  C411.2,329.152,411.2,344.032,405.024,361.504z"></path>
                                        </svg>
                                    </a>
                                </div>
                            \`;
                        }
                    }),
                    exporters: {
                        web: function (values) {
                            let phone = values.whatsapp_phone ? values.whatsapp_phone.match(/[0-9]/g).join("") : "";
                            return \`
                                <div style="text-align: \$\{values.whatsapp_alignment\}">
                                    <a href="https://api.whatsapp.com/send?phone=$\{phone\}&text=\$\{values.whatsapp_message\}" target="_blank">
                                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Capa_1" x="0px" y="0px" viewBox="0 0 512 512" xml:space="preserve" width="50" height="50">
                                            <path style="fill: #49d648;" d="M256.064,0h-0.128l0,0C114.784,0,0,114.816,0,256c0,56,18.048,107.904,48.736,150.048l-31.904,95.104  l98.4-31.456C155.712,496.512,204,512,256.064,512C397.216,512,512,397.152,512,256S397.216,0,256.064,0z"></path>
                                            <path style="fill: #FAFAFA;" d="M405.024,361.504c-6.176,17.44-30.688,31.904-50.24,36.128c-13.376,2.848-30.848,5.12-89.664-19.264  C189.888,347.2,141.44,270.752,137.664,265.792c-3.616-4.96-30.4-40.48-30.4-77.216s18.656-54.624,26.176-62.304  c6.176-6.304,16.384-9.184,26.176-9.184c3.168,0,6.016,0.16,8.576,0.288c7.52,0.32,11.296,0.768,16.256,12.64  c6.176,14.88,21.216,51.616,23.008,55.392c1.824,3.776,3.648,8.896,1.088,13.856c-2.4,5.12-4.512,7.392-8.288,11.744  c-3.776,4.352-7.36,7.68-11.136,12.352c-3.456,4.064-7.36,8.416-3.008,15.936c4.352,7.36,19.392,31.904,41.536,51.616  c28.576,25.44,51.744,33.568,60.032,37.024c6.176,2.56,13.536,1.952,18.048-2.848c5.728-6.176,12.8-16.416,20-26.496  c5.12-7.232,11.584-8.128,18.368-5.568c6.912,2.4,43.488,20.48,51.008,24.224c7.52,3.776,12.48,5.568,14.304,8.736  C411.2,329.152,411.2,344.032,405.024,361.504z"></path>
                                        </svg>
                                    </a>
                                </div>
                            \`;
                        }
                    }
                }
            });
        `);

        //     const {editorValues} = require('./funnelGenieDevImport.js')
        //     customJS.push(`
        //     console.log(${editorValues})
        //     unlayer.registerTool({                
        //         type: ${JSON.stringify(editorValues.type)},
        //         category: ${JSON.stringify(editorValues.category)},
        //         label: ${JSON.stringify(editorValues.label)},
        //         icon: ${JSON.stringify(editorValues.icon)},
        //         values: ${JSON.stringify(editorValues.values)},
        //         options: ${JSON.stringify(editorValues.options)},
        //         renderer: {
        //             Viewer: unlayer.createViewer({
        //             render(values) {  
                        
        //                 console.log(values.whatsapp_phone)
        //                 return ${JSON.stringify(editorValues.renderer)} 
        //             }
        //         }),
        //             exporters: {
        //                 web: function (values) {
        //                     let phone = values.whatsapp_phone ? values.whatsapp_phone.match(/[0-9]/g).join("") : "";
        //                     return \`
        //                         <div style="text-align: \$\{values.whatsapp_alignment\}">
        //                             <a href="https://api.whatsapp.com/send?phone=$\{phone\}&text=\$\{values.whatsapp_message\}" target="_blank">
        //                                 <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Capa_1" x="0px" y="0px" viewBox="0 0 512 512" xml:space="preserve" width="50" height="50">
        //                                     <path style="fill: #49d648;" d="M256.064,0h-0.128l0,0C114.784,0,0,114.816,0,256c0,56,18.048,107.904,48.736,150.048l-31.904,95.104  l98.4-31.456C155.712,496.512,204,512,256.064,512C397.216,512,512,397.152,512,256S397.216,0,256.064,0z"></path>
        //                                     <path style="fill: #FAFAFA;" d="M405.024,361.504c-6.176,17.44-30.688,31.904-50.24,36.128c-13.376,2.848-30.848,5.12-89.664-19.264  C189.888,347.2,141.44,270.752,137.664,265.792c-3.616-4.96-30.4-40.48-30.4-77.216s18.656-54.624,26.176-62.304  c6.176-6.304,16.384-9.184,26.176-9.184c3.168,0,6.016,0.16,8.576,0.288c7.52,0.32,11.296,0.768,16.256,12.64  c6.176,14.88,21.216,51.616,23.008,55.392c1.824,3.776,3.648,8.896,1.088,13.856c-2.4,5.12-4.512,7.392-8.288,11.744  c-3.776,4.352-7.36,7.68-11.136,12.352c-3.456,4.064-7.36,8.416-3.008,15.936c4.352,7.36,19.392,31.904,41.536,51.616  c28.576,25.44,51.744,33.568,60.032,37.024c6.176,2.56,13.536,1.952,18.048-2.848c5.728-6.176,12.8-16.416,20-26.496  c5.12-7.232,11.584-8.128,18.368-5.568c6.912,2.4,43.488,20.48,51.008,24.224c7.52,3.776,12.48,5.568,14.304,8.736  C411.2,329.152,411.2,344.032,405.024,361.504z"></path>
        //                                 </svg>
        //                             </a>
        //                         </div>
        //                     \`;
        //                 }
        //             }
        //         }
                
        // }) 
        //     `)

            customJS.push(`
        var plg_page_header = ${JSON.stringify(this.state.page_data.funnel_header_analytics)}
        var plg_page_footer = ${JSON.stringify(this.state.page_data.funnel_footer_analytics)}
        
        console.log("Page data 🚩🏁🌈🎉", plg_page_header)
            // Changes for June 6 2021
                // Re register Body In Editor 
                    
                // unlayer.registerTool({
                //         id: "bodies",
                //         type: "bodies",
                //         options: {
                //             "headerScript": {
                //                 title: "Header",
                //                 position: 2,
                //                 options: {
                //                     "headerScript": {
                //                         label: "",
                //                         defaultValue: plg_page_header,
                //                         widget: "html"
                //                     }
                //                 }
                //             },
                //             "footerScript": {
                //                 title: "Footer",
                //                 position: 3,
                //                 options: {
                //                     "footerScript": {
                //                         label: "",
                //                         defaultValue: plg_page_footer,
                //                         widget: "html"
                //                     }
                //                 }
                //             },
                //             // Changes For June 6, 2021
                //             default: {
                //                 title: null,
                //                 position: 1,
                //                 options: {
                //                     backgroundColor: {
                //                         label: "Background Color",
                //                         defaultValue: "#FF0000",
                //                         widget: "color_picker"
                //                     },
                //                     backgroundImage: {
                //                         supportedDisplayModes: ["web"],
                //                         label: "Background Image",
                //                         defaultValue: {
                //                             url: "",
                //                             fullWidth: !0,
                //                             repeat: !1,
                //                             center: !0,
                //                             cover: !1
                //                         },
                //                         widget: "background_image"
                //                     },
                //                     contentWidth: {
                //                         label: "Content Width",
                //                         defaultValue: "500px",
                //                         widget: "content_width"
                //                     },
                //                     fontFamily: {
                //                         label: "Font Family",
                //                         defaultValue: {
                //                             label: "Arial",
                //                             value: "arial,helvetica,sans-serif"
                //                         },
                //                         widget: "font_family"
                //                     }
                //                 }
                //             }
                //         }
                //     })
                
                
        `);

        if(document.getElementById("editorJS")) document.getElementById("editorJS").remove();
        var script1 = document.createElement("script");
        script1.id = "editorJS";
        script1.type = "text/javascript";
        script1.src = webConfig.siteURL + "/assets/graphics/js/embed.js";
        script1.onload = () => {
            console.log("Initializing Unlayer...");
            unlayer.init({
              id: "editor",
              projectId: 1234,
              locale: "en",
              customJS: customJS,
              customCSS: [
                `   .CodeMirror-linenumber {
                        display:none;
                    }
                    .display-inline {
                        display: block;
                        white-space: nowrap;
                        overflow: hidden;
                        text-overflow: ellipsis;
                    }
                    .close-button {
                        font-size: 15px;
                        color: #fff;
                        position: absolute;
                        right: 2px;
                        top: 5px;
                        padding: 1px 2px 2px 2px;
                        background-color: red;
                        border-radius: 50%;
                        cursor: pointer;
                    }
                    .gZMubD iframe {
                        border-top: 1px #e2e2e2 solid;
                        border-bottom: 1px #e2e2e2 solid;
                    }
                    .blockbuilder-preview {
                        padding: 0;
                    }
                   
                    .fVxoSz {
                        display: none;
                    }
                    .rc-slider:hover > .rc-slider-handle::after {
                        content: attr(aria-valuenow) "%";
                        width: 35px;
                        height: 17px;
                        background: #343a40;
                        position: absolute;
                        top: -25px;
                        left: -13px;
                        text-align: center;
                        font-size: 10px;
                        border: 1px solid #595959;
                        color: #fff;
                        border-radius: 4px;
                    }
                    #notifier_box {
                        box-shadow: rgba(0,0,0,.7) 0px 6px 10px !important;
                        border-color: rgb(119, 119, 119) !important;
                    }
                    .blockbuilder-content-tool:hover { 
                        box-shadow: rgba(0,0,0,.7) 0px 6px 10px !important;
                        border-color: rgb(119, 119, 119) !important;
                    }
                    .blockbuilder-saved-row-tool-container .row {
                        transform: scale(0.4, 0.5) translate(60%, 0%);
                        width: 1200px;
                        align-items: center;
                    }
                    .sc-jzJRlG.dQsDrs {
                        max-height: 130px;
                    }
                    .blockbuilder-content-tool[draggable="false"] {
                        border-color: #006b2b;
                        display: none;
                    }
                    .ipNZHf .blockbuilder-content-tool {
                        font-size: 9px;
                    }
                    
                    /* Custom Modal */
                    .plg_modal {
                        display: none;
                        position: fixed;
                        z-index: 999;
                        top: 0;
                        width: calc(100% - 425px);
                        align-items: center;
                        margin: auto;
                        min-height: 100%;
                        justify-content: center;
                        background-color: #000000c7;
                    }
                    .plg_modal .container {
                        background-color: #e4e1e1;
                        box-shadow: rgba(0,0,0,.7) 0px 6px 10px !important;
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        height: 60vh;
                        width: 60vw;
                        overflow: auto;
                    }
                    .plg_modal .container .row {
                        height: fit-content;
                        min-width: 60%;
                    }
                    .plg_modal .blockbuilder-placeholder-empty {
                        height: 60vh;
                    }
                    .ReactModal__Overlay.ReactModal__Overlay--after-open {
                        z-index: 1000 !important;
                    }
                    .blockbuilder-layer-inline-editor {
                        z-index: 1000 !important;
                    }
                    .page { height: 580px; margin: 10px auto; background: #373a3c; padding: 10px 20px; border-radius: 5px; } .gallery { list-style: none; display: flex; flex-wrap: wrap; width: auto; height: 532px; margin: 0 auto; padding: 0; overflow-y: scroll; justify-content: space-between; } .gallery .img { animation-delay: 2s; animation-timing-function: ease-in; animation-iteration-count: 1; animation-fill-mode: both; } .gallery .img { cursor: pointer; background: #21252929; margin: 5px; } .gallery .img{ width: 150px; height: 150px; display: flex; justify-content: center;flex-direction: column; } .page#page2 { opacity: 0; transition: transform 2s; transform: translate; } .animate-center { animation-name: centerEl; } @keyframes centerEl { 0% { transform: translatey(0) translatex(0); } 100% { transform: translatey(50px) translatex(75px); } }
                    .blockbuilder-widget select, .blockbuilder-widget select:focus  {
                        margin-top: 10px;
                        color: #fefefe !important;
                        background-color: #555 !important;
                        border: 1px solid #777777 !important;
                    }
                    .display-shopify-variants {
                        align-items: baseline;
                    }
                    .hide {
                        display: none;
                    }
                    .shopify-show-result {
                        list-style: none;
                        padding: 0;
                        margin: 0;
                        position: absolute;
                        width: 100%;
                        background-color: #555555;
                        color: #ededed;
                        z-index: 1;
                        max-height: 300px;
                        overflow-y: auto;
                        overflow-x: hidden;
                        border-bottom: 2px solid #293039;
                        border-radius: 0 0 5px 5px;
                    }
                    .shopify-show-result li {
                        padding: 10px;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                    }
                    .shopify-show-result li img {
                        width: 40px;
                        height: 40px;
                        margin-right: 10px;
                    }
                    .shopify-show-result li:hover {
                        background-color: #777777;
                    }
                    .shopify-show-result li:not(:last-child) {
                        border-bottom: 1px solid #777777;
                    }
                    #blockbuilder-widget-variant-menu input[type="text"]:disabled, input[type="number"]:disabled {
                        color: #a09f9f !important;
                        background-color: #3a3a3a !important;
                    }
                    .u_content_variant {
                        overflow: hidden;
                    }
                    .u_body {
                        width: 100%;
                        transition: width 0.5s;
                        -webkit-transition: width 0.5s;
                        margin: 0 auto;
                    }
                    .edit-mobile .u_body, .edit-tablet .u_body {
                        width: 371px;
                        padding: 0 5px;
                        border-right: 1px dashed #d0d2d1;
                        border-left: 1px dashed #d0d2d1;
                    }
                    
                    .edit-mobile .plg_modal, .edit-mobile #scroll-top, .edit-mobile #scroll-bottom {
                        width: 364px !important;
                    }
                    .edit-tablet .u_body {
                        width: 659px !important;
                    }
                    .edit-tablet .plg_modal, .edit-tablet #scroll-top, .edit-tablet #scroll-bottom {
                        width: 659px !important;
                    }
                    .edit-mobile button {
                        width: 100% !important;
                    }
                    /*May13
                    .edit-mobile .row {
                        display: unset;
                    }*/
                    .edit-mobile .col-md-1, .edit-mobile .col-md-2, .edit-mobile .col-md-3, .edit-mobile .col-md-4, .edit-mobile .col-md-5, .edit-mobile .col-md-6, .edit-mobile .col-md-7, .edit-mobile .col-md-8, .edit-mobile .col-md-9, .edit-mobile .col-md-10, .edit-mobile .col-md-11 {
                        min-width: 100%;
                    }
                    .editor-loader {
                        display: inline-block;
                        border: 5px solid #f3f3f3;
                        border-radius: 50%;
                        border-top: 5px solid #3498db;
                        width: 30px;
                        height: 30px;
                        -webkit-animation: spin 2s linear infinite;
                        animation: spin 2s linear infinite;
                    }
                    /* for the multiple variants */
                    .tags-container {
                        display: -webkit-box;
                        display: flex;
                        -webkit-box-orient: horizontal;
                        -webkit-box-direction: normal;
                        flex-flow: row wrap;
                        margin-bottom: 15px;
                        width: 100%;
                        min-height: 34px;
                        padding: 2px 5px;
                        font-size: 14px;
                        line-height: 1.6;
                        background-color: transparent;
                        border: 1px solid #ccc;
                        border-radius: 1px;
                        overflow: hidden;
                        word-wrap: break-word;
                        box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
                      }
                  
                      input.tag-input {
                        -webkit-box-flex: 3;
                        flex: 3;
                        border: 0;
                        outline: 0;
                      }
                  
                      .tag {
                        position: relative;
                        margin: 2px 6px 2px 0;
                        padding: 1px 20px 1px 8px;
                        font-size: inherit;
                        font-weight: 400;
                        text-align: center;
                        color: #fff;
                        background-color: #317CAF;
                        border-radius: 3px;
                        -webkit-transition: background-color .3s ease;
                        transition: background-color .3s ease;
                        cursor: default;
                      }
                  
                      .tag:first-child {
                        margin-left: 0;
                      }
                  
                      .tag--marked {
                        background-color: #6fadd7;
                      }
                  
                      .tag--exists {
                        background-color: #EDB5A1;
                        -webkit-animation: shake 1s linear;
                        animation: shake 1s linear;
                      }
                  
                      .tag__name {
                        margin-right: 3px;
                      }
                  
                      .tag__remove {
                        position: absolute;
                        right: 0;
                        bottom: 0;
                        width: 20px;
                        height: 100%;
                        padding: 0 5px;
                        font-size: 16px;
                        font-weight: 400;
                        -webkit-transition: opacity .3s ease;
                        transition: opacity .3s ease;
                        opacity: .5;
                        cursor: pointer;
                        border: 0;
                        background-color: transparent;
                        color: #fff;
                        line-height: 1;
                      }
                  
                      .tag__remove:hover {
                        opacity: 1;
                      }
                  
                      .tag__remove:focus {
                        outline: 5px auto #fff;
                      }
                  
                      @-webkit-keyframes shake {
                  
                        0%,
                        100% {
                          -webkit-transform: translate3d(0, 0, 0);
                          transform: translate3d(0, 0, 0);
                        }
                  
                        10%,
                        30%,
                        50%,
                        70%,
                        90% {
                          -webkit-transform: translate3d(-5px, 0, 0);
                          transform: translate3d(-5px, 0, 0);
                        }
                  
                        20%,
                        40%,
                        60%,
                        80% {
                          -webkit-transform: translate3d(5px, 0, 0);
                          transform: translate3d(5px, 0, 0);
                        }
                      }
                  
                      @keyframes shake {
                  
                        0%,
                        100% {
                          -webkit-transform: translate3d(0, 0, 0);
                          transform: translate3d(0, 0, 0);
                        }
                  
                        10%,
                        30%,
                        50%,
                        70%,
                        90% {
                          -webkit-transform: translate3d(-5px, 0, 0);
                          transform: translate3d(-5px, 0, 0);
                        }
                  
                        20%,
                        40%,
                        60%,
                        80% {
                          -webkit-transform: translate3d(5px, 0, 0);
                          transform: translate3d(5px, 0, 0);
                        }
                      }
                    @-webkit-keyframes spin {
                        0% { -webkit-transform: rotate(0deg); }
                        100% { -webkit-transform: rotate(360deg); }
                    }
                    
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                    ${
                      !condition.has_local_tag(
                        this.props.session.getCurrentUser,
                        "yala"
                      ) &&
                      `
                        .u_content_yala_genie {
                            display: none;
                        }
                    `
                    }
                  `,
              ],
              appearance: {
                theme: "dark",
                panels: {
                  tools: {
                    dock: "left",
                  },
                },
              },
              tools: {
                "cod-form": {
                  enabled:
                    this.state.page_data.is_cod_funnel === true ||
                    this.state.page_data.is_cod_funnel === null
                      ? true
                      : false,
                  properties: {
                    country: {
                      editor: {
                        data: {
                          options: points.funnelEditorData.countryList,
                        },
                      },
                    },
                  },
                },
                variant: {
                  enabled:
                    this.state.page_data.page_type == "checkout" ? true : false,
                },
                multi_variants: {
                  enabled:
                    this.state.page_data.page_type == "checkout" &&
                    condition.is_exclusive_vip_user(
                      this.props.session.getCurrentUser
                    )
                      ? true
                      : false,
                },
                multi_variants_two: {
                  enabled:
                    this.state.page_data.page_type == "checkout" &&
                    condition.is_exclusive_vip_user(
                      this.props.session.getCurrentUser
                    )
                      ? true
                      : false,
                },
                multiple_variant_tools: {
                  enabled:
                    this.state.page_data.page_type == "checkout" &&
                    condition.is_exclusive_vip_user(
                      this.props.session.getCurrentUser
                    )
                      ? true
                      : false,
                },
                image_carousel_editor: {
                  enabled: this.props.session.getCurrentUser ? true : false,
                },
                multi_variants_cc: {
                  enabled:
                    this.state.page_data.page_type == "checkout" &&
                    condition.is_exclusive_vip_user(
                      this.props.session.getCurrentUser
                    )
                      ? true
                      : false,
                },
                fomo_input: { enabled: true },
                multiple_genie_variants: {
                  enabled:
                    this.state.page_data.page_type == "checkout" &&
                    condition.is_exclusive_vip_user(
                      this.props.session.getCurrentUser
                    )
                      ? true
                      : false,
                },
                multi_variants_upsell_button: {
                  enabled:
                    isUpsellOrDownsell &&
                    condition.is_exclusive_vip_user(
                      this.props.session.getCurrentUser
                    )
                      ? true
                      : false,
                },
                Receipt: {
                  enabled:
                    this.state.page_data.page_type == "checkout" ? true : false,
                },
                product_addons: {
                  enabled:
                    this.state.page_data.page_type == "checkout" ? true : false,
                },
                SimpleForm: {
                  enabled:
                    this.state.page_data.page_type == "checkout" ? true : false,
                },
                order_list: {
                  enabled:
                    this.state.page_data.page_type == "thank-you-page"
                      ? true
                      : false,
                },
                thankyou_upsell_button: {
                  enabled:
                    this.state.page_data.page_type == "thank-you-page" &&
                    this.props.session.getCurrentUser.privilege == 10
                      ? true
                      : false, // User Privilege
                },
                yala_genie: {
                  enabled:
                    this.state.page_data.page_type == "thank-you-page" &&
                    condition.has_local_tag(
                      this.props.session.getCurrentUser,
                      "yala"
                    ),
                },
              },
              mergeTags: [
                { name: "Shop Name", value: this.state.page_data.domain_name },
                {
                  name: "Shop Email",
                  value: this.state.page_data.funnel_email
                    ? this.state.page_data.funnel_email
                    : "[No Email Specify in funnel Settings]",
                },
                {
                  name: "Shop Phone",
                  value: this.state.page_data.funnel_phone
                    ? this.state.page_data.funnel_phone
                    : "[No Phone Number Specify in funnel Settings]",
                },
                {
                  name: "Shop Address",
                  value: this.state.page_data.funnel_address
                    ? this.state.page_data.funnel_address
                    : "[No Address Specified in funnel Settings]",
                },
              ],
              blocks: [
                header,
                header1,
                header2,
                header3,
                header4,
                header5,
                header6,
                header7,
                header8,
                header9,
                header10,
                header11,
                productDescription1,
                productDescription2,
                productDescription3,
                productDescription4,
                productDescription5,
                productDescription6,
                productDescription7,
                testimonial1,
                testimonial2,
                testimonial3,
                trustBadge1,
                guaranteeSeal1,
                footer,
                {
                  category: "Forms",
                  tags: [],
                  data: {
                    cells: [1],
                    columns: [
                      {
                        contents: [
                          {
                            type: "form",
                            values: {
                              containerPadding: "10px",
                              _meta: {
                                htmlID: "u_content_form_1",
                                htmlClassNames: "u_content_form",
                              },
                              selectable: true,
                              draggable: true,
                              deletable: true,
                              fields: [
                                {
                                  name: "name_1",
                                  type: "text",
                                  label: "Name",
                                  placeholder_text: "Your Name",
                                  show_label: true,
                                  required: true,
                                },
                                {
                                  type: "email",
                                  name: "email",
                                  label: "Email",
                                  value: "",
                                  options: "",
                                  show_label: true,
                                  placeholder_text: "Your Email",
                                  required: true,
                                },
                              ],
                              fieldBorder: {
                                borderTopWidth: "1px",
                                borderTopStyle: "solid",
                                borderTopColor: "#CCC",
                                borderLeftWidth: "1px",
                                borderLeftStyle: "solid",
                                borderLeftColor: "#CCC",
                                borderRightWidth: "1px",
                                borderRightStyle: "solid",
                                borderRightColor: "#CCC",
                                borderBottomWidth: "1px",
                                borderBottomStyle: "solid",
                                borderBottomColor: "#CCC",
                              },
                              fieldBorderRadius: "0px",
                              fieldPadding: "10px",
                              fieldBackgroundColor: "#FFF",
                              fieldColor: "#121212",
                              fieldFontSize: "12px",
                              formWidth: "100%",
                              formAlign: "center",
                              fieldDistance: "10px",
                              labelFontSize: "14px",
                              labelColor: "#444",
                              labelAlign: "left",
                              labelPadding: "0px 0px 3px",
                              buttonText: "Access Now",
                              buttonColors: {
                                color: "#FFF",
                                backgroundColor: "#3AAEE0",
                                hoverColor: "#2A92BF",
                              },
                              buttonAlign: "center",
                              buttonWidth: "66%",
                              buttonFontSize: "14px",
                              buttonBorder: {},
                              buttonBorderRadius: "4px",
                              buttonPadding: "10px",
                              buttonMargin: "5px 0px 0px",
                              fieldWidth: "100%",
                            },
                          },
                        ],
                        values: {},
                      },
                    ],
                    values: {
                      columns: false,
                      backgroundColor: "",
                      columnsBackgroundColor: "",
                      backgroundImage: {
                        url: "",
                        fullWidth: true,
                        repeat: false,
                        center: true,
                        cover: false,
                      },
                      padding: "0px",
                      hideMobile: false,
                      noStackMobile: false,
                      selectable: true,
                      draggable: true,
                      deletable: true,
                    },
                  },
                  displayMode: "web",
                },
              ],
            });
            
            console.log("adding listener to update");
            unlayer.addEventListener("design:updated", update => {
                var ifr = document.querySelector('#editor iframe');
                var scrollTop = ifr.contentDocument.getElementById("scroll-top");
                var scrollBottom = ifr.contentDocument.getElementById("scroll-bottom");
                ifr.contentDocument.querySelectorAll(".blockbuilder-layer-drag").forEach(el => {
                    el.ondrag = () => {
                        scrollTop.style.display = "block";
                        scrollBottom.style.display = "block";
                    }
                    el.ondragend = () => {
                        scrollTop.style.display = "none";
                        scrollBottom.style.display = "none";
                    }
                })
                
                // center navigation
                window.navigation_ID_list = [];
                ifr.contentDocument.querySelectorAll(".u_content_navbar").forEach(el => {
                    el.parentNode.parentNode.parentNode.parentNode.parentNode.style = "align-items: center;";
                    window.navigation_ID_list.push(el.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.getAttribute("id"));
                });

                // add notifier icon to sidebar
                if(update.item.type == "notifier"){
                    if(update.type == "content:added"){
                        ifr.contentDocument.getElementById(update.item.values._meta.htmlID).style.padding = "0";
                        ifr.contentDocument.getElementById(update.item.values._meta.htmlID).previousElementSibling.style.opacity = "0";
                        ifr.contentDocument.querySelectorAll(".blockbuilder-content-tool").forEach(el => {
                            if(el.querySelector(".blockbuilder-content-tool-name").innerText.toLowerCase() == "notifier"){
                                el.setAttribute("draggable", false)
                                el.onclick = () => {
                                    ifr.contentDocument.getElementById('notifier_box').click()
                                }
                                ifr.contentDocument.getElementById('notifier_box').click()
                            }
                        });

                        if(!ifr.contentDocument.getElementById("sidebar-notifier")){
                            var li_container = document.createElement("li");
                            li_container.id = "sidebar-notifier";
                            li_container.className = "nav-item";
                            li_container.innerHTML = '<a role="button" class="nav-link"><span class="nav-icon"><svg class="svg-inline--fa fa-palette fa-w-16" xmlns="http://www.w3.org/2000/svg" version="1.1" id="Capa_1" x="0px" y="0px" width="535.5px" height="535.5px" viewBox="0 0 535.5 535.5" xml:space="preserve" fill="#fff"> <g> <g id="notifications-on"> <path d="M142.8,53.55l-35.7-35.7C45.9,63.75,5.1,135.15,0,216.75h51C56.1,147.9,89.25,89.25,142.8,53.55z M484.5,216.75h51 c-5.1-81.6-43.35-153-104.55-198.9l-35.7,35.7C446.25,89.25,479.4,147.9,484.5,216.75z M433.5,229.5 c0-79.05-53.55-142.8-127.5-160.65V51c0-20.4-17.85-38.25-38.25-38.25c-20.4,0-38.25,17.85-38.25,38.25v17.85 C155.55,86.7,102,150.45,102,229.5v140.25l-51,51v25.5h433.5v-25.5l-51-51V229.5z M267.75,522.75c2.55,0,7.65,0,10.2,0 c17.85-2.55,30.6-15.3,35.7-30.6c2.55-5.101,5.1-12.75,5.1-20.4h-102C216.75,499.8,239.7,522.75,267.75,522.75z"></path> </g> </g> </svg></span><span class="nav-name"><span>Notifier</span></span></a>';
                            li_container.onclick = () => {
                                ifr.contentDocument.getElementById('notifier_box').click();
                            }
                            ifr.contentDocument.querySelector(".nav.flex-column.nav-tabs").appendChild(li_container)
                        }
                    }
                    if(update.type == "content:removed"){
                        ifr.contentDocument.querySelectorAll(".blockbuilder-content-tool").forEach(el => {
                            if(el.querySelector(".blockbuilder-content-tool-name").innerText.toLowerCase() == "notifier"){
                                el.setAttribute("draggable", true);
                                el.style.display = "flex !important";
                            }
                        })
                        ifr.contentDocument.getElementById("sidebar-notifier").remove();
                    }
                }
            })
            var template = null;
            if (this.state.page_data.design.length == 0) {
                template = {
                    "body": {
                        "rows": [
                            {
                                "cells": [
                                    1,
                                    1
                                ],
                                "columns": [
                                    {
                                        "contents": [
                                            {
                                                "type": "image",
                                                "values": {
                                                    "containerPadding": "10px",
                                                    "_meta": {
                                                        "htmlID": "u_content_image_5",
                                                        "htmlClassNames": "u_content_image"
                                                    },
                                                    "selectable": true,
                                                    "draggable": true,
                                                    "deletable": true,
                                                    "src": {
                                                        "url": "https://unroll-images-production.s3.amazonaws.com/projects/0/1555103836045-logo-1.png",
                                                        "width": 200,
                                                        "height": 56
                                                    },
                                                    "fullWidth": false,
                                                    "textAlign": "left",
                                                    "maxWidth": "100%",
                                                    "altText": "Image",
                                                    "action": {
                                                        "url": "",
                                                        "target": ""
                                                    }
                                                }
                                            }
                                        ],
                                        "values": {
                                            "_meta": {
                                                "htmlID": "u_column_1",
                                                "htmlClassNames": "u_column"
                                            },
                                            "padding": "0px"
                                        }
                                    },
                                    {
                                        "contents": [
                                            {
                                                "type": "image",
                                                "values": {
                                                    "containerPadding": "10px",
                                                    "_meta": {
                                                        "htmlID": "u_content_image_6",
                                                        "htmlClassNames": "u_content_image"
                                                    },
                                                    "selectable": true,
                                                    "draggable": true,
                                                    "deletable": true,
                                                    "src": {
                                                        "url": "https://unroll-images-production.s3.amazonaws.com/projects/0/1555103877882-tiempoLimitado.png",
                                                        "width": 322,
                                                        "height": 29
                                                    },
                                                    "fullWidth": false,
                                                    "textAlign": "right",
                                                    "maxWidth": "100%",
                                                    "altText": "Image",
                                                    "action": {
                                                        "url": "",
                                                        "target": ""
                                                    }
                                                }
                                            }
                                        ],
                                        "values": {
                                            "backgroundColor": "",
                                            "padding": "12px 0px 0px",
                                            "border": {},
                                            "_meta": {
                                                "htmlID": "u_column_17",
                                                "htmlClassNames": "u_column"
                                            }
                                        }
                                    }
                                ],
                                "values": {
                                    "columns": false,
                                    "backgroundColor": "rgba(255,255,255,0)",
                                    "columnsBackgroundColor": "rgba(255,255,255,0)",
                                    "backgroundImage": {
                                        "url": "",
                                        "fullWidth": true,
                                        "repeat": false,
                                        "center": false,
                                        "cover": false
                                    },
                                    "padding": "10px",
                                    "hideMobile": false,
                                    "noStackMobile": true,
                                    "_meta": {
                                        "htmlID": "u_row_1",
                                        "htmlClassNames": "u_row"
                                    },
                                    "selectable": true,
                                    "draggable": true,
                                    "deletable": true
                                }
                            },
                            {
                                "cells": [
                                    1
                                ],
                                "columns": [
                                    {
                                        "contents": [
                                            {
                                                "type": "image",
                                                "values": {
                                                    "containerPadding": "19px",
                                                    "_meta": {
                                                        "htmlID": "u_content_image_7",
                                                        "htmlClassNames": "u_content_image"
                                                    },
                                                    "selectable": true,
                                                    "draggable": true,
                                                    "deletable": true,
                                                    "src": {
                                                        "url": "https://unroll-images-production.s3.amazonaws.com/projects/0/1555104002256-copy_desktop.gif",
                                                        "width": 1200,
                                                        "height": 108
                                                    },
                                                    "fullWidth": false,
                                                    "textAlign": "center",
                                                    "maxWidth": "100%",
                                                    "altText": "Image",
                                                    "action": {
                                                        "url": "",
                                                        "target": ""
                                                    }
                                                }
                                            },
                                            {
                                                "type": "image",
                                                "values": {
                                                    "containerPadding": "0px",
                                                    "_meta": {
                                                        "htmlID": "u_content_image_8",
                                                        "htmlClassNames": "u_content_image"
                                                    },
                                                    "selectable": true,
                                                    "draggable": true,
                                                    "deletable": true,
                                                    "src": {
                                                        "url": "https://unroll-images-production.s3.amazonaws.com/projects/0/1555104048376-header_desktop_f.jpg",
                                                        "width": 1920,
                                                        "height": 530
                                                    },
                                                    "fullWidth": true,
                                                    "textAlign": "center",
                                                    "maxWidth": "100%",
                                                    "altText": "Image",
                                                    "action": {
                                                        "url": "",
                                                        "target": ""
                                                    }
                                                }
                                            }
                                        ],
                                        "values": {
                                            "_meta": {
                                                "htmlID": "u_column_2",
                                                "htmlClassNames": "u_column"
                                            }
                                        }
                                    }
                                ],
                                "values": {
                                    "columns": false,
                                    "backgroundColor": "rgba(255,255,255,0)",
                                    "columnsBackgroundColor": "rgba(255,255,255,0)",
                                    "backgroundImage": {
                                        "url": "",
                                        "fullWidth": true,
                                        "repeat": false,
                                        "center": false,
                                        "cover": false
                                    },
                                    "padding": "10px",
                                    "hideMobile": false,
                                    "noStackMobile": false,
                                    "_meta": {
                                        "htmlID": "u_row_2",
                                        "htmlClassNames": "u_row"
                                    },
                                    "selectable": true,
                                    "draggable": true,
                                    "deletable": true
                                }
                            },
                            {
                                "cells": [
                                    1
                                ],
                                "columns": [
                                    {
                                        "contents": [
                                            {
                                                "type": "image",
                                                "values": {
                                                    "containerPadding": "10px",
                                                    "_meta": {
                                                        "htmlID": "u_content_image_9",
                                                        "htmlClassNames": "u_content_image"
                                                    },
                                                    "selectable": true,
                                                    "draggable": true,
                                                    "deletable": true,
                                                    "src": {
                                                        "url": "https://unroll-images-production.s3.amazonaws.com/projects/0/1555104221306-bajada_desktop.png",
                                                        "width": 1200,
                                                        "height": 131
                                                    },
                                                    "fullWidth": false,
                                                    "textAlign": "center",
                                                    "maxWidth": "100%",
                                                    "altText": "Image",
                                                    "action": {
                                                        "url": "",
                                                        "target": ""
                                                    }
                                                }
                                            }
                                        ],
                                        "values": {
                                            "backgroundColor": "",
                                            "padding": "0px 100px",
                                            "border": {},
                                            "_meta": {
                                                "htmlID": "u_column_21",
                                                "htmlClassNames": "u_column"
                                            }
                                        }
                                    }
                                ],
                                "values": {
                                    "columns": false,
                                    "backgroundColor": "",
                                    "columnsBackgroundColor": "",
                                    "backgroundImage": {
                                        "url": "",
                                        "fullWidth": true,
                                        "repeat": false,
                                        "center": true,
                                        "cover": false
                                    },
                                    "padding": "0px",
                                    "hideMobile": false,
                                    "noStackMobile": false,
                                    "_meta": {
                                        "htmlID": "u_row_14",
                                        "htmlClassNames": "u_row"
                                    },
                                    "selectable": true,
                                    "draggable": true,
                                    "deletable": true
                                }
                            },
                            {
                                "cells": [
                                    1,
                                    1
                                ],
                                "columns": [
                                    {
                                        "contents": [
                                            {
                                                "type": "button",
                                                "values": {
                                                    "containerPadding": "10px",
                                                    "_meta": {
                                                        "htmlID": "u_content_button_5",
                                                        "htmlClassNames": "u_content_button"
                                                    },
                                                    "selectable": true,
                                                    "draggable": true,
                                                    "deletable": true,
                                                    "href": "",
                                                    "buttonColors": {
                                                        "color": "#ffffff",
                                                        "backgroundColor": "#3ae052",
                                                        "hoverColor": "#2daa3f"
                                                    },
                                                    "textAlign": "center",
                                                    "lineHeight": "120%",
                                                    "border": {
                                                        "borderTopWidth": "0px",
                                                        "borderTopStyle": "solid",
                                                        "borderTopColor": "#CCC",
                                                        "borderLeftWidth": "0px",
                                                        "borderLeftStyle": "solid",
                                                        "borderLeftColor": "#CCC",
                                                        "borderRightWidth": "0px",
                                                        "borderRightStyle": "solid",
                                                        "borderRightColor": "#CCC",
                                                        "borderBottomWidth": "0px",
                                                        "borderBottomStyle": "solid",
                                                        "borderBottomColor": "#CCC"
                                                    },
                                                    "borderRadius": "4px",
                                                    "padding": "20px 80px",
                                                    "text": "<span style=\"font-size: 14px; line-height: 16.8px;\"><span style=\"font-size: 16px; line-height: 19.2px;\"><strong>HABLE CON NOSOTROS, GRATIS</strong></span><br /></span>",
                                                    "calculatedWidth": 430,
                                                    "calculatedHeight": 59
                                                }
                                            }
                                        ],
                                        "values": {
                                            "backgroundColor": "",
                                            "padding": "0px",
                                            "border": {},
                                            "_meta": {
                                                "htmlID": "u_column_18",
                                                "htmlClassNames": "u_column"
                                            }
                                        }
                                    },
                                    {
                                        "contents": [
                                            {
                                                "type": "button",
                                                "values": {
                                                    "containerPadding": "10px",
                                                    "_meta": {
                                                        "htmlID": "u_content_button_6",
                                                        "htmlClassNames": "u_content_button"
                                                    },
                                                    "selectable": true,
                                                    "draggable": true,
                                                    "deletable": true,
                                                    "href": "",
                                                    "buttonColors": {
                                                        "color": "#FFFFFF",
                                                        "backgroundColor": "#f78e19",
                                                        "hoverColor": "#dc7e16"
                                                    },
                                                    "textAlign": "center",
                                                    "lineHeight": "120%",
                                                    "border": {},
                                                    "borderRadius": "4px",
                                                    "padding": "20px",
                                                    "text": "<span style=\"font-size: 18px; line-height: 21.6px;\"><strong><span style=\"line-height: 21.6px; font-size: 18px;\">Aproveche una oferta &uacute;nica. <span style=\"line-height: 21.6px; font-size: 18px;\">Click</span> Aqu&iacute;.</span></strong></span>",
                                                    "calculatedWidth": 412,
                                                    "calculatedHeight": 61
                                                }
                                            }
                                        ],
                                        "values": {
                                            "backgroundColor": "",
                                            "padding": "0px",
                                            "border": {},
                                            "_meta": {
                                                "htmlID": "u_column_19",
                                                "htmlClassNames": "u_column"
                                            }
                                        }
                                    }
                                ],
                                "values": {
                                    "columns": false,
                                    "backgroundColor": "",
                                    "columnsBackgroundColor": "",
                                    "backgroundImage": {
                                        "url": "",
                                        "fullWidth": true,
                                        "repeat": false,
                                        "center": true,
                                        "cover": false
                                    },
                                    "padding": "0px",
                                    "hideMobile": false,
                                    "noStackMobile": false,
                                    "_meta": {
                                        "htmlID": "u_row_13",
                                        "htmlClassNames": "u_row"
                                    },
                                    "selectable": true,
                                    "draggable": true,
                                    "deletable": true
                                }
                            },
                            {
                                "cells": [
                                    1,
                                    2
                                ],
                                "columns": [
                                    {
                                        "contents": [
                                            {
                                                "type": "text",
                                                "values": {
                                                    "containerPadding": "10px 15px 8px",
                                                    "_meta": {
                                                        "htmlID": "u_content_text_21",
                                                        "htmlClassNames": "u_content_text"
                                                    },
                                                    "selectable": true,
                                                    "draggable": true,
                                                    "deletable": true,
                                                    "color": "#6eba79",
                                                    "textAlign": "left",
                                                    "lineHeight": "160%",
                                                    "text": "<h3 style=\"margin-top: 0px; margin-bottom: 0px; color: #fe8904; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; font-family: Lato, sans-serif; text-align: center;\">&nbsp;</h3>\n<h3 style=\"margin-top: 0px; margin-bottom: 0px; color: #fe8904; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; font-family: Lato, sans-serif; text-align: center;\">&nbsp;</h3>\n<h3 style=\"margin-top: 0px; margin-bottom: 0px; color: #fe8904; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; font-family: Lato, sans-serif; text-align: center;\">SUDA</h3>"
                                                }
                                            },
                                            {
                                                "type": "text",
                                                "values": {
                                                    "containerPadding": "10px 15px",
                                                    "_meta": {
                                                        "htmlID": "u_content_text_9",
                                                        "htmlClassNames": "u_content_text"
                                                    },
                                                    "selectable": true,
                                                    "draggable": true,
                                                    "deletable": true,
                                                    "color": "#4f4f4f",
                                                    "textAlign": "left",
                                                    "lineHeight": "150%",
                                                    "text": "<h2 style=\"margin-top: 0px; margin-bottom: 0.5rem; color: #a2ca28; font-size: 35px; line-height: 35px; font-weight: 300; text-transform: uppercase; font-family: Lato, sans-serif; text-align: center;\">DONDE M&Aacute;S LO</h2>\n<h2 style=\"margin-top: 0px; margin-bottom: 0.5rem; color: #a2ca28; font-size: 35px; line-height: 35px; font-weight: 300; text-transform: uppercase; font-family: Lato, sans-serif; text-align: center;\">NECESITAS</h2>"
                                                }
                                            },
                                            {
                                                "type": "text",
                                                "values": {
                                                    "containerPadding": "10px",
                                                    "_meta": {
                                                        "htmlID": "u_content_text_15",
                                                        "htmlClassNames": "u_content_text"
                                                    },
                                                    "selectable": true,
                                                    "draggable": true,
                                                    "deletable": true,
                                                    "color": "#121212",
                                                    "textAlign": "center",
                                                    "lineHeight": "140%",
                                                    "text": "<p style=\"font-size: 14px; line-height: 140%;\"><span style=\"color: #656e74; font-family: Lato, sans-serif; text-align: center; font-size: 14px; line-height: 19.6px;\">Redu-shaper&reg; concentra el calor en las zonas de gorditos y rollitos ayud&aacute;ndote a modelar cintura, espalda y abdomen.</span></p>"
                                                }
                                            },
                                            {
                                                "type": "text",
                                                "values": {
                                                    "containerPadding": "10px",
                                                    "_meta": {
                                                        "htmlID": "u_content_text_16",
                                                        "htmlClassNames": "u_content_text"
                                                    },
                                                    "selectable": true,
                                                    "draggable": true,
                                                    "deletable": true,
                                                    "color": "#121212",
                                                    "textAlign": "center",
                                                    "lineHeight": "140%",
                                                    "text": "<p style=\"font-size: 14px; line-height: 140%;\"><a style=\"color: #a2ca28; touch-action: manipulation; font-family: Lato, sans-serif;\" href=\"https://www.redushaper.info/home/#footer\">Contacta gratis un especialista, click aqu&iacute;</a></p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>\n<p style=\"font-size: 14px; line-height: 140%;\">&nbsp;</p>"
                                                }
                                            }
                                        ],
                                        "values": {
                                            "_meta": {
                                                "htmlID": "u_column_7",
                                                "htmlClassNames": "u_column"
                                            },
                                            "padding": "0px 20px",
                                            "backgroundColor": "#ffffff"
                                        }
                                    },
                                    {
                                        "contents": [
                                            {
                                                "type": "image",
                                                "values": {
                                                    "containerPadding": "0px",
                                                    "_meta": {
                                                        "htmlID": "u_content_image_3",
                                                        "htmlClassNames": "u_content_image"
                                                    },
                                                    "selectable": true,
                                                    "draggable": true,
                                                    "deletable": true,
                                                    "src": {
                                                        "url": "https://unroll-images-production.s3.amazonaws.com/projects/0/1555104977314-dondeNecesitas_m.jpg",
                                                        "width": 794,
                                                        "height": 394
                                                    },
                                                    "fullWidth": true,
                                                    "textAlign": "center",
                                                    "maxWidth": "100%",
                                                    "altText": "Image",
                                                    "action": {
                                                        "url": "",
                                                        "target": ""
                                                    }
                                                }
                                            }
                                        ],
                                        "values": {
                                            "_meta": {
                                                "htmlID": "u_column_8",
                                                "htmlClassNames": "u_column"
                                            },
                                            "padding": "0px"
                                        }
                                    }
                                ],
                                "values": {
                                    "columns": false,
                                    "backgroundColor": "#a2ca28",
                                    "columnsBackgroundColor": "rgba(255,255,255,0)",
                                    "backgroundImage": {
                                        "url": "",
                                        "fullWidth": true,
                                        "repeat": false,
                                        "center": false,
                                        "cover": false
                                    },
                                    "padding": "0px",
                                    "hideMobile": false,
                                    "noStackMobile": false,
                                    "_meta": {
                                        "htmlID": "u_row_6",
                                        "htmlClassNames": "u_row"
                                    },
                                    "selectable": true,
                                    "draggable": true,
                                    "deletable": true
                                }
                            },
                            {
                                "cells": [
                                    2,
                                    1
                                ],
                                "columns": [
                                    {
                                        "contents": [
                                            {
                                                "type": "image",
                                                "values": {
                                                    "containerPadding": "0px",
                                                    "_meta": {
                                                        "htmlID": "u_content_image_10",
                                                        "htmlClassNames": "u_content_image"
                                                    },
                                                    "selectable": true,
                                                    "draggable": true,
                                                    "deletable": true,
                                                    "src": {
                                                        "url": "https://unroll-images-production.s3.amazonaws.com/projects/0/1555105311252-heat.jpg",
                                                        "width": 794,
                                                        "height": 394
                                                    },
                                                    "fullWidth": true,
                                                    "textAlign": "center",
                                                    "maxWidth": "100%",
                                                    "altText": "Image",
                                                    "action": {
                                                        "url": "",
                                                        "target": ""
                                                    }
                                                }
                                            }
                                        ],
                                        "values": {
                                            "_meta": {
                                                "htmlID": "u_column_3",
                                                "htmlClassNames": "u_column"
                                            }
                                        }
                                    },
                                    {
                                        "contents": [
                                            {
                                                "type": "text",
                                                "values": {
                                                    "containerPadding": "10px 15px 8px",
                                                    "_meta": {
                                                        "htmlID": "u_content_text_8",
                                                        "htmlClassNames": "u_content_text"
                                                    },
                                                    "selectable": true,
                                                    "draggable": true,
                                                    "deletable": true,
                                                    "color": "#6eba79",
                                                    "textAlign": "left",
                                                    "lineHeight": "160%",
                                                    "text": ""
                                                }
                                            },
                                            {
                                                "type": "text",
                                                "values": {
                                                    "containerPadding": "10px 15px 8px",
                                                    "_meta": {
                                                        "htmlID": "u_content_text_24",
                                                        "htmlClassNames": "u_content_text"
                                                    },
                                                    "selectable": true,
                                                    "draggable": true,
                                                    "deletable": true,
                                                    "color": "#6eba79",
                                                    "textAlign": "left",
                                                    "lineHeight": "160%",
                                                    "text": "<h3 style=\"margin-top: 0px; margin-bottom: 0px; color: #fe8904; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; font-family: Lato, sans-serif; text-align: center;\">SUDA</h3>"
                                                }
                                            },
                                            {
                                                "type": "text",
                                                "values": {
                                                    "containerPadding": "10px 15px",
                                                    "_meta": {
                                                        "htmlID": "u_content_text_18",
                                                        "htmlClassNames": "u_content_text"
                                                    },
                                                    "selectable": true,
                                                    "draggable": true,
                                                    "deletable": true,
                                                    "color": "#4f4f4f",
                                                    "textAlign": "left",
                                                    "lineHeight": "150%",
                                                    "text": "<h2 style=\"margin-top: 0px; margin-bottom: 0.5rem; color: #a2ca28; font-size: 35px; line-height: 35px; font-weight: 300; text-transform: uppercase; font-family: Lato, sans-serif; text-align: center;\">DONDE M&Aacute;S LO</h2>\n<h2 style=\"margin-top: 0px; margin-bottom: 0.5rem; color: #a2ca28; font-size: 35px; line-height: 35px; font-weight: 300; text-transform: uppercase; font-family: Lato, sans-serif; text-align: center;\">NECESITAS</h2>"
                                                }
                                            },
                                            {
                                                "type": "text",
                                                "values": {
                                                    "containerPadding": "10px",
                                                    "_meta": {
                                                        "htmlID": "u_content_text_22",
                                                        "htmlClassNames": "u_content_text"
                                                    },
                                                    "selectable": true,
                                                    "draggable": true,
                                                    "deletable": true,
                                                    "color": "#121212",
                                                    "textAlign": "center",
                                                    "lineHeight": "140%",
                                                    "text": "<p style=\"font-size: 14px; line-height: 140%;\"><span style=\"color: #656e74; font-family: Lato, sans-serif; font-size: 14px; line-height: 19.6px;\">Redu-shaper&reg; concentra el calor en las zonas de gorditos y rollitos ayud&aacute;ndote a modelar cintura, espalda y abdomen.</span></p>"
                                                }
                                            },
                                            {
                                                "type": "text",
                                                "values": {
                                                    "containerPadding": "10px",
                                                    "_meta": {
                                                        "htmlID": "u_content_text_23",
                                                        "htmlClassNames": "u_content_text"
                                                    },
                                                    "selectable": true,
                                                    "draggable": true,
                                                    "deletable": true,
                                                    "color": "#121212",
                                                    "textAlign": "center",
                                                    "lineHeight": "140%",
                                                    "text": ""
                                                }
                                            },
                                            {
                                                "type": "text",
                                                "values": {
                                                    "containerPadding": "10px",
                                                    "_meta": {
                                                        "htmlID": "u_content_text_19",
                                                        "htmlClassNames": "u_content_text"
                                                    },
                                                    "selectable": true,
                                                    "draggable": true,
                                                    "deletable": true,
                                                    "color": "#121212",
                                                    "textAlign": "center",
                                                    "lineHeight": "140%",
                                                    "text": "<p style=\"line-height: 140%; font-size: 14px;\"><a style=\"color: #a2ca28; touch-action: manipulation; font-family: Lato, sans-serif;\" href=\"https://www.redushaper.info/home/#footer\">Contacta gratis un especialista, click aqu&iacute;</a></p>\n<p style=\"line-height: 140%; font-size: 14px;\">&nbsp;</p>\n<p style=\"line-height: 140%; font-size: 14px;\">&nbsp;</p>\n<p style=\"line-height: 140%; font-size: 14px;\">&nbsp;</p>\n<p style=\"line-height: 140%; font-size: 14px;\">&nbsp;</p>"
                                                }
                                            }
                                        ],
                                        "values": {
                                            "backgroundColor": "#ffffff",
                                            "padding": "0px 20px",
                                            "border": {},
                                            "_meta": {
                                                "htmlID": "u_column_24",
                                                "htmlClassNames": "u_column"
                                            }
                                        }
                                    }
                                ],
                                "values": {
                                    "columns": false,
                                    "backgroundColor": "#a2ca28",
                                    "columnsBackgroundColor": "rgba(255,255,255,0)",
                                    "backgroundImage": {
                                        "url": "",
                                        "fullWidth": true,
                                        "repeat": false,
                                        "center": false,
                                        "cover": false
                                    },
                                    "padding": "0px",
                                    "hideMobile": false,
                                    "noStackMobile": false,
                                    "_meta": {
                                        "htmlID": "u_row_3",
                                        "htmlClassNames": "u_row"
                                    },
                                    "selectable": true,
                                    "draggable": true,
                                    "deletable": true
                                }
                            },
                            {
                                "cells": [
                                    1,
                                    2
                                ],
                                "columns": [
                                    {
                                        "contents": [
                                            {
                                                "type": "image",
                                                "values": {
                                                    "containerPadding": "0px",
                                                    "_meta": {
                                                        "htmlID": "u_content_image_2",
                                                        "htmlClassNames": "u_content_image"
                                                    },
                                                    "selectable": true,
                                                    "draggable": true,
                                                    "deletable": true,
                                                    "src": {
                                                        "url": "https://a.mailmunch.co/user_data/landing_pages/1500313461528-1.png",
                                                        "width": 500,
                                                        "height": 500
                                                    },
                                                    "fullWidth": true,
                                                    "textAlign": "center",
                                                    "maxWidth": "100%",
                                                    "altText": "Image",
                                                    "action": {
                                                        "url": "",
                                                        "target": ""
                                                    }
                                                }
                                            }
                                        ],
                                        "values": {
                                            "_meta": {
                                                "htmlID": "u_column_4",
                                                "htmlClassNames": "u_column"
                                            }
                                        }
                                    },
                                    {
                                        "contents": [
                                            {
                                                "type": "text",
                                                "values": {
                                                    "containerPadding": "10px 15px 8px",
                                                    "_meta": {
                                                        "htmlID": "u_content_text_6",
                                                        "htmlClassNames": "u_content_text"
                                                    },
                                                    "selectable": true,
                                                    "draggable": true,
                                                    "deletable": true,
                                                    "color": "#6eba79",
                                                    "textAlign": "left",
                                                    "lineHeight": "160%",
                                                    "text": "<div><span style=\"font-size: 20px; line-height: 32px;\">[[business_name]] SKI RIDE</span></div>"
                                                }
                                            },
                                            {
                                                "type": "text",
                                                "values": {
                                                    "containerPadding": "10px 15px",
                                                    "_meta": {
                                                        "htmlID": "u_content_text_7",
                                                        "htmlClassNames": "u_content_text"
                                                    },
                                                    "selectable": true,
                                                    "draggable": true,
                                                    "deletable": true,
                                                    "color": "#4f4f4f",
                                                    "textAlign": "left",
                                                    "lineHeight": "150%",
                                                    "text": "<div>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation.</div>"
                                                }
                                            },
                                            {
                                                "type": "button",
                                                "values": {
                                                    "containerPadding": "5px 15px",
                                                    "_meta": {
                                                        "htmlID": "u_content_button_1",
                                                        "htmlClassNames": "u_content_button"
                                                    },
                                                    "selectable": true,
                                                    "draggable": true,
                                                    "deletable": true,
                                                    "href": "",
                                                    "buttonColors": {
                                                        "color": "#FFF",
                                                        "backgroundColor": "#fa9302",
                                                        "hoverColor": "#cf7a04"
                                                    },
                                                    "textAlign": "left",
                                                    "lineHeight": "120%",
                                                    "border": {},
                                                    "borderRadius": "20px",
                                                    "padding": "10px 20px",
                                                    "calculatedHeight": 36,
                                                    "calculatedWidth": 135,
                                                    "text": "ORDER NOW<br />"
                                                }
                                            }
                                        ],
                                        "values": {
                                            "_meta": {
                                                "htmlID": "u_column_5",
                                                "htmlClassNames": "u_column"
                                            }
                                        }
                                    }
                                ],
                                "values": {
                                    "columns": false,
                                    "backgroundColor": "rgba(255,255,255,0)",
                                    "columnsBackgroundColor": "rgba(255,255,255,0)",
                                    "backgroundImage": {
                                        "url": "",
                                        "fullWidth": true,
                                        "repeat": false,
                                        "center": false,
                                        "cover": false
                                    },
                                    "padding": "10px",
                                    "hideMobile": false,
                                    "noStackMobile": false,
                                    "_meta": {
                                        "htmlID": "u_row_4",
                                        "htmlClassNames": "u_row"
                                    },
                                    "selectable": true,
                                    "draggable": true,
                                    "deletable": true
                                }
                            },
                            {
                                "cells": [
                                    1
                                ],
                                "columns": [
                                    {
                                        "contents": [
                                            {
                                                "type": "divider",
                                                "values": {
                                                    "containerPadding": "1px 20px 5px",
                                                    "_meta": {
                                                        "htmlID": "u_content_divider_2",
                                                        "htmlClassNames": "u_content_divider"
                                                    },
                                                    "selectable": true,
                                                    "draggable": true,
                                                    "deletable": true,
                                                    "width": "100%",
                                                    "border": {
                                                        "borderTopWidth": "1px",
                                                        "borderTopStyle": "solid",
                                                        "borderTopColor": "#CCC"
                                                    },
                                                    "textAlign": "center"
                                                }
                                            }
                                        ],
                                        "values": {
                                            "_meta": {
                                                "htmlID": "u_column_6",
                                                "htmlClassNames": "u_column"
                                            }
                                        }
                                    }
                                ],
                                "values": {
                                    "columns": false,
                                    "backgroundColor": "rgba(255,255,255,0)",
                                    "columnsBackgroundColor": "rgba(255,255,255,0)",
                                    "backgroundImage": {
                                        "url": "",
                                        "fullWidth": true,
                                        "repeat": false,
                                        "center": false,
                                        "cover": false
                                    },
                                    "padding": "0px",
                                    "hideMobile": false,
                                    "noStackMobile": false,
                                    "_meta": {
                                        "htmlID": "u_row_5",
                                        "htmlClassNames": "u_row"
                                    },
                                    "selectable": true,
                                    "draggable": true,
                                    "deletable": true
                                }
                            },
                            {
                                "cells": [
                                    1
                                ],
                                "columns": [
                                    {
                                        "contents": [
                                            {
                                                "type": "divider",
                                                "values": {
                                                    "containerPadding": "1px 20px 5px",
                                                    "_meta": {
                                                        "htmlID": "u_content_divider_3",
                                                        "htmlClassNames": "u_content_divider"
                                                    },
                                                    "selectable": true,
                                                    "draggable": true,
                                                    "deletable": true,
                                                    "width": "100%",
                                                    "border": {
                                                        "borderTopWidth": "1px",
                                                        "borderTopStyle": "solid",
                                                        "borderTopColor": "#CCC"
                                                    },
                                                    "textAlign": "center"
                                                }
                                            }
                                        ],
                                        "values": {
                                            "_meta": {
                                                "htmlID": "u_column_9",
                                                "htmlClassNames": "u_column"
                                            }
                                        }
                                    }
                                ],
                                "values": {
                                    "columns": false,
                                    "backgroundColor": "rgba(255,255,255,0)",
                                    "columnsBackgroundColor": "rgba(255,255,255,0)",
                                    "backgroundImage": {
                                        "url": "",
                                        "fullWidth": true,
                                        "repeat": false,
                                        "center": false,
                                        "cover": false
                                    },
                                    "padding": "0px",
                                    "hideMobile": false,
                                    "noStackMobile": false,
                                    "_meta": {
                                        "htmlID": "u_row_7",
                                        "htmlClassNames": "u_row"
                                    },
                                    "selectable": true,
                                    "draggable": true,
                                    "deletable": true
                                }
                            },
                            {
                                "cells": [
                                    1,
                                    2
                                ],
                                "columns": [
                                    {
                                        "contents": [
                                            {
                                                "type": "image",
                                                "values": {
                                                    "containerPadding": "0px",
                                                    "_meta": {
                                                        "htmlID": "u_content_image_4",
                                                        "htmlClassNames": "u_content_image"
                                                    },
                                                    "selectable": true,
                                                    "draggable": true,
                                                    "deletable": true,
                                                    "src": {
                                                        "url": "https://a.mailmunch.co/user_data/landing_pages/1500314095876-3.png",
                                                        "width": 500,
                                                        "height": 500
                                                    },
                                                    "fullWidth": true,
                                                    "textAlign": "center",
                                                    "maxWidth": "100%",
                                                    "altText": "Image",
                                                    "action": {
                                                        "url": "",
                                                        "target": ""
                                                    }
                                                }
                                            }
                                        ],
                                        "values": {
                                            "_meta": {
                                                "htmlID": "u_column_10",
                                                "htmlClassNames": "u_column"
                                            }
                                        }
                                    },
                                    {
                                        "contents": [
                                            {
                                                "type": "text",
                                                "values": {
                                                    "containerPadding": "10px 15px 8px",
                                                    "_meta": {
                                                        "htmlID": "u_content_text_10",
                                                        "htmlClassNames": "u_content_text"
                                                    },
                                                    "selectable": true,
                                                    "draggable": true,
                                                    "deletable": true,
                                                    "color": "#6eba79",
                                                    "textAlign": "left",
                                                    "lineHeight": "160%",
                                                    "text": "<div><span style=\"font-size: 20px; line-height: 32px;\">BEACH DAY</span></div>"
                                                }
                                            },
                                            {
                                                "type": "text",
                                                "values": {
                                                    "containerPadding": "10px 15px",
                                                    "_meta": {
                                                        "htmlID": "u_content_text_11",
                                                        "htmlClassNames": "u_content_text"
                                                    },
                                                    "selectable": true,
                                                    "draggable": true,
                                                    "deletable": true,
                                                    "color": "#4f4f4f",
                                                    "textAlign": "left",
                                                    "lineHeight": "150%",
                                                    "text": "<div>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation</div>"
                                                }
                                            },
                                            {
                                                "type": "button",
                                                "values": {
                                                    "containerPadding": "5px 15px",
                                                    "_meta": {
                                                        "htmlID": "u_content_button_3",
                                                        "htmlClassNames": "u_content_button"
                                                    },
                                                    "selectable": true,
                                                    "draggable": true,
                                                    "deletable": true,
                                                    "href": "",
                                                    "buttonColors": {
                                                        "color": "#FFF",
                                                        "backgroundColor": "#fa9302",
                                                        "hoverColor": "#cf7a04"
                                                    },
                                                    "textAlign": "left",
                                                    "lineHeight": "120%",
                                                    "border": {},
                                                    "borderRadius": "20px",
                                                    "padding": "10px 20px",
                                                    "calculatedHeight": 36,
                                                    "calculatedWidth": 135,
                                                    "text": "ORDER NOW<br />"
                                                }
                                            }
                                        ],
                                        "values": {
                                            "_meta": {
                                                "htmlID": "u_column_11",
                                                "htmlClassNames": "u_column"
                                            }
                                        }
                                    }
                                ],
                                "values": {
                                    "columns": false,
                                    "backgroundColor": "rgba(255,255,255,0)",
                                    "columnsBackgroundColor": "rgba(255,255,255,0)",
                                    "backgroundImage": {
                                        "url": "",
                                        "fullWidth": true,
                                        "repeat": false,
                                        "center": false,
                                        "cover": false
                                    },
                                    "padding": "10px",
                                    "hideMobile": false,
                                    "noStackMobile": false,
                                    "_meta": {
                                        "htmlID": "u_row_8",
                                        "htmlClassNames": "u_row"
                                    },
                                    "selectable": true,
                                    "draggable": true,
                                    "deletable": true
                                }
                            },
                            {
                                "cells": [
                                    1
                                ],
                                "columns": [
                                    {
                                        "contents": [
                                            {
                                                "type": "divider",
                                                "values": {
                                                    "containerPadding": "1px 20px 5px",
                                                    "_meta": {
                                                        "htmlID": "u_content_divider_4",
                                                        "htmlClassNames": "u_content_divider"
                                                    },
                                                    "selectable": true,
                                                    "draggable": true,
                                                    "deletable": true,
                                                    "width": "100%",
                                                    "border": {
                                                        "borderTopWidth": "1px",
                                                        "borderTopStyle": "solid",
                                                        "borderTopColor": "#CCC"
                                                    },
                                                    "textAlign": "center"
                                                }
                                            }
                                        ],
                                        "values": {
                                            "_meta": {
                                                "htmlID": "u_column_12",
                                                "htmlClassNames": "u_column"
                                            }
                                        }
                                    }
                                ],
                                "values": {
                                    "columns": false,
                                    "backgroundColor": "rgba(255,255,255,0)",
                                    "columnsBackgroundColor": "rgba(255,255,255,0)",
                                    "backgroundImage": {
                                        "url": "",
                                        "fullWidth": true,
                                        "repeat": false,
                                        "center": false,
                                        "cover": false
                                    },
                                    "padding": "0px",
                                    "hideMobile": false,
                                    "noStackMobile": false,
                                    "_meta": {
                                        "htmlID": "u_row_9",
                                        "htmlClassNames": "u_row"
                                    },
                                    "selectable": true,
                                    "draggable": true,
                                    "deletable": true
                                }
                            },
                            {
                                "cells": [
                                    1
                                ],
                                "columns": [
                                    {
                                        "contents": [
                                            {
                                                "type": "text",
                                                "values": {
                                                    "containerPadding": "15px",
                                                    "_meta": {
                                                        "htmlID": "u_content_text_12",
                                                        "htmlClassNames": "u_content_text"
                                                    },
                                                    "selectable": true,
                                                    "draggable": true,
                                                    "deletable": true,
                                                    "color": "#fa9302",
                                                    "textAlign": "center",
                                                    "lineHeight": "130%",
                                                    "text": "<div><span style=\"font-size: 36px; line-height: 46.8px;\">NEED MORE INFORMATION?</span></div>"
                                                }
                                            },
                                            {
                                                "type": "text",
                                                "values": {
                                                    "containerPadding": "10px",
                                                    "_meta": {
                                                        "htmlID": "u_content_text_13",
                                                        "htmlClassNames": "u_content_text"
                                                    },
                                                    "selectable": true,
                                                    "draggable": true,
                                                    "deletable": true,
                                                    "color": "#4f4f4f",
                                                    "textAlign": "center",
                                                    "lineHeight": "120%",
                                                    "text": "<div><span style=\"font-size: 20px; line-height: 24px;\">Subscribe to get updates.</span></div>"
                                                }
                                            },
                                            {
                                                "type": "button",
                                                "values": {
                                                    "containerPadding": "20px",
                                                    "_meta": {
                                                        "htmlID": "u_content_button_4",
                                                        "htmlClassNames": "u_content_button"
                                                    },
                                                    "selectable": true,
                                                    "draggable": true,
                                                    "deletable": true,
                                                    "href": "",
                                                    "buttonColors": {
                                                        "color": "#FFF",
                                                        "backgroundColor": "#6eba79",
                                                        "hoverColor": "#58a864"
                                                    },
                                                    "textAlign": "center",
                                                    "lineHeight": "160%",
                                                    "border": {},
                                                    "borderRadius": "37px",
                                                    "padding": "10px 20px",
                                                    "calculatedHeight": 52,
                                                    "calculatedWidth": 218,
                                                    "text": "<span style=\"font-size: 20px; line-height: 32px;\">SUBSCRIBE NOW</span>"
                                                }
                                            }
                                        ],
                                        "values": {
                                            "_meta": {
                                                "htmlID": "u_column_13",
                                                "htmlClassNames": "u_column"
                                            }
                                        }
                                    }
                                ],
                                "values": {
                                    "columns": false,
                                    "backgroundColor": "rgba(255,255,255,0)",
                                    "columnsBackgroundColor": "rgba(255,255,255,0)",
                                    "backgroundImage": {
                                        "url": "",
                                        "fullWidth": true,
                                        "repeat": false,
                                        "center": false,
                                        "cover": false
                                    },
                                    "padding": "10px",
                                    "hideMobile": false,
                                    "noStackMobile": false,
                                    "_meta": {
                                        "htmlID": "u_row_10",
                                        "htmlClassNames": "u_row"
                                    },
                                    "selectable": true,
                                    "draggable": true,
                                    "deletable": true
                                }
                            }
                        ],
                        "values": {
                            "backgroundColor": "#ffffff",
                            "backgroundImage": {
                                "url": "",
                                "fullWidth": true,
                                "repeat": false,
                                "center": true,
                                "cover": false
                            },
                            "contentWidth": "1200px",
                            "fontFamily": {
                                "label": "Montserrat",
                                "value": "'Montserrat',sans-serif",
                                "type": "google",
                                "weights": "400,700"
                            },
                            "_meta": {
                                "htmlID": "u_body",
                                "htmlClassNames": "u_body"
                            }
                        }
                    }
                }
            } else {
                var lastIndex = this.state.page_data.design.length - 1;
                this.setState({ selectedIndex: lastIndex });
                template = !params.splitEdit ? JSON.parse(this.changeWordTemplate(this.state.page_data.design[lastIndex].json)) : JSON.parse(this.changeWordTemplate(this.state.page_data.split_design));

                // function for disabling drag for notifier if it aleady has notifier enable in the page
                unlayer.addEventListener('design:loaded', function(data) {
                    var ifr = document.querySelector('#editor iframe');
                    ifr.contentDocument.getElementById("u_body").parentNode.id = "editor-screen";
                    if(data.design.counters.u_content_notifier){
                        ifr.contentDocument.querySelectorAll(".blockbuilder-content-tool").forEach(el => {
                            if(el.querySelector(".blockbuilder-content-tool-name").innerText.toLowerCase() == "notifier"){
                                if(state.page_data.design[lastIndex].json.includes('"type":"notifier"')){
                                    el.setAttribute("draggable", false);
                                    if(!ifr.contentDocument.getElementById("sidebar-notifier")){
                                        var li_container = document.createElement("li");
                                        li_container.id = "sidebar-notifier";
                                        li_container.className = "nav-item";
                                        li_container.innerHTML = '<a role="button" class="nav-link"><span class="nav-icon"><svg class="svg-inline--fa fa-palette fa-w-16" xmlns="http://www.w3.org/2000/svg" version="1.1" id="Capa_1" x="0px" y="0px" width="535.5px" height="535.5px" viewBox="0 0 535.5 535.5" xml:space="preserve" fill="#fff"> <g> <g id="notifications-on"> <path d="M142.8,53.55l-35.7-35.7C45.9,63.75,5.1,135.15,0,216.75h51C56.1,147.9,89.25,89.25,142.8,53.55z M484.5,216.75h51 c-5.1-81.6-43.35-153-104.55-198.9l-35.7,35.7C446.25,89.25,479.4,147.9,484.5,216.75z M433.5,229.5 c0-79.05-53.55-142.8-127.5-160.65V51c0-20.4-17.85-38.25-38.25-38.25c-20.4,0-38.25,17.85-38.25,38.25v17.85 C155.55,86.7,102,150.45,102,229.5v140.25l-51,51v25.5h433.5v-25.5l-51-51V229.5z M267.75,522.75c2.55,0,7.65,0,10.2,0 c17.85-2.55,30.6-15.3,35.7-30.6c2.55-5.101,5.1-12.75,5.1-20.4h-102C216.75,499.8,239.7,522.75,267.75,522.75z"></path> </g> </g> </svg></span><span class="nav-name"><span>Notifier</span></span></a>';
                                        li_container.onclick = () => {
                                            ifr.contentDocument.getElementById('notifier_box').click();
                                        }
                                        ifr.contentDocument.querySelector(".nav.flex-column.nav-tabs").appendChild(li_container);
                                    }
                                }
                            }
                        });
                    } else {
                        // if clear the page remove notifier from sidebar of editor if exist
                        if(ifr.contentDocument.getElementById("sidebar-notifier")){
                            ifr.contentDocument.querySelectorAll(".blockbuilder-content-tool").forEach(el => {
                                if(el.querySelector(".blockbuilder-content-tool-name").innerText.toLowerCase() == "notifier"){
                                    el.setAttribute("draggable", true);
                                    ifr.contentDocument.getElementById("sidebar-notifier").remove();
                                };
                            });
                        }
                    }
                    if(resolve){
                        resolve()
                    }
                })
            }

            // todo :: start removing data that is not in the right place
            let remove_missing = [];
            let fn_checkout = ["variant", "multi_variants","multiple_variant_tools" , "multi_variants_two", "Receipt", "product_addons", "SimpleForm", "paypal-button", "authorize-form", "authorize-form-subscription", "stripe-checkout", "conekta-form", "conekta-form-subscription", "cod-form", "cod-form-v2","cod-form-new-genie"];
            let fn_upsell = ["multi_variants_upsell_button", "authorize_form_subscription_upsell", "conekta-form-upsell", "conekta-form-subscription-upsell"];
            let fn_thankyou = ["order_list", "yala_genie", "thankyou_upsell_button"];
            // if has in design but restricted
            if (!condition.is_exclusive_vip_user(currentUser)) remove_missing.push(...["multi_variants", "multi_variants_upsell_button"]);
            if (!condition.has_local_tag(currentUser, "yala")) remove_missing.push(...["yala_genie"]);
            if (!condition.has_local_tag(currentUser, "i_conekta")) remove_missing.push(...["conekta-form", "conekta-form-upsell"]);
            if (!condition.has_funnel_subscriber(currentUser, "fa_subscriber")) remove_missing.push(...["authorize-form-subscription", "authorize_form_subscription_upsell"]);
            if (!condition.has_funnel_subscriber(currentUser, "fc_subscriber")) remove_missing.push(...["conekta-form-subscription", "conekta-form-subscription-upsell"]);
            if (!paypalClientID) remove_missing.push("paypal-button");
            if (selected_merchant !== "stripe") remove_missing.push("stripe-checkout");
            if (selected_merchant !== "authorize.net") remove_missing.push(...["authorize-form", "authorize-form-subscription", "authorize_form_subscription_upsell"]);
            if (selected_merchant !== "conekta") remove_missing.push(...["conekta-form", "conekta-form-subscription", "conekta-form-upsell", "conekta-form-subscription-upsell"]);
            // base on page type
            if (page_type === "checkout") removeData([...remove_missing, ...fn_upsell, ...fn_thankyou]);
            else if (isUpsellOrDownsell) removeData([...remove_missing, ...fn_checkout, ...fn_thankyou]);
            else if (page_type === "thank-you-page") removeData([...remove_missing, ...fn_checkout, ...fn_upsell]);
            else removeData([...remove_missing, ...fn_checkout, ...fn_upsell, ...fn_thankyou]);
            function removeData(remove_contents) {
                template.body.rows.forEach((row, x) => {
                    row.columns.forEach((column, y) => {
                        column.contents.forEach((content, z) => { // remove object inside array
                            if (remove_contents.includes(content.type)) column.contents.splice(z, 1);
                        });
                    });
                });
            }
            // end removing data that is not in the right page type

            unlayer.loadDesign(template);
            // reflect the custom javascript and refresh the template
            unlayer.loadDesign(template);

            // start enabling the save button
            const self = this;
            function enableSaveButtons(){
                setTimeout(function() {
                    self.setState({ isPageFullyLoaded: true }, () => self.hasNoPlgSku());
                }, 1000);
            }
            document.querySelector("#editor iframe").addEventListener('load', enableSaveButtons, false);
            // end enabling the save button
        }

        document.body.appendChild(script1);
    }

    changeSelectedIndex() {
        var template = JSON.parse(this.changeWordTemplate(this.state.page_data.design[this.state.selectedIndex].json));
        unlayer.loadDesign(template);
    }

    uploadHTML(callback) {
        var state = this.state;
        var currentUser = this.props.session.getCurrentUser;
        var page_data = this.state.page_data;
        var domain = this.state.page_data.domain_name;
        var path = null;
        var params = this.props.location.state;
        if(!page_data.page_is_root){
            path = page_data.path ? page_data.funnel_name + "/" + page_data.path : page_data.funnel_name;
        }
        var qryParams = !params.splitEdit ? "$html" : "$html2";
        var qryTxt = !params.splitEdit ? "html: $html" : "html2: $html2";
        var payload = {
            payload: !page_data.published_page_id && !state.pageID ? {
                "query": "mutation($domain: String, $path: String, $creator: String, $html: String){\n  addPage(domain: $domain, path: $path, creator: $creator, html: $html){\n    id\n   }\n}",
                "variables": {
                    domain: domain,
                    path: path,
                    creator: currentUser.id,
                    html: state.saveAsHTML
                }
            } : {
                    "query": "mutation($id: String, "+qryParams+": String, $path: String){\n  updatePage(id: $id, path: $path, "+qryTxt+"){\n    id\n   }\n}",
                    "variables": {
                        id: page_data.published_page_id ? page_data.published_page_id : state.pageID,
                        path: path,
                        domain: domain,
                        html: !params.splitEdit ? state.saveAsHTML : '',
                        html2: params.splitEdit ? state.saveAsHTML : ''
                    }
                }
        }
        points.customFetch('/send-html-to-domain', 'POST', payload, res => {
            console.log("the callback ",res);
            callback(res)
        })
    }

    exportCheckoutLoader(){
        var discountList = document.querySelector("#editor iframe").contentWindow.discountList;
        if(discountList.filter(el => el).length == 0) return '';
        return `
            <style> 
                .loading-checkout {
                    position: absolute;
                    top: 0;
                }
                .loading-checkout #Progress_Status {
                    width: 50%;
                    background-color: #ddd;
                }
                .loading-checkout .center {
                    display: flex;
                    justify-content: center;
                }
                .loading-checkout .border-loading {
                    border-radius: 40px;
                    border: 0px solid;
                    height: 25px;
                }
                .loading-checkout #myprogressBar {
                    width: 1%;
                    background-image: linear-gradient(45deg, #6698d1 20%, #4776cf 20%, #4776cf 50%, #6698d1 50%, #6698d1 70%, #4776cf 70%, #4776cf 100%);
                    background-size: 35.36px 35.36px;
                    text-align: center;
                    line-height: 25px;
                    color: #fff f;
                    font-size: 18px;
                    font-weight: bold;
                    font-family: sans-serif;
                }
                .loading-checkout .div1 {
                    z-index: 999;
                }
                .loading-checkout .loading-screen {
                    height: 100%;
                    position: fixed;
                    width: 100%;
                    background: white;
                    align-items: center;
                    height: 100%;
                }
                .loading-checkout .loading-content {
                    border: 1px solid #36ad60;
                    padding: 10px 30px;
                    width: 600px;
                    height: 350px;
                }
                .loading-checkout .gif-loading {
                    margin-bottom: 5px;
                    width: -webkit-fill-available;
                }
                .loading-checkout #Progress_Status {
                    width: 100%;
                }
                .loading-checkout .loading-text {
                    font-size: 25px;
                    font-weight: bold;
                    font-family: sans-serif;
                    margin-top: 20px;
                    text-align: center;
                }
                .loading-checkout .fade {
                    display: flex;
                    justify-content: center;
                    /* visibility: hidden; */
                    /* opacity: 0; */
                    /* transition: visibility 0s 2s, opacity 2s linear; */
                    height: 100%;
                    position: fixed;
                    width: 100%;
                    background: white;
                    align-items: center;
                    height: 100%;
                }
            </style>

            <div class="loading-checkout">
                <div id="first-load" class="loading-screen div1 center" style="">
                    <div class="img"><img src="https://productlistgenie.com/images/e.gif" height="150px"></div>
                </div>
                <div id="main-loading-content" class="fade" style="display: none; z-index: 99999;">
                    <div class="loading-content">
                        <div style="height:100px">
                            <p id="demo" class="loading-text">Special ${Math.max(...discountList)}% Discount still available - Applying ${Math.max(...discountList)}% Discount!</p>
                        </div>
                        <div id="d" class="gif-loading center"><img src="https://productlistgenie.com/images/sa.gif?a=0.7921999254599787" height="150px"></div>

                        <div id="Progress_Status" class="border-loading">
                            <div id="myprogressBar" class="border-loading" style="width: 100%;">100%</div>
                        </div>
                    </div>
                </div>
            </div>

            <script>
                function divchange() {
                    document.getElementById("first-load").style.display = "none";
                    document.getElementById("main-loading-content").style.display = "flex";
                }
                window.onload = setTimeout(divchange, 3000);
                function update() {
                    var element = document.getElementById("myprogressBar");
                    var width = 1;
                    var identity = setInterval(scene, 50);
                    function scene() {
                        if (width >= 33) {
                            clearInterval(identity);
                            document.getElementById("demo").innerHTML = "Limited stock available in Warehouse 2. Reserving your units...!";
                            document.getElementById("d").innerHTML = '<img src="https://productlistgenie.com/images/sa.gif?a=2" height="150px"/>';
                        } else {
                            width++;
                            element.style.width = width + '%';
                            element.innerHTML = width * 1 + '%';
                        }
                    }
                }
                window.onload = setTimeout(update, 3000);
                function update1() {
                    var element = document.getElementById("myprogressBar");
                    var width = 33;
                    var identity = setInterval(scene, 50);
                    function scene() {
                        if (width >= 66) {
                            clearInterval(identity);
                            document.getElementById("demo").innerHTML = "Special ${Math.max(...discountList)}% Discount still available - Applying ${Math.max(...discountList)}% Discount!";
                            document.getElementById("d").innerHTML = '<img src="https://productlistgenie.com/images/sa.gif?a=1" height="150px"/>';
                        } else {
                            width++;
                            element.style.width = width + '%';
                            element.innerHTML = width * 1 + '%';
                        }
                    }
                }
                window.onload = setTimeout(update1, 6000);
                function update2() {
                    var element = document.getElementById("myprogressBar");
                    var width = 66;
                    var identity = setInterval(scene, 50);
                    function scene() {
                        if (width >= 100) {
                            clearInterval(identity);
                            document.getElementById("demo").innerHTML = "Special ${Math.max(...discountList)}% Discount still available - Applying ${Math.max(...discountList)}% Discount!";
                        } else {
                            width++;
                            element.style.width = width + '%';
                            element.innerHTML = width * 1 + '%';
                        }
                    }
                }
                window.onload = setTimeout(update2, 9000);
                function fade() {
                    document.getElementById("main-loading-content").className = "fade";
                }
                window.onload = setTimeout(fade, 11000);
                function fade1() {
                    document.getElementById("main-loading-content").style.display = "none";
                }
                window.onload = setTimeout(fade1, 12000);
            </script>
        `;
    }

    toTitleCase(str) {
        return str.replace(
            /\w\S*/g,
            function(txt) {
                return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
            }
        );
    }

    updateFunnelPageList(updateFunnelPageList, dontUpload, resolve) {
        toastr.options.onclick = null;
        var state = this.state;
        console.log("🏁🏁🚩");
        console.log();
        // console.log(state.saveAsJSON.body.values.footerScript);
        var JSONContentDesign = JSON.parse(state.page_data.design[state.page_data.design.length -1].json).body.values


        var headerScript =  JSONContentDesign.headerScript;
        var footerScript = JSONContentDesign.footerScript;
        
        console.log("🏁🏁🚩 headerScript", headerScript);
        console.log("🏁🏁🚩 footerScript", footerScript);
        
        if(state.isSaving) return null;
        this.setState({ isSaving: true });
        var page_data = state.page_data;        
        var domain = this.state.page_data.domain_name;
        toastr.options.timeOut = 0;
        toastr.options.extendedTimeOut = 0;
        toastr.clear();
        toastr.info("Loading Please wait...", "");
        let inHeader = `
            <meta plgdata data-pageid="${page_data.id}"> 
            <meta plgdata data-funnelid="${page_data.funnel_id}">
            <meta plgdata data-funnelname="${page_data.funnel_name}">
            <meta plgdata data-cid="${this.encryptString(user_id)}">
            <meta plgdata data-ptype="${page_data.page_type}">
        `;
        let inBody = "", meta = "", inFooter = page_data.funnel_footer_analytics ? page_data.funnel_footer_analytics : ""; //June 8 Edited
        
        // Klaviyo Integration Sept11 2021
        let integrations = []

        
        if(state.klaviyoPK && page_data.funnel_use_email_abandonment) {
            const klaviyo = {
                type: "klaviyo",
                pk: state.klaviyoPK,
                campaign: state.cartAbandonment,
                t: 5  // delay to execute, use 0 if want to execute immediately 
            }
            inHeader += `<meta plgdata data-integration="${this.encryptString(JSON.stringify(klaviyo))}">`;
        }
        // RECENT:
        inHeader += `<script>
                    const plgQS=()=>{const c=new URLSearchParams(window.location.search);return null!==c.get("plgsrc")?c.get("plgsrc"):""};
                    var sourcePR = window.location.href
                    </script>`

        if(page_data.split_design){
            inHeader += `<meta plgdata data-ab="${this.props.location.state.splitEdit ? "b" : "a"}">`;
        }
        
        if(page_data.funnel_facebook_id){
            // if user put facebook id in funnel setting
            //TODO: Conversion API May25
            var trackView = "";
            if(page_data.page_type == "page"){
                trackView = "ViewContent";
            }
            inHeader += `
                <script>
                    !function(f,b,e,v,n,t,s)
                    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
                    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
                    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
                    n.queue=[];t=b.createElement(e);t.async=!0;
                    t.src=v;s=b.getElementsByTagName(e)[0];
                    s.parentNode.insertBefore(t,s)}(window, document,'script',
                    'https://connect.facebook.net/en_US/fbevents.js');
                    fbq('init', '${page_data.funnel_facebook_id}');
                    fbq('track', 'PageView');
                    ${trackView ? "fbq('track', '"+trackView+"')" : void 0}
                    localStorage.setItem('fb_pixel_id', '${page_data.funnel_facebook_id}');
                </script>
                <noscript>
                    <img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=${page_data.funnel_facebook_id}&ev=PageView&noscript=1"/>
                </noscript>
            `;
        }
        if(page_data.funnel_google_id){
            // if user put google id in funnel setting
            // page_data.funnel_name page_data.page_type
            const googleIDandLabel = page_data.funnel_google_id.replace(/ /g, '').split(/,/)
            inHeader += `
                <script async src="https://www.googletagmanager.com/gtag/js?id=${googleIDandLabel[0]}"></script>
                <script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){dataLayer.push(arguments);}
                    gtag('js', new Date());
                    gtag('config', '${googleIDandLabel[0]}');\n`;
                
                    if(typeof googleIDandLabel[1] !== 'undefined'){
                        inHeader += `gtag('config', '${googleIDandLabel[1]}');\n`;
                    }
                    if(typeof googleIDandLabel[2] !== 'undefined'){
                        inHeader +=    `\n const googleConversion = (value) => {
                            gtag("event", "conversion", {
                            send_to: "${googleIDandLabel[1]}/${googleIDandLabel[2]}",
                            value: value,
                            currency: "USD",
                            });
                        }`;
                    };

            inHeader +=`</script>`;
        }
        // Sept1
        if(page_data.funnel_tiktok_id){
            // if user put snapchat id in funnel setting
            inHeader += `
            <script>
            !function (w, d, t) {
                w.TiktokAnalyticsObject=t;var ttq=w[t]=w[t]||[];ttq.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie"],ttq.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}};for(var i=0;i<ttq.methods.length;i++)ttq.setAndDefer(ttq,ttq.methods[i]);ttq.instance=function(t){for(var e=ttq._i[t]||[],n=0;n<ttq.methods.length;n++)ttq.setAndDefer(e,ttq.methods[n]);return e},ttq.load=function(e,n){var i="https://analytics.tiktok.com/i18n/pixel/events.js";ttq._i=ttq._i||{},ttq._i[e]=[],ttq._i[e]._u=i,ttq._t=ttq._t||{},ttq._t[e]=+new Date,ttq._o=ttq._o||{},ttq._o[e]=n||{};var o=document.createElement("script");o.type="text/javascript",o.async=!0,o.src=i+"?sdkid="+e+"&lib="+t;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(o,a)};
              }(window, document, 'ttq');
              ttq.load('${page_data.funnel_tiktok_id}');
              ttq.page();
              ttq.track('ViewContent'); 
                </script>
            `;
        }
        
        // RECENT: CHange the if else            
        if(page_data.funnel_everflow){
            inHeader += `
            <script type="text/javascript" src="https://www.tb42trk.com/scripts/sdk/everflow.js"></script>
            
            <script type="text/javascript">
            let event_id = "${page_data.page_keyword}"
            EF.urlParameter('oid') ? localStorage.setItem('plgoid', EF.urlParameter('oid')) : void 0;
            EF.click({
                offer_id: EF.urlParameter('oid'),
                affiliate_id: EF.urlParameter('affid'),
                transaction_id: EF.urlParameter('__ef_tid'),
                sub1: EF.urlParameter('sub1'),
                sub2: EF.urlParameter('sub2'),
                sub3: EF.urlParameter('sub3'),
                sub4: EF.urlParameter('sub4'),
                sub5: EF.urlParameter('sub5'),
                uid: EF.urlParameter('uid'),
                ${(page_data.page_type == "upsell" && page_data.page_keyword != "" ) ?
                `event_id: event_id` : ""
                }  
            });
            setTimeout(() => {
                try {
                    EF.customParamProvider.then(el => {
                         sourcePR = window.location.origin + window.location.pathname + "?effp=" + el.effp + "&transaction_id=" + (localStorage.getItem("ef_tid_c_o_" + localStorage.getItem("plgoid")) ? JSON.parse(localStorage.getItem("ef_tid_c_o_" + localStorage.getItem("plgoid"))).value : "") + "&oid=" + localStorage.getItem("plgoid") + "&amount=PLGAMOUNT" + ${page_data.page_type == "upsell" ? `"&event_id=" + event_id +` : ""} "&event_source_url="+ window.location.host + "&shopifyOrderId="
                     }) 
                 } catch (error) {
                     console.log(error)
                 }
            }, 2000)
            </script>
            `;
            
        }
        

        if(page_data.funnel_snapchat_id){
            // if user put snapchat id in funnel setting
            inHeader += `
                <script>
                    (function(win, doc, sdk_url){
                    if(win.snaptr) return;
                    var tr=win.snaptr=function(){
                    tr.handleRequest? tr.handleRequest.apply(tr, arguments):tr.queue.push(arguments);
                    };
                    tr.queue = [];
                    var s='script';
                    var new_script_section=doc.createElement(s);
                    new_script_section.async=!0;
                    new_script_section.src=sdk_url;
                    var insert_pos=doc.getElementsByTagName(s)[0];
                    insert_pos.parentNode.insertBefore(new_script_section, insert_pos);
                    })(window, document, 'https://sc-static.net/scevent.min.js');
                    snaptr('init', '${page_data.funnel_snapchat_id}', {'user_email': typeof sessionID !== "undefined" ? sessionID : ''});
                    snaptr('track','PAGE_VIEW');
                </script>
            `;
        }
        //April21
        if(page_data.funnel_header_analytics){
            inHeader += page_data.funnel_header_analytics; //June8 edited
        }
        if(page_data.page_type == "checkout" && this.state.enableLoader){
            inBody = this.exportCheckoutLoader();
        }
        if (false && this.state.page_data.funnel_enable_floating_bar && this.state.page_data.funnel_enable_floating_bar_link) { // floating bar and link
            let link = this.state.page_data.funnel_enable_floating_bar_link;
            inBody += `
                <style>
                    .floating-bar-container { position: fixed; top: 0; background-color: #313131; width: 100%; z-index: 1; }
                    .floating-bar-container img { width: 25px; height: 25px; margin-right: 5px; border-radius: 50%; }
                    .floating-bar-button {
                        width: fit-content;
                        border-radius: 20px;
                        margin: 5px;
                        padding: 3px;
                        display: flex;
                        align-items: center;
                        border: none;
                        font-size: 16px;
                        color: #fff;
                        cursor: pointer;
                        background-color: transparent;
                        -webkit-animation-name: animane;
                        -webkit-animation-duration: 1.5s;
                        -webkit-animation-iteration-count: infinite;
                        -webkit-animation-direction: alternate;
                        animation-name: animane;
                        animation-duration: 1.5s;
                        animation-iteration-count: infinite;
                        animation-direction: alternate;
                    }
                    @-webkit-keyframes floating-bar-button { 0% { background-color: transparent; } 50% { background-color: transparent; } 51% { background-color: #fd5151; } 100% { background-color: #fd5151; } }
                    @-webkit-keyframes animane { to { background-color: #fd5151; } }
                    @keyframes animane { to { background-color: #fd5151;  } }
                </style>
                <div class="floating-bar-container">
                    <button class="floating-bar-button" onclick="gotoLink()">
                        <img src="https://cdn.productlistgenie.com/images/NWM0MGM0NWU0ZjFkZmMwOTJjZDdiYzI3/1590676086769left-circular-xxl.png">
                        عرض جميع المنتجات
                    </button>
                </div>
                <script>
                    let floatingBarContainerHeight = document.querySelector(".floating-bar-container").offsetHeight;
                    document.body.style.paddingTop = floatingBarContainerHeight + "px";
                    function gotoLink(){
                        window.location.href = "${link}";
                    }
                </script>
            `;
        }
        
        if(page_data.page_type == "checkout"){
            inBody += `
                <script>
                    var isShowed = false;
                    function addAbandonmentEvent(obj, evt, fn) {
                        if (obj.addEventListener) {
                            obj.addEventListener(evt, fn, false);
                        }
                        else if (obj.attachEvent) {
                            obj.attachEvent("on" + evt, fn);
                        }
                    }
                    addAbandonmentEvent(document, 'mouseout', function(evt) {
                        if (evt.toElement == null && evt.relatedTarget == null && !isShowed) {
                            var apiKey = "${state.klaviyoPK}";
                            var cartAbandonment = "${state.cartAbandonment}";
                            var usePLGabandonment = ${page_data.funnel_use_email_abandonment};
                            var full_name = "";
                            var email = "";
                            var phone = "";
                            document.querySelectorAll('[name="firstName"]').forEach(el => {
                                if(el.value) full_name = el.value;
                            })
                            document.querySelectorAll('[name="email"]').forEach(el => {
                                if(el.value) email = el.value;
                            })
                            document.querySelectorAll('[name="phone"]').forEach(el => {
                                if(el.value) phone = el.value;
                            })
                            if(email && full_name){
                                isShowed = true;
                                if(apiKey && cartAbandonment){
                                    var url = "/send_order_confirmation?pk="+apiKey+"&ocid="+cartAbandonment+"&name="+full_name+"&email="+email+"&product="+encodeURI(plg_selectedVariant.product_name)+"&price="+plg_price+"&quantity=1&a=yes";
                                    fetch(url).then(result => {
                                        console.log("sending as abandon order success.")
                                    })
                                }
                                if(usePLGabandonment){
                                    var getRandomString = text => text + Math.floor((Math.random() * 1000000000000) + 1);
                                    var pdata = ${page_data.funnel_integration};
                                    var abandonmentPayload = {
                                        name: full_name,
                                        link: window.location.href,
                                        domain: window.location.host,
                                        productData: {
                                            name: plg_selectedVariant.product_name,
                                            variantName: plg_selectedVariant.variant_name,
                                            price: plg_selectedVariant.price,
                                            discount: ""
                                        },
                                        email: {
                                            sendToEmail: email,
                                            contentToSend: pdata.map(el => el.messageType == "Email" ? el.messageID : void 0).filter(el => el)
                                        },
                                        sms: {
                                            sendToSMS: phone,
                                            contentToSend: pdata.map(el => el.messageType == "SMS" ? el.messageID : void 0).filter(el => el)
                                        }
                                    };
                                    fetch('/send_abandonment', {
                                        method: "post",
                                        headers: {
                                            'Content-Type': 'application/json'
                                        },
                                        body: JSON.stringify(abandonmentPayload)
                                    })
                                    .then(res => console.log("success"))
                                }
                            } else {
                                console.log("no fullname and email dont do anything.")
                            }
                        }
                    });
                </script>
            `;
        }
        if(page_data.funnel_favicon_link){
            meta += `<link rel="icon" type="image/png" sizes="16x16" href="${page_data.funnel_favicon_link}">`;
        }
        let title = this.toTitleCase(page_data.page_title ? page_data.page_title : page_data.path ? page_data.path.replace(/-|_/g," ") : page_data.funnel_name.replace(/-|_/g," "));
        meta += `
            <meta name="description" content="${page_data.page_description ? page_data.page_description : title}">
            <meta name="keywords" content="${page_data.page_keyword ? page_data.page_keyword : title}">
            <title>${title}</title>
            <meta property="og:locale" content="en_US">
            <meta property="og:type" content="website">
            <meta property="og:title" content="${this.toTitleCase(page_data.path ? page_data.path.replace(/-|_/g," ") : page_data.funnel_name.replace(/-|_/g," "))}">
            <meta property="og:description" content="${page_data.page_description ? page_data.page_description : title}">
            <meta property="og:url" content="https://${page_data.page_is_root ? domain : domain + "/" + page_data.funnel_name + (page_data.path ? "/" + page_data.path : "")}">
            <meta property="og:site_name" content="${this.toTitleCase(page_data.path ? page_data.path.replace(/-|_/g," ") : page_data.funnel_name.replace(/-|_/g," "))}">
            <meta property="og:image" content="${page_data.page_og_image_link}">
            <script src="https://unpkg.com/libphonenumber-js@1.7.30/bundle/libphonenumber-max.js" defer></script>
        `;
        inFooter += `<script src="https://stats.productlistgenie.io/plg.min.js?123"></script>`;
        
        // start necessary things for modal
        inHeader += `<style>
            .updating {
                color: rgb(230, 230, 230) !important;
                background-color: #7AC943;
                -webkit-transition: background-color 700ms linear;
                -ms-transition: background-color 700ms linear;
                transition: background-color 700ms linear;
            }
            .plg_modal { display: none; position: fixed; z-index: 999; top: 0; width: calc(100% - 425px); align-items: center; margin: auto; min-height: 100%; justify-content: center; background-color: #000000c7; }
            .plg_modal .container { background-color: #e4e1e1; box-shadow: rgba(0, 0, 0, .7) 0px 6px 10px !important; display: flex; justify-content: center; align-items: center; height: 60vh; width: 60vw; overflow: auto; position: relative; }
            .plg_modal .container .row { min-width: 60%; }
            .plg_modal .blockbuilder-placeholder-empty { height: 60vh; }
            .plg_modal .container .plg_close_modal { font-size: 25px; line-height: 1; position: absolute; top: 10px; right: 10px; cursor: pointer; color: #373a3c; text-shadow: 0px 0px 2px #fff; }
            @media screen and (max-width: 992px) {
                .plg_modal .container { height: 80vh; width: 80vw; }
                .plg_modal .container .row { min-width: 80%; }
            }
            @media screen and (max-width: 600px) {
                .plg_modal .container { height: 90vh; width: 90vw; }
                .plg_modal .container .row { min-width: 90%; }
            }
        </style>`;
        if(state.selectedModalAction) {
            inHeader += `
                <script>
                    function toggleModal(selector){
                        var modal = document.querySelector('.plg_modal');
                        if(selector) document.querySelector(selector);
                        modal.querySelector(".row").style.height = "100%";
                        if(modal) {
                            if(modal.style.display == "flex") modal.style.cssText='display: none; width: 100%;';
                            else modal.style.cssText='display: flex; width: 100%;';
                            modal.onclick = (e) => {
                                if(e.target == modal){
                                    modal.style.cssText='display: none; width: 100%;';
                                }
                            };
                            addCloseButton(modal, selector);
                        } else {
                            setTimeout(() => toggleModal(selector), 1000); // recheck again after 1 second
                        }
                    }
                    function addCloseButton(mcontainer, selector) {
                        let hasClose = mcontainer.querySelector(".plg_close_modal");
                        if(!hasClose) {
                            let xBtn = document.createElement("span");
                            xBtn.classList.add("plg_close_modal");
                            xBtn.innerHTML = "&times;";
                            xBtn.onclick = () => toggleModal(selector);
                            mcontainer.querySelector(".container").appendChild(xBtn);
                        }
                    }
                </script>
            `;
            if(state.selectedModalAction === "onload") {
                inHeader += "<script>toggleModal();</script>";
            } else if(state.selectedModalAction == "onexit") {
                inHeader += `
                    <script>
                        var _isShowed = false;
                        function addOnExitEvent(obj, evt, fn) {
                            if (obj.addEventListener) {
                                obj.addEventListener(evt, fn, false);
                            }
                            else if (obj.attachEvent) {
                                obj.attachEvent("on" + evt, fn);
                            }
                        }
                        addOnExitEvent(document, 'mouseout', function(evt) {
                            if (evt.toElement == null && evt.relatedTarget == null && !_isShowed) {
                                toggleModal();
                                _isShowed = true;   
                            }
                        });
                        // for mobile exit intent
                        if(/Mobi/i.test(navigator.userAgent) || /Android/i.test(navigator.userAgent)) {
                            // for switching tab
                            document.addEventListener("visibilitychange", function() {
                                if(!document.hidden && !_isShowed) {
                                    toggleModal();
                                    _isShowed = true;
                                }
                            });
                            // for hitting back button
                            let exitHandler = () => {
                                if(!_isShowed) {
                                    // window.history.forward();
                                    toggleModal();
                                    _isShowed = true;
                                    setTimeout(() => {
                                        window.addEventListener('popstate', exitHandler, { once: true });
                                    }, 50);
                                } else {
                                    window.history.back();
                                }
                            }
                            window.addEventListener('popstate', exitHandler, { once: true });
                            window.history.pushState(null, null, null);
                        }
                    </script>
                `;
            }
        }
        // end necessary things for modal
        // start pang samantagal hide ng button sa floating container
        inFooter += `
            <script>
                let targetDOM = document.querySelectorAll(".cod-form > button, #cod_paymentForm button, .authorize-form button, .paypal-form button, .stripe-form button");
                let hideButton = document.querySelectorAll('.plg_hide button');
                let isShowInScroll = false, isNotShowInScroll = false;
                if(hideButton.length !== 0) {
                    window.addEventListener('scroll', function(){
                        let isVisible = isScrolledIntoViews(targetDOM);
                        if(isVisible && !isShowInScroll) {
                            isShowInScroll = true;
                            isNotShowInScroll = false;
                            hideButton.forEach(btn => {
                                btn.style.transition = 'opacity 1s linear 0s';
                                btn.style.opacity = 0;
                            });
                        } else if(!isVisible && !isNotShowInScroll) {
                            isShowInScroll = false;
                            isNotShowInScroll = true;
                            hideButton.forEach(btn => {
                                btn.style.transition = 'opacity 1s linear 0s';
                                btn.style.opacity = 1;
                            });
                        }
                    });
                    function isScrolledIntoViews(els) { // multiple
                        let isFound = false;
                        for(let i = 0; i < els.length; i++) {
                            let el = els[i];
                            let rect = el.getBoundingClientRect();
                            let elemTop = rect.top;
                            let elemBottom = rect.bottom;
                            isFound = (elemTop >= 0) && (elemBottom <= window.innerHeight);
                            if(isFound) break;
                        };
                        return isFound;
                    }
                }
            </script>
        `;
        // end pang samantagal hide ng button sa floating container
        this.exportPage(inHeader, meta, inBody, inFooter, () => {
            var websiteURL = "https://" + domain + "/" + page_data.funnel_name + (page_data.path ? "/" + page_data.path : "");
            // if this page is set as root
            if(page_data.page_is_root){
                websiteURL = "https://" + domain
            }
            if(page_data.split_design) { // if has active split design
                if(this.props.location.state.splitEdit) websiteURL += "?p=b"; // if page b of split page
                else websiteURL += "?p=a"; // if page a of split page or normal page
            }
            var payload = { url: websiteURL };
            if (dontUpload) {
                this.setState({
                    isPublish: false
                }, () => {
                    updateFunnelPageList().then(({ data }) => {
                        this.setState({ isSaving: false });
                        points.toastrPrompt(toastr, "success", "Page saved successfully", "");
                    }).catch(error => {
                        this.setState({ isSaving: false });
                        toastr.clear();
                        toastr.warning(error.graphQLErrors[0].message, "An Error has occurred!");
                    });
                })
            } else {
                this.uploadHTML(data => {
                    if (data) {
                        this.setState({ pageID: data.data.addPage ? data.data.addPage.id : data.data.updatePage.id, isPublish: true }, () => {
                            points.customFetch("/getScreenshot","post", payload, result => {
                                this.setState({ screenshotFileName: result ? result.url : "" }, () => {
                                    updateFunnelPageList().then(({ data }) => {
                                        this.setState({ isSaving: false });
                                        if(!resolve){
                                            toastr.clear();
                                            toastr.options.onclick = function () {
                                                window.open(websiteURL, '_blank');
                                                toastr.clear();
                                            }
                                            toastr.success("Click here to view.", "Page saved successfully!");
                                        } else {
                                            resolve();
                                        }
                                    }).catch(error => {
                                        this.setState({ isSaving: false });
                                        toastr.clear();
                                        toastr.warning(error.graphQLErrors[0].message, "An Error has occurred!");
                                        if(resolve) this.hide_show_loading();
                                    });
                                })
                            })
                        })
                    } else {
                        this.setState({ isSaving: false });
                        toastr.clear();
                        toastr.warning("The domain cannot return the page id.", "Please contact admin.");
                    }
                });
            }
        });
    }

    escapeHtml(unsafe) {
        return unsafe//.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
    }

    inject_iframe(callback){
        callback();
        // if(this.state.page_data.page_type != "thank-you-page") {
        //     callback();
        // } else {
        //     unlayer.exportHtml(data => {
        //         let obj = data.design;
        //         obj.counters.u_content_html = (obj.counters.u_content_html ? obj.counters.u_content_html : 0) + 1
        //         obj.counters.u_row = obj.counters.u_row + 1
        //         obj.counters.u_column = obj.counters.u_column + 1
        //         let last_row = obj.body.rows[obj.body.rows.length-1];
        //         if(last_row.values._meta.htmlClassNames.includes("plg_modal")) {
        //             last_row = obj.body.rows[obj.body.rows.length-2];
        //         }
        //         if(!last_row.values._meta.htmlClassNames.includes("u_content_yala_genie")) { // kapag wla pang iframe
        //             let values = {
        //                 ...last_row.values,
        //                 _meta: {
        //                     htmlID: "u_row_"+obj.counters.u_row,
        //                     htmlClassNames: "u_row u_content_yala_genie"
        //                 },
        //                 // selectable: false,
        //                 // draggable: false,
        //                 // deletable: false,
        //             };
        //             obj.body.rows.push({
        //                 cells: [1],
        //                 columns: [{
        //                     contents: [{
        //                         type: "html",
        //                         slug: undefined,
        //                         values: {
        //                             _meta: {
        //                                 htmlID: "u_content_html_"+obj.counters.u_content_html,
        //                                 htmlClassNames: "u_content_html"
        //                             },
        //                             // selectable: false,
        //                             // draggable: false,
        //                             // deletable: false,
        //                             html: "<iframe src=\"\" style=\"width: 100%; border: 0;\" scrolling=\"no\"></iframe> <script> let iframe = document.querySelector(\".u_content_yala_genie iframe\"); let cod_currency = JSON.parse(localStorage.getItem(\"cod_currency\")); if(cod_currency) iframe.src = \"https://yalagenie.com/thank-you/\"+cod_currency.code.toLowerCase(); iframe.onload = function(){ iframe.height = iframe.contentDocument.body.offsetHeight + 200; } </script>"
        //                         }
        //                     }],
        //                     values: {
        //                         ...last_row.columns[last_row.columns.length-1].values,
        //                         border: {},
        //                         htmlID: "u_column_"+obj.counters.u_column,
        //                         htmlClassNames: "u_column"
        //                     }
        //                 }],
        //                 values: values
        //             })
        //             unlayer.loadDesign(obj);
        //             setTimeout(callback, 200);
        //         } else callback()
        //     })
        // }
    }

    exportPage(replaceByInHeader, replaceByMeta, replaceByInBody, replaceByInFooter, callback) {
        // start experimentation to inject iframe in design
        this.inject_iframe(proceed);
        // end experimentation to inject iframe in design

        var self = this;

        function proceed() {
            unlayer.exportHtml(function (data) {
                var json = data.design;
                var html = data.html;
                html = html.replace("<!--[**analytics**]-->", replaceByInHeader);
                html = html.replace("<!--[**meta**]-->", replaceByMeta);
                html = html.replace("<!--[**checkoutloader**]-->", replaceByInBody);
                html = html.replace(/\[funnel_name\]/g, "/"+self.state.page_data.funnel_name);
                html = html.replace("<\/body>", replaceByInFooter+"</body>");
                var regex = new RegExp('href="'+self.state.page_data.funnel_name,"g")
                html = html.replace(regex, 'href="/'+self.state.page_data.funnel_name)
    
                self.setState({ saveAsJSON: json, saveAsHTML: self.escapeHtml(self.changeWordTemplate(html)) }, () => callback())
            })
        }
    }

    hasNoPlgSku() {
        if (typeof unlayer !== "undefined" && this.state.page_data.is_fulfill_by_plg && this.state.page_data.page_type === "checkout") {
            let self = this, no_sku = false;
            unlayer.exportHtml(data => {
                data.design.body.rows.forEach(row => {
                    row.columns.forEach(column => {
                        column.contents.forEach(content => {
                            if(content.type === "variant") {
                                let content_value = JSON.parse(content.values.variants);
                                if (!no_sku) no_sku = content_value.filter(e => !e.variant_sku).length !== 0; // change to true if has result for filter of no sku
                            } else if (content.type === "multi_variants") {
                                let content_value = JSON.parse(content.values.multi_variants);
                                let keys = Object.keys(content_value).filter(e => e !== "selected_iso2");
                                keys.forEach(key => {
                                    let val = content_value[key];
                                    if (val.variants.length !== 0 && !no_sku) { // yung country na na setup na ang variant 
                                        no_sku = val.variants.filter(e => !e.sku).length !== 0; // change to true if has result for filter of no sku
                                    }
                                })
                            }
                        });
                    });
                });
                self.setState({ show_approve_button: no_sku });
            });
        }
    }

    head() {
        return (
            <Helmet bodyAttributes={{ class: "dashboardPage" }}>
                <title>Funnel Genie (DEV) - Product List Genie</title>
            </Helmet>
        );
    }

    render() {
        var state = this.state;
        var currentUser = this.props.session.getCurrentUser;
        var page_data = this.state.page_data;
        if (page_data) {
            const designLastObject = page_data.design.length != 0 ? page_data.design[page_data.design.length-1] : null;
            var ss = "";
            if(state.screenshotFileName) {
                ss = state.screenshotFileName;
            } else if(designLastObject && designLastObject.screenshot_url) {
                ss = designLastObject.screenshot_url;
            }
            return (
                <div>
                    {this.head()}
                    <Mutation
                        mutation={UPDATE_FUNNELGENIE_PAGE_SETTING}
                        variables={{
                            funnel_id: state.page_data.funnel_id,
                            page_id: state.selectedPageID,
                            published_page_id: state.pageID ? state.pageID : page_data.published_page_id,
                            page_enable_loader: state.enableLoader,
                            page_selected_modal_action: state.selectedModalAction,
                            is_publish: state.isPublish,
                            design_json: JSON.stringify(state.saveAsJSON),
                            design_screenshot: ss,
                            is_split_edit: this.props.location.state.splitEdit ? true : false,
                            source: "editor"
                        }} >
                        {(updateFunnelPageList, { data, loading, error }) => {
                            return (
                                <Header headerActions={{
                                    goBackLink: "/funnel-genie-pages-list/"+page_data.funnel_id,
                                    save: () => this.updateFunnelPageList(updateFunnelPageList, true),
                                    saveAndPublish: () => this.updateFunnelPageList(updateFunnelPageList),
                                    publishAllPages: () => this.publishAllPages(updateFunnelPageList),
                                    // enable loader
                                    pageType: page_data.page_type,
                                    enableLoader: state.enableLoader,
                                    enableCheckoutLoaderAction: action => {
                                        this.setState({ enableLoader: action })
                                    },
                                    // change log
                                    changeLogIndex: state.selectedIndex,
                                    changeLogData: page_data.design,
                                    changeLogAction: (indexValue) => {
                                        this.setState({ selectedIndex: parseInt(indexValue) }, () => this.changeSelectedIndex())
                                    },
                                    // page list
                                    pageSelected: state.selectedPageID,
                                    pageList: this.props.location.state.pageList,
                                    changeSelectedPage: id => {
                                        this.setState({ selectedPageID: id, isPageFullyLoaded: false }, () => this.loadThisPage(id))
                                    },
                                    splitEdit: this.props.location.state.splitEdit,
                                    actionSelected: state.selectedModalAction || "",
                                    changeSelectedAction: action => {
                                        this.setState({ selectedModalAction: action })
                                    },
                                    page_data: state.page_data,
                                    isPageFullyLoaded: state.isPageFullyLoaded
                                }} />
                            );
                        }}
                    </Mutation>
                    <div id="editor" />
                    {state.show_approve_button &&
                        <div className="funnel">
                            <button className="btn-success" onClick={() => this.setState({ show_approve_modal: true })} style={{ position: "fixed", bottom: 10, left: 10 }}>Approve my product</button>
                        </div>
                    }
                    {state.show_approve_modal &&
                        <Modal open={state.show_approve_modal} closeModal={() => this.setState({ show_approve_modal: false })} style={{ borderTop: "5px solid #23c78a", borderRadius: 10, padding: 0, width: "30%", height: 400 }}>
                            <div className="funnel">
                                <style dangerouslySetInnerHTML={{ __html: `.popup-content .content {padding: 0px;}` }} />
                                <div className="modal-header">
                                    <h4 className="header">Approve my Product</h4>
                                </div>
                                <div className="page-container">
                                <div style={{
                                            fontSize: "12px",
                                            fontStyle: "italic",
                                            paddingBottom: "10px"
                                        }}>
                                        Please no more than a kilo, not too wide or long or shipping price goes up 3-5 times.
                                            <br />
                                        No product that touches skin or health related as we have strict rules in the Middle East
                                        </div>         
                                    <Mutation mutation={SEND_MESSAGE} variables={{ sender_id: currentUser.id, funnel_id: state.page_data.funnel_id, page_id: state.page_data.id, product_link: state.product_link }} >
                                        {(sendMessage, { data, loading, error }) => {
                                            return (
                                                <form className="form" onSubmit={event => {
                                                    event.preventDefault();
                                                    points.executeMutation(sendMessage, toastr, () => {
                                                        points.toastrPrompt(toastr, "success", "Product has been requested. Please wait for the fulfiller to respond to your notification", "Success");
                                                        this.setState({ show_approve_modal: false, show_approve_button: false });
                                                    });
                                                }}>
                                                    <label className="header-medium-bold row-separator">Funnel Name</label>
                                                    <Input className="stretch-width" value={points.presentableFunnelName(state.page_data.funnel_name)} readOnly />
                                                    <label className="header-medium-bold row-separator">Page Name</label>
                                                    <Input className="stretch-width" value={points.presentableFunnelName(state.page_data.path || "homepage")} readOnly />
                                                    <label className="header-medium-bold row-separator">Amazon or Aliexpress Product Link</label>
                                                    <Input className="stretch-width" name="product_link" value={state.product_link} onChange={event => this.setState({ [event.name]: event.value })} required />
                                                    <button className="btn-success stretch-width" type="submit" disabled={loading}>Submit</button>
                                                </form>
                                            );
                                        }}
                                    </Mutation>
                                </div>
                            </div>
                        </Modal>
                    }
                </div>
            );
        } else {
            return (
                <div className="center-vertical">
                    <Loading height={200} width={200} />
                </div>
            )
        }
    }
}

export default withAuth(session => session && session.getCurrentUser)(FunnelGenieDEV);